{"version":3,"names":["useRef","GroupChannelListOrder","confirmAndMarkAsDelivered","useAsyncEffect","useFreshCallback","useAppFeatures","useChannelHandler","useGroupChannelListReducer","HOOK_NAME","createGroupChannelListQuery","sdk","queryCreator","passedQuery","groupChannel","createMyGroupChannelListQuery","includeEmpty","limit","order","LATEST_LAST_MESSAGE","useGroupChannelListWithQuery","userId","options","deliveryReceiptEnabled","queryRef","loading","groupChannels","refreshing","updateChannels","setChannels","deleteChannels","updateRefreshing","updateLoading","updateOrder","updateChannelsAndMarkAsDelivered","channels","init","uid","current","hasNext","next","onChannelChanged","channel","onChannelFrozen","onChannelUnfrozen","onChannelMemberCountChanged","onChannelDeleted","url","onUserJoined","onUserLeft","user","isMe","onUserBanned","onMessageReceived","refresh"],"sources":["useGroupChannelListWithQuery.ts"],"sourcesContent":["import { useRef } from 'react';\n\nimport { GroupChannelListOrder } from '@sendbird/chat/groupChannel';\nimport type { SendbirdChannel, SendbirdChatSDK, SendbirdGroupChannelListQuery } from '@sendbird/uikit-utils';\nimport { confirmAndMarkAsDelivered, useAsyncEffect, useFreshCallback } from '@sendbird/uikit-utils';\n\nimport { useAppFeatures } from '../../common/useAppFeatures';\nimport { useChannelHandler } from '../../handler/useChannelHandler';\nimport type { UseGroupChannelList, UseGroupChannelListOptions } from '../../types';\nimport { useGroupChannelListReducer } from './reducer';\n\nconst HOOK_NAME = 'useGroupChannelListWithQuery';\n\nconst createGroupChannelListQuery = (\n  sdk: SendbirdChatSDK,\n  queryCreator: UseGroupChannelListOptions['queryCreator'],\n) => {\n  const passedQuery = queryCreator?.();\n  if (passedQuery) return passedQuery;\n\n  return sdk.groupChannel.createMyGroupChannelListQuery({\n    includeEmpty: false,\n    limit: 20,\n    order: GroupChannelListOrder.LATEST_LAST_MESSAGE,\n  });\n};\n\nexport const useGroupChannelListWithQuery: UseGroupChannelList = (sdk, userId, options) => {\n  const { deliveryReceiptEnabled } = useAppFeatures(sdk);\n  const queryRef = useRef<SendbirdGroupChannelListQuery>();\n\n  const {\n    loading,\n    groupChannels,\n    refreshing,\n    updateChannels,\n    setChannels,\n    deleteChannels,\n    updateRefreshing,\n    updateLoading,\n    updateOrder,\n  } = useGroupChannelListReducer();\n\n  const updateChannelsAndMarkAsDelivered = (channels: SendbirdChannel[]) => {\n    updateChannels(channels);\n    if (deliveryReceiptEnabled) confirmAndMarkAsDelivered(channels);\n  };\n\n  const init = useFreshCallback(async (uid?: string) => {\n    if (uid) {\n      queryRef.current = createGroupChannelListQuery(sdk, options?.queryCreator);\n      updateOrder(queryRef.current?.order);\n\n      if (queryRef.current?.hasNext) {\n        const channels = await queryRef.current.next();\n\n        setChannels(channels, true);\n        if (deliveryReceiptEnabled) confirmAndMarkAsDelivered(channels);\n      }\n    }\n  });\n\n  useAsyncEffect(async () => {\n    updateLoading(true);\n    await init(userId);\n    updateLoading(false);\n  }, [init, userId]);\n\n  useChannelHandler(sdk, HOOK_NAME, {\n    onChannelChanged: (channel) => updateChannels([channel]),\n    onChannelFrozen: (channel) => updateChannels([channel]),\n    onChannelUnfrozen: (channel) => updateChannels([channel]),\n    onChannelMemberCountChanged: (channels) => updateChannels(channels),\n    onChannelDeleted: (url) => deleteChannels([url]),\n    onUserJoined: (channel) => updateChannels([channel]),\n    onUserLeft: (channel, user) => {\n      const isMe = user.userId === userId;\n      if (isMe) deleteChannels([channel.url]);\n      else updateChannels([channel]);\n    },\n    onUserBanned(channel, user) {\n      const isMe = user.userId === userId;\n      if (isMe) deleteChannels([channel.url]);\n      else updateChannels([channel]);\n    },\n    onMessageReceived(channel) {\n      updateChannelsAndMarkAsDelivered([channel]);\n    },\n  });\n\n  const refresh = useFreshCallback(async () => {\n    updateRefreshing(true);\n    await init(userId);\n    updateRefreshing(false);\n  });\n\n  const next = useFreshCallback(async () => {\n    if (queryRef.current?.hasNext) {\n      const channels = await queryRef.current.next();\n      setChannels(channels, false);\n      if (deliveryReceiptEnabled) confirmAndMarkAsDelivered(channels);\n    }\n  });\n\n  return {\n    loading,\n    groupChannels,\n    refresh,\n    refreshing,\n    next,\n  };\n};\n"],"mappings":"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"}