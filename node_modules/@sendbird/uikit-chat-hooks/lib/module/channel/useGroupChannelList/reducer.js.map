{"version":3,"names":["useReducer","getGroupChannels","defaultReducer","action","draft","compareByOrder","createCompareByOrder","order","type","key","value","status","channels","forEach","freshChannel","idx","groupChannels","findIndex","staleChannel","url","sort","channelUrls","c","splice","clearPrev","useGroupChannelListReducer","loading","refreshing","dispatch","updateChannels","deleteChannels","setChannels","updateLoading","updateRefreshing","updateOrder","undefined","channel1","channel2","lastMessage","createdAt","name","localeCompare"],"sources":["reducer.ts"],"sourcesContent":["import { useReducer } from 'react';\n\nimport type { SendbirdChannel } from '@sendbird/uikit-utils';\nimport { SendbirdGroupChannel, getGroupChannels } from '@sendbird/uikit-utils';\n\ntype Order = 'latest_last_message' | 'chronological' | 'channel_name_alphabetical' | 'metadata_value_alphabetical';\n\ntype Action =\n  | {\n      type: 'update_loading' | 'update_refreshing';\n      value: { status: boolean };\n    }\n  | {\n      type: 'update_channels';\n      value: { channels: SendbirdChannel[] };\n    }\n  | {\n      type: 'delete_channels';\n      value: { channelUrls: string[] };\n    }\n  | {\n      type: 'set_channels';\n      value: { channels: SendbirdChannel[]; clearPrev: boolean };\n    }\n  | {\n      type: 'update_order';\n      value: { order?: Order };\n    };\n\ntype State = {\n  loading: boolean;\n  refreshing: boolean;\n  groupChannels: SendbirdGroupChannel[];\n  order?: Order;\n};\n\nconst defaultReducer = ({ ...draft }: State, action: Action) => {\n  const compareByOrder = createCompareByOrder(draft.order);\n\n  switch (action.type) {\n    case 'update_refreshing':\n    case 'update_loading': {\n      const key = action.type === 'update_loading' ? 'loading' : 'refreshing';\n      draft[key] = action.value.status;\n      break;\n    }\n    case 'update_channels': {\n      getGroupChannels(action.value.channels).forEach((freshChannel) => {\n        const idx = draft.groupChannels.findIndex((staleChannel) => staleChannel.url === freshChannel.url);\n        if (idx > -1) draft.groupChannels[idx] = freshChannel;\n      });\n\n      compareByOrder && (draft.groupChannels = draft.groupChannels.sort(compareByOrder));\n      break;\n    }\n    case 'delete_channels': {\n      action.value.channelUrls.forEach((url) => {\n        const idx = draft.groupChannels.findIndex((c) => c.url === url);\n        if (idx > -1) draft.groupChannels.splice(idx, 1);\n      });\n\n      compareByOrder && (draft.groupChannels = draft.groupChannels.sort(compareByOrder));\n      break;\n    }\n    case 'set_channels': {\n      if (action.value.clearPrev) {\n        draft.groupChannels = getGroupChannels(action.value.channels);\n      } else {\n        draft.groupChannels = [...draft.groupChannels, ...getGroupChannels(action.value.channels)];\n      }\n\n      compareByOrder && (draft.groupChannels = draft.groupChannels.sort(compareByOrder));\n      break;\n    }\n    case 'update_order': {\n      draft.order = action.value.order;\n      break;\n    }\n  }\n  return draft;\n};\n\nexport const useGroupChannelListReducer = (order?: Order) => {\n  const [{ loading, refreshing, groupChannels }, dispatch] = useReducer(defaultReducer, {\n    loading: true,\n    refreshing: false,\n    groupChannels: [],\n    order,\n  });\n\n  const updateChannels = (channels: SendbirdChannel[]) => {\n    dispatch({ type: 'update_channels', value: { channels } });\n  };\n  const deleteChannels = (channelUrls: string[]) => {\n    dispatch({ type: 'delete_channels', value: { channelUrls } });\n  };\n  const setChannels = (channels: SendbirdChannel[], clearPrev: boolean) => {\n    dispatch({ type: 'set_channels', value: { channels, clearPrev } });\n  };\n  const updateLoading = (status: boolean) => {\n    dispatch({ type: 'update_loading', value: { status } });\n  };\n  const updateRefreshing = (status: boolean) => {\n    dispatch({ type: 'update_refreshing', value: { status } });\n  };\n  const updateOrder = (order?: Order) => {\n    dispatch({ type: 'update_order', value: { order } });\n  };\n\n  return {\n    updateLoading,\n    updateRefreshing,\n    updateChannels,\n    deleteChannels,\n    setChannels,\n\n    updateOrder,\n\n    loading,\n    refreshing,\n    groupChannels,\n  };\n};\n\nconst createCompareByOrder = (order?: Order) => {\n  if (!order) return undefined;\n\n  return (channel1: SendbirdGroupChannel, channel2: SendbirdGroupChannel): number => {\n    switch (order) {\n      case 'latest_last_message': {\n        if (channel1.lastMessage && channel2.lastMessage) {\n          return channel2.lastMessage.createdAt - channel1.lastMessage.createdAt;\n        } else if (channel1.lastMessage) {\n          return -1;\n        } else if (channel2.lastMessage) {\n          return 1;\n        } else {\n          return channel2.createdAt - channel1.createdAt;\n        }\n      }\n\n      case 'chronological': {\n        return channel2.createdAt - channel1.createdAt;\n      }\n\n      case 'channel_name_alphabetical': {\n        return channel1.name.localeCompare(channel2.name);\n      }\n      default: {\n        return 0;\n      }\n    }\n  };\n};\n"],"mappings":"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"}