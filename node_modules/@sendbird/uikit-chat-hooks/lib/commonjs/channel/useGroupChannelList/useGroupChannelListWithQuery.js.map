{"version":3,"names":["HOOK_NAME","createGroupChannelListQuery","sdk","queryCreator","passedQuery","groupChannel","createMyGroupChannelListQuery","includeEmpty","limit","order","GroupChannelListOrder","LATEST_LAST_MESSAGE","useGroupChannelListWithQuery","userId","options","deliveryReceiptEnabled","useAppFeatures","queryRef","useRef","loading","groupChannels","refreshing","updateChannels","setChannels","deleteChannels","updateRefreshing","updateLoading","updateOrder","useGroupChannelListReducer","updateChannelsAndMarkAsDelivered","channels","confirmAndMarkAsDelivered","init","useFreshCallback","uid","current","hasNext","next","useAsyncEffect","useChannelHandler","onChannelChanged","channel","onChannelFrozen","onChannelUnfrozen","onChannelMemberCountChanged","onChannelDeleted","url","onUserJoined","onUserLeft","user","isMe","onUserBanned","onMessageReceived","refresh"],"sources":["useGroupChannelListWithQuery.ts"],"sourcesContent":["import { useRef } from 'react';\n\nimport { GroupChannelListOrder } from '@sendbird/chat/groupChannel';\nimport type { SendbirdChannel, SendbirdChatSDK, SendbirdGroupChannelListQuery } from '@sendbird/uikit-utils';\nimport { confirmAndMarkAsDelivered, useAsyncEffect, useFreshCallback } from '@sendbird/uikit-utils';\n\nimport { useAppFeatures } from '../../common/useAppFeatures';\nimport { useChannelHandler } from '../../handler/useChannelHandler';\nimport type { UseGroupChannelList, UseGroupChannelListOptions } from '../../types';\nimport { useGroupChannelListReducer } from './reducer';\n\nconst HOOK_NAME = 'useGroupChannelListWithQuery';\n\nconst createGroupChannelListQuery = (\n  sdk: SendbirdChatSDK,\n  queryCreator: UseGroupChannelListOptions['queryCreator'],\n) => {\n  const passedQuery = queryCreator?.();\n  if (passedQuery) return passedQuery;\n\n  return sdk.groupChannel.createMyGroupChannelListQuery({\n    includeEmpty: false,\n    limit: 20,\n    order: GroupChannelListOrder.LATEST_LAST_MESSAGE,\n  });\n};\n\nexport const useGroupChannelListWithQuery: UseGroupChannelList = (sdk, userId, options) => {\n  const { deliveryReceiptEnabled } = useAppFeatures(sdk);\n  const queryRef = useRef<SendbirdGroupChannelListQuery>();\n\n  const {\n    loading,\n    groupChannels,\n    refreshing,\n    updateChannels,\n    setChannels,\n    deleteChannels,\n    updateRefreshing,\n    updateLoading,\n    updateOrder,\n  } = useGroupChannelListReducer();\n\n  const updateChannelsAndMarkAsDelivered = (channels: SendbirdChannel[]) => {\n    updateChannels(channels);\n    if (deliveryReceiptEnabled) confirmAndMarkAsDelivered(channels);\n  };\n\n  const init = useFreshCallback(async (uid?: string) => {\n    if (uid) {\n      queryRef.current = createGroupChannelListQuery(sdk, options?.queryCreator);\n      updateOrder(queryRef.current?.order);\n\n      if (queryRef.current?.hasNext) {\n        const channels = await queryRef.current.next();\n\n        setChannels(channels, true);\n        if (deliveryReceiptEnabled) confirmAndMarkAsDelivered(channels);\n      }\n    }\n  });\n\n  useAsyncEffect(async () => {\n    updateLoading(true);\n    await init(userId);\n    updateLoading(false);\n  }, [init, userId]);\n\n  useChannelHandler(sdk, HOOK_NAME, {\n    onChannelChanged: (channel) => updateChannels([channel]),\n    onChannelFrozen: (channel) => updateChannels([channel]),\n    onChannelUnfrozen: (channel) => updateChannels([channel]),\n    onChannelMemberCountChanged: (channels) => updateChannels(channels),\n    onChannelDeleted: (url) => deleteChannels([url]),\n    onUserJoined: (channel) => updateChannels([channel]),\n    onUserLeft: (channel, user) => {\n      const isMe = user.userId === userId;\n      if (isMe) deleteChannels([channel.url]);\n      else updateChannels([channel]);\n    },\n    onUserBanned(channel, user) {\n      const isMe = user.userId === userId;\n      if (isMe) deleteChannels([channel.url]);\n      else updateChannels([channel]);\n    },\n    onMessageReceived(channel) {\n      updateChannelsAndMarkAsDelivered([channel]);\n    },\n  });\n\n  const refresh = useFreshCallback(async () => {\n    updateRefreshing(true);\n    await init(userId);\n    updateRefreshing(false);\n  });\n\n  const next = useFreshCallback(async () => {\n    if (queryRef.current?.hasNext) {\n      const channels = await queryRef.current.next();\n      setChannels(channels, false);\n      if (deliveryReceiptEnabled) confirmAndMarkAsDelivered(channels);\n    }\n  });\n\n  return {\n    loading,\n    groupChannels,\n    refresh,\n    refreshing,\n    next,\n  };\n};\n"],"mappings":";;;;;;;AAAA;;AAEA;;AAEA;;AAEA;;AACA;;AAEA;;AAEA,MAAMA,SAAS,GAAG,8BAAlB;;AAEA,MAAMC,2BAA2B,GAAG,CAClCC,GADkC,EAElCC,YAFkC,KAG/B;EACH,MAAMC,WAAW,GAAGD,YAAH,aAAGA,YAAH,uBAAGA,YAAY,EAAhC;EACA,IAAIC,WAAJ,EAAiB,OAAOA,WAAP;EAEjB,OAAOF,GAAG,CAACG,YAAJ,CAAiBC,6BAAjB,CAA+C;IACpDC,YAAY,EAAE,KADsC;IAEpDC,KAAK,EAAE,EAF6C;IAGpDC,KAAK,EAAEC,mCAAA,CAAsBC;EAHuB,CAA/C,CAAP;AAKD,CAZD;;AAcO,MAAMC,4BAAiD,GAAG,CAACV,GAAD,EAAMW,MAAN,EAAcC,OAAd,KAA0B;EACzF,MAAM;IAAEC;EAAF,IAA6B,IAAAC,8BAAA,EAAed,GAAf,CAAnC;EACA,MAAMe,QAAQ,GAAG,IAAAC,aAAA,GAAjB;EAEA,MAAM;IACJC,OADI;IAEJC,aAFI;IAGJC,UAHI;IAIJC,cAJI;IAKJC,WALI;IAMJC,cANI;IAOJC,gBAPI;IAQJC,aARI;IASJC;EATI,IAUF,IAAAC,mCAAA,GAVJ;;EAYA,MAAMC,gCAAgC,GAAIC,QAAD,IAAiC;IACxER,cAAc,CAACQ,QAAD,CAAd;IACA,IAAIf,sBAAJ,EAA4B,IAAAgB,qCAAA,EAA0BD,QAA1B;EAC7B,CAHD;;EAKA,MAAME,IAAI,GAAG,IAAAC,4BAAA,EAAiB,MAAOC,GAAP,IAAwB;IACpD,IAAIA,GAAJ,EAAS;MAAA;;MACPjB,QAAQ,CAACkB,OAAT,GAAmBlC,2BAA2B,CAACC,GAAD,EAAMY,OAAN,aAAMA,OAAN,uBAAMA,OAAO,CAAEX,YAAf,CAA9C;MACAwB,WAAW,sBAACV,QAAQ,CAACkB,OAAV,sDAAC,kBAAkB1B,KAAnB,CAAX;;MAEA,0BAAIQ,QAAQ,CAACkB,OAAb,+CAAI,mBAAkBC,OAAtB,EAA+B;QAC7B,MAAMN,QAAQ,GAAG,MAAMb,QAAQ,CAACkB,OAAT,CAAiBE,IAAjB,EAAvB;QAEAd,WAAW,CAACO,QAAD,EAAW,IAAX,CAAX;QACA,IAAIf,sBAAJ,EAA4B,IAAAgB,qCAAA,EAA0BD,QAA1B;MAC7B;IACF;EACF,CAZY,CAAb;EAcA,IAAAQ,0BAAA,EAAe,YAAY;IACzBZ,aAAa,CAAC,IAAD,CAAb;IACA,MAAMM,IAAI,CAACnB,MAAD,CAAV;IACAa,aAAa,CAAC,KAAD,CAAb;EACD,CAJD,EAIG,CAACM,IAAD,EAAOnB,MAAP,CAJH;EAMA,IAAA0B,oCAAA,EAAkBrC,GAAlB,EAAuBF,SAAvB,EAAkC;IAChCwC,gBAAgB,EAAGC,OAAD,IAAanB,cAAc,CAAC,CAACmB,OAAD,CAAD,CADb;IAEhCC,eAAe,EAAGD,OAAD,IAAanB,cAAc,CAAC,CAACmB,OAAD,CAAD,CAFZ;IAGhCE,iBAAiB,EAAGF,OAAD,IAAanB,cAAc,CAAC,CAACmB,OAAD,CAAD,CAHd;IAIhCG,2BAA2B,EAAGd,QAAD,IAAcR,cAAc,CAACQ,QAAD,CAJzB;IAKhCe,gBAAgB,EAAGC,GAAD,IAAStB,cAAc,CAAC,CAACsB,GAAD,CAAD,CALT;IAMhCC,YAAY,EAAGN,OAAD,IAAanB,cAAc,CAAC,CAACmB,OAAD,CAAD,CANT;IAOhCO,UAAU,EAAE,CAACP,OAAD,EAAUQ,IAAV,KAAmB;MAC7B,MAAMC,IAAI,GAAGD,IAAI,CAACpC,MAAL,KAAgBA,MAA7B;MACA,IAAIqC,IAAJ,EAAU1B,cAAc,CAAC,CAACiB,OAAO,CAACK,GAAT,CAAD,CAAd,CAAV,KACKxB,cAAc,CAAC,CAACmB,OAAD,CAAD,CAAd;IACN,CAX+B;;IAYhCU,YAAY,CAACV,OAAD,EAAUQ,IAAV,EAAgB;MAC1B,MAAMC,IAAI,GAAGD,IAAI,CAACpC,MAAL,KAAgBA,MAA7B;MACA,IAAIqC,IAAJ,EAAU1B,cAAc,CAAC,CAACiB,OAAO,CAACK,GAAT,CAAD,CAAd,CAAV,KACKxB,cAAc,CAAC,CAACmB,OAAD,CAAD,CAAd;IACN,CAhB+B;;IAiBhCW,iBAAiB,CAACX,OAAD,EAAU;MACzBZ,gCAAgC,CAAC,CAACY,OAAD,CAAD,CAAhC;IACD;;EAnB+B,CAAlC;EAsBA,MAAMY,OAAO,GAAG,IAAApB,4BAAA,EAAiB,YAAY;IAC3CR,gBAAgB,CAAC,IAAD,CAAhB;IACA,MAAMO,IAAI,CAACnB,MAAD,CAAV;IACAY,gBAAgB,CAAC,KAAD,CAAhB;EACD,CAJe,CAAhB;EAMA,MAAMY,IAAI,GAAG,IAAAJ,4BAAA,EAAiB,YAAY;IAAA;;IACxC,0BAAIhB,QAAQ,CAACkB,OAAb,+CAAI,mBAAkBC,OAAtB,EAA+B;MAC7B,MAAMN,QAAQ,GAAG,MAAMb,QAAQ,CAACkB,OAAT,CAAiBE,IAAjB,EAAvB;MACAd,WAAW,CAACO,QAAD,EAAW,KAAX,CAAX;MACA,IAAIf,sBAAJ,EAA4B,IAAAgB,qCAAA,EAA0BD,QAA1B;IAC7B;EACF,CANY,CAAb;EAQA,OAAO;IACLX,OADK;IAELC,aAFK;IAGLiC,OAHK;IAILhC,UAJK;IAKLgB;EALK,CAAP;AAOD,CApFM"}