{"version":3,"names":["HOOK_NAME","createGroupChannelListCollection","sdk","collectionCreator","passedCollection","filter","GroupChannelFilter","includeEmpty","groupChannel","createGroupChannelCollection","limit","order","GroupChannelListOrder","LATEST_LAST_MESSAGE","useGroupChannelListWithCollection","userId","options","id","useUniqId","deliveryReceiptEnabled","useAppFeatures","collectionRef","useRef","loading","groupChannels","refreshing","setChannels","deleteChannels","updateRefreshing","updateLoading","useGroupChannelListReducer","updateChannelsAndMarkAsDelivered","markAsDelivered","source","updatedChannels","channels","current","GroupChannelEventSource","EVENT_MESSAGE_RECEIVED","EVENT_MESSAGE_SENT","SYNC_CHANNEL_BACKGROUND","SYNC_CHANNEL_CHANGELOGS","undefined","confirmAndMarkAsDelivered","init","useFreshCallback","uid","dispose","setGroupChannelCollectionHandler","onChannelsAdded","context","onChannelsUpdated","onChannelsDeleted","hasMore","loadMore","useEffect","useAsyncEffect","useChannelHandler","onUserBanned","channel","user","isMe","url","refresh","next"],"sources":["useGroupChannelListWithCollection.ts"],"sourcesContent":["import { useEffect, useRef } from 'react';\n\nimport { GroupChannelEventSource, GroupChannelFilter, GroupChannelListOrder } from '@sendbird/chat/groupChannel';\nimport type { SendbirdBaseChannel, SendbirdChatSDK, SendbirdGroupChannelCollection } from '@sendbird/uikit-utils';\nimport { confirmAndMarkAsDelivered, useAsyncEffect, useFreshCallback, useUniqId } from '@sendbird/uikit-utils';\n\nimport { useAppFeatures } from '../../common/useAppFeatures';\nimport { useChannelHandler } from '../../handler/useChannelHandler';\nimport type { UseGroupChannelList, UseGroupChannelListOptions } from '../../types';\nimport { useGroupChannelListReducer } from './reducer';\n\nconst HOOK_NAME = 'useGroupChannelListWithCollection';\n\nconst createGroupChannelListCollection = (\n  sdk: SendbirdChatSDK,\n  collectionCreator: UseGroupChannelListOptions['collectionCreator'],\n) => {\n  const passedCollection = collectionCreator?.();\n  if (passedCollection) return passedCollection;\n\n  const filter = new GroupChannelFilter();\n  filter.includeEmpty = false;\n\n  return sdk.groupChannel.createGroupChannelCollection({\n    filter,\n    limit: 20,\n    order: GroupChannelListOrder.LATEST_LAST_MESSAGE,\n  });\n};\n\nexport const useGroupChannelListWithCollection: UseGroupChannelList = (sdk, userId, options) => {\n  const id = useUniqId(HOOK_NAME);\n  const { deliveryReceiptEnabled } = useAppFeatures(sdk);\n\n  const collectionRef = useRef<SendbirdGroupChannelCollection>();\n\n  const { loading, groupChannels, refreshing, setChannels, deleteChannels, updateRefreshing, updateLoading } =\n    useGroupChannelListReducer();\n\n  const updateChannelsAndMarkAsDelivered = (\n    markAsDelivered: boolean,\n    source?: GroupChannelEventSource,\n    updatedChannels?: SendbirdBaseChannel[],\n  ) => {\n    const channels = collectionRef.current?.channels ?? [];\n    setChannels(channels, true);\n    if (markAsDelivered && deliveryReceiptEnabled) {\n      switch (source) {\n        case GroupChannelEventSource.EVENT_MESSAGE_RECEIVED:\n        case GroupChannelEventSource.EVENT_MESSAGE_SENT:\n        case GroupChannelEventSource.SYNC_CHANNEL_BACKGROUND:\n        case GroupChannelEventSource.SYNC_CHANNEL_CHANGELOGS:\n        case undefined:\n          confirmAndMarkAsDelivered(updatedChannels ?? channels);\n          break;\n      }\n    }\n  };\n\n  const init = useFreshCallback(async (uid?: string) => {\n    if (collectionRef.current) collectionRef.current?.dispose();\n\n    if (uid) {\n      collectionRef.current = createGroupChannelListCollection(sdk, options?.collectionCreator);\n\n      collectionRef.current?.setGroupChannelCollectionHandler({\n        onChannelsAdded: (context, channels) => {\n          updateChannelsAndMarkAsDelivered(true, context.source, channels);\n        },\n        onChannelsUpdated: (context, channels) => {\n          updateChannelsAndMarkAsDelivered(true, context.source, channels);\n        },\n        onChannelsDeleted: () => {\n          updateChannelsAndMarkAsDelivered(false);\n        },\n      });\n\n      if (collectionRef.current?.hasMore) {\n        await collectionRef.current?.loadMore();\n        updateChannelsAndMarkAsDelivered(true);\n      }\n    }\n  });\n\n  useEffect(() => {\n    return () => {\n      if (collectionRef.current) collectionRef.current?.dispose();\n    };\n  }, []);\n\n  useAsyncEffect(async () => {\n    updateLoading(true);\n    await init(userId);\n    updateLoading(false);\n  }, [init, userId]);\n\n  useChannelHandler(sdk, `${HOOK_NAME}_${id}`, {\n    onUserBanned: (channel, user) => {\n      const isMe = user.userId === userId;\n      if (isMe) deleteChannels([channel.url]);\n      else updateChannelsAndMarkAsDelivered(false);\n    },\n  });\n\n  const refresh = useFreshCallback(async () => {\n    updateRefreshing(true);\n    await init(userId);\n    updateRefreshing(false);\n  });\n\n  const next = useFreshCallback(async () => {\n    if (collectionRef.current?.hasMore) {\n      await collectionRef.current?.loadMore();\n      updateChannelsAndMarkAsDelivered(true);\n    }\n  });\n\n  return {\n    loading,\n    groupChannels,\n    refresh,\n    refreshing,\n    next,\n  };\n};\n"],"mappings":"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"}