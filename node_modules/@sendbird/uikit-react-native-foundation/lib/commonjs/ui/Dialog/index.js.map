{"version":3,"names":["AlertContext","React","createContext","ActionMenuContext","PromptContext","BottomSheetContext","DISMISS_TIMEOUT","DialogProvider","defaultLabels","children","waitDismissTimeout","useRef","waitDismissPromise","waitDismiss","useCallback","resolver","current","setTimeout","completeDismiss","clearTimeout","undefined","render","useForceUpdate","dialogQueue","workingDialogJob","visibleState","isProcessing","Boolean","updateToShow","updateToHide","Promise","resolve","consumeQueue","job","shift","createJob","type","props","jobItem","push","alert","openMenu","openPrompt","openSheet","title","menuItems","message","buttons","text","ok","onSubmit","defaultValue","submitLabel","prompt","cancelLabel","cancel","placeholder","sheetItems","HeaderComponent","useActionMenu","context","useContext","Error","useAlert","usePrompt","useBottomSheet"],"sources":["index.tsx"],"sourcesContent":["import React, { useCallback, useContext, useRef } from 'react';\n\nimport { useForceUpdate } from '@sendbird/uikit-utils';\n\nimport type { ActionMenuItem } from '../ActionMenu';\nimport ActionMenu from '../ActionMenu';\nimport type { AlertItem } from '../Alert';\nimport Alert from '../Alert';\nimport type { BottomSheetItem } from '../BottomSheet';\nimport BottomSheet from '../BottomSheet';\nimport type { PromptItem } from '../Prompt';\nimport Prompt from '../Prompt';\n\ntype DialogJob =\n  | {\n      type: 'ActionMenu';\n      props: ActionMenuItem;\n    }\n  | {\n      type: 'Alert';\n      props: AlertItem;\n    }\n  | {\n      type: 'Prompt';\n      props: PromptItem;\n    }\n  | {\n      type: 'BottomSheet';\n      props: BottomSheetItem;\n    };\n\ntype DialogPropsBy<T extends DialogJob['type'], U extends DialogJob = DialogJob> = U extends { type: T; props: infer P }\n  ? P\n  : never;\n\ntype DialogContextType = {\n  openMenu: (props: DialogPropsBy<'ActionMenu'>) => void;\n  alert: (props: DialogPropsBy<'Alert'>) => void;\n  openPrompt: (props: DialogPropsBy<'Prompt'>) => void;\n  openSheet: (props: DialogPropsBy<'BottomSheet'>) => void;\n};\n\nconst AlertContext = React.createContext<Pick<DialogContextType, 'alert'> | null>(null);\nconst ActionMenuContext = React.createContext<Pick<DialogContextType, 'openMenu'> | null>(null);\nconst PromptContext = React.createContext<Pick<DialogContextType, 'openPrompt'> | null>(null);\nconst BottomSheetContext = React.createContext<Pick<DialogContextType, 'openSheet'> | null>(null);\n\ntype Props = React.PropsWithChildren<{\n  defaultLabels?: {\n    alert?: { ok?: string };\n    prompt?: { placeholder?: string; ok?: string; cancel?: string };\n  };\n}>;\nconst DISMISS_TIMEOUT = 3000;\nexport const DialogProvider = ({ defaultLabels, children }: Props) => {\n  const waitDismissTimeout = useRef<NodeJS.Timeout>();\n  const waitDismissPromise = useRef<() => void>();\n  const waitDismiss = useCallback((resolver: () => void) => {\n    waitDismissPromise.current = resolver;\n    waitDismissTimeout.current = setTimeout(completeDismiss, DISMISS_TIMEOUT);\n  }, []);\n  const completeDismiss = useCallback(() => {\n    if (waitDismissTimeout.current) clearTimeout(waitDismissTimeout.current);\n    if (waitDismissPromise.current) waitDismissPromise.current();\n    waitDismissTimeout.current = undefined;\n    waitDismissPromise.current = undefined;\n  }, []);\n\n  const render = useForceUpdate();\n  const dialogQueue = useRef<DialogJob[]>([]);\n  const workingDialogJob = useRef<DialogJob>();\n  const visibleState = useRef(false);\n\n  const isProcessing = () => Boolean(workingDialogJob.current);\n  const updateToShow = useCallback(() => {\n    visibleState.current = true;\n    render();\n  }, []);\n  const updateToHide = useCallback((): Promise<void> => {\n    return new Promise((resolve) => {\n      visibleState.current = false;\n      render();\n      waitDismiss(resolve);\n    });\n  }, []);\n  const consumeQueue = useCallback(() => {\n    completeDismiss();\n    const job = dialogQueue.current.shift();\n    if (job) {\n      workingDialogJob.current = job;\n      updateToShow();\n    } else {\n      workingDialogJob.current = undefined;\n    }\n  }, []);\n\n  const createJob =\n    <T extends DialogJob['type']>(type: T) =>\n    (props: DialogPropsBy<T>) => {\n      const jobItem = { type, props } as DialogJob;\n      if (isProcessing()) dialogQueue.current.push(jobItem);\n      else {\n        workingDialogJob.current = jobItem;\n        updateToShow();\n      }\n    };\n\n  const alert = useCallback(createJob('Alert'), []);\n  const openMenu = useCallback(createJob('ActionMenu'), []);\n  const openPrompt = useCallback(createJob('Prompt'), []);\n  const openSheet = useCallback(createJob('BottomSheet'), []);\n\n  return (\n    <AlertContext.Provider value={{ alert }}>\n      <ActionMenuContext.Provider value={{ openMenu }}>\n        <PromptContext.Provider value={{ openPrompt }}>\n          <BottomSheetContext.Provider value={{ openSheet }}>\n            {children}\n            {workingDialogJob.current?.type === 'ActionMenu' && (\n              <ActionMenu\n                onHide={updateToHide}\n                onDismiss={consumeQueue}\n                visible={visibleState.current}\n                title={workingDialogJob.current.props.title}\n                menuItems={workingDialogJob.current.props.menuItems}\n              />\n            )}\n            {workingDialogJob.current?.type === 'Alert' && (\n              <Alert\n                onHide={updateToHide}\n                onDismiss={consumeQueue}\n                visible={visibleState.current}\n                title={workingDialogJob.current.props.title}\n                message={workingDialogJob.current.props.message}\n                buttons={workingDialogJob.current.props.buttons ?? [{ text: defaultLabels?.alert?.ok || 'OK' }]}\n              />\n            )}\n            {workingDialogJob.current?.type === 'Prompt' && (\n              <Prompt\n                onHide={updateToHide}\n                onDismiss={consumeQueue}\n                visible={visibleState.current}\n                title={workingDialogJob.current.props.title}\n                onSubmit={workingDialogJob.current.props.onSubmit}\n                defaultValue={workingDialogJob.current.props.defaultValue}\n                submitLabel={workingDialogJob.current.props.submitLabel ?? defaultLabels?.prompt?.ok}\n                cancelLabel={workingDialogJob.current.props.cancelLabel ?? defaultLabels?.prompt?.cancel}\n                placeholder={workingDialogJob.current.props.placeholder ?? defaultLabels?.prompt?.placeholder}\n              />\n            )}\n            {workingDialogJob.current?.type === 'BottomSheet' && (\n              <BottomSheet\n                onHide={updateToHide}\n                onDismiss={consumeQueue}\n                visible={visibleState.current}\n                sheetItems={workingDialogJob.current.props.sheetItems}\n                HeaderComponent={workingDialogJob.current.props.HeaderComponent}\n              />\n            )}\n          </BottomSheetContext.Provider>\n        </PromptContext.Provider>\n      </ActionMenuContext.Provider>\n    </AlertContext.Provider>\n  );\n};\n\nexport const useActionMenu = () => {\n  const context = useContext(ActionMenuContext);\n  if (!context) throw new Error('ActionMenuContext is not provided, wrap your app with DialogProvider');\n  return context;\n};\nexport const useAlert = () => {\n  const context = useContext(AlertContext);\n  if (!context) throw new Error('AlertContext is not provided, wrap your app with DialogProvider');\n  return context;\n};\nexport const usePrompt = () => {\n  const context = useContext(PromptContext);\n  if (!context) throw new Error('PromptContext is not provided, wrap your app with DialogProvider');\n  return context;\n};\nexport const useBottomSheet = () => {\n  const context = useContext(BottomSheetContext);\n  if (!context) throw new Error('BottomSheetContext is not provided, wrap your app with DialogProvider');\n  return context;\n};\n"],"mappings":"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"}