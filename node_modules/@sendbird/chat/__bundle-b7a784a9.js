import{_ as e,A as t,a as n,b as r,P as i,c as s,d as o,g as a,e as u,i as c,v as l,f as h,h as d,C as f,j as p,k as v,l as m,u as _,S as y,m as g,n as b,M as I,o as w,V as E,U as T,p as k,r as S,s as C,t as N,w as A,x as O,R as P,y as U,z as M,B as R,D as L,E as x,F as D,G as q,H as F,I as B,J as K,K as z,L as Q,N as j,O as V,Q as H,T as G,W,X as Y,Y as X,Z as J,$ as Z,a0 as $,a1 as ee,a2 as te,a3 as ne,a4 as re,a5 as ie,a6 as se,a7 as oe,a8 as ae,a9 as ue,aa as ce,ab as le,ac as he,ad as de,ae as fe,af as pe,ag as ve,ah as me,ai as _e,aj as ye,ak as ge,al as be,am as Ie,an as we,ao as Ee,ap as Te,aq as ke,ar as Se,as as Ce,at as Ne,au as Ae,av as Oe,aw as Pe,ax as Ue,ay as Me,az as Re,aA as Le,aB as xe}from"./__bundle-2c42a88c.js";var De,qe,Fe,Be;!function(e){e.SUCCESS="success",e.PENDING="pending",e.ERROR="error"}(De||(De={})),function(e){e.DEFAULT="default",e.ALL="all",e.MENTION_ONLY="mention_only",e.OFF="off"}(qe||(qe={})),function(e){e.FCM="gcm",e.APNS="apns",e.UNKNOWN="unknown"}(Fe||(Fe={})),function(e){e.ALTERNATIVE="alternative",e.DEFAULT="default"}(Be||(Be={}));var Ke,ze,Qe,je=function(r){function i(e){var i=e.title,s=e.optionTexts,o=e.data,a=e.allowUserSuggestion,u=e.allowMultipleVotes,c=e.closeAt,l=r.call(this)||this;return l.method=t.POST,l.path=n,l.params={title:i,options:s,data:o,allow_user_suggestion:a,allow_multiple_votes:u,close_at:c},l}return e(i,r),i}(r),Ve=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.poll=new i(e,n),r}return e(n,t),n}(s),He=function(r){function i(e){var i=e.channelUrl,s=e.channelType,o=e.pollId,a=r.call(this)||this;return a.method=t.GET,a.path="".concat(n,"/").concat(encodeURIComponent(o)),a.params={channel_url:i,channel_type:s},a}return e(i,r),i}(r),Ge=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.poll=new i(e,n),r}return e(n,t),n}(s),We=function(r){function i(e){var i=e.channelUrl,s=e.channelType,o=e.pollId,a=e.pollOptionId,u=r.call(this)||this;return u.method=t.GET,u.path="".concat(n,"/").concat(encodeURIComponent(o),"/options/").concat(encodeURIComponent(a)),u.params={channel_url:i,channel_type:s},u}return e(i,r),i}(r),Ye=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.pollOption=new o(e,n),r}return e(n,t),n}(s),Xe=function(n){function r(e){var r=e.channelType,i=e.channelUrl,s=e.timestamp,o=e.token,c=n.call(this)||this;return c.method=t.GET,c.path="".concat(a(r),"/").concat(encodeURIComponent(i),"/polls/changelogs"),c.params=u({change_ts:s,token:o}),c}return e(r,n),r}(r),Je=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.updatedPolls=n.updated.map((function(t){return function(e,t){return t?new i(e,t):null}(e,t)})),r.deletedPollIds=n.deleted.map((function(e){return e})),r.hasMore=n.has_more,r.nextToken=n.next,r}return e(n,t),n}(s),Ze={title:null,optionTexts:null,data:null,allowUserSuggestion:null,allowMultipleVotes:null,closeAt:-1},$e=function(e){return c("string",e.title)&&l(e.optionTexts)&&h(e.data)&&c("boolean",e.allowUserSuggestion,!0)&&c("boolean",e.allowMultipleVotes,!0)&&c("number",e.closeAt,!0)},et={channelUrl:null,channelType:null,pollId:null,pollOptionId:null},tt=function(e){return c("string",e.channelUrl)&&d(f,e.channelType)&&c("number",e.pollId)&&c("number",e.pollOptionId)},nt={channelUrl:null,channelType:null,pollId:null},rt=function(e){return c("string",e.channelUrl)&&""!==e.channelUrl&&d(f,e.channelType)&&c("number",e.pollId)},it={},st=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,o=t.logger;this._iid=e,this._sdkState=n,this._sessionManager=i,this._requestQueue=s,this._dispatcher=r,this._logger=o,it[e]=this}return e.of=function(e){return it[e]},e.prototype.buildPollFromSerializedData=function(e){var t=p(e);return new i(this._iid,i.payloadify(t))},e.prototype.get=function(e){return v(this,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return _(rt(e)).throw(y.invalidParameters),t=new He(g({},e)),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(Ge).poll]}}))}))},e.prototype.create=function(e){return v(this,void 0,void 0,(function(){var t,n,r;return m(this,(function(i){switch(i.label){case 0:return _($e(e)).throw(y.invalidParameters),t=e.data,n=new je(g(g({},e),{data:t})),[4,this._requestQueue.send(n)];case 1:return r=i.sent(),[2,r.as(Ve).poll]}}))}))},e.prototype.getOption=function(e){return v(this,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return _(tt(e)).throw(y.invalidParameters),t=new We(g({},e)),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(Ye).pollOption]}}))}))},e.prototype.getPollChangeLogs=function(e,t,n,r){return void 0===r&&(r=I.SYNC_POLL_CHANGELOGS),v(this,void 0,void 0,(function(){var i,s,o,a,c,l,h;return m(this,(function(d){switch(d.label){case 0:return i=new Xe(u({channelType:t,channelUrl:e,timestamp:"number"==typeof n?n:null,token:"string"==typeof n?n:null})),[4,this._requestQueue.send(i)];case 1:return s=d.sent(),o=s.as(Je),a=o.updatedPolls,c=o.deletedPollIds,l=o.hasMore,h=o.nextToken,a.length>0&&this._dispatcher.dispatch(new b({polls:a,source:r})),[2,{updatedPolls:a,deletedPollIds:c,hasMore:l,token:h}]}}))}))},e}(),ot=function(e,t){this.pollId=0,this.messageId=0,this.pollId=t.poll.id,this.messageId=t.poll.message_id,this._iid=e,this._payload=t},at=function(e){this.pollId=0,this.messageId=0,this.pollId=e.poll_id,this.messageId=e.message_id,this._payload=e},ut=function(r){function i(e){var i=e.channelUrl,s=e.channelType,o=e.token,a=e.limit,u=r.call(this)||this;return u.method=t.GET,u.path=n,u.params={channel_url:i,channel_type:s,token:o,limit:a},u}return e(i,r),i}(r),ct=function(t){function n(e,n){var r,s=this;return(s=t.call(this,e,n)||this).polls=(null!==(r=n.polls)&&void 0!==r?r:[]).map((function(t){return new i(e,t)})),s.token=n.next,s}return e(n,t),n}(s),lt=function(t){function n(e,n){return t.call(this,e,n.channelUrl,n.channelType,n)||this}return e(n,t),n.prototype.next=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s;return m(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=E.of(this._iid).requestQueue,t=new ut(g(g({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=o.sent(),r=n.as(ct),i=r.polls,s=r.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw y.queryInProgress;case 4:return[3,6];case 5:throw y.invalidParameters;case 6:return[2]}}))}))},n}(w),ht=function(r){function i(e){var i=e.channelUrl,s=e.channelType,o=e.pollId,a=e.pollOptionId,u=e.token,c=e.limit,l=r.call(this)||this;return l.method=t.GET,l.path="".concat(n,"/").concat(encodeURIComponent(o),"/options/").concat(encodeURIComponent(a),"/voters"),l.params={channel_url:i,channel_type:s,token:u,limit:c},l}return e(i,r),i}(r),dt=function(t){function n(e,n){var r,i=this;return(i=t.call(this,e,n)||this).voters=(null!==(r=n.voters)&&void 0!==r?r:[]).map((function(t){return new T(e,t)})),i.token=n.next,i}return e(n,t),n}(s),ft=function(t){function n(e,n){var r=t.call(this,e,n.channelUrl,n.channelType,n)||this;return r.pollId=n.pollId,r.pollOptionId=n.pollOptionId,r}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&c("number",this.pollId)&&c("number",this.pollOptionId)},n.prototype.next=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s;return m(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=E.of(this._iid).requestQueue,t=new ht(g(g({},this),{pollId:this.pollId,pollOptionId:this.pollOptionId,token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=o.sent(),r=n.as(dt),i=r.voters,s=r.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw y.queryInProgress;case 4:return[3,6];case 5:throw y.invalidParameters;case 6:return[2]}}))}))},n}(w),pt=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="poll",e}return e(n,t),n.prototype.init=function(e,n){var r=n.sdkState,i=n.dispatcher,s=n.sessionManager,o=n.requestQueue,a=n.logger,u=n.onlineDetector,c=n.cacheContext;t.prototype.init.call(this,e,{sdkState:r,dispatcher:i,sessionManager:s,requestQueue:o,logger:a,onlineDetector:u,cacheContext:c}),this._manager=new st(e,{sdkState:r,dispatcher:i,sessionManager:s,requestQueue:o,logger:a,onlineDetector:u,cacheContext:c})},n.prototype.create=function(e){return v(this,void 0,void 0,(function(){var t;return m(this,(function(n){return t=g(g({},Ze),e),_($e(t)).throw(y.invalidParameters),[2,this._manager.create(t)]}))}))},n.prototype.get=function(e){return v(this,void 0,void 0,(function(){var t;return m(this,(function(n){return t=g(g({},nt),e),_(rt(t)).throw(y.invalidParameters),[2,this._manager.get(t)]}))}))},n.prototype.getOption=function(e){return v(this,void 0,void 0,(function(){var t;return m(this,(function(n){return t=g(g({},et),e),_(tt(t)).throw(y.invalidParameters),[2,this._manager.getOption(t)]}))}))},n.prototype.buildPollFromSerializedData=function(e){return this._manager.buildPollFromSerializedData(e)},n}(k),vt={profileImage:null,profileUrl:null,nickname:null},mt=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return Object.keys(e).forEach((function(t){n.hasOwnProperty(t)&&(n[t]=e[t])})),n}return e(n,t),n}((function(){this.onSessionExpired=C,this.onSessionTokenRequired=function(e){return e(null)},this.onSessionError=C,this.onSessionRefreshed=C,this.onSessionClosed=C})),_t=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return Object.keys(e).forEach((function(t){n.hasOwnProperty(t)&&(n[t]=e[t])})),n}return e(n,t),n}((function(){this.onConnected=C,this.onReconnectStarted=C,this.onReconnectSucceeded=C,this.onReconnectFailed=C,this.onDisconnected=C})),yt=function(t){function n(e){void 0===e&&(e={});var n=t.call(this)||this;return Object.keys(e).forEach((function(t){n.hasOwnProperty(t)&&(n[t]=e[t])})),n}return e(n,t),n}((function(){this.onFriendsDiscovered=C,this.onTotalUnreadMessageCountUpdated=C})),gt=100,bt="GroupChannel",It=100;!function(e){e.LATEST_LAST_MESSAGE="latest_last_message",e.CHRONOLOGICAL="chronological",e.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",e.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"}(Ke||(Ke={})),function(e){e.CHRONOLOGICAL="chronological",e.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",e.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"}(ze||(ze={})),function(e){e.CREATED_AT="created_at",e.SCHEDULED_AT="scheduled_at"}(Qe||(Qe={}));var wt,Et=function(e){switch(e){case Ke.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case Ke.CHRONOLOGICAL:return["-createdAt","syncIndex"];case Ke.CHANNEL_NAME_ALPHABETICAL:return["name"]}},Tt=function(){function e(){this.messageTypeFilter=N.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=P.NONE}return e.prototype.clone=function(){var t=new e,n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(e){t[e]=n[e]})),t},e.prototype.match=function(e){switch(this.messageTypeFilter){case N.USER:if(e.messageType!==A.USER)return!1;break;case N.FILE:if(e.messageType!==A.FILE)return!1;break;case N.ADMIN:if(e.messageType!==A.ADMIN)return!1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(e.customType))return!1;if(this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0){if(!(e instanceof O))return!1;if(!this.senderUserIdsFilter.includes(e.sender.userId))return!1}switch(this.replyType){case P.NONE:if(e.parentMessageId>0)return!1;break;case P.ONLY_REPLY_TO_CHANNEL:if(e instanceof O&&e.parentMessageId>0&&!e.replyToChannel)return!1}return!0},e}();!function(e){e.CHANNEL_LATEST="channel_latest",e.NEWEST_CHILD_MESSAGE="newest_child_message"}(wt||(wt={}));var kt,St=function(e){switch(e){case wt.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case wt.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}},Ct={data:null,customType:null,mentionType:U.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,parentMessageId:null,isReplyToChannel:!1,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null,isPinnedMessage:!1},Nt=function(e){return c("string",e.data,!0)&&c("string",e.customType,!0)&&d(U,e.mentionType)&&M("string",e.mentionedUserIds,!0)&&M(T,e.mentionedUsers,!0)&&c("string",e.mentionedMessageTemplate,!0)&&M(R,e.metaArrays,!0)&&c("number",e.parentMessageId,!0)&&c("boolean",e.isReplyToChannel)&&d(L,e.pushNotificationDeliveryOption,!0)&&c(x,e.appleCriticalAlertOptions,!0)&&c("boolean",e.isPinnedMessage,!0)},At=function(e){return e?{isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,pollId:e.pollId}:null},Ot=g(g({},Ct),{message:null,translationTargetLanguages:null,pollId:null}),Pt=function(e){return Nt(e)&&c("string",e.message)&&M("string",e.translationTargetLanguages,!0)&&c("number",e.pollId,!0)};!function(e){e.FILE="file",e.BLOB="blob",e.BLOB_LIKE_OBJECT="blobLikeObject",e.URL="url"}(kt||(kt={}));var Ut=function(e){return"undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob},Mt=function(e){return e===kt.BLOB||e===kt.FILE},Rt=function(e){return e?{file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null},Lt=g(g({},Ct),{file:null,fileKey:null,fileUrl:null,fileName:null,fileType:null,fileSize:null,mimeType:null,thumbnailSizes:null,requireAuth:!1}),xt=function(e){return Nt(e)&&(S(e.file)||c("string",e.fileUrl))&&c("string",e.fileName,!0)&&c("string",e.mimeType,!0)&&c("number",e.fileSize,!0)&&(null===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((function(e){return c("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},Dt="undefined"!=typeof document&&"undefined"!=typeof navigator;Dt&&navigator.userAgent&&navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/");var qt=Dt&&navigator.userAgent&&navigator.userAgent.includes("Firefox/")&&!navigator.userAgent.includes("Seamonkey/");Dt&&navigator.userAgent&&navigator.userAgent.includes("Safari/")&&!navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/"),Dt&&navigator.userAgent&&(navigator.userAgent.includes("OPR/")||navigator.userAgent.includes("Opera/")),Dt&&navigator.userAgent&&navigator.userAgent.includes("Trident/7.0");var Ft,Bt,Kt=Dt&&navigator.userAgent&&navigator.userAgent.includes("Edge/"),zt=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))};!function(e){e[e.PROCESSING=0]="PROCESSING",e[e.DONE=1]="DONE"}(Ft||(Ft={})),function(e){e.NEWNODE="newnode",e.REMOVENODE="removenode",e.CLAIM_HOST="claimhost",e.SYNC_HOST="synchost",e.REQUEST_LOCK="requestlock",e.ACQUIRE_LOCK="acquirelock",e.RELEASE_LOCK="releaselock"}(Bt||(Bt={}));var Qt,jt={},Vt=function(){function e(e,t){void 0===t&&(t={});var n=this;return this._state=Ft.PROCESSING,this._hostId=null,this._queue=[],this._currentItem=null,this._activationTimeout=null,this._activationQueue=[],jt[e]&&!t.forceCreate||(this.nodeId=zt(),this.key=e,Dt&&(t.startAsInvisible?this.registerNode():"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&n.claimHost()})),window.addEventListener("message",(function(e){var t,r,i=e.data,s=i.nodeId,o=i.requestId,a=i.key,u=i.op,c=i.data;if(s!==n.nodeId&&a===n.key)switch(u){case Bt.NEWNODE:n._sendSync();break;case Bt.CLAIM_HOST:n._sendSync(),n._hostId=s;break;case Bt.SYNC_HOST:if(!n.isInSync){n._activationTimeout&&clearTimeout(n._activationTimeout);var l=c,h=l.currentItemRequestId,d=l.queue,f=function(e){var t=n._queue.findIndex((function(t){return t.requestId===e.requestId}));t<0&&n._requestLock({nodeId:e.nodeId,requestId:e.requestId,key:n.key,op:Bt.REQUEST_LOCK,ts:e.ts})};try{for(var p=D(d),v=p.next();!v.done;v=p.next()){f(v.value)}}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}n._currentItem=n._queue.find((function(e){return e.requestId===h})),n._completeSync()}break;case Bt.REMOVENODE:n._queue=n._queue.filter((function(e){return e.nodeId!==i.nodeId})),n._currentItem&&n._currentItem.nodeId===i.nodeId&&(n._currentItem=null,n._acquire(n._queue[0]));break;case Bt.REQUEST_LOCK:n._requestLock(i);break;case Bt.ACQUIRE_LOCK:var m=n._queue.find((function(e){return e.requestId===o}));n._acquire(m);break;case Bt.RELEASE_LOCK:n._release(o)}})),window.addEventListener("beforeunload",(function(){n._send(Bt.REMOVENODE)}))),jt[e]=this),jt[e]}return Object.defineProperty(e.prototype,"locked",{get:function(){return!!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInSync",{get:function(){return this._state==Ft.DONE},enumerable:!1,configurable:!0}),e.prototype._send=function(e,t){var n,r;void 0===t&&(t={});var i={nodeId:this.nodeId,requestId:null!==(n=null==t?void 0:t.requestId)&&void 0!==n?n:zt(),key:this.key,op:e,data:null!==(r=t.data)&&void 0!==r?r:null,ts:Date.now()};return Dt&&window.postMessage(i,"*"),i},e.prototype._acquire=function(e){void 0===e&&(e=null),e?(this._currentItem=e,this._currentItem.onAcquired(e.requestId)):this._currentItem=null},e.prototype._release=function(e){if(this._currentItem&&this._currentItem.requestId===e){var t=this._currentItem;this._currentItem=null,t.nodeId===this.nodeId&&this._send(Bt.RELEASE_LOCK,{requestId:t.requestId});var n=this._queue.findIndex((function(t){return t.requestId===e}));n>-1&&this._queue.splice(n,1),t.onReleased(e)}},e.prototype._requestLock=function(e){var t=this;return new Promise((function(n){var r={nodeId:e.nodeId,requestId:e.requestId,ts:e.ts,onAcquired:function(e){t.isHost&&t._send(Bt.ACQUIRE_LOCK,{requestId:e}),n()},onReleased:function(){t._acquire(t._queue[0])}},i=!1;for(var s in t._queue)if(t._queue[s].ts>r.ts){t._queue.splice(parseInt(s),0,r),i=!0;break}i||t._queue.push(r),t._currentItem||t._acquire(t._queue[0])}))},e.prototype._sendSync=function(){var e;this.isHost&&this._send(Bt.SYNC_HOST,{data:{currentItemRequestId:null===(e=this._currentItem)||void 0===e?void 0:e.requestId,queue:this._queue.map((function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}}))}})},e.prototype._waitUntilSyncCompleted=function(){return v(this,void 0,void 0,(function(){var e=this;return m(this,(function(t){return this.isHost&&!this.isInSync?[2,new Promise((function(t){e._activationQueue.push(t)}))]:[2]}))}))},e.prototype._waitSync=function(){var e=this;this.isInSync||(this._activationTimeout=setTimeout((function(){e._completeSync()}),8))},e.prototype._completeSync=function(){this.isInSync||(this._state=Ft.DONE,this._activationQueue.forEach((function(e){return e()})),this._activationQueue=[])},e.prototype.registerNode=function(){this._send(Bt.NEWNODE),this._waitSync()},e.prototype.claimHost=function(){this._hostId=this.nodeId,this._send(Bt.CLAIM_HOST),this._waitSync()},e.prototype.lock=function(){return v(this,void 0,void 0,(function(){var e;return m(this,(function(t){switch(t.label){case 0:return[4,this._waitUntilSyncCompleted()];case 1:return t.sent(),e=this._send(Bt.REQUEST_LOCK),[4,this._requestLock(e)];case 2:return t.sent(),[2]}}))}))},e.prototype.unlock=function(){var e;this._release(null===(e=this._currentItem)||void 0===e?void 0:e.requestId)},e}(),Ht=g(g({},Ot),{scheduledAt:null}),Gt=function(e){return Pt(e)&&c("number",e.scheduledAt,!0)},Wt=g(g({},Ct),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1}),Yt=function(e){return Nt(e)&&c("number",e.scheduledAt)&&(S(e.file)||c("string",e.fileUrl))&&c("string",e.fileName,!0)&&c("string",e.mimeType,!0)&&c("number",e.fileSize,!0)&&(null===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return c("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},Xt={},Jt=function(t){function n(e,n){var r=n.sdkState,i=n.cacheContext,s=t.call(this,e)||this;return s._sdkState=r,s._cacheContext=i,Xt[e]=s,s._mutex=new Vt("unsendmessagecache.lock"),s}return e(n,t),n.of=function(e){return Xt[e]},Object.defineProperty(n.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e&&e.collection("UnsentMessage")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),n.prototype._serialize=function(e){if(e.messageId>0)throw y.invalidParameters;var t,n=g({},e.serialize());return e instanceof q?(e.messageParams&&(n.messageParams=At(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,g(g({},At(t)),{scheduledAt:t.scheduledAt})))):e instanceof F&&(e.messageParams&&(n.messageParams=Rt(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=function(e){return g(g({},Rt(e)),{scheduledAt:e.scheduledAt})}(e.scheduledInfo.scheduledMessageParams))),n},n.prototype._deserialize=function(e){return e?(e=g(g({},e),{messageId:parseInt(e.messageId)}),B.of(this._iid).buildMessageFromSerializedData(e)):null},n.prototype._deserializeWithMessageCreateParams=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o;return m(this,(function(a){switch(a.label){case 0:return t=B.of(this._iid),n=this._deserialize(e),e.messageParams?n instanceof q?(r=e.messageParams,n.messageParams=t.buildUserMessageCreateParamsFromSerializedData(r,n),[3,4]):[3,1]:[3,4];case 1:return n instanceof F?(r=e.messageParams).fileKey&&"string"==typeof r.fileKey&&Mt(r.fileType)?(i=r,[4,this.collection.getBlob(r.fileKey)]):[3,3]:[3,4];case 2:i.file=a.sent(),a.label=3;case 3:n.messageParams=t.buildFileMessageCreateParamsFromSerializedData(r,n),a.label=4;case 4:return n.scheduledInfo&&e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams?n instanceof q?(s=e.scheduledInfo.scheduledMessageParams,n.scheduledInfo.scheduledMessageParams=t.buildScheduledUserMessageCreateParamsFromSerializedData(s,n),[3,8]):[3,5]:[3,8];case 5:return n instanceof F?(s=e.scheduledInfo.scheduledMessageParams).fileKey&&"string"==typeof s.fileKey&&Mt(s.fileType)?(o=s,[4,this.collection.getBlob(s.fileKey)]):[3,7]:[3,8];case 6:o.file=a.sent(),a.label=7;case 7:n.scheduledInfo.scheduledMessageParams=t.buildScheduledFileMessageCreateParamsFromSerializedData(s,n),a.label=8;case 8:return[2,n]}}))}))},n.prototype.get=function(e){return v(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=n.sent())return[2,this._deserializeWithMessageCreateParams(t)];n.label=2;case 2:return[2,null]}}))}))},n.prototype.fetch=function(e){var t=e.channelUrl,n=void 0===t?null:t,r=e.filter,i=void 0===r?new Tt:r,s=e.order,o=void 0===s?wt.CHANNEL_LATEST:s,a=e.sendingStatus,u=void 0===a?null:a,c=e.backward,l=void 0!==c&&c,h=e.parentMessageId,d=void 0===h?null:h;return v(this,void 0,void 0,(function(){var e,t,r,s,a=this;return m(this,(function(c){switch(c.label){case 0:return this.localCacheEnabled?(e=St(o),t={"/where":function(e){return!!(o!==wt.NEWEST_CHILD_MESSAGE||d&&0!==e.parentMessageId&&e.parentMessageId===d)&&i.match(a._deserialize(e))}},n&&(t.channelUrl=n),u&&(t.sendingStatus=u),r={where:t,index:e,backward:l},[4,this.collection.query(r)]):[3,3];case 1:return[4,c.sent().fetch({})];case 2:return s=c.sent(),[2,Promise.all(s.map((function(e){return v(a,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,this._deserializeWithMessageCreateParams(e)];case 1:return[2,t.sent()]}}))}))})))];case 3:return[2,[]]}}))}))},n.prototype.getAllChildMessages=function(e,t){return void 0===t&&(t=new Tt),v(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,this.fetch({filter:t,order:wt.NEWEST_CHILD_MESSAGE,channelUrl:e.channelUrl,backward:!1,parentMessageId:e.messageId})];case 1:return[2,n.sent()]}}))}))},n.prototype.upsert=function(e){return v(this,void 0,void 0,(function(){var t=this;return m(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return v(t,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return e instanceof F?[4,this._mutex.lock()]:[3,4];case 1:return n.sent(),[4,this.saveBlob(e)];case 2:return n.sent(),[4,this._mutex.unlock()];case 3:n.sent(),n.label=4;case 4:return t=this._serialize(e),[4,this.collection.upsertOne(t)];case 5:return n.sent(),[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},n.prototype.upsertChildMessages=function(e){return v(this,void 0,void 0,(function(){var t=this;return m(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return v(t,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return t=[],(null===(n=e.threadInfo)||void 0===n?void 0:n.replyCount)>0?[4,this.getAllChildMessages(e)]:[3,2];case 1:t=r.sent(),r.label=2;case 2:return t.length>0?(t.forEach((function(t){return t.applyParentMessage(e)})),[4,this.upsert(t)]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},n.prototype.remove=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o;return m(this,(function(a){switch(a.label){case 0:if(!this.localCacheEnabled)return[3,8];a.label=1;case 1:a.trys.push([1,6,7,8]),t=D(e),n=t.next(),a.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove(r)]);case 3:a.sent(),a.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=a.sent(),s={error:i},[3,8];case 7:try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},n.prototype.removeMessagesOfChannel=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e}})]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},n.prototype.clear=function(){return v(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},n.prototype.saveBlob=function(e){return v(this,void 0,void 0,(function(){var t,n,r;return m(this,(function(i){switch(i.label){case 0:return e instanceof F?e.messageParams&&(t=e.messageParams).file&&Ut(t.file)?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,2]:[3,4];case 1:r=i.sent(),t.fileKey=r,t.fileType=kt.BLOB,i.label=2;case 2:return e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&((n=e.scheduledInfo.scheduledMessageParams).file&&Ut(n.file))?[4,this.collection.saveBlob(n.file,e.reqId)]:[3,4];case 3:r=i.sent(),n.fileKey=r,n.fileType=kt.BLOB,i.label=4;case 4:return[2]}}))}))},n}(K),Zt=function(e,t){return function(n,r){if(1===n)e.clear().then((function(){t.clear().then((function(){(function(e){return v(void 0,void 0,void 0,(function(){return m(this,(function(t){return[2,e.commitSchema([{collectionName:"GroupChannel",keyName:"url",index:[Et(Ke.LATEST_LAST_MESSAGE),Et(Ke.CHRONOLOGICAL),Et(Ke.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:"Message",keyName:"messageId",index:[St(wt.CHANNEL_LATEST),St(wt.NEWEST_CHILD_MESSAGE)]},{collectionName:"UnsentMessage",keyName:"reqId",index:[St(wt.CHANNEL_LATEST),St(wt.NEWEST_CHILD_MESSAGE)]},{collectionName:"Poll",keyName:"pollId"}])]}))}))})(e).then((function(){return r()})).catch((function(e){return r(e)}))})).catch((function(e){return r(e)}))})).catch((function(e){return r(e)}));else r()}},$t={},en=function(t){function n(e,n){var r=n.sdkState,i=n.cacheContext,s=n.unsentMessageCache,o=t.call(this,e)||this;return o._sdkState=r,o._cacheContext=i,o._unsentMessageCache=s,$t[e]=o,o}return e(n,t),n.of=function(e){return $t[e]},Object.defineProperty(n.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e?e.collection("Message"):null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),n.prototype._serialize=function(e){return g(g({},e.serialize()),{messageId:"".concat(e.messageId)})},n.prototype._deserialize=function(e){return e=g(g({},e),{messageId:parseInt(e.messageId)}),B.of(this._iid).buildMessageFromSerializedData(e)},n.prototype.get=function(e){return v(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=n.sent())return[2,this._deserialize(t)];n.label=2;case 2:return[2,null]}}))}))},n.prototype.fetch=function(e){var t=e.channelUrl,n=e.token,r=e.limit,i=void 0===r?100:r,s=e.filter,o=void 0===s?new Tt:s,a=e.order,u=void 0===a?wt.CHANNEL_LATEST:a,c=e.backward,l=void 0!==c&&c,h=e.parentMessageId,d=void 0===h?null:h,f=e.isPollOnly,p=void 0!==f&&f;return v(this,void 0,void 0,(function(){var e,r,s,a=this;return m(this,(function(c){switch(c.label){case 0:return this.localCacheEnabled?(e=St(u),r={where:{channelUrl:t,"/where":function(e){if(n)switch(u){case wt.CHANNEL_LATEST:if(!l&&e.createdAt>n||l&&e.createdAt<n)return!1;break;case wt.NEWEST_CHILD_MESSAGE:if(!d||0===e.parentMessageId||e.parentMessageId!==d)return!1}return!(p&&!e._poll)&&o.match(a._deserialize(e))}},index:e,backward:l},[4,this.collection.query(r)]):[3,3];case 1:return[4,c.sent().fetch({limit:i})];case 2:return s=c.sent(),[2,Promise.all(s.map((function(e){return v(a,void 0,void 0,(function(){return m(this,(function(t){return[2,this._deserialize(e)]}))}))})))];case 3:return[2,[]]}}))}))},n.prototype.getAllChildMessages=function(e,t){return void 0===t&&(t=new Tt),v(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,this.fetch({channelUrl:e.channelUrl,token:Date.now(),limit:null,backward:!1,filter:t,order:wt.NEWEST_CHILD_MESSAGE,parentMessageId:e.messageId})];case 1:return[2,n.sent()]}}))}))},n.prototype.upsert=function(e){return v(this,void 0,void 0,(function(){var t,n=this;return m(this,(function(r){switch(r.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,5];case 1:return r.sent(),t=e.map((function(e){return n._serialize(e)})),[4,this.collection.upsertMany(t)];case 2:return r.sent(),[4,this.upsertChildMessages(e)];case 3:return r.sent(),[4,this._unsentMessageCache.upsertChildMessages(e)];case 4:r.sent(),r.label=5;case 5:return[2]}}))}))},n.prototype.upsertChildMessages=function(e){return v(this,void 0,void 0,(function(){var t=this;return m(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return v(t,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return t=[],(null===(n=e.threadInfo)||void 0===n?void 0:n.replyCount)>0?[4,this.getAllChildMessages(e)]:[3,2];case 1:t=r.sent(),r.label=2;case 2:return t.length>0?(t.forEach((function(t){return t.applyParentMessage(e)})),[4,this.upsert(t)]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},n.prototype.remove=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o;return m(this,(function(a){switch(a.label){case 0:if(!this.localCacheEnabled)return[3,8];a.label=1;case 1:a.trys.push([1,6,7,8]),t=D(e),n=t.next(),a.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove("".concat(r))]);case 3:a.sent(),a.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=a.sent(),s={error:i},[3,8];case 7:try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},n.prototype.removeMessagesOfChannel=function(e){return v(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:St(wt.CHANNEL_LATEST)})]:[3,6];case 1:return n.sent(),[4,(t=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 2:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 3:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 4:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 5:n.sent(),n.label=6;case 6:return[2]}}))}))},n.prototype.removeUnderOffset=function(e,t){return v(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":t}},index:St(wt.CHANNEL_LATEST)})]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},n.prototype.clear=function(){return v(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},n.prototype.countBetween=function(e,t,n){return v(this,void 0,void 0,(function(){var r,i=this;return m(this,(function(s){switch(s.label){case 0:return this.localCacheEnabled?(r=St(wt.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:e,"/where":function(e){var r=i._deserialize(e);return n.includes(r.createdAt)&&t.match(r)}},index:r}).count()]):[3,2];case 1:return[2,s.sent()];case 2:return[2,0]}}))}))},n.prototype.saveBlobs=function(e){return v(this,void 0,void 0,(function(){var t=this;return m(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return v(t,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return e instanceof F&&e.messageParams&&((t=e.messageParams).file&&Ut(t.file))?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,2];case 1:n=r.sent(),t.fileKey=n,r.label=2;case 2:return[2]}}))}))})))];case 1:return n.sent(),[2]}}))}))},n}(K),tn=function(t){function n(e){void 0===e&&(e=!0);var n=t.call(this)||this;return n._pauseDelayTimer=null,n._currentState="visible",n._isEnabled=e,n._toggleState=n._toggleState.bind(n),n}return e(n,t),Object.defineProperty(n.prototype,"isAvailable",{get:function(){return"undefined"!=typeof window&&!!window.addEventListener&&!!window.removeEventListener},enumerable:!1,configurable:!0}),n.prototype._toggleState=function(){var e=this;"hidden"!==document.visibilityState?"hidden"===this._currentState&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=null),this.dispatch("resume")):"hidden"!==this._currentState&&(this._pauseDelayTimer=setTimeout((function(){e._pauseDelayTimer=null,e.dispatch("pause")}),3e4)),this._currentState=document.visibilityState},n.prototype.start=function(){this._isEnabled&&this.isAvailable&&window.addEventListener("visibilitychange",this._toggleState,{capture:!0})},n.prototype.stop=function(){this._isEnabled&&this.isAvailable&&window.removeEventListener("visibilitychange",this._toggleState,{capture:!0})},n}(z),nn=function(){function e(e){var t=e.logger,n=e.connectionDelegate,r=void 0===n?null:n,i=this;this._onlineWorker=function(){var e;return null===(e=i.connectionDelegate)||void 0===e?void 0:e.reconnect()},this._offlineWorker=function(){var e;return null===(e=i.connectionDelegate)||void 0===e?void 0:e.disconnect()},this.unsubscribes=[],this._onlineListener=function(e){if(i.isAvailableOnWeb)return window.addEventListener("online",e),function(){return window.removeEventListener("online",e,!1)}},this._offlineListener=function(e){if(i.isAvailableOnWeb)return window.addEventListener("offline",e),function(){return window.removeEventListener("offline",e,!1)}},this.logger=t,r&&(this.connectionDelegate=r)}return Object.defineProperty(e.prototype,"isAvailableOnWeb",{get:function(){return"undefined"!=typeof window&&window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&void 0!==navigator.onLine},enumerable:!1,configurable:!0}),e.prototype.setOnlineListener=function(e){Boolean(e)&&"function"==typeof e&&(this._onlineListener=e)},e.prototype.setOfflineListener=function(e){Boolean(e)&&"function"==typeof e&&(this._offlineListener=e)},e.prototype.start=function(){this.unsubscribes=[this._onlineListener(this._onlineWorker),this._offlineListener(this._offlineWorker)]},e.prototype.stop=function(){var e=this;this.unsubscribes.forEach((function(t){try{null==t||t()}catch(t){e.logger.warn(t.message)}})),this.unsubscribes=[]},e.prototype.isOnline=function(){return v(this,void 0,void 0,(function(){return m(this,(function(e){return this.isAvailableOnWeb?[2,navigator.onLine]:[2,new Promise((function(e){fetch("https://www.google.com",{method:t.GET,mode:"no-cors"}).then((function(){return e(!0)})).catch((function(){return e(!1)}))}))]}))}))},e}(),rn=function(t){function n(e){var n=e.message,r=t.call(this)||this;return r.message=n,r}return e(n,t),n}(Q),sn={},on=function(){function e(e,t){var n=t.localCacheEnabled,r=t.dispatcher,i=t.sdkState,s=t.logger,o=this;sn[e]=this,this._iid=e,sn[e]=this,this._localCacheEnabled=n,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=r,this._logger=s,this._sdkState=i,this._localCacheEnabled&&r.on((function(e){if(e instanceof H)switch(e.stateType){case G.CONNECTED:o._isProcessingAutoResend||o.processAutoResendRegisteredPendingMessages().then((function(){return o._processNextAutoResend()}));break;case G.INTERNAL_DISCONNECTED:case G.EXTERNAL_DISCONNECTED:o._isProcessingAutoResend=!1}}))}return e.of=function(e){return sn[e]},e.prototype.processNonAutoResendRegisteredPendingMessages=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s;return m(this,(function(o){switch(o.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:e=o.sent();try{for(t=D(e),n=t.next();!n.done;n=t.next())0===(r=n.value).errorCode&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",r.reqId),r.sendingStatus=j.FAILED,r.errorCode=W.ACK_TIMEOUT,this._dispatcher.dispatch(new Y({messages:[r],source:I.LOCAL_MESSAGE_FAILED})))}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[2]}}))}))},e.prototype.processAutoResendRegisteredPendingMessages=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s,o,a;return m(this,(function(u){switch(u.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:e=u.sent();try{for(t=D(e),n=t.next();!n.done;n=t.next())(r=n.value).errorCode&&V(r.errorCode)&&(i=(new Date).getTime(),s=r.createdAt+2592e5,i<=s?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(r.reqId)<0&&this._autoResendQueue.push(r):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(s).toLocaleString()),r.sendingStatus=j.FAILED,this._dispatcher.dispatch(new Y({messages:[r],source:I.LOCAL_MESSAGE_FAILED}))))}catch(e){o={error:e}}finally{try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(o)throw o.error}}return[2]}}))}))},e.prototype.completeCurrentAndProcessNextAutoResend=function(e){if(this._localCacheEnabled&&(e.sendingStatus===j.SUCCEEDED||e.sendingStatus===j.FAILED&&!V(e.errorCode))){var t=this.indexOf(e);t>=0&&this._autoResendQueue.splice(t,1),0===t&&this._processNextAutoResend()}},e.prototype._fetchAllCachedPendingMessages=function(){return v(this,void 0,void 0,(function(){var e,t;return m(this,(function(n){switch(n.label){case 0:return(e=Jt.of(this._iid))?[4,e.fetch({sendingStatus:j.PENDING,backward:!0})]:[3,2];case 1:return t=n.sent(),[3,3];case 2:t=[],n.label=3;case 3:return[2,t]}}))}))},e.prototype.indexOf=function(e){return this._autoResendQueue.length>0?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId):-1},e.prototype._isNotInQueue=function(e){return-1===this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId)},e.prototype._processNextAutoResend=function(){return v(this,void 0,void 0,(function(){var e;return m(this,(function(t){if(this._localCacheEnabled&&"foreground"===this._sdkState.appState)try{this._autoResendQueue.length>0?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),e=this._autoResendQueue[0],this._dispatcher.dispatch(new rn({message:e})),this._logger.debug("processing auto-resend for message request id: ",e.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1)}catch(e){this._logger.warn("process auto-resend error: ",e),this._isProcessingAutoResend=!1}return[2]}))}))},e}();!function(e){e[e.USER_BLOCK=20001]="USER_BLOCK",e[e.USER_UNBLOCK=2e4]="USER_UNBLOCK",e[e.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED"}(Qt||(Qt={}));var an=function(){function e(e){this.category=e.cat,this.data=e.data}return e.getDataAsUserBlockEvent=function(e,t){var n=t.data,r=n.blocker,i=n.blockee;return{blocker:new T(e,r),blockee:new T(e,i)}},e.getDataAsFriendDiscoveredEvent=function(e,t){var n=t.data.friend_discoveries;return{friendDiscoveries:Array.isArray(n)?n.map((function(t){return new T(e,t)})):[]}},e}(),un=function(t){function n(e,n){var r=n.userId,i=t.call(this)||this;return i._iid=e,i.userId=r,i}return e(n,t),n}(Q),cn=function(t){function n(e,n,r){var i=t.call(this,e,"USEV",r)||this;return i.event=new an(r),i}return e(n,t),n}(X),ln=function(n){function r(e){var r=e.userId,i=e.nickname,s=void 0===i?null:i,o=e.profileUrl,a=void 0===o?null:o,c=e.profileImage,l=void 0===c?null:c,h=e.preferredLanguages,d=void 0===h?null:h,f=n.call(this)||this;return f.method=t.PUT,f.path="".concat(J,"/").concat(encodeURIComponent(r)),f.params=u({nickname:s,profile_url:a,profile_file:l,preferred_languages:d}),f}return e(r,n),r}(r),hn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.user=null,r.user=new T(e,g({},n)),r}return e(n,t),n}(s),dn=function(n){function r(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=t.POST,s.path="".concat(J,"/").concat(encodeURIComponent(r),"/push/apns"),s.params={apns_device_token:i,always_push:!0},s}return e(r,n),r}(r);!function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.token=n.token,r.type=n.type?Fe[n.type.toLowerCase()]:Fe.UNKNOWN,r.user=new T(e,n.user),r}e(n,t)}(s);var fn=function(n){function r(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=t.POST,s.path="".concat(J,"/").concat(encodeURIComponent(r),"/push/gcm"),s.params={gcm_reg_token:i,always_push:!0},s}return e(r,n),r}(r);!function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.token=n.token,r.type=n.type?Fe[n.type.toLowerCase()]:Fe.UNKNOWN,r.user=new T(e,n.user),r}e(n,t)}(s);var pn=function(n){function r(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=t.DELETE,s.path="".concat(J,"/").concat(encodeURIComponent(r),"/push/apns/").concat(encodeURIComponent(i)),s}return e(r,n),r}(r);!function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.token=n.token,r.user=new T(e,n.user),r.lastDeletedAt=n.device_token_last_deleted_at,r}e(n,t)}(s);var vn=function(n){function r(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=t.DELETE,s.path="".concat(J,"/").concat(encodeURIComponent(r),"/push/gcm/").concat(encodeURIComponent(i)),s}return e(r,n),r}(r);!function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.token=n.token,r.user=new T(e,n.user),r.lastDeletedAt=n.device_token_last_deleted_at,r}e(n,t)}(s);var mn=function(n){function r(e){var r=e.userId,i=n.call(this)||this;return i.method=t.DELETE,i.path="".concat(J,"/").concat(encodeURIComponent(r),"/push/apns"),i}return e(r,n),r}(r);!function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.type=n.type?Fe[n.type.toLowerCase()]:Fe.UNKNOWN,r.user=new T(e,n.user),r.lastDeletedAt=n.device_token_last_deleted_at,r}e(n,t)}(s);var _n=function(n){function r(e){var r=e.userId,i=n.call(this)||this;return i.method=t.DELETE,i.path="".concat(J,"/").concat(encodeURIComponent(r),"/push/gcm"),i}return e(r,n),r}(r);!function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.type=n.type?Fe[n.type.toLowerCase()]:Fe.UNKNOWN,r.user=new T(e,n.user),r.lastDeletedAt=n.device_token_last_deleted_at,r}e(n,t)}(s);var yn=function(n){function r(e){var r=e.userId,i=e.type,s=e.token,o=e.ts,a=n.call(this)||this;return a.method=t.GET,a.path="".concat(J,"/").concat(encodeURIComponent(r),"/push/").concat(encodeURIComponent(i),"/device_tokens"),a.params={created_ts:o,token:s},a}return e(r,n),r}(r),gn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.pushTokens={type:n.type?Fe[n.type.toLowerCase()]:Fe.UNKNOWN,deviceTokens:n.device_tokens,hasMore:n.has_more,token:n.token},r}return e(n,t),n}(s),bn=function(n){function r(e){var r=e.userId,i=n.call(this)||this;return i.method=t.GET,i.path="".concat(J,"/").concat(encodeURIComponent(r),"/channel_invitation_preference"),i}return e(r,n),r}(r),In=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.autoAccept=n.auto_accept,r}return e(n,t),n}(s),wn=function(n){function r(e){var r=e.userId,i=e.willAutoAccept,s=n.call(this)||this;return s.method=t.PUT,s.path="".concat(J,"/").concat(encodeURIComponent(r),"/channel_invitation_preference"),s.params={auto_accept:i},s}return e(r,n),r}(r),En=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.autoAccept=n.auto_accept,r}return e(n,t),n}(s),Tn=function(n){function r(e){var r=e.userId,i=n.call(this)||this;return i.method=t.GET,i.path="".concat(J,"/").concat(encodeURIComponent(r),"/push_preference"),i}return e(r,n),r}(r),kn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.preference={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone},r}return e(n,t),n}(s),Sn=function(n){function r(e){var r=e.userId,i=e.doNotDisturbOn,s=e.startHour,o=e.startMin,a=e.endHour,u=e.endMin,c=e.timezone,l=n.call(this)||this;return l.method=t.PUT,l.path="".concat(J,"/").concat(encodeURIComponent(r),"/push_preference"),l.params={do_not_disturb:i,start_hour:s,start_min:o,end_hour:a,end_min:u,timezone:c},l}return e(r,n),r}(r),Cn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.preference={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone},r}return e(n,t),n}(s),Nn=function(n){function r(e){var r=e.userId,i=n.call(this)||this;return i.method=t.GET,i.path="".concat(J,"/").concat(encodeURIComponent(r),"/push_preference"),i}return e(r,n),r}(r),An=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.snoozePeriod={isSnoozeOn:n.snooze_enabled},"number"==typeof n.snooze_start_ts&&(r.snoozePeriod.startTs=n.snooze_start_ts),"number"==typeof n.snooze_end_ts&&(r.snoozePeriod.endTs=n.snooze_end_ts),r}return e(n,t),n}(s),On=function(n){function r(e){var r=e.userId,i=e.snoozeOn,s=e.startTs,o=e.endTs,a=n.call(this)||this;return a.method=t.PUT,a.path="".concat(J,"/").concat(encodeURIComponent(r),"/push_preference"),a.params={snooze_enabled:i,snooze_start_ts:s,snooze_end_ts:o},a}return e(r,n),r}(r),Pn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.snoozePeriod={isSnoozeOn:n.snooze_enabled},"number"==typeof n.snooze_start_ts&&(r.snoozePeriod.startTs=n.snooze_start_ts),"number"==typeof n.snooze_end_ts&&(r.snoozePeriod.endTs=n.snooze_end_ts),r}return e(n,t),n}(s),Un=function(n){function r(e){var r=e.userId,i=e.blockedUserId,s=n.call(this)||this;return s.method=t.POST,s.path="".concat(J,"/").concat(encodeURIComponent(r),"/block"),s.params={target_id:i},s}return e(r,n),r}(r);!function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.user=new T(e,n),r}e(n,t)}(s);var Mn=function(n){function r(e){var r=e.userId,i=e.unblockedUserId,s=n.call(this)||this;return s.method=t.DELETE,s.path="".concat(J,"/").concat(encodeURIComponent(r),"/block/").concat(encodeURIComponent(i)),s}return e(r,n),r}(r);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var Rn=function(n){function r(e){var r=e.userId,i=n.call(this)||this;return i.method=t.GET,i.path="".concat(J,"/").concat(encodeURIComponent(r),"/push_preference"),i}return e(r,n),r}(r),Ln=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.pushTriggerOption=n.push_trigger_option,r}return e(n,t),n}(s),xn=function(n){function r(e){var r=e.userId,i=e.pushTriggerOption,s=n.call(this)||this;return s.method=t.PUT,s.path="".concat(J,"/").concat(encodeURIComponent(r),"/push_preference"),s.params={push_trigger_option:i},s}return e(r,n),r}(r),Dn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.pushTriggerOption=n.push_trigger_option,r}return e(n,t),n}(s),qn=function(n){function r(e){var r=e.userId,i=n.call(this)||this;return i.method=t.GET,i.path="".concat(J,"/").concat(encodeURIComponent(r),"/push/template"),i}return e(r,n),r}(r),Fn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.name=n.name,r}return e(n,t),n}(s),Bn=function(n){function r(e){var r=e.userId,i=e.templateName,s=n.call(this)||this;return s.method=t.PUT,s.path="".concat(J,"/").concat(encodeURIComponent(r),"/push/template"),s.params={name:i},s}return e(r,n),r}(r),Kn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.name=n.name,r}return e(n,t),n}(s),zn=function(n){function r(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=t.GET,s.path="".concat(J,"/").concat(encodeURIComponent(r),"/friends/changelogs"),s.params={token:i},s}return e(r,n),r}(r),Qn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.changelogs={addedUsers:n.added.map((function(t){return new T(e,t)})),updatedUsers:n.updated.map((function(t){return new T(e,t)})),deletedUserIds:n.deleted,hasMore:n.has_more,token:n.next},r}return e(n,t),n}(s),jn=function(n){function r(e){var r=e.userId,i=e.discoveries,s=n.call(this)||this;return s.method=t.PUT,s.path="".concat(J,"/").concat(encodeURIComponent(r),"/friend_discoveries"),s.params={friend_discoveries:i.map((function(e){return{friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName}}))},s}return e(r,n),r}(r),Vn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.friendDiscoveryRequestId=n.friend_discovery_request_id,r}return e(n,t),n}(s),Hn=function(n){function r(e){var r=e.userId,i=e.discoveryKeys,s=n.call(this)||this;return s.method=t.DELETE,s.path="".concat(J,"/").concat(encodeURIComponent(r),"/friend_discoveries"),s.params={friend_discovery_keys:i},s}return e(r,n),r}(r);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var Gn=function(n){function r(e){var r=e.userId,i=e.userIds,s=n.call(this)||this;return s.method=t.POST,s.path="".concat(J,"/").concat(encodeURIComponent(r),"/friends"),s.params={user_ids:i},s}return e(r,n),r}(r),Wn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.users=n.users.map((function(t){return new T(e,t)})),r}return e(n,t),n}(s),Yn=function(n){function r(e){var r=e.userId,i=e.userIds,s=n.call(this)||this;return s.method=t.DELETE,s.path="".concat(J,"/").concat(encodeURIComponent(r),"/friends"),s.params={user_ids:i},s}return e(r,n),r}(r);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var Xn=function(n){function r(e){var r=e.userId,i=n.call(this)||this;return i.method=t.GET,i.path="".concat(J,"/").concat(r,"/allow_friend_discovery"),i.params={},i}return e(r,n),r}(r),Jn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.allowFriendDiscovery=n.allow_friend_discovery,r}return e(n,t),n}(s),Zn=function(n){function r(e){var r=e.userId,i=e.allowFriendDiscovery,s=n.call(this)||this;return s.method=t.PUT,s.path="".concat(J,"/").concat(r,"/allow_friend_discovery"),s.params={allow_friend_discovery:i},s}return e(r,n),r}(r);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var $n,er=function(e){this.key=null,this.url=null,this.key=e.key,this.url=e.url},tr=function(e){var t,n,r;this.id=0,this.name=null,this.url=null,this.emojis=[],this.id=null!==(t=e.id)&&void 0!==t?t:0,this.name=null!==(n=e.name)&&void 0!==n?n:"",this.url=null!==(r=e.url)&&void 0!==r?r:"",this.emojis=e.emojis?e.emojis.map((function(e){return new er(e)})):[]},nr=function(e){this.emojiHash=null,this.emojiCategories=[],this.emojiHash=e.emoji_hash||"",this.emojiCategories=e.emoji_categories?e.emoji_categories.map((function(e){return new tr(e)})):[]},rr=function(n){function r(){var e=n.call(this)||this;return e.method=t.GET,e.path=Z,e}return e(r,n),r}(r),ir=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.emojiContainer=new nr(n),r}return e(n,t),n}(s),sr=function(n){function r(e){var r=e.categoryId,i=n.call(this)||this;return i.method=t.GET,i.path="".concat(Z,"/").concat(r),i}return e(r,n),r}(r),or=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.emojiCategory=new tr(n),r}return e(n,t),n}(s),ar=function(n){function r(e){var r=e.key,i=n.call(this)||this;return i.method=t.GET,i.path="".concat($,"/").concat(r),i}return e(r,n),r}(r),ur=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.emoji=new er(n),r}return e(n,t),n}(s),cr=function(n){function r(e){var r=e.limit,i=e.token,s=e.userIdsFilter,o=e.metaDataKeyFilter,a=e.metaDataValuesFilter,c=e.nicknameStartsWithFilter,l=n.call(this)||this;return l.method=t.GET,l.path=J,l.params=u({limit:r,token:i,user_ids:s,metadatakey:o,metadatavalues_in:a,nickname_startswith:c}),l}return e(r,n),r}(r),lr=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.users=n.users.map((function(t){return new T(e,t)})),r.next=n.next,r}return e(n,t),n}(s),hr=function(t){function n(e,n){var r,i,s,o=this;return(o=t.call(this,e,n)||this).userIdsFilter=null,o.metaDataKeyFilter=null,o.metaDataValuesFilter=null,o.nicknameStartsWithFilter=null,o.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,o.metaDataKeyFilter=null!==(i=n.metaDataKeyFilter)&&void 0!==i?i:null,o.metaDataValuesFilter=null!==(s=n.metaDataValuesFilter)&&void 0!==s?s:null,o.nicknameStartsWithFilter=n.nicknameStartsWithFilter||null,o}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&M("string",this.userIdsFilter,!0)&&c("string",this.metaDataKeyFilter,!0)&&M("string",this.metaDataValuesFilter,!0)&&c("string",this.metaDataKeyFilter,!0)},n.prototype.next=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s;return m(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=E.of(this._iid).requestQueue,t=new cr(g(g({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=o.sent(),r=n.as(lr),i=r.users,s=r.next,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw y.queryInProgress;case 4:return[3,6];case 5:throw y.invalidParameters;case 6:return[2]}}))}))},n}(ee),dr=function(n){function r(e){var r=e.userId,i=e.limit,s=e.token,o=e.userIdsFilter,a=n.call(this)||this;return a.method=t.GET,a.path="".concat(J,"/").concat(r,"/block"),a.params=u({limit:i,token:s,user_ids:o}),a}return e(r,n),r}(r),fr=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.users=n.users.map((function(t){return new T(e,t)})),r.next=n.next,r}return e(n,t),n}(s),pr=function(t){function n(e,n){var r,i=this;return(i=t.call(this,e,n)||this).userIdsFilter=null,i.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,i}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&M("string",this.userIdsFilter,!0)},n.prototype.next=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s,o,a;return m(this,(function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=E.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new dr(g(g({},this),{userId:t.userId,token:this._token})),[4,n.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(fr),o=s.users,a=s.next,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,o];case 2:return[2,[]];case 3:throw y.queryInProgress;case 4:return[3,6];case 5:throw y.invalidParameters;case 6:return[2]}}))}))},n}(ee),vr=function(n){function r(e){var r=e.userId,i=e.limit,s=e.token,o=n.call(this)||this;return o.method=t.GET,o.path="".concat(J,"/").concat(encodeURIComponent(r),"/friends"),o.params={limit:i,token:s},o}return e(r,n),r}(r),mr=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.hasMore=n.has_more,r.users=n.users.map((function(t){return new T(e,t)})),r.next=n.next,r}return e(n,t),n}(s),_r=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)},n.prototype.next=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s,o,a,u;return m(this,(function(c){switch(c.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=E.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new vr(g(g({},this),{userId:t.userId,token:this._token})),[4,n.send(r)]):[3,2]:[3,5];case 1:return i=c.sent(),s=i.as(mr),o=s.users,a=s.hasMore,u=s.next,this._token=u,this._hasNext=a,this._isLoading=!1,[2,o];case 2:return[2,[]];case 3:throw y.queryInProgress;case 4:return[3,6];case 5:throw y.invalidParameters;case 6:return[2]}}))}))},n}(ee),yr={},gr=function(){function e(e){var t=e.dbname,n=e.itemSizeLimit,r=void 0===n?1048576:n,i=e.cacheLimit,s=void 0===i?256:i,o=e.blockHashBase,a=void 0===o?2:o,u=e.blockHashMultiplier,c=void 0===u?10:u,l=e.blockHashConstant,h=void 0===l?11:l,d=e.transactionApplyDelay,f=void 0===d?200:d,p=e.disableLogger,v=void 0!==p&&p;return yr[t]||(this.itemSizeLimit=r,this.cacheLimit=s,this.blockHashBase=a,this.blockHashMultiplier=c,this.blockHashConstant=h,this.transactionApplyDelay=f,this.disableLogger=v,yr[t]=this),yr[t]}return e.get=function(e){return yr[e]},e}();!function(e){e[e.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",e[e.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",e[e.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",e[e.STORE_IS_FULL=61001003]="STORE_IS_FULL",e[e.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",e[e.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",e[e.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",e[e.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",e[e.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",e[e.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",e[e.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",e[e.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",e[e.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",e[e.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",e[e.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",e[e.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",e[e.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",e[e.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",e[e.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",e[e.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",e[e.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND"}($n||($n={}));var br,Ir=function(t){function n(e){var r=e.code,i=void 0===r?$n.UNKNOWN_ERROR:r,s=e.message,o=void 0===s?"Unknown error occurred.":s,a=t.call(this,o)||this;return a.code=i,Object.setPrototypeOf(a,n.prototype),a}return e(n,t),Object.defineProperty(n,"storeNotDefined",{get:function(){return new n({code:$n.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeNotAvailable",{get:function(){return new n({code:$n.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeNotAvailableInPrivateBrowsing",{get:function(){return new n({code:$n.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeIsFull",{get:function(){return new n({code:$n.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeKeyTypeIsInvalid",{get:function(){return new n({code:$n.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeBrokenIntegrity",{get:function(){return new n({code:$n.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeBrokenBlob",{get:function(){return new n({code:$n.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeEncryptionInvalid",{get:function(){return new n({code:$n.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeItemSizeExceeded",{get:function(){return new n({code:$n.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeReadFailed",{get:function(){return new n({code:$n.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeWriteFailed",{get:function(){return new n({code:$n.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"databaseSchemaNotOnUpgrade",{get:function(){return new n({code:$n.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionNotReady",{get:function(){return new n({code:$n.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionKeyNotMatch",{get:function(){return new n({code:$n.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionQueryNotValid",{get:function(){return new n({code:$n.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionInsertDuplicate",{get:function(){return new n({code:$n.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionKeyNotFound",{get:function(){return new n({code:$n.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionKeyNotGiven",{get:function(){return new n({code:$n.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionWriteFailed",{get:function(){return new n({code:$n.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionItemSizeExceeded",{get:function(){return new n({code:$n.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"indexTableIsRequired",{get:function(){return new n({code:$n.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"indexTypesNotMatch",{get:function(){return new n({code:$n.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"compareTypesNotMatch",{get:function(){return new n({code:$n.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"circularReferenceFound",{get:function(){return new n({code:$n.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0}),n}(Error);!function(e){e.INIT="init",e.READY="ready",e.CLOSED="closed"}(br||(br={}));var wr,Er=function(e,t){if(void 0===t&&(t=new WeakMap),"object"==typeof e&&null!==e){if(t.has(e))throw Ir.circularReferenceFound;t.set(e,!0);var n=null;if(Array.isArray(e))n=e.map((function(e){return Er(e,t)}));else if(e instanceof RegExp)n=e;else if(e instanceof Date)n=e;else for(var r in n={},e)n[r]=Er(e[r],t);return t.delete(e),n}return e},Tr=function(e,t){if(null==t)return 1;if(null==e)return-1;if(typeof e!=typeof t)throw Ir.compareTypesNotMatch;var n=0;switch(typeof e){case"boolean":case"number":n=e-t;break;case"string":n=e.localeCompare(t)}return n},kr=function(e,t){for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+(n<<6)+(n<<16)-n;return(n>>>0)%t},Sr=function(e){return new Promise((function(t){setTimeout((function(){return t()}),e)}))},Cr=function(e,t){if(!t)return!1;if("function"!=typeof e){for(var n in e){if(["/and","&&"].includes(n)){if(e[n].some((function(e){return!Cr(e,t)})))return!1}else if(["/or","||"].includes(n)){if(e[n].every((function(e){return!Cr(e,t)})))return!1}else if("/where"===n){if(!(0,e[n])(t))return!1}else{var r=n;if("object"==typeof e[r]){var i=e[r];for(var s in i)switch(s){case"/eq":case"=":if((o=t[r])!==(a=i[s]))return!1;break;case"/neq":case"!=":if((o=t[r])===(a=i[s]))return!1;break;case"/gt":case">":var o=t[r],a=i[s];if(!(Tr(o,a)>0))return!1;break;case"/gte":case">=":o=t[r],a=i[s];if(!(Tr(o,a)>=0))return!1;break;case"/lt":case"<":o=t[r],a=i[s];if(!(Tr(o,a)<0))return!1;break;case"/lte":case"<=":o=t[r],a=i[s];if(!(Tr(o,a)<=0))return!1;break;case"/in":o=t[r];if(!(a=i[s]).includes(o))return!1;break;case"/nin":o=t[r];if((a=i[s]).includes(o))return!1;break;case"/contain":o=t[r],a=i[s];if(!o.includes(a))return!1;break;case"/regex":o=t[r];if(!(a=i[s]).test(o))return!1;break;case"/where":o=t[r];if(!(0,i[s])(o))return!1}}else if("function"==typeof e[r]){if(!e[r](t[r]))return!1}else if(e[r]!==t[r])return!1}}return!0}return e(t)},Nr=function(){},Ar=function(){return Promise.resolve()},Or=function(e){return e},Pr=function(e,t){t(null)};!function(e){e[e.FORWARD=0]="FORWARD",e[e.BACKWARD=1]="BACKWARD"}(wr||(wr={}));var Ur,Mr,Rr,Lr=function(){function e(e){var t=e.initialPrevValue,n=void 0===t?null:t,r=e.initialNextValue,i=void 0===r?null:r,s=e.iterator,o=e.map,a=void 0===o?Or:o,u=e.backward,c=void 0===u?Ar:u,l=e.forward,h=void 0===l?Ar:l,d=e.complete,f=void 0===d?Nr:d;this._prevValue=n,this._nextValue=i,this._error=null,this._map=a,this._backward=c,this._forward=h,this._iterator=s,this._complete=f}return Object.defineProperty(e.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return!!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return!!this._nextValue},enumerable:!1,configurable:!0}),e.prototype.prev=function(){return v(this,void 0,void 0,(function(){var e,t,n;return m(this,(function(r){switch(r.label){case 0:if(!this.hasPrevious)return[3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._prevValue,t=this,[4,this._backward()];case 2:return t._prevValue=r.sent()||null,this._nextValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,r.sent()];case 6:this._complete(),r.label=7;case 7:return[2]}}))}))},e.prototype.next=function(){return v(this,void 0,void 0,(function(){var e,t,n;return m(this,(function(r){switch(r.label){case 0:if(!this.hasNext)return[3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._nextValue,t=this,[4,this._forward()];case 2:return t._nextValue=r.sent()||null,this._prevValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,r.sent()];case 6:this._complete(),r.label=7;case 7:return[2]}}))}))},e.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete()},e}(),xr=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,s=e.blockManager,o=e.indexer;this.condition=n,this.backward=i,this._blockManager=s,this._indexer=o}return e.prototype.findOptimizedStartPosition=function(){var e=this,t=["=","/eq",">",">=","/gt","/gte"],n=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var r=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(var i in this._indexer.fields){var s=this._indexer.fields[i],o=1;if("-"===s[0]&&(s=s.slice(1),o=-1),this.condition[s])if("object"==typeof this.condition[s]){var a=o>0?n:t;for(var u in this.condition[s])if(a.includes(u))for(var c=r;c>=0;c--)if(o*Tr(this._indexer.origin[c].columnValues[i],this.condition[s][u])<=0){r=c;break}}else for(c=r;c>=0;c--)if(o*Tr(this._indexer.origin[c].columnValues[i],this.condition[s])<=0){r=c;break}}return Math.min(r+1,this._indexer.origin.length-1)}var l=0;if("function"!=typeof this.condition)for(var h=function(r){var i=d._indexer.fields[r],s=1;if("-"===i[0]&&(i=i.slice(1),s=-1),d.condition[i])if("object"==typeof d.condition[i])Object.keys(d.condition[i]).forEach((function(o){if((s>0?t:n).includes(o))for(var a=l;a<e._indexer.origin.length;a++)if(s*Tr(e._indexer.origin[a].columnValues[r],e.condition[i][o])>=0){l=a;break}}));else for(var o=l;o<d._indexer.origin.length;o++)if(s*Tr(d._indexer.origin[o].columnValues[r],d.condition[i])>=0){l=o;break}},d=this,i=0;i<this._indexer.fields.length;i++)h(i);return Math.max(l-1,0)},e.prototype.each=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o,a,u=this;return m(this,(function(c){switch(c.label){case 0:if(t=this.findOptimizedStartPosition(),n=0,this.backward&&this._indexer.origin[t]&&(n=this._indexer.origin[t].keys.length-1),r=function(){if(u._indexer.origin[t]){if(!u._indexer.origin[t].keys[++n]){if(!u._indexer.origin[++t])return!1;n=0}return!0}return!1},i=function(){if(u._indexer.origin[t]){if(!u._indexer.origin[t].keys[--n]){if(!u._indexer.origin[--t])return!1;n=u._indexer.origin[t].keys.length-1}return!0}return!1},s=null,!this._indexer.origin[t])return[3,4];o=this.backward?i:r,c.label=1;case 1:return[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])];case 2:if(a=c.sent(),Cr(this.condition,a))return s=a,[3,4];c.label=3;case 3:if(o())return[3,1];c.label=4;case 4:return[4,new Promise((function(o){var a=new Lr({initialNextValue:Er(s),iterator:e,forward:function(){return v(u,void 0,void 0,(function(){var e,s;return m(this,(function(o){switch(o.label){case 0:e=this.backward?i:r,o.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return s=o.sent(),Cr(this.condition,s)?[2,Er(s)]:[3,1];case 3:return[2,null]}}))}))},backward:function(){return v(u,void 0,void 0,(function(){var e,s;return m(this,(function(o){switch(o.label){case 0:e=this.backward?r:i,o.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return s=o.sent(),Cr(this.condition,s)?[2,Er(s)]:[3,1];case 3:return[2,null]}}))}))},complete:o});e(a)}))];case 5:return[2,c.sent()]}}))}))},e}(),Dr=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,s=e.mutex,o=e.blockManager,a=e.indexer;this._mutex=s,this._iterator=new xr({condition:n,backward:i,blockManager:o,indexer:a})}return e.prototype.fetch=function(e){return void 0===e&&(e={}),v(this,void 0,void 0,(function(){var t,n,r,i,s=this;return m(this,(function(o){switch(o.label){case 0:if(t=Math.max(e.offset||0,0),0===(n="number"==typeof e.limit?e.limit:Number.MAX_SAFE_INTEGER))return[2,[]];if(n<0)throw Ir.collectionQueryNotValid;o.label=1;case 1:return o.trys.push([1,4,,5]),r=[],[4,this._mutex.lock()];case 2:return o.sent(),[4,this._iterator.each((function(e){return v(s,void 0,void 0,(function(){return m(this,(function(i){return e.error?e.stop():e.hasNext?0===t?(r.push(e.nextValue),0<n&&n<=r.length?e.stop():e.next()):(t--,e.next()):e.stop(),[2]}))}))}))];case 3:return o.sent(),this._mutex.unlock(),[2,r];case 4:throw i=o.sent(),this._mutex.unlock(),i;case 5:return[2]}}))}))},e.prototype.count=function(){return v(this,void 0,void 0,(function(){var e,t,n=this;return m(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),e=0,[4,this._mutex.lock()];case 1:return r.sent(),[4,this._iterator.each((function(t){return v(n,void 0,void 0,(function(){return m(this,(function(n){return t.error?t.stop():t.hasNext?(e++,t.next()):t.stop(),[2]}))}))}))];case 2:return r.sent(),this._mutex.unlock(),[2,e];case 3:throw t=r.sent(),this._mutex.unlock(),t;case 4:return[2]}}))}))},e}(),qr=function(e){return"".concat("nest","@").concat(e)},Fr=function(e,t){return"".concat(qr(e),"/").concat(t)},Br=function(e,t){return"".concat(Fr(e,t),".metadata")},Kr=function(e,t){return"".concat(Fr(e,t),"/block.")},zr=function(e,t){return"".concat(Fr(e,t),"/blob.")},Qr=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this.dbname=t,this.collectionName=n,this.store=r}return e.prototype.get=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o,a,u,c;return m(this,(function(l){switch(l.label){case 0:return[4,this.store.get(e)];case 1:return(t=l.sent())?(n=t.data,r=t.type,"undefined"==typeof fetch?[3,4]:[4,fetch(n)]):[3,5];case 2:return[4,l.sent().blob()];case 3:return[2,l.sent()];case 4:for(512,i=[],s=atob(n.split(",")[1]),o=0;o<s.length;o+=512){for(a=s.slice(o,o+512),u=new Array(a.length),c=0;c<a.length;c++)u[c]=a.charCodeAt(c);i.push(new Uint8Array(u))}return[2,new Blob(i,{type:r})];case 5:return[2,null]}}))}))},e.prototype.save=function(e,t){return void 0===t&&(t="".concat(Date.now())),v(this,void 0,void 0,(function(){var n,r,i,s,o=this;return m(this,(function(a){switch(a.label){case 0:return[4,new Promise((function(n){var r=function(e,t,n,r){return void 0===r&&(r=0),"".concat(zr(e,t)).concat(n,".").concat(r)}(o.dbname,o.collectionName,t),i=new FileReader;i.onload=function(){n({blobId:r,data:i.result,type:e.type})},i.readAsDataURL(e)}))];case 1:return n=a.sent(),r=n.blobId,i=n.data,s=n.type,[4,this.store.set({key:r,value:{data:i,type:s},generation:1})];case 2:return a.sent(),[2,r]}}))}))},e.prototype.remove=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,this.store.remove(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.clear=function(){return v(this,void 0,void 0,(function(){var e,t,n=this;return m(this,(function(r){switch(r.label){case 0:return e=zr(this.dbname,this.collectionName),[4,this.store.getAllKeys()];case 1:return t=r.sent(),[4,Promise.all(t.filter((function(t){return t.startsWith(e)})).map((function(e){return v(n,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,this.store.remove(e)];case 1:return[2,t.sent()]}}))}))})))];case 2:return r.sent(),[2]}}))}))},e}();!function(e){e[e.COMMIT=0]="COMMIT",e[e.WRITE=1]="WRITE",e[e.ERROR=2]="ERROR"}(Ur||(Ur={})),function(e){e.PENDING="pending",e.PERSISTENT="persistent",e.VOLATILE="volatile"}(Mr||(Mr={})),function(e){e[e.NO_CACHE=0]="NO_CACHE",e[e.DEFAULT=1]="DEFAULT",e[e.PERSISTENT=2]="PERSISTENT"}(Rr||(Rr={}));var jr=[Mr.PENDING,Mr.VOLATILE],Vr={},Hr=function(){function e(e){var t=e.dbname,n=e.limit,r=void 0===n?256:n;return Vr[t]||(this.dbname=t,this._items=[],this._limit=r,Vr[t]=this),Vr[t]}return e.get=function(e){return Vr[e]},Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.find=function(e,t,n){return void 0===n&&(n=Rr.DEFAULT),v(this,void 0,void 0,(function(){var r,i;return m(this,(function(s){switch(s.label){case 0:return(r=this.get(t))?[3,2]:[4,e.get(t)];case 1:return(i=s.sent())&&(r={key:t,value:i,generation:1,state:n===Rr.PERSISTENT?Mr.PERSISTENT:Mr.VOLATILE},this.put(r)),[3,3];case 2:n===Rr.PERSISTENT&&(r.state=Mr.PERSISTENT),s.label=3;case 3:return[2,r]}}))}))},e.prototype.get=function(e,t){void 0===t&&(t=Rr.DEFAULT);var n=this._items.map((function(e){return e.key})).indexOf(e);if(n>-1){var r=this._items[n];return t===Rr.PERSISTENT&&(r.state=Mr.PERSISTENT),t!==Rr.NO_CACHE&&this.put(r),r}return null},e.prototype.put=function(e){var t,n;if(this._limit>0){var r=this._items.map((function(e){return e.key})).indexOf(e.key);if(r>-1)jr.includes(this._items[r].state)&&jr.includes(e.state)?(this._items.splice(r,1),this._items.push(e)):(this._items[r].state=e.state,this._items[r].generation=e.generation,this._items[r].value=e.value);else{this._items.push(e);var i=this._items.filter((function(e){return e.state===Mr.VOLATILE})),s=i.length-this._limit;if(s>0){var o=[];try{for(var a=D(this._items),u=a.next();!u.done;u=a.next()){var c=u.value;c.state===Mr.VOLATILE&&s>0?s--:o.push(c)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}this._items=o}}}},e.prototype.remove=function(e){var t=this._items.map((function(e){return e.key})).indexOf(e);t>-1&&this._items.splice(t,1)},e.prototype.clearByCondition=function(e){this._items=this._items.filter((function(t){return!e(t)}))},e.prototype.clear=function(e){void 0===e&&(e=!1),this._items=e?[]:this._items.filter((function(e){return e.state!==Mr.VOLATILE}))},e}(),Gr=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this._metadata=null,this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=t,this.collectionName=n,this.metadataKey=function(e,t){return"".concat(Fr(e,t),"/trans.metadata")}(t,n),this.recordsetKey=function(e,t){return"".concat(Fr(e,t),"/trans.recordset")}(t,n),this._store=r}return Object.defineProperty(e.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),e.prototype._getReducedRecordset=function(e){return void 0===e&&(e=[]),v(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return[4,this._store.get(this.recordsetKey)];case 1:return(t=n.sent()||[]).push.apply(t,te([],ne(e),!1)),[2,this._reduceRecordSet(t)]}}))}))},e.prototype._reduceRecordSet=function(e){for(var t=[],n={},r=e.length-1;r>=0;r--){for(var i=e[r],s=[],o=i.requests.length-1;o>=0;o--){var a=i.requests[o],u=a.data;n[u.key]||(s.unshift(a),n[u.key]=!0)}s.length>0&&(i.requests=s,t.unshift(i))}return t},e.prototype._applyRecord=function(e,t){return v(this,void 0,void 0,(function(){var n,r,i,s,o,a,u,c,l;return m(this,(function(h){switch(h.label){case 0:n=Hr.get(this.dbname),r=t.generation,i=t.requests,s=null,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this._store.setMany(i.map((function(e){return g(g({},e.data),{generation:r})})))];case 2:for(o=h.sent(),a=0;a<i.length;a++)o[a]instanceof Error&&(s||(s=o[a]),u=i[a].data,n.put(g(g({},u),{generation:r,state:Mr.PERSISTENT})));return[3,4];case 3:return c=h.sent(),s=c,[3,4];case 4:return s?[3,6]:(l=e.filter((function(e){return e.generation!==r})),[4,this._store.set({key:this.recordsetKey,value:l,generation:r})]);case 5:return h.sent(),this._onWrite.forEach((function(e){e(i.map((function(e){return e.data})))})),[3,7];case 6:this._onError.forEach((function(e){return e(s)})),h.label=7;case 7:return[2]}}))}))},e.prototype.init=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s,o,a;return m(this,(function(u){switch(u.label){case 0:return e=this,[4,this._store.get(this.metadataKey)];case 1:return e._metadata=u.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:t=u.sent(),u.label=3;case 3:u.trys.push([3,8,9,10]),n=D(t),r=n.next(),u.label=4;case 4:return r.done?[3,7]:(i=r.value,[4,this._applyRecord(t,i)]);case 5:u.sent(),u.label=6;case 6:return r=n.next(),[3,4];case 7:return[3,10];case 8:return s=u.sent(),o={error:s},[3,10];case 9:try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(o)throw o.error}return[7];case 10:return[2]}}))}))},e.prototype.on=function(e,t,n){switch(e){case Ur.COMMIT:this._onCommit.set(t,n);break;case Ur.WRITE:this._onWrite.set(t,n);break;case Ur.ERROR:this._onError.set(t,n)}},e.prototype.requestWrite=function(e,t){void 0===t&&(t=null),this._requests.push({data:e,options:t}),Hr.get(this.dbname).put(g({state:Mr.PENDING,generation:this.generation},e))},e.prototype.requestMultipleWrite=function(e,t){var n,r;void 0===t&&(t=null);var i=Hr.get(this.dbname);try{for(var s=D(e),o=s.next();!o.done;o=s.next()){var a=o.value;this._requests.push({data:a,options:t}),i.put(g({state:Mr.PENDING,generation:this.generation},a))}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype.clear=function(){return v(this,void 0,void 0,(function(){return m(this,(function(e){return Hr.get(this.dbname).clearByCondition((function(e){return e.state===Mr.PENDING})),this._requests=[],[2]}))}))},e.prototype.commit=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s,o,a,u,c,l,h,d=this;return m(this,(function(f){switch(f.label){case 0:if(!((e=this._requests).length>0))return[3,4];for(t=[],n={},a=e.length-1;a>=0;a--)r=e[a],c=r.data,n[c.key]||(n[c.key]=!0,t.unshift(r));return i={generation:this.generation,requests:t},[4,this._getReducedRecordset([i])];case 1:return s=f.sent(),[4,this._store.set({key:this.recordsetKey,value:s,generation:this.generation})];case 2:return f.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata,generation:1})];case 3:for(f.sent(),o=Hr.get(this.dbname),a=0;a<t.length;a++)u=t[a],c=u.data,l=u.options,o.put(g(g({},c),{generation:i.generation,state:l&&l.persistent?Mr.PERSISTENT:Mr.VOLATILE}));this._requests=[],this._onCommit.forEach((function(t){t(e.map((function(e){return e.data})))})),h=gr.get(this.dbname),setTimeout((function(){try{d._applyRecord(s,i)}catch(e){d._onError.forEach((function(t){return t(e)}))}}),h.transactionApplyDelay),f.label=4;case 4:return[2]}}))}))},e}(),Wr=function(){function e(e){var t=e.blockId,n=e.keyName,r=e.items,i=void 0===r?[]:r,s=e.limit;this.blockId=t,this.keyName=n,this.limit=s,this._items=te([],ne(i),!1)}return e.createFromCacheItem=function(t){return t?new e(t.value):null},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._items.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.serialize=function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},e.prototype.getItemByKey=function(e){var t=this;return this._items.find((function(n){var r=n[t.keyName];return e===r}))},e.prototype.has=function(e){var t=this;return this._items.map((function(e){return e[t.keyName]})).includes(e)},e.prototype.add=function(e){var t=this,n=this._items.map((function(e){return e[t.keyName]})).indexOf(e[this.keyName]);return n<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[n]=e,!0)},e.prototype.remove=function(e){for(var t in this._items)if(this._items[t][this.keyName]===e)return this._items.splice(parseInt(t),1),!0;return!1},e.prototype.clear=function(){this._items=[]},e}(),Yr=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.metadata,i=e.hashFunction,s=void 0===i?kr:i,o=e.transaction,a=e.store;this.dbname=t,this.collectionName=n,this.hashFunction=s,this.metadata=r,this._transaction=o,this._store=a}return Object.defineProperty(e.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),e.prototype.createBlockId=function(e,t){return void 0===t&&(t=this.metadata.blockLevel),n=this.dbname,r=this.collectionName,i=t,s="".concat(function(e,t,n){var r=n.base*Math.pow(n.multiplier,t)+n.constant;return(n.hashFunction||kr)(e,r)}(e,t,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(Kr(n,r)).concat(i,".").concat(s);var n,r,i,s},e.prototype._findBlock=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s;return m(this,(function(o){switch(o.label){case 0:t=Hr.get(this.dbname),n=this.metadata.blockLevel,o.label=1;case 1:return n>0?(r=this.createBlockId(e,n),[4,t.find(this._store,r)]):[3,4];case 2:if((i=o.sent())&&(s=Wr.createFromCacheItem(i),s.getItemByKey(e)))return[2,s];o.label=3;case 3:return n--,[3,1];case 4:return[2,null]}}))}))},e.prototype.getFromBlock=function(e){return v(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return[4,this._findBlock(e)];case 1:return[2,(t=n.sent())?t.getItemByKey(e):null]}}))}))},e.prototype.putToBlock=function(e,t){return v(this,void 0,void 0,(function(){var n,r,i,s,o;return m(this,(function(a){switch(a.label){case 0:return n=gr.get(this.dbname),r=this.createBlockId(e),i=Math.floor(this._store.itemSizeLimit/n.itemSizeLimit),[4,Hr.get(this.dbname).find(this._store,r)];case 1:return s=a.sent(),(o=s?Wr.createFromCacheItem(s):new Wr({blockId:r,keyName:this.keyName,items:[],limit:i})).add(t)?(this._transaction.requestWrite({key:o.blockId,value:o.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.removeFromBlock=function(e){return v(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return[4,this._findBlock(e)];case 1:return(t=n.sent())&&t.remove(e)?(this._transaction.requestWrite({key:t.blockId,value:t.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.clearAllBlocks=function(){return v(this,void 0,void 0,(function(){var e,t,n;return m(this,(function(r){switch(r.label){case 0:return e=Kr(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return t=r.sent(),n=t.filter((function(t){return t.startsWith(e)})),[4,this._store.removeMany(n)];case 2:return r.sent(),[4,this._transaction.clear()];case 3:return r.sent(),Hr.get(this.dbname).clearByCondition((function(t){return t.key.startsWith(e)})),[2]}}))}))},e}(),Xr={},Jr=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.fields,s=e.transaction,o=e.store,a=this;this._origin=[],this._table=[];var u=function(e,t,n){return"".concat(Fr(e,t),"/index.").concat(n)}(t,n,i.join(">"));return Xr[u]||(this.dbname=t,this.collectionName=n,this.keyName=r,this.fields=i,this.indexerKey=u,this._transaction=s,this._store=o,this._transaction.on(Ur.COMMIT,this.indexerKey,(function(){return a.commit()})),this._transaction.on(Ur.ERROR,this.indexerKey,(function(){return a.abort()}))),Xr[u]}return e.createKey=function(e){return e.join(">")},e.parseKey=function(e){return e.split(">")},e.clearIndexerMap=function(){for(var e in Xr)delete Xr[e]},e.prototype._addItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=ne(this.indexOf(n),2),i=r[0];return r[1]?!this._table[i].keys.includes(t)&&(this._table[i].keys.push(t),!0):(this._table.splice(i,0,{columnValues:n,keys:[t]}),!0)},e.prototype._removeItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=ne(this.indexOf(n),2),i=r[0];if(r[1]){var s=this._table[i].keys.indexOf(t);if(s>-1)return this._table[i].keys.splice(s,1),0===this._table[i].keys.length&&this._table.splice(i,1),!0}return!1},Object.defineProperty(e.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),e.prototype.getColumnValues=function(e){var t,n,r,i,s=[];try{for(var o=D(this.fields),a=o.next();!a.done;a=o.next()){var u=a.value;if("-"===u[0]&&(u=u.slice(1)),r=e[u],i=void 0,i=typeof r,null!==r&&"undefined"!==i&&"boolean"!==i&&"number"!==i&&"string"!==i)throw Ir.indexTypesNotMatch;s.push(e[u])}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return s},e.prototype.diff=function(e,t){for(var n in this.fields){var r="-"===this.fields[n][0]?-1:1,i=Tr(e[n],t[n]);if(0!==i)return r*i}return 0},e.prototype.indexOf=function(e){if(this._table.length>0){for(var t=0,n=this._table.length-1;t<=n;){var r=Math.floor((t+n)/2),i=this.diff(e,this._table[r].columnValues);if(i>0)t=r+1;else{if(!(i<0))return[r,!0];n=r-1}}return[t,!1]}return[0,!1]},e.prototype.ensure=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s,o,a,u,c,l,h,d,f,p,v,_;return m(this,(function(m){switch(m.label){case 0:return[4,(e=Hr.get(this.dbname)).find(this._store,this.indexerKey,Rr.PERSISTENT)];case 1:return(t=m.sent())?[3,11]:(n=Kr(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:r=m.sent(),m.label=3;case 3:m.trys.push([3,8,9,10]),i=D(r),s=i.next(),m.label=4;case 4:return s.done?[3,7]:(o=s.value).startsWith(n)?[4,e.find(this._store,o,Rr.NO_CACHE)]:[3,6];case 5:a=m.sent(),u=Wr.createFromCacheItem(a);try{for(v=void 0,c=D(u.items),l=c.next();!l.done;l=c.next())h=l.value,this._addItem(h)}catch(e){v={error:e}}finally{try{l&&!l.done&&(_=c.return)&&_.call(c)}finally{if(v)throw v.error}}m.label=6;case 6:return s=i.next(),[3,4];case 7:return[3,10];case 8:return d=m.sent(),f={error:d},[3,10];case 9:try{s&&!s.done&&(p=i.return)&&p.call(i)}finally{if(f)throw f.error}return[7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=t.value,this._table=Er(this._origin),m.label=12;case 12:return Xr[this.indexerKey]=this,[2]}}))}))},e.prototype.drop=function(){return v(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return Hr.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return e.sent(),delete Xr[this.indexerKey],[2]}}))}))},e.prototype.addItem=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){return this._addItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.removeItem=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){return this._removeItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.clear=function(){return v(this,void 0,void 0,(function(){return m(this,(function(e){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.commit=function(){this._origin=this._table,this._table=Er(this._origin)},e.prototype.abort=function(){this._table=Er(this._origin)},e}(),Zr=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.keyHash,s=e.indexes,o=e.store,a=this;this._state=br.INIT,this._metadata=null,this._indexers=[],this.dbname=t,this.name=n,this.keyName=r,this.indexes=te([[r]],ne(s.filter((function(e){return Jr.createKey(e)!==a.keyName}))),!1),this._keyHash=i,this._store=o,this._mutex=new Vt(function(e,t){return"".concat(Fr(e,t),".lock")}(t,n)),this._blobContainer=new Qr({dbname:t,collectionName:n,store:o}),this._transaction=new Gr({dbname:t,collectionName:n,store:o})}return e.metadataOf=function(e,t,n){return v(this,void 0,void 0,(function(){var r;return m(this,(function(i){switch(i.label){case 0:return r=Br(e,t),[4,n.get(r)];case 1:return[2,i.sent()]}}))}))},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return this._state===br.READY},enumerable:!1,configurable:!0}),e.prototype.init=function(){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o,a,u,c,l,h,d,f,p,v=this;return m(this,(function(m){switch(m.label){case 0:return[4,this._mutex.lock()];case 1:m.sent(),m.label=2;case 2:return m.trys.push([2,9,,10]),t=gr.get(this.dbname),[4,e.metadataOf(this.dbname,this.name,this._store)];case 3:return n=m.sent(),this._metadata=n||{keyName:this.keyName,blockLevel:1,blockHashBase:t.blockHashBase,blockHashMultiplier:t.blockHashMultiplier,blockHashConstant:t.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:m.sent(),this._blockManager=new Yr({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=te([],ne(this.indexes),!1),i=[],s=r.map((function(e){return Jr.createKey(e)})),o=n?n.indexes.map((function(e){return Jr.createKey(e)})):[];try{for(a=D(o),u=a.next();!u.done;u=a.next())c=u.value,s.includes(c)||i.push(Jr.parseKey(c))}catch(e){f={error:e}}finally{try{u&&!u.done&&(p=a.return)&&p.call(a)}finally{if(f)throw f.error}}return(l=[]).push.apply(l,te([],ne(r.map((function(e){var t=new Jr({dbname:v.dbname,collectionName:v.name,keyName:v.keyName,fields:e,transaction:v._transaction,store:v._store});return v._indexers.push(t),t.ensure()}))),!1)),l.push.apply(l,te([],ne(i.map((function(e){return new Jr({dbname:v.dbname,collectionName:v.name,keyName:v.keyName,fields:e,transaction:v._transaction,store:v._store}).drop()}))),!1)),[4,Promise.all(l)];case 5:return m.sent(),[4,this._transaction.commit()];case 6:return m.sent(),s.sort().join(",")===o.sort().join(",")?[3,8]:(h=Br(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:h,value:this._metadata,generation:1})]);case 7:m.sent(),m.label=8;case 8:return this._state=br.READY,this._mutex.unlock(),[3,10];case 9:throw d=m.sent(),this._mutex.unlock(),d;case 10:return[2]}}))}))},e.prototype.close=function(){this._state=br.CLOSED},e.prototype._hasPropertyOfKeyName=function(e){var t=e[this.keyName];return"string"==typeof t&&!!t},e.prototype._getIndexerBy=function(e){var t,n;void 0===e&&(e=null),e||(e=[this.keyName]);var r=Jr.createKey(e);try{for(var i=D(this._indexers),s=i.next();!s.done;s=i.next()){var o=s.value;if(r===Jr.createKey(o.fields))return o}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return null},e.prototype._upgradeBlockLevel=function(){return v(this,void 0,void 0,(function(){var e;return m(this,(function(t){switch(t.label){case 0:return e=Br(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:e,value:this._metadata,generation:1})];case 1:return t.sent(),[2]}}))}))},e.prototype._requestInsert=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o;return m(this,(function(a){switch(a.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return a.sent()?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return a.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return a.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:a.sent(),a.label=5;case 5:a.trys.push([5,10,11,12]),n=D(this._indexers),r=n.next(),a.label=6;case 6:return r.done?[3,9]:[4,r.value.addItem(e)];case 7:a.sent(),a.label=8;case 8:return r=n.next(),[3,6];case 9:return[3,12];case 10:return i=a.sent(),s={error:i},[3,12];case 11:try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(s)throw s.error}return[7];case 12:return[3,14];case 13:throw Ir.collectionInsertDuplicate;case 14:return[2]}}))}))},e.prototype._requestUpsert=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o,a,u,c,l,h,d,f;return m(this,(function(p){switch(p.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=p.sent())?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return p.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return p.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:p.sent(),p.label=5;case 5:p.trys.push([5,10,11,12]),r=D(this._indexers),i=r.next(),p.label=6;case 6:return i.done?[3,9]:[4,(u=i.value).addItem(e)];case 7:p.sent(),p.label=8;case 8:return i=r.next(),[3,6];case 9:return[3,12];case 10:return s=p.sent(),l={error:s},[3,12];case 11:try{i&&!i.done&&(h=r.return)&&h.call(r)}finally{if(l)throw l.error}return[7];case 12:return[3,23];case 13:return[4,this._blockManager.putToBlock(t,e)];case 14:p.sent(),p.label=15;case 15:p.trys.push([15,21,22,23]),o=D(this._indexers),a=o.next(),p.label=16;case 16:return a.done?[3,20]:0===(u=a.value).diff(u.getColumnValues(n),u.getColumnValues(e))?[3,19]:[4,u.removeItem(n)];case 17:return p.sent(),[4,u.addItem(e)];case 18:p.sent(),p.label=19;case 19:return a=o.next(),[3,16];case 20:return[3,23];case 21:return c=p.sent(),d={error:c},[3,23];case 22:try{a&&!a.done&&(f=o.return)&&f.call(o)}finally{if(d)throw d.error}return[7];case 23:return[2]}}))}))},e.prototype._requestUpdate=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o,a,u;return m(this,(function(c){switch(c.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=c.sent())?[4,this._blockManager.putToBlock(t,e)]:[3,11];case 2:c.sent(),c.label=3;case 3:c.trys.push([3,9,10,11]),r=D(this._indexers),i=r.next(),c.label=4;case 4:return i.done?[3,8]:0===(s=i.value).diff(s.getColumnValues(n),s.getColumnValues(e))?[3,7]:[4,s.removeItem(n)];case 5:return c.sent(),[4,s.addItem(e)];case 6:c.sent(),c.label=7;case 7:return i=r.next(),[3,4];case 8:return[3,11];case 9:return o=c.sent(),a={error:o},[3,11];case 10:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(a)throw a.error}return[7];case 11:return[2]}}))}))},e.prototype._requestRemove=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o;return m(this,(function(a){switch(a.label){case 0:return[4,this._blockManager.getFromBlock(e)];case 1:return(t=a.sent())?[4,this._blockManager.removeFromBlock(e)]:[3,10];case 2:a.sent(),a.label=3;case 3:a.trys.push([3,8,9,10]),n=D(this._indexers),r=n.next(),a.label=4;case 4:return r.done?[3,7]:[4,r.value.removeItem(t)];case 5:a.sent(),a.label=6;case 6:return r=n.next(),[3,4];case 7:return[3,10];case 8:return i=a.sent(),s={error:i},[3,10];case 9:try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(s)throw s.error}return[7];case 10:return[2]}}))}))},e.prototype._requestClear=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i;return m(this,(function(s){switch(s.label){case 0:return[4,this._blockManager.clearAllBlocks()];case 1:s.sent(),s.label=2;case 2:s.trys.push([2,7,8,9]),e=D(this._indexers),t=e.next(),s.label=3;case 3:return t.done?[3,6]:[4,t.value.clear()];case 4:s.sent(),s.label=5;case 5:return t=e.next(),[3,3];case 6:return[3,9];case 7:return n=s.sent(),r={error:n},[3,9];case 8:try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}return[7];case 9:return[2]}}))}))},e.prototype.getByKey=function(e){return v(this,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,6];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(e)];case 3:return t=r.sent(),this._mutex.unlock(),[2,Er(t)];case 4:throw n=r.sent(),this._mutex.unlock(),n;case 5:return[3,7];case 6:throw Ir.collectionNotReady;case 7:return[2]}}))}))},e.prototype.query=function(e){return void 0===e&&(e={}),this.isReady?new Dr({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward}):null},e.prototype.insertOne=function(e){return v(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Ir.collectionKeyNotGiven;return[4,this._requestInsert(Er(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Ir.collectionNotReady;case 9:return[2]}}))}))},e.prototype.insertMany=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o,a,u=this;return m(this,(function(c){switch(c.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:c.sent(),c.label=2;case 2:if(c.trys.push([2,12,,14]),e.some((function(e){return!u._hasPropertyOfKeyName(e)})))throw Ir.collectionKeyNotGiven;c.label=3;case 3:c.trys.push([3,8,9,10]),t=D(e),n=t.next(),c.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestInsert(Er(r))]);case 5:c.sent(),c.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return i=c.sent(),o={error:i},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(o)throw o.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return c.sent(),this._mutex.unlock(),[2,e];case 12:return s=c.sent(),[4,this._transaction.clear()];case 13:throw c.sent(),this._mutex.unlock(),s;case 14:return[3,16];case 15:throw Ir.collectionNotReady;case 16:return[2]}}))}))},e.prototype.upsertOne=function(e){return v(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Ir.collectionKeyNotGiven;return[4,this._requestUpsert(Er(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Ir.collectionNotReady;case 9:return[2]}}))}))},e.prototype.upsertMany=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o,a,u=this;return m(this,(function(c){switch(c.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:c.sent(),c.label=2;case 2:if(c.trys.push([2,12,,14]),e.some((function(e){return!u._hasPropertyOfKeyName(e)})))throw Ir.collectionKeyNotGiven;c.label=3;case 3:c.trys.push([3,8,9,10]),t=D(e),n=t.next(),c.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestUpsert(Er(r))]);case 5:c.sent(),c.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return i=c.sent(),o={error:i},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(o)throw o.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return c.sent(),this._mutex.unlock(),[2,e];case 12:return s=c.sent(),[4,this._transaction.clear()];case 13:throw c.sent(),this._mutex.unlock(),s;case 14:return[3,16];case 15:throw Ir.collectionNotReady;case 16:return[2]}}))}))},e.prototype.update=function(e){return v(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Ir.collectionKeyNotGiven;return[4,this._requestUpdate(Er(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Ir.collectionNotReady;case 9:return[2]}}))}))},e.prototype.updateIf=function(e,t){return v(this,void 0,void 0,(function(){var n,r,i,s,o,a,u,c,l,h,d,f,p,_,y=this;return m(this,(function(g){switch(g.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,16];case 1:g.sent(),g.label=2;case 2:return g.trys.push([2,13,,15]),n=e.where,r=void 0===n?{}:n,i=e.index,s=void 0===i?null:i,o=e.backward,a=void 0!==o&&o,u=[],[4,new xr({condition:r,blockManager:this._blockManager,backward:a,indexer:this._getIndexerBy(s)}).each((function(e){return v(y,void 0,void 0,(function(){var n,i;return m(this,(function(s){if(e.error)throw e.stop(),e.error;if(e.hasNext){if(n=e.nextValue,Cr(r,n)&&t.set){if("function"!=typeof t.set)for(i in t.set)n[i]=t.set[i];else t.set(n);u.push(n)}e.next()}else e.stop();return[2]}))}))}))];case 3:g.sent(),g.label=4;case 4:g.trys.push([4,9,10,11]),c=D(u),l=c.next(),g.label=5;case 5:return l.done?[3,8]:(h=l.value,[4,this._requestUpdate(Er(h))]);case 6:g.sent(),g.label=7;case 7:return l=c.next(),[3,5];case 8:return[3,11];case 9:return d=g.sent(),p={error:d},[3,11];case 10:try{l&&!l.done&&(_=c.return)&&_.call(c)}finally{if(p)throw p.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return g.sent(),this._mutex.unlock(),[2,u];case 13:return f=g.sent(),[4,this._transaction.clear()];case 14:throw g.sent(),this._mutex.unlock(),f;case 15:return[3,17];case 16:throw this._transaction.clear(),Ir.collectionNotReady;case 17:return[2]}}))}))},e.prototype.remove=function(e){return v(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,5,,7]),[4,this._requestRemove(e)];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[3,7];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Ir.collectionNotReady;case 9:return[2]}}))}))},e.prototype.removeIf=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o,a,u,c,l,h,d,f,p,_=this;return m(this,(function(y){switch(y.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:y.sent(),y.label=2;case 2:return y.trys.push([2,13,,14]),t=e.where,n=void 0===t?{}:t,r=e.index,i=void 0===r?null:r,s=e.backward,o=void 0!==s&&s,a=[],[4,new xr({condition:n,blockManager:this._blockManager,backward:o,indexer:this._getIndexerBy(i)}).each((function(e){return v(_,void 0,void 0,(function(){var t,r;return m(this,(function(i){if(e.error)throw e.stop(),e.error;return e.hasNext?(t=e.nextValue,Cr(n,t)&&(r=t[this.keyName],a.push(r)),e.next()):e.stop(),[2]}))}))}))];case 3:y.sent(),y.label=4;case 4:y.trys.push([4,9,10,11]),u=D(a),c=u.next(),y.label=5;case 5:return c.done?[3,8]:(l=c.value,[4,this._requestRemove(l)]);case 6:y.sent(),y.label=7;case 7:return c=u.next(),[3,5];case 8:return[3,11];case 9:return h=y.sent(),f={error:h},[3,11];case 10:try{c&&!c.done&&(p=u.return)&&p.call(u)}finally{if(f)throw f.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return y.sent(),this._mutex.unlock(),[2,a];case 13:throw d=y.sent(),this._mutex.unlock(),d;case 14:return[3,16];case 15:throw this._transaction.clear(),Ir.collectionNotReady;case 16:return[2]}}))}))},e.prototype.clear=function(){return v(this,void 0,void 0,(function(){var e;return m(this,(function(t){switch(t.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return t.sent(),[4,this._transaction.commit()];case 4:return t.sent(),this._mutex.unlock(),[3,7];case 5:return e=t.sent(),[4,this._transaction.clear()];case 6:throw t.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw Ir.collectionNotReady;case 9:return[2]}}))}))},e.prototype.getBlob=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,this._blobContainer.get(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.saveBlob=function(e,t){return void 0===t&&(t=null),v(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,this._blobContainer.save(e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.removeBlob=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,this._blobContainer.remove(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.removeAllBlobs=function(){return v(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,this._blobContainer.clear()];case 1:return e.sent(),[2]}}))}))},e}(),$r=function(){function e(e){var t,n,r;this.encryption=null!==(t=e.encryption)&&void 0!==t?t:re,this.itemSizeLimit=null!==(n=e.itemSizeLimit)&&void 0!==n?n:4194304,this.metadataBuffer=null!==(r=e.metadataBuffer)&&void 0!==r?r:256}return e.prototype._getRawKey=function(e,t){return void 0===t&&(t=""),"".concat(e).concat(t)},e.prototype._generateShardPostfixArray=function(e){return void 0===e&&(e=1),te([],ne(Array(e).keys()),!1)},e.prototype._shardify=function(e){var t=this,n=e.key,r=e.value,i=JSON.stringify(this.encryption.encrypt(r)),s=Math.ceil(i.length/this.adjustedItemSizeLimit);return this._generateShardPostfixArray(s).map((function(e){var r={key:t._getRawKey(n,".".concat(e)),data:i.substring(e*t.adjustedItemSizeLimit,(e+1)*t.adjustedItemSizeLimit)};return 0===e&&(r.metadata={shards:s}),r}))},Object.defineProperty(e.prototype,"adjustedItemSizeLimit",{get:function(){return Math.max(this.itemSizeLimit-this.metadataBuffer,4)},enumerable:!1,configurable:!0}),e.prototype.usage=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s,o,a,u;return m(this,(function(c){switch(c.label){case 0:return e=0,[4,this._getAllRawKeys()];case 1:t=c.sent(),c.label=2;case 2:c.trys.push([2,7,8,9]),n=D(t),r=n.next(),c.label=3;case 3:return r.done?[3,6]:(i=r.value,[4,this._getRaw(i)]);case 4:(s=c.sent())&&(e+=JSON.stringify(s).length),c.label=5;case 5:return r=n.next(),[3,3];case 6:return[3,9];case 7:return o=c.sent(),a={error:o},[3,9];case 8:try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(a)throw a.error}return[7];case 9:return[2,e]}}))}))},e.prototype.getAllKeys=function(){return v(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,this._getAllRawKeys()];case 1:return[2,e.sent().filter((function(e){return e.endsWith(".0")})).map((function(e){return e.replace(/\.0$/,"")}))]}}))}))},e.prototype.get=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o,a=this;return m(this,(function(u){switch(u.label){case 0:return t=this._getRawKey(e,".0"),[4,this._getRaw(t)];case 1:if(!(n=u.sent()))return[3,7];u.label=2;case 2:return u.trys.push([2,6,,7]),r=n.data,(null==(i=n.metadata)?void 0:i.shards)>1?[4,Promise.all(this._generateShardPostfixArray(null==i?void 0:i.shards).map((function(t){return v(a,void 0,void 0,(function(){var n,i;return m(this,(function(s){switch(s.label){case 0:return t>0?(n=this._getRawKey(e,".".concat(t)),[4,this._getRaw(n)]):[3,2];case 1:if(!(i=s.sent()))throw Ir.storeBrokenIntegrity;return[2,i.data];case 2:return[2,r]}}))}))})))]:[3,4];case 3:return o=u.sent(),[3,5];case 4:o=[r],u.label=5;case 5:return s=o,[2,this.encryption.decrypt(JSON.parse(s.join("")))];case 6:return u.sent(),[2,null];case 7:return[2,null]}}))}))},e.prototype.set=function(e){return v(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return t=this._shardify(e),[4,this._setRaw(t)];case 1:return n.sent(),[2,g({},e.value)]}}))}))},e.prototype.setMany=function(e){return v(this,void 0,void 0,(function(){var t=this;return m(this,(function(n){switch(n.label){case 0:return[4,this._setRaw([].concat.apply([],te([],ne(e.map((function(e){return t._shardify(e)}))),!1)))];case 1:return n.sent(),[2,e.map((function(e){return e.value}))]}}))}))},e.prototype.remove=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i=this;return m(this,(function(s){switch(s.label){case 0:return t=this._getRawKey(e,".0"),[4,this._getRaw(t)];case 1:return(n=s.sent())?(r=n.metadata,[4,this._removeRaw(this._generateShardPostfixArray(null==r?void 0:r.shards).map((function(t){return i._getRawKey(e,".".concat(t))})))]):[3,3];case 2:return s.sent(),[2,!0];case 3:return[2,!1]}}))}))},e.prototype.removeMany=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o,a,u,c,l=this;return m(this,(function(h){switch(h.label){case 0:t=[],n=function(e){var n,i,s;return m(this,(function(o){switch(o.label){case 0:return n=r._getRawKey(e,".0"),[4,r._getRaw(n)];case 1:return(i=o.sent())&&(s=i.metadata,t.push.apply(t,te([],ne(r._generateShardPostfixArray(null==s?void 0:s.shards).map((function(t){return l._getRawKey(e,".".concat(t))}))),!1))),[2]}}))},r=this,h.label=1;case 1:h.trys.push([1,6,7,8]),i=D(e),s=i.next(),h.label=2;case 2:return s.done?[3,5]:(o=s.value,[5,n(o)]);case 3:h.sent(),h.label=4;case 4:return s=i.next(),[3,2];case 5:return[3,8];case 6:return a=h.sent(),u={error:a},[3,8];case 7:try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}return[7];case 8:return t.length>0?[4,this._removeRaw(t)]:[3,10];case 9:h.sent(),h.label=10;case 10:return[2,e]}}))}))},e}(),ei={},ti=function(t){function n(e){void 0===e&&(e={});var n,r=this;r=t.call(this,g(g({},e),{itemSizeLimit:null!==(n=e.itemSizeLimit)&&void 0!==n?n:4194304}))||this;var i=e.delay,s=void 0===i?1:i;return r.delay=s,r.observer={},r}return e(n,t),Object.defineProperty(n.prototype,"rawData",{get:function(){return ei[this.dbname]},set:function(e){ei[this.dbname]=e},enumerable:!1,configurable:!0}),n.prototype._getAllRawKeys=function(){return v(this,void 0,void 0,(function(){return m(this,(function(e){if(ei[this.dbname])return[2,Object.keys(ei[this.dbname])];throw Ir.storeNotAvailable}))}))},n.prototype._getRaw=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return ei[this.dbname]?[4,Sr(this.delay)]:[3,2];case 1:return t.sent(),[2,ei[this.dbname][e]?g({key:e},ei[this.dbname][e]):null];case 2:throw Ir.storeNotAvailable}}))}))},n.prototype._setRaw=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o,a,u;return m(this,(function(c){switch(c.label){case 0:return ei[this.dbname]?[4,Sr(this.delay)]:[3,2];case 1:c.sent();try{for(t=D(e),n=t.next();!n.done;n=t.next())r=n.value,i=r.key,s=r.data,o=r.metadata,ei[this.dbname][i]=Object.freeze({data:s,metadata:o})}catch(e){a={error:e}}finally{try{n&&!n.done&&(u=t.return)&&u.call(t)}finally{if(a)throw a.error}}return[3,3];case 2:throw Ir.storeNotAvailable;case 3:return[2]}}))}))},n.prototype._removeRaw=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s;return m(this,(function(o){switch(o.label){case 0:return ei[this.dbname]?[4,Sr(this.delay)]:[3,2];case 1:o.sent();try{for(t=D(e),n=t.next();!n.done;n=t.next())r=n.value,ei[this.dbname][r]&&delete ei[this.dbname][r]}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[3,3];case 2:throw Ir.storeNotAvailable;case 3:return[2]}}))}))},n.prototype.observe=function(e,t,n){var r=this;this.observer[e]||(this.observer[e]={}),t.forEach((function(t){return r.observer[e][t]=n}))},n.prototype.isAvailable=function(){return v(this,void 0,void 0,(function(){return m(this,(function(e){return[2,!0]}))}))},n.prototype.init=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){return this.dbname=e,ei[this.dbname]={},[2]}))}))},n.prototype.set=function(e){return v(this,void 0,void 0,(function(){var n;return m(this,(function(r){if(this.observer[e.key]&&"function"==typeof this.observer[e.key].set&&(n=this.observer[e.key].set()))throw n;return[2,t.prototype.set.call(this,e)]}))}))},n.prototype.setMany=function(e){return v(this,void 0,void 0,(function(){var n,r,i,s,o,a;return m(this,(function(u){try{for(n=D(e),r=n.next();!r.done;r=n.next())if(i=r.value,this.observer[i.key]&&"function"==typeof this.observer[i.key].set&&(s=this.observer[i.key].set()))throw s}catch(e){o={error:e}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(o)throw o.error}}return[2,t.prototype.setMany.call(this,e)]}))}))},n.prototype.clear=function(){return v(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,Sr(this.delay)];case 1:return e.sent(),ei[this.dbname]={},[2]}}))}))},n}($r),ni=function(t){function n(e){void 0===e&&(e={});var n,r=this;return(r=t.call(this,g(g({},e),{itemSizeLimit:null!==(n=e.itemSizeLimit)&&void 0!==n?n:104857600}))||this)._storeName="NestDBStore",r._window="undefined"!=typeof window?window:null,r._indexedDb=r._window?r._window.indexedDB||r._window.mozIndexedDB||r._window.webkitIndexedDB||r._window.msIndexedDB:null,r}return e(n,t),n.prototype._getObjectStore=function(e){return this._database.transaction(this._storeName,e).objectStore(this._storeName)},n.prototype._getAllRawKeys=function(){return v(this,void 0,void 0,(function(){var e=this;return m(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,n){var r=e._getObjectStore("readonly").getAllKeys();r.addEventListener("success",(function(e){t(e.target.result)})),r.addEventListener("error",(function(e){return n(e.target.error)}))}))];case 1:return[2,t.sent()]}}))}))},n.prototype._getRaw=function(e){return v(this,void 0,void 0,(function(){var t=this;return m(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(n,r){var i=t._getObjectStore("readonly").get(e);i.addEventListener("success",(function(e){var t;n(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.result)})),i.addEventListener("error",(function(e){return r(e.target.error)}))}))];case 1:return[2,n.sent()]}}))}))},n.prototype._setRaw=function(e){return v(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return t=this._getObjectStore("readwrite"),[4,Promise.all(e.map((function(e){return new Promise((function(n,r){var i=t.put(e);i.addEventListener("success",(function(e){n(e.target.result)})),i.addEventListener("error",(function(){r("Failed to write.")}))}))})))];case 1:return n.sent(),[2]}}))}))},n.prototype._removeRaw=function(e){return v(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return t=this._getObjectStore("readwrite"),[4,Promise.all(e.map((function(e){return new Promise((function(n,r){var i=t.delete(e);i.addEventListener("success",(function(){return n(e)})),i.addEventListener("error",(function(e){return r(e.target.error)}))}))})))];case 1:return n.sent(),[2]}}))}))},n.prototype.isAvailable=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i=this;return m(this,(function(s){switch(s.label){case 0:if(!((null==(e="undefined"!=typeof window?window:null)?void 0:e.indexedDB)||(null==e?void 0:e.mozIndexedDB)||(null==e?void 0:e.webkitIndexedDB)||(null==e?void 0:e.msIndexedDB)))return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),this._indexedDb=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,t="undefined"!=typeof document&&"undefined"!=typeof navigator,n=navigator.userAgent&&navigator.userAgent.includes("Firefox/")&&!navigator.userAgent.includes("Seamonkey/"),r=navigator.userAgent&&navigator.userAgent.includes("Edge/"),[4,new Promise((function(s,o){if(t)if(n){var a=i._indexedDb.open("_testMozilla");a.onerror=function(){return o("Private browsing mode.")},a.onsuccess=function(){return s()}}else r?(e.PointerEvent||e.MSPointerEvent)&&o("Private browsing mode."):s()}))];case 2:return s.sent(),[2,!0];case 3:return s.sent(),[2,!1];case 4:return[2,!1]}}))}))},n.prototype.init=function(e){return v(this,void 0,void 0,(function(){var t,n=this;return m(this,(function(r){switch(r.label){case 0:return this.dbname=e,[4,new Promise((function(e,t){if(n._window&&Dt)if(qt){var r=n._indexedDb.open("_testMozilla");r.onerror=function(){return t(Ir.storeNotAvailableInPrivateBrowsing)},r.onsuccess=function(){return e()}}else Kt?n._window.indexedDB||!n._window.PointerEvent&&!n._window.MSPointerEvent||t(Ir.storeNotAvailableInPrivateBrowsing):e();else t(Ir.storeNotAvailable)}))];case 1:return r.sent(),t=this,[4,new Promise((function(t,r){var i=n._indexedDb.open(e);i.addEventListener("upgradeneeded",(function(e){e.target.result.createObjectStore("NestDBStore",{keyPath:"key"})})),i.addEventListener("success",(function(e){return t(e.target.result)})),i.addEventListener("error",(function(e){return r(e.target.error)}))}))];case 2:return t._database=r.sent(),[2]}}))}))},n.prototype.clear=function(){return v(this,void 0,void 0,(function(){var e=this;return m(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,n){var r=e._getObjectStore("readwrite").clear();r.addEventListener("success",(function(){return t()})),r.addEventListener("error",(function(e){return n(e.target.error)}))}))];case 1:return[2,t.sent()]}}))}))},n}($r),ri=function(t){function n(e){var n=this,r=e.AsyncStorage,i=e.itemSizeLimit,s=void 0===i?6291456:i,o=ie(e,["AsyncStorage","itemSizeLimit"]);return(n=t.call(this,g(g({},o),{itemSizeLimit:s}))||this)._asyncStorage=r,n}return e(n,t),n.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},n.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},n.prototype._getAllRawKeys=function(){return v(this,void 0,void 0,(function(){var e,t=this;return m(this,(function(n){switch(n.label){case 0:return[4,this._asyncStorage.getAllKeys()];case 1:return e=n.sent(),[2,e.filter((function(e){return t._isBelonging(e)})).map((function(e){return e.substring("".concat(t.dbname,"/").length)}))]}}))}))},n.prototype._getRaw=function(e){return v(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return[4,this._asyncStorage.getItem(this._getActualKey(e))];case 1:return[2,(t=n.sent())?JSON.parse(t):null]}}))}))},n.prototype._setRaw=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o,a;return m(this,(function(u){switch(u.label){case 0:t=[];try{for(n=D(e),r=n.next();!r.done;r=n.next())i=r.value,s=i.key,i.data.length<=this.adjustedItemSizeLimit&&t.push([this._getActualKey(s),JSON.stringify(i)])}catch(e){o={error:e}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(o)throw o.error}}return[4,this._asyncStorage.multiSet(t)];case 1:return u.sent(),[2]}}))}))},n.prototype._removeRaw=function(e){return v(this,void 0,void 0,(function(){var t=this;return m(this,(function(n){switch(n.label){case 0:return[4,this._asyncStorage.multiRemove(e.map((function(e){return t._getActualKey(e)})))];case 1:return n.sent(),[2]}}))}))},n.prototype.isAvailable=function(){return v(this,void 0,void 0,(function(){return m(this,(function(e){return[2,!!this._asyncStorage]}))}))},n.prototype.init=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){return this.dbname=e,[2]}))}))},n.prototype.clear=function(){return v(this,void 0,void 0,(function(){var e;return m(this,(function(t){switch(t.label){case 0:return[4,this.getAllKeys()];case 1:return e=t.sent(),[4,this.removeMany(e)];case 2:return t.sent(),[2]}}))}))},n}($r);!function(t){function n(e){var n,r=this;return(r=t.call(this,g(g({},e),{itemSizeLimit:null!==(n=e.itemSizeLimit)&&void 0!==n?n:6291456}))||this)._mmkv=e.MMKV,r}e(n,t),n.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},n.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},n.prototype._getAllRawKeys=function(){return v(this,void 0,void 0,(function(){var e,t=this;return m(this,(function(n){switch(n.label){case 0:return[4,this._mmkv.getAllKeys()];case 1:return e=n.sent(),[2,e.filter((function(e){return t._isBelonging(e)})).map((function(e){return e.substring("".concat(t.dbname,"/").length)}))]}}))}))},n.prototype._getRaw=function(e){return v(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return[4,this._mmkv.getString(this._getActualKey(e))];case 1:return[2,(t=n.sent())?JSON.parse(t):null]}}))}))},n.prototype._setRaw=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o;return m(this,(function(a){try{for(t=D(e),n=t.next();!n.done;n=t.next())r=n.value,i=r.key,r.data.length<=this.adjustedItemSizeLimit&&this._mmkv.set(this._getActualKey(i),JSON.stringify(r))}catch(e){s={error:e}}finally{try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(s)throw s.error}}return[2]}))}))},n.prototype._removeRaw=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s;return m(this,(function(o){try{for(t=D(e),n=t.next();!n.done;n=t.next())r=n.value,this._mmkv.delete(this._getActualKey(r))}catch(e){i={error:e}}finally{try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}}return[2]}))}))},n.prototype.isAvailable=function(){return v(this,void 0,void 0,(function(){return m(this,(function(e){return[2,!!this._mmkv]}))}))},n.prototype.init=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){return this.dbname=e,[2]}))}))},n.prototype.clear=function(){return v(this,void 0,void 0,(function(){var e;return m(this,(function(t){switch(t.label){case 0:return[4,this.getAllKeys()];case 1:return e=t.sent(),[4,this.removeMany(e)];case 2:return t.sent(),[2]}}))}))}}($r);var ii,si=!0,oi=function(){function e(){}return e.off=function(){si=!1},e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];si&&console.log.apply(console,te(["".concat("[NESTDB]","[LOG]")],ne(e),!1))},e.warning=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];si&&console.warn.apply(console,te(["".concat("[NESTDB]","[WARNING]")],ne(e),!1))},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];si&&console.error.apply(console,te(["".concat("[NESTDB]","[ERROR]")],ne(e),!1))},e}();!function(e){e.INIT="INIT",e.OPENING="OPENING",e.OPENED="OPENED",e.CLOSED="CLOSED"}(ii||(ii={}));var ai,ui=function(){function e(e){var t=e.name,n=e.version,r=e.store,i=e.config;this.name=t,this._version=n,this._state=ii.INIT,this._config=i||new gr({dbname:t}),this._store=r,this._event={success:Nr,error:Nr,upgrade:Pr},this._collections=new Map,this._globalMutex=new Vt("".concat(this.name,".lock")),this._config.disableLogger&&oi.off(),new Hr({dbname:t,limit:this._config.cacheLimit})}return Object.defineProperty(e.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),e.prototype.estimateUsage=function(){return v(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,(t=this._store,v(void 0,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,t.usage()];case 1:return[2,e.sent()]}}))})))];case 1:return[2,e.sent()]}var t}))}))},e.prototype.commitSchema=function(e){return v(this,void 0,void 0,(function(){var t=this;return m(this,(function(n){switch(n.label){case 0:return this._state!==ii.OPENING?[3,2]:[4,Promise.all(e.map((function(e){return v(t,void 0,void 0,(function(){var t,n,r,i;return m(this,(function(s){switch(s.label){case 0:return t=e.collectionName,n=e.keyName,r=e.index,i=void 0===r?[]:r,this._collections.has(t)||this._collections.set(t,new Zr({dbname:this.name,collectionName:t,keyName:n,indexes:i,store:this._store})),[4,this._collections.get(t).init()];case 1:return s.sent(),[2]}}))}))})))];case 1:return n.sent(),[3,3];case 2:throw Ir.databaseSchemaNotOnUpgrade;case 3:return[2]}}))}))},e.prototype.open=function(){var e;return v(this,void 0,void 0,(function(){var t,n,r,i,s=this;return m(this,(function(o){switch(o.label){case 0:return[4,this._globalMutex.lock()];case 1:if(o.sent(),this._state===ii.OPENED)return[3,15];this._state=ii.OPENING,o.label=2;case 2:return o.trys.push([2,5,,15]),[4,this._store.init(this.name)];case 3:return o.sent(),a=this.name,t="".concat(qr(a),".metadata"),n={version:0,collectionNames:[]},[4,this._store.get(t)];case 4:return r=null!==(e=o.sent())&&void 0!==e?e:n,[2,new Promise((function(e,n){var i=function(e){r.version<s._version?s._event.upgrade(r.version,(function(n){return v(s,void 0,void 0,(function(){var i;return m(this,(function(s){switch(s.label){case 0:if(n)return[3,5];r.version++,r.collectionNames=Array.from(this._collections.keys()),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._store.set({key:t,value:r,generation:this._version})];case 2:return s.sent(),e({continued:!0}),[3,4];case 3:return i=s.sent(),e({continued:!1,err:i}),[3,4];case 4:return[3,6];case 5:e({continued:!1,err:n}),s.label=6;case 6:return[2]}}))}))})):e({continued:!1})},o=function(t){var a=t.continued,u=void 0!==a&&a,c=t.err,l=void 0===c?null:c;if(u)setTimeout((function(){return i(o)}),10);else if(l)oi.error(l.message),s._globalMutex.unlock(),s._event.error(l),n(l);else{var h=[];r.collectionNames.forEach((function(e){s._collections.has(e)||h.push(v(s,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return[4,Zr.metadataOf(this.name,e,this._store)];case 1:return(t=r.sent())?(n=new Zr({dbname:this.name,collectionName:e,keyName:t.keyName,indexes:t.indexes,store:this._store}),this._collections.set(e,n),[4,n.init()]):[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))})))})),Promise.all(h).then((function(){s._state=ii.OPENED,s._globalMutex.unlock(),s._event.success(),e()})).catch((function(e){oi.error(e.message),s._globalMutex.unlock(),s._event.error(e),n(e)}))}};i(o)}))];case 5:switch(i=o.sent(),i.code){case $n.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return[3,6];case $n.STORE_NOT_AVAILABLE:return[3,8];case $n.STORE_ENCRYPTION_INVALID:return[3,10]}return[3,13];case 6:return oi.warning("Access to the local storage is not allowed in private browsing. Switched to MemoryStore automatically."),this._store=new ti({}),this._globalMutex.unlock(),this._event.error(i),[4,this.open()];case 7:return o.sent(),[3,14];case 8:return oi.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new ti({}),this._globalMutex.unlock(),this._event.error(i),[4,this.open()];case 9:return o.sent(),[3,14];case 10:return oi.warning("Encryption algorithm has changed. Stored data would be cleared."),[4,this._store.clear()];case 11:return o.sent(),this._globalMutex.unlock(),this._event.error(i),[4,this.open()];case 12:return o.sent(),[3,14];case 13:throw oi.error(i.message),this._globalMutex.unlock(),this._event.error(i),i;case 14:return[3,15];case 15:return[2]}var a}))}))},e.prototype.close=function(){this._collections.forEach((function(e){return e.close()})),this._state=ii.CLOSED},e.prototype.clear=function(){return v(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,Promise.all(Array.from(this._collections.values()).map((function(e){return e.clear()})))];case 1:return e.sent(),[2]}}))}))},e.prototype.reset=function(){return v(this,void 0,void 0,(function(){var e,t=this;return m(this,(function(n){switch(n.label){case 0:return this.close(),(e=Hr.get(this.name))&&e.clearByCondition((function(e){return e.key.startsWith(qr(t.name))})),[4,this._store.clear()];case 1:return n.sent(),[2]}}))}))},e.prototype.on=function(e,t){this._event[e]=t},e.prototype.off=function(e){if("function"==typeof this._event[e])if("upgrade"===e)this._event[e]=Pr;else this._event[e]=Nr},e.prototype.collection=function(e){return this._collections.get(e)||null},e}();!function(e){e.MUTED="muted",e.BANNED="banned"}(ai||(ai={}));var ci,li=function(){function e(e){var t,n,r;this.restrictionType=null,this.description=null,this.endAt=-1,d(ai,e.restriction_type)&&(this.restrictionType=e.restriction_type),this.description=null!==(t=e.description)&&void 0!==t?t:null,this.endAt=null!==(r=null!==(n=e.end_at)&&void 0!==n?n:e.muted_end_at)&&void 0!==r?r:-1}return e.payloadify=function(e){return e?u({restriction_type:e.restrictionType,description:e.description,end_at:e.endAt}):null},e}(),hi=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.restrictionInfo=null,r.restrictionInfo=new li(n),r}return e(n,t),n.payloadify=function(e){return e?u(g(g({},t.payloadify.call(this,e)),li.payloadify(e.restrictionInfo))):null},n}(T),di={data:null,customType:null,mentionType:U.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},fi=function(e){return c("string",e.data,!0)&&c("string",e.customType,!0)&&d(U,e.mentionType)&&M("string",e.mentionedUserIds,!0)&&M(T,e.mentionedUsers,!0)&&c("string",e.mentionedMessageTemplate,!0)&&M(R,e.metaArrays,!0)&&d(L,e.pushNotificationDeliveryOption,!0)&&c(x,e.appleCriticalAlertOptions,!0)},pi=g(g({},di),{message:null,translationTargetLanguages:null,pollId:null}),vi=function(e){return fi(e)&&c("string",e.message,!0)&&M("string",e.translationTargetLanguages,!0)&&c("number",e.pollId,!0)},mi=g({},di),_i=function(n){function r(e){var r=e.channelUrl,i=e.channelType,s=e.token,o=e.limit,u=n.call(this)||this;return u.method=t.GET,u.path="".concat(a(i),"/").concat(encodeURIComponent(r),"/operators"),u.params={token:s,limit:o},u}return e(r,n),r}(r),yi=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.operators=n.operators.map((function(t){return new T(e,t)})),r.token=n.next,r}return e(n,t),n}(s),gi=function(t){function n(e,n,r,i){return t.call(this,e,n,r,i)||this}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)},n.prototype.next=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s,o;return m(this,(function(a){switch(a.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,t=E.of(this._iid).requestQueue,n=new _i(g(g({},this),{channelUrl:this.channelUrl,token:this._token})),[4,t.send(n)]):[3,2]):[3,5];case 1:return r=a.sent(),i=r.as(yi),s=i.operators,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,s];case 2:return[2,e];case 3:throw y.queryInProgress;case 4:return[3,6];case 5:throw y.invalidParameters;case 6:return[2]}}))}))},n}(w),bi=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.limit,u=e.token;return(r=n.call(this)||this).method=t.GET,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/mute"),r.params={limit:o,token:u},r}return e(r,n),r}(r),Ii=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.token=null,r.mutedUsers=[];var i=n.next,s=n.muted_list;return r.token=i,s&&s.length>0&&(r.mutedUsers=s.map((function(t){return new hi(e,t)}))),r}return e(n,t),n}(s),wi=function(t){function n(e,n,r,i){return t.call(this,e,n,r,i)||this}return e(n,t),n.prototype.next=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s;return m(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=E.of(this._iid).requestQueue,t=new bi(g(g({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=o.sent(),r=n.as(Ii),i=r.mutedUsers,s=r.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw y.queryInProgress;case 4:return[3,6];case 5:throw y.invalidParameters;case 6:return[2]}}))}))},n}(w),Ei=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.limit,c=e.token;return(r=n.call(this)||this).method=t.GET,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/ban"),r.params=u({limit:o,token:c}),r}return e(r,n),r}(r),Ti=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.token=null,r.bannedUsers=[];var i=n.next,s=n.banned_list;return r.token=i,s&&s.length>0&&(r.bannedUsers=s.map((function(t){return new hi(e,t.user)}))),r}return e(n,t),n}(s),ki=function(t){function n(e,n,r,i){return t.call(this,e,n,r,i)||this}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)},n.prototype.next=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s;return m(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=E.of(this._iid).requestQueue,t=new Ei(g(g({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=o.sent(),r=n.as(Ti),i=r.bannedUsers,s=r.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw y.queryInProgress;case 4:return[3,6];case 5:throw y.invalidParameters;case 6:return[2]}}))}))},n}(w);!function(e){e.SPAM="spam",e.HARASSING="harassing",e.SUSPICIOUS="suspicious",e.INAPPROPRIATE="inappropriate"}(ci||(ci={}));var Si=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.operatorUserIds;return(r=n.call(this)||this).method=t.POST,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/operators"),r.params={operator_ids:o},r}return e(r,n),r}(r);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var Ci=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.operatorUserIds;return(r=n.call(this)||this).method=t.DELETE,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/operators"),r.params={operator_ids:o},r}return e(r,n),r}(r);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(s);var Ni=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.userId;return(r=n.call(this)||this).method=t.GET,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/mute/").concat(o),r}return e(r,n),r}(r),Ai=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.isMuted=!1,r.startAt=null,r.endAt=null,r.remainingDuration=null,r.description=null;var i=n.is_muted,s=n.start_at,o=n.end_at,a=n.remaining_duration,u=n.description;return r.isMuted=i,r.startAt=s,r.endAt=o,r.remainingDuration=a,r.description=u,r}return e(n,t),n}(s),Oi=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.keys;return(r=n.call(this)||this).method=t.GET,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={keys:o,include_ts:!0},r}return e(r,n),r}(r),Pi=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.ts=null;var i=n.metadata,s=n.ts;return r.metadata=i,r.ts=null!=s?s:null,r}return e(n,t),n}(s),Ui=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.metadata;return(r=n.call(this)||this).method=t.POST,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={metadata:o,include_ts:!0},r}return e(r,n),r}(r),Mi=function(t){function n(e,n){var r,i,s=this;return(s=t.call(this,e,n)||this).metaData=null!==(r=n.metadata)&&void 0!==r?r:{},s.ts=null!==(i=n.ts)&&void 0!==i?i:null,s}return e(n,t),n}(s),Ri=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.metadata,u=e.upsert;return(r=n.call(this)||this).method=t.PUT,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={metadata:o,include_ts:!0,upsert:null!=u&&u},r}return e(r,n),r}(r),Li=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.ts=null;var i=n.metadata,s=n.ts;return r.metadata=i,r.ts=null!=s?s:null,r}return e(n,t),n}(s),xi=function(t){function n(e,n,r){var i=t.call(this,e,"SYEV",r)||this;return i.created=null,i.updated=null,i.deleted=null,r.data&&(i.created=r.data.created,i.updated=r.data.updated,i.deleted=r.data.deleted),i}return e(n,t),n}(X),Di=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.key;return(r=n.call(this)||this).method=t.DELETE,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/metadata/").concat(o),r.params={include_ts:!0},r}return e(r,n),r}(r),qi=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.ts=null;var i=n.ts;return r.ts=null!=i?i:null,r}return e(n,t),n}(s),Fi=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType;return(r=n.call(this)||this).method=t.DELETE,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={include_ts:!0},r}return e(r,n),r}(r),Bi=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.ts=null;var i=n.ts;return r.ts=null!=i?i:null,r}return e(n,t),n}(s),Ki=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.keys;return(r=n.call(this)||this).method=t.GET,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={keys:o},r}return e(r,n),r}(r),zi=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.metaCounter=n,r}return e(n,t),n}(s),Qi=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.metaCounter;return(r=n.call(this)||this).method=t.POST,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={metacounter:o},r}return e(r,n),r}(r),ji=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.metaCounter=n,r}return e(n,t),n}(s),Vi=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.metaCounter,u=e.upsert,c=void 0!==u&&u,l=e.mode,h=void 0===l?"set":l;return(r=n.call(this)||this).method=t.PUT,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={metacounter:o,upsert:c,mode:h},r}return e(r,n),r}(r),Hi=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.metaCounter=n,r}return e(n,t),n}(s),Gi=function(t){function n(e,n,r){var i=t.call(this,e,"SYEV",r)||this;return i.created=null,i.updated=null,i.deleted=null,r.data&&(i.created=r.data.created,i.updated=r.data.updated,i.deleted=r.data.deleted),i}return e(n,t),n}(X),Wi=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.key;return(r=n.call(this)||this).method=t.DELETE,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/metacounter/").concat(o),r.params=null,r}return e(r,n),r}(r);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(s);var Yi=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType;return(r=n.call(this)||this).method=t.DELETE,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params=null,r}return e(r,n),r}(r);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var Xi=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.userId,u=e.seconds,c=e.description;return(r=n.call(this)||this).method=t.POST,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/mute"),r.params={user_id:o,seconds:u,description:c},r}return e(r,n),r}(r);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(s);var Ji=function(t){function n(e,n,r){var i=t.call(this,e,"SYEV",r)||this;return i.user=new hi(e,r.data),i}return e(n,t),n}(X),Zi=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.userId;return(r=n.call(this)||this).method=t.DELETE,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/mute/").concat(encodeURIComponent(o)),r}return e(r,n),r}(r);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var $i=function(t){function n(e,n,r){var i=t.call(this,e,"SYEV",r)||this;return i.user=new hi(e,r.data),i}return e(n,t),n}(X),es=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.userId,c=e.seconds,l=e.description;return(r=n.call(this)||this).method=t.POST,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/ban"),r.params=u({user_id:o,seconds:c,description:l}),r}return e(r,n),r}(r);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var ts=function(t){function n(e,n,r){var i=t.call(this,e,"SYEV",r)||this;return i.memberCount=null,i.joinedMemberCount=null,i.user=new hi(e,r.data),r.data.member_count&&(i.memberCount=r.data.member_count),r.data.joined_member_count&&(i.joinedMemberCount=r.data.joined_member_count),i}return e(n,t),n}(X),ns=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.userId;return(r=n.call(this)||this).method=t.DELETE,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/ban/").concat(encodeURIComponent(o)),r}return e(r,n),r}(r);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var rs=function(t){function n(e,n,r){var i=t.call(this,e,"SYEV",r)||this;return i.user=new hi(e,r.data),i}return e(n,t),n}(X),is=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.freezing;return(r=n.call(this)||this).method=t.PUT,r.path="".concat(a(s),"/").concat(encodeURIComponent(i),"/freeze"),r.params={freeze:o},r}return e(r,n),r}(r);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var ss=function(t){function n(e,n,r){var i=t.call(this,e,"SYEV",r)||this;return i.freeze=r.data.freeze,i}return e(n,t),n}(X),os=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.category,a=e.userId,u=e.description;return(r=n.call(this)||this).method=t.POST,r.path="".concat(se(s),"/").concat(encodeURIComponent(i)),r.params={report_category:o,reporting_user_id:a,report_description:u},r}return e(r,n),r}(r),as=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.category,a=e.userId,u=e.offendingUserId,c=e.description;return(r=n.call(this)||this).method=t.POST,r.path="".concat(oe,"/users/").concat(u),r.params={channel_url:i,channel_type:s===f.OPEN?"open_channels":"group_channels",report_category:o,reporting_user_id:a,report_description:c},r}return e(r,n),r}(r),us=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,o=e.category,a=e.userId,u=e.offendingUserId,c=e.messageId,l=e.description;return(r=n.call(this)||this).method=t.POST,r.path="".concat(se(s),"/").concat(encodeURIComponent(i),"/messages/").concat(c),r.params={report_category:o,reporting_user_id:a,report_description:l,offending_user_id:u},r}return e(r,n),r}(r),cs=function(t){function n(e){var n=[];return e.mentionType===U.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map((function(e){return e.userId})))),t.call(this,{code:"MESG",ackRequired:!0,payload:u({channel_url:e.channelUrl,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:n,mentioned_message_template:e.mentionedMessageTemplate,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==L.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:e.parentMessageId>0?e.parentMessageId:null,req_id:e.reqId,poll_id:e.pollId,pin_message:e.isPinnedMessage})})||this}return e(n,t),n}(ae),ls=function(t){function n(e,n,r){var i,s,o,a=this;(a=t.call(this,e,"MESG",r)||this).message=new q(e,r);var u=E.of(e).sdkState;return a.isMentioned=ue(a.message.mentionType,null!==(i=a.message.mentionedUserIds)&&void 0!==i?i:null===(s=a.message.mentionedUsers)||void 0===s?void 0:s.map((function(e){return e.userId})),u.userId),a.forceUpdateLastMessage=null!==(o=r.force_update_last_message)&&void 0!==o&&o,a}return e(n,t),n}(X),hs=function(t){function n(e){var n,r=null;return e.mentionType===U.USERS&&(e.mentionedUserIds?r=e.mentionedUserIds:e.mentionedUsers&&(r=e.mentionedUsers.map((function(e){return e.userId})))),t.call(this,{code:"MEDI",ackRequired:!0,payload:u({channel_url:e.channelUrl,msg_id:e.messageId,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:r,mentioned_message_template:e.mentionedMessageTemplate,apple_critical_alert_options:null===(n=e.appleCriticalAlertOptions)||void 0===n?void 0:n.serialize(),poll_id:e.pollId})})||this}return e(n,t),n}(ae),ds=function(t){function n(e,n,r){var i,s,o,a,u,c,l=this;(l=t.call(this,e,"MEDI",r)||this).message=new q(e,r);var h=E.of(e).sdkState;return l.mentionCountChange=ce({mentionType:null!==(s=null===(i=r.old_values)||void 0===i?void 0:i.mention_type)&&void 0!==s?s:null,mentionedUserIds:null!==(a=null===(o=r.old_values)||void 0===o?void 0:o.mentioned_user_ids)&&void 0!==a?a:[]},{mentionType:l.message.mentionType,mentionedUserIds:null!==(u=l.message.mentionedUserIds)&&void 0!==u?u:null===(c=l.message.mentionedUsers)||void 0===c?void 0:c.map((function(e){return e.userId}))},h.userId),l}return e(n,t),n}(X),fs=function(t){function n(e){var n=null;return e.mentionType===U.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map((function(e){return e.userId})))),t.call(this,{code:"FEDI",ackRequired:!0,payload:u({channel_url:e.channelUrl,msg_id:e.messageId,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:n,apple_critical_alert_options:e.appleCriticalAlertOptions})})||this}return e(n,t),n}(ae),ps=function(t){function n(e,n,r){var i,s,o,a,u,c,l=this;(l=t.call(this,e,"FEDI",r)||this).message=new F(e,r);var h=E.of(e).sdkState;return l.mentionCountChange=ce({mentionType:null!==(s=null===(i=r.old_values)||void 0===i?void 0:i.mention_type)&&void 0!==s?s:null,mentionedUserIds:null!==(a=null===(o=r.old_values)||void 0===o?void 0:o.mentioned_user_ids)&&void 0!==a?a:[]},{mentionType:l.message.mentionType,mentionedUserIds:null!==(u=l.message.mentionedUserIds)&&void 0!==u?u:null===(c=l.message.mentionedUsers)||void 0===c?void 0:c.map((function(e){return e.userId}))},h.userId),l}return e(n,t),n}(X),vs=function(n){function r(e){var r=n.call(this)||this;return r.method=t.DELETE,r.path="".concat(a(e.channelType),"/").concat(e.channelUrl,"/messages/").concat(e.messageId),r}return e(r,n),r}(r);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var ms=function(t){function n(e,n,r){var i=t.call(this,e,"DELM",r)||this;return i.channelUrl=r.channel_url,i.channelType=r.channel_type,i.messageId=Number(r.msg_id),i}return e(n,t),n}(X),_s=function(n){function r(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.reactionKey,u=n.call(this)||this;return u.method=t.POST,u.path="".concat(a(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/reactions"),u.params={reaction:o},u}return e(r,n),r}(r),ys=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.reactionEvent=new le(n),r}return e(n,t),n}(s),gs=function(n){function r(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.reactionKey,u=n.call(this)||this;return u.method=t.DELETE,u.path="".concat(a(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/reactions"),u.params={reaction:o},u}return e(r,n),r}(r),bs=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.reactionEvent=new le(g({},n)),r}return e(n,t),n}(s),Is=function(n){function r(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,o=e.translationTargetLanguages,u=n.call(this)||this;return u.method=t.POST,u.path="".concat(a(r),"/").concat(encodeURIComponent(i),"/messages/").concat(encodeURIComponent(s),"/translation"),u.params={target_langs:o},u}return e(r,n),r}(r),ws=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.message=new q(e,n),r}return e(n,t),n}(s),Es=function(n){function r(e){var r,i=this;i=n.call(this)||this;var s=[];e.mentionType===U.USERS&&(e.mentionedUserIds?s=e.mentionedUserIds:e.mentionedUsers&&(s=e.mentionedUsers.map((function(e){return e.userId}))));var o=e.channelType,u=e.channelUrl;return i.method=t.POST,i.path="".concat(a(o),"/").concat(encodeURIComponent(u),"/scheduled_messages"),i.params={req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:he.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:s,sorted_metaarray:null===(r=e.metaArrays)||void 0===r?void 0:r.map((function(e){return R.payloadify(e)})),apple_critical_alert_options:x.payloadify(e.appleCriticalAlertOptions),target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption},i}return e(r,n),r}(r),Ts=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.message=new q(e,n),r}return e(n,t),n}(s),ks=function(n){function r(e){var r,i=this;i=n.call(this)||this;var s=[];e.mentionType===U.USERS&&(e.mentionedUserIds?s=e.mentionedUserIds:e.mentionedUsers&&(s=e.mentionedUsers.map((function(e){return e.userId}))));var o=e.channelType,u=e.channelUrl;return i.method=t.POST,i.path="".concat(a(o),"/").concat(encodeURIComponent(u),"/scheduled_messages"),i.params={req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:he.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:e.thumbnailSizes?e.thumbnailSizes.map((function(e){return de.payloadify(e)})):[],custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:s,sorted_metaarray:null===(r=e.metaArrays)||void 0===r?void 0:r.map((function(e){return R.payloadify(e)})),apple_critical_alert_options:x.payloadify(e.appleCriticalAlertOptions),push_option:e.pushNotificationDeliveryOption},i}return e(r,n),r}(r),Ss=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.message=new F(e,n),r}return e(n,t),n}(s),Cs=function(r){function i(e){var i=e.pollId,s=e.title,o=e.data,a=e.allowUserSuggestion,u=e.allowMultipleVotes,c=e.closeAt,l=r.call(this)||this;return l.method=t.PUT,l.path="".concat(n,"/").concat(encodeURIComponent(i)),l.params={title:s,data:o,allow_user_suggestion:a,allow_multiple_votes:u,close_at:c},l}return e(i,r),i}(r),Ns=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.poll=new i(e,n),r}return e(n,t),n}(s),As=function(r){function i(e){var i=e.pollId,s=r.call(this)||this;return s.method=t.DELETE,s.path="".concat(n,"/").concat(encodeURIComponent(i)),s}return e(i,r),i}(r);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var Os=function(r){function i(e){var i=e.pollId,s=r.call(this)||this;return s.method=t.PUT,s.path="".concat(n,"/").concat(encodeURIComponent(i),"/close"),s}return e(i,r),i}(r),Ps=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.poll=new i(e,n),r}return e(n,t),n}(s),Us=function(r){function i(e){var i=e.channelUrl,s=e.channelType,o=e.pollId,a=e.optionText,u=r.call(this)||this;return u.method=t.POST,u.path="".concat(n,"/").concat(encodeURIComponent(o),"/options"),u.params={channel_url:i,channel_type:s,text:a},u}return e(i,r),i}(r),Ms=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.poll=new i(e,n),r}return e(n,t),n}(s),Rs=function(r){function i(e){var i=e.pollId,s=e.pollOptionId,o=e.optionText,a=r.call(this)||this;return a.method=t.PUT,a.path="".concat(n,"/").concat(encodeURIComponent(i),"/options/").concat(encodeURIComponent(s)),a.params={text:o},a}return e(i,r),i}(r),Ls=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.poll=new i(e,n),r}return e(n,t),n}(s),xs=function(r){function i(e){var i=e.pollId,s=e.pollOptionId,o=r.call(this)||this;return o.method=t.DELETE,o.path="".concat(n,"/").concat(encodeURIComponent(i),"/options/").concat(encodeURIComponent(s)),o}return e(i,r),i}(r);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(s);var Ds=function(t){function n(e){var n=e.reqId,r=e.channelType,i=e.channelUrl,s=e.pollId,o=e.pollOptionIds;return t.call(this,{code:"VOTE",ackRequired:!0,payload:u({req_id:n,channel_type:r===f.OPEN?"open_channels":"group_channels",channel_url:i,poll_id:s,option_ids:o})})||this}return e(n,t),n}(ae),qs=function(t){function n(e,n,r){var i=t.call(this,e,"VOTE",r)||this;return i.event=null,i.channelUrl=null,i.channelType=null,i.event=new at(r),i.channelUrl=r.channel_url,i.channelType=r.channel_type,i}return e(n,t),n}(X),Fs=2,Bs=function(t){function n(e,n){var r,i,s,o,a=this;return(a=t.call(this,e)||this).url="",a.channelType=f.BASE,a.name="",a.coverUrl="",a.customType="",a.data="",a.isFrozen=!1,a.isEphemeral=!1,a.creator=null,a.createdAt=0,a.url=n.channel_url,a.name=null!==(r=n.name)&&void 0!==r?r:"",a.coverUrl=null!==(i=n.cover_url)&&void 0!==i?i:"",a.customType=null!==(s=n.custom_type)&&void 0!==s?s:"",a.data=null!==(o=n.data)&&void 0!==o?o:"",a.isFrozen=!!c("boolean",n.freeze)&&n.freeze,a.isEphemeral=!!c("boolean",n.is_ephemeral)&&n.is_ephemeral,a.creator=n.created_by?new T(a._iid,n.created_by):null,a.createdAt=1e3*n.created_at,a._cachedMetaData=new Map,n.metadata&&n.ts&&Object.keys(n.metadata).forEach((function(e){a._cachedMetaData.set(e,{value:n.metadata[e],isRemoved:!1,updatedAt:n.ts})})),a}return e(n,t),n.payloadify=function(e){return u(g(g({},t.payloadify.call(this,e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:T.payloadify(e.creator),created_at:e.createdAt/1e3}))},n.prototype.isGroupChannel=function(){return this.channelType===f.GROUP},n.prototype.isOpenChannel=function(){return this.channelType===f.OPEN},Object.defineProperty(n.prototype,"cachedMetaData",{get:function(){var e={};return this._cachedMetaData.forEach((function(t,n){t.isRemoved||(e[n]=t.value)})),e},enumerable:!1,configurable:!0}),n.prototype._upsertCachedMetaData=function(e,t){var n=this;Object.keys(e).forEach((function(r){var i=n._cachedMetaData.get(r);(!i||i.updatedAt<=t)&&n._cachedMetaData.set(r,{value:e[r],isRemoved:!1,updatedAt:t})}))},n.prototype._removeFromCachedMetaData=function(e,t){var n=this;e.forEach((function(e){var r=n._cachedMetaData.get(e);r&&r.updatedAt<t&&(r.isRemoved=!1,r.updatedAt=t)}))},n.prototype._generateRequestId=function(){return"rq-".concat(fe())},n.prototype.isIdentical=function(e){return e&&this.url===e.url},n.prototype.isEqual=function(e){return pe(this,e)},n.prototype.createOperatorListQuery=function(e){return void 0===e&&(e={}),new gi(this._iid,this.url,this.channelType,e)},n.prototype.createMutedUserListQuery=function(e){return void 0===e&&(e={}),new wi(this._iid,this.url,this.channelType,e)},n.prototype.createBannedUserListQuery=function(e){return void 0===e&&(e={}),new ki(this._iid,this.url,this.channelType,e)},n.prototype.createPreviousMessageListQuery=function(e){return void 0===e&&(e={}),new ve(this._iid,this.url,this.channelType,e)},n.prototype.addOperators=function(e){return v(this,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return _(M("string",e)).throw(y.invalidParameters),t=E.of(this._iid).requestQueue,n=new Si({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},n.prototype.removeOperators=function(e){return v(this,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return _(M("string",e)).throw(y.invalidParameters),t=E.of(this._iid).requestQueue,n=new Ci({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},n.prototype.getMyMutedInfo=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s,o,a,u,c,l;return m(this,(function(h){switch(h.label){case 0:return e=E.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Ni({channelUrl:this.url,channelType:this.channelType,userId:t.userId}),[4,n.send(r)];case 1:return i=h.sent(),s=i.as(Ai),o=s.isMuted,a=s.startAt,u=s.endAt,c=s.remainingDuration,l=s.description,[2,{isMuted:o,startAt:a,endAt:u,remainingDuration:c,description:l}]}}))}))},n.prototype.getMetaData=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o;return m(this,(function(a){switch(a.label){case 0:return _(M("string",e)).throw(y.invalidParameters),t=E.of(this._iid).requestQueue,n=new Oi({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,t.send(n)];case 1:return r=a.sent(),i=r.as(Pi),s=i.metadata,o=i.ts,this._upsertCachedMetaData(s,o),[2,s]}}))}))},n.prototype.getAllMetaData=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s;return m(this,(function(o){switch(o.label){case 0:return e=E.of(this._iid).requestQueue,t=new Oi({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(t)];case 1:return n=o.sent(),r=n.as(Pi),i=r.metadata,s=r.ts,this._upsertCachedMetaData(i,s),[2,i]}}))}))},n.prototype.createMetaData=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i;return m(this,(function(s){switch(s.label){case 0:return t=E.of(this._iid).requestQueue,n=new Ui({channelUrl:this.url,channelType:this.channelType,metadata:e}),[4,t.send(n)];case 1:return r=s.sent(),i=r.as(Mi).metaData,this._upsertCachedMetaData(i,0),[2,i]}}))}))},n.prototype.updateMetaData=function(e,t){return void 0===t&&(t=!1),v(this,void 0,void 0,(function(){var n,r,i,s,o,a;return m(this,(function(u){switch(u.label){case 0:return n=E.of(this._iid).requestQueue,r=new Ri({channelUrl:this.url,channelType:this.channelType,metadata:e,upsert:t}),[4,n.send(r)];case 1:return i=u.sent(),s=i.as(Li),o=s.metadata,a=s.ts,this._upsertCachedMetaData(o,a),[2,o]}}))}))},n.prototype.deleteMetaData=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i;return m(this,(function(s){switch(s.label){case 0:return _(c("string",e)).throw(y.invalidParameters),t=E.of(this._iid).requestQueue,n=new Di({channelUrl:this.url,channelType:this.channelType,key:e}),[4,t.send(n)];case 1:return r=s.sent(),i=r.as(qi).ts,this._removeFromCachedMetaData([e],i),[2]}}))}))},n.prototype.deleteAllMetaData=function(){return v(this,void 0,void 0,(function(){var e,t,n,r;return m(this,(function(i){switch(i.label){case 0:return e=E.of(this._iid).requestQueue,t=new Fi({channelUrl:this.url,channelType:this.channelType}),[4,e.send(t)];case 1:return n=i.sent(),r=n.as(Bi).ts,this._removeFromCachedMetaData(te([],ne(this._cachedMetaData.keys()),!1),r),[2]}}))}))},n.prototype.getMetaCounters=function(e){return v(this,void 0,void 0,(function(){var t,n,r;return m(this,(function(i){switch(i.label){case 0:return _(M("string",e)).throw(y.invalidParameters),t=E.of(this._iid).requestQueue,n=new Ki({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(zi).metaCounter]}}))}))},n.prototype.getAllMetaCounters=function(){return v(this,void 0,void 0,(function(){var e,t,n;return m(this,(function(r){switch(r.label){case 0:return e=E.of(this._iid).requestQueue,t=new Ki({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(t)];case 1:return n=r.sent(),[2,n.as(zi).metaCounter]}}))}))},n.prototype.createMetaCounters=function(e){return v(this,void 0,void 0,(function(){var t,n,r;return m(this,(function(i){switch(i.label){case 0:return t=E.of(this._iid).requestQueue,n=new Qi({channelUrl:this.url,channelType:this.channelType,metaCounter:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(ji).metaCounter]}}))}))},n.prototype.updateMetaCounters=function(e,t){return void 0===t&&(t=!1),v(this,void 0,void 0,(function(){var n,r,i;return m(this,(function(s){switch(s.label){case 0:return n=E.of(this._iid).requestQueue,r=new Vi({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(Hi).metaCounter]}}))}))},n.prototype.increaseMetaCounters=function(e){return v(this,void 0,void 0,(function(){var t,n,r;return m(this,(function(i){switch(i.label){case 0:return t=E.of(this._iid).requestQueue,n=new Vi({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"increase"}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(Hi).metaCounter]}}))}))},n.prototype.decreaseMetaCounters=function(e){return v(this,void 0,void 0,(function(){var t,n,r;return m(this,(function(i){switch(i.label){case 0:return t=E.of(this._iid).requestQueue,n=new Vi({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"decrease"}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(Hi).metaCounter]}}))}))},n.prototype.deleteMetaCounter=function(e){return v(this,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return _(c("string",e)).throw(y.invalidParameters),t=E.of(this._iid).requestQueue,n=new Wi({channelUrl:this.url,channelType:this.channelType,key:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},n.prototype.deleteAllMetaCounters=function(){return v(this,void 0,void 0,(function(){var e,t;return m(this,(function(n){switch(n.label){case 0:return e=E.of(this._iid).requestQueue,t=new Yi({channelUrl:this.url,channelType:this.channelType}),[4,e.send(t)];case 1:return n.sent(),[2]}}))}))},n.prototype.muteUser=function(e,t,n){return v(this,void 0,void 0,(function(){return m(this,(function(r){return[2,this.muteUserWithUserId(e.userId,t,n)]}))}))},n.prototype.muteUserWithUserId=function(e,t,n){return v(this,void 0,void 0,(function(){var r,i;return m(this,(function(s){switch(s.label){case 0:return _(c("string",e)&&c("number",t,!0)&&c("string",n,!0)).throw(y.invalidParameters),r=E.of(this._iid).requestQueue,i=new Xi({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:t,description:n}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},n.prototype.unmuteUser=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){return[2,this.unmuteUserWithUserId(e.userId)]}))}))},n.prototype.unmuteUserWithUserId=function(e){return v(this,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return _(c("string",e)).throw(y.invalidParameters),t=E.of(this._iid).requestQueue,n=new Zi({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},n.prototype.banUser=function(e,t,n){return v(this,void 0,void 0,(function(){return m(this,(function(r){return[2,this.banUserWithUserId(e.userId,t,n)]}))}))},n.prototype.banUserWithUserId=function(e,t,n){return v(this,void 0,void 0,(function(){var r,i;return m(this,(function(s){switch(s.label){case 0:return _(c("string",e)&&c("number",t,!0)&&c("string",n,!0)).throw(y.invalidParameters),r=E.of(this._iid).requestQueue,i=new es({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:t,description:n}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},n.prototype.unbanUser=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){return[2,this.unbanUserWithUserId(e.userId)]}))}))},n.prototype.unbanUserWithUserId=function(e){return v(this,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return _(c("string",e)).throw(y.invalidParameters),t=E.of(this._iid).requestQueue,n=new ns({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},n.prototype.freeze=function(){return v(this,void 0,void 0,(function(){var e,t;return m(this,(function(n){switch(n.label){case 0:return e=E.of(this._iid).requestQueue,t=new is({channelUrl:this.url,channelType:this.channelType,freezing:!0}),[4,e.send(t)];case 1:return n.sent(),this.isFrozen=!0,[2]}}))}))},n.prototype.unfreeze=function(){return v(this,void 0,void 0,(function(){var e,t;return m(this,(function(n){switch(n.label){case 0:return e=E.of(this._iid).requestQueue,t=new is({channelUrl:this.url,channelType:this.channelType,freezing:!1}),[4,e.send(t)];case 1:return n.sent(),this.isFrozen=!1,[2]}}))}))},n.prototype.getMessagesByMessageId=function(e,t){return v(this,void 0,void 0,(function(){var n;return m(this,(function(r){switch(r.label){case 0:return n=g(g({},Ie),t),_(c("number",e)&&we(n)).throw(y.invalidParameters),[4,B.of(this._iid).getMessagesByMessageId(this.url,this.channelType,e,n)];case 1:return[2,r.sent()]}}))}))},n.prototype.getMessagesByTimestamp=function(e,t){return v(this,void 0,void 0,(function(){var n;return m(this,(function(r){switch(r.label){case 0:return n=g(g({},Ie),t),_(c("number",e)&&we(n)).throw(y.invalidParameters),[4,B.of(this._iid).getMessagesByTimestamp(this.url,this.channelType,e,n)];case 1:return[2,r.sent()]}}))}))},n.prototype.getMessageChangeLogsSinceTimestamp=function(e,t){return void 0===t&&(t={}),v(this,void 0,void 0,(function(){var n;return m(this,(function(r){switch(r.label){case 0:return n=g(g({},Ee),t),_(c("number",e)&&Te(n)).throw(y.invalidParameters),[4,B.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,n)];case 1:return[2,r.sent()]}}))}))},n.prototype.getMessageChangeLogsSinceToken=function(e,t){return void 0===t&&(t={}),v(this,void 0,void 0,(function(){var n;return m(this,(function(r){switch(r.label){case 0:return n=g(g({},Ee),t),_(c("string",e)&&Te(n)).throw(y.invalidParameters),[4,B.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,n)];case 1:return[2,r.sent()]}}))}))},n.prototype._createPendingSendableMessagePayload=function(e,t,n){var r=E.of(this._iid).sessionManager;return u({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,sorted_metaarray:e.metaArrays?e.metaArrays.map((function(e){return R.payloadify(e)})):null,apple_critical_alert_options:e.appleCriticalAlertOptions?x.payloadify(e.appleCriticalAlertOptions):null,created_at:n,user:me.payloadify(r.currentUser),req_id:t,request_state:j.PENDING,mentioned_user_ids:e.mentionedUserIds,mentioned_users:e.mentionedUsers})},n.prototype._createPendingUserMessage=function(e,t,n){var r,i,s={};if(e.translationTargetLanguages)try{for(var o=D(e.translationTargetLanguages),a=o.next();!a.done;a=o.next()){s[a.value]=""}}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}var c=u(g(g({},this._createPendingSendableMessagePayload(e,t,n)),{type:A.USER,message:e.message,translations:s})),l=new q(this._iid,c);return l.messageParams=e,l},n.prototype._createPendingScheduledUserMessage=function(e,t,n){var r=this._createPendingUserMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r},n.prototype._createPendingFileMessage=function(e,t,n){var r=u(g(g({},this._createPendingSendableMessagePayload(e,t,n)),{type:A.FILE,url:e.fileUrl,file:{name:e.fileName,size:e.fileSize,type:e.mimeType,data:e.data},thumbnails:e.thumbnailSizes?e.thumbnailSizes.map((function(e){return{url:"",width:e.maxWidth,height:e.maxHeight}})):[]})),i=new F(this._iid,r);return i.messageParams=e,i},n.prototype._createPendingScheduledFileMessage=function(e,t,n){var r=this._createPendingFileMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r},n.prototype._markMessageAsFailed=function(e,t,n){void 0===n&&(n=!1),e.errorCode=t.code,t.code===W.REQUEST_CANCELED?e.sendingStatus=j.CANCELED:n||(e.sendingStatus=j.FAILED)},n.prototype.sendUserMessage=function(e){var t=g(g({},Ot),e);return _(Pt(t)).throw(y.invalidParameters),this._sendUserMessage(t)},n.prototype._sendUserMessage=function(e,t){var n=this;void 0===t&&(t=null);var r=E.of(this._iid),i=r.dispatcher,s=r.requestQueue,o=t,a=Date.now(),u=new be;if(!o){o=this._generateRequestId();var c=E.of(this._iid).dispatcher;_e(2).then((function(){var t=n._createPendingUserMessage(e,o,a);c.dispatch(new Y({messages:[t],source:I.EVENT_MESSAGE_SENT_PENDING})),ye((function(){return v(n,void 0,void 0,(function(){return m(this,(function(e){return[2,u._trigger(null,t)]}))}))}))}))}var l=new cs(g(g({},e),{channelUrl:this.url,channelType:this.channelType,reqId:o}));return s.send(l).then((function(e){var t=e.as(ls).message;i.dispatch(new Y({messages:[t],source:I.EVENT_MESSAGE_SENT_SUCCESS})),ye((function(){return v(n,void 0,void 0,(function(){return m(this,(function(e){return[2,u._trigger(null,t)]}))}))}))})).catch((function(t){if(ge(t))throw t;_e(2).then((function(){var r=n._createPendingUserMessage(e,o,a),s=E.of(n._iid).cacheContext.localCacheEnabled&&V(t.code);n._markMessageAsFailed(r,t,s),i.dispatch(new Y({messages:[r],source:r.sendingStatus===j.PENDING?I.REQUEST_RESEND_MESSAGE:I.EVENT_MESSAGE_SENT_FAILED})),ye((function(){return v(n,void 0,void 0,(function(){return m(this,(function(e){return[2,u._trigger(t,r)]}))}))}))}))})),u},n.prototype._autoResendUserMessage=function(e){return _(e instanceof q).throw(y.invalidParameters),this._sendUserMessage(e.messageParams,e.reqId)},n.prototype.resendUserMessage=function(e){var t;return v(this,void 0,void 0,(function(){var n,r;return m(this,(function(i){return _(e instanceof q&&!e.scheduledInfo).throw(y.invalidParameters),n=new ke,r=null!==(t=e.messageParams)&&void 0!==t?t:function(e){var t;return u({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,pollId:null===(t=e.poll)||void 0===t?void 0:t.id,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,message:e.message,translationTargetLanguages:Object.keys(e.translations)})}(e),this._sendUserMessage(r,e.reqId).onFailed((function(e){return n.reject(e)})).onSucceeded((function(e){return n.resolve(e)})),[2,n.promise]}))}))},n.prototype.updateUserMessage=function(e,t){return v(this,void 0,void 0,(function(){var n,r,i,s;return m(this,(function(o){switch(o.label){case 0:return n=g(g({},pi),t),_(c("number",e)&&vi(n)).throw(y.invalidParameters),r=E.of(this._iid).requestQueue,i=new hs(g({channelType:this.channelType,channelUrl:this.url,messageId:e},n)),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(ds).message]}}))}))},n.prototype.copyUserMessage=function(e,t){var r,i,s;return v(this,void 0,void 0,(function(){var o,a;return m(this,(function(u){return _(e instanceof n&&t instanceof q&&t.sendingStatus===j.SUCCEEDED&&this.url===t.channelUrl&&!t.scheduledInfo).throw(y.invalidParameters),_(!t.poll).throw(y.notSupportedError),o=new ke,a=null!==(r=t.messageParams)&&void 0!==r?r:g(g({},t),{mentionType:t.mentionType,mentionedUserIds:null!==(i=t.mentionedUserIds)&&void 0!==i?i:null===(s=t.mentionedUsers)||void 0===s?void 0:s.map((function(e){return e.userId})),translationTargetLanguages:Object.keys(t.translations),pushNotificationDeliveryOption:L.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1}),e._sendUserMessage(a).onSucceeded((function(e){o.resolve(e)})).onFailed((function(e){return o.reject(e)})),[2,o.promise]}))}))},n.prototype.translateUserMessage=function(e,t){return v(this,void 0,void 0,(function(){var n,r,i;return m(this,(function(s){switch(s.label){case 0:return _(e instanceof q&&e.messageId>0&&M("string",t)).throw(y.invalidParameters),n=E.of(this._iid).requestQueue,r=new Is({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,translationTargetLanguages:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(ws).message]}}))}))},n.prototype._createScheduledUserMessage=function(e,t){var n=this,r=E.of(this._iid).requestQueue,i=Date.now(),s=this._generateRequestId();_e(2).then((function(){var r=n._createPendingScheduledUserMessage(e,s,i);ye((function(){return v(n,void 0,void 0,(function(){return m(this,(function(e){return[2,t._trigger(null,r)]}))}))}))}));var o=new Es(g({reqId:s,channelType:this.channelType,channelUrl:this.url},e));r.send(o).then((function(e){var r=e.as(Ts).message;ye((function(){return v(n,void 0,void 0,(function(){return m(this,(function(e){return[2,t._trigger(null,r)]}))}))}))})).catch((function(r){if(ge(r))throw r;_e(2).then((function(){var o=n._createPendingScheduledUserMessage(e,s,i);n._markMessageAsFailed(o,r),ye((function(){return v(n,void 0,void 0,(function(){return m(this,(function(e){return[2,t._trigger(r,o)]}))}))}))}))}))},n.prototype.sendFileMessage=function(e){var t=g(g({},Lt),e);return _(xt(t)).throw(y.invalidParameters),this._sendFileMessage(t)},n.prototype._sendFileMessage=function(e,t){var n=this;void 0===t&&(t=null);var r=E.of(this._iid).dispatcher,i=B.of(this._iid).fileMessageQueue,s=t,o=Date.now(),a=new be;return s||(s=this._generateRequestId(),_e(2).then((function(){var t=n._createPendingFileMessage(e,s,o);r.dispatch(new Y({messages:[t],source:I.EVENT_MESSAGE_SENT_PENDING})),ye((function(){return v(n,void 0,void 0,(function(){return m(this,(function(e){return[2,a._trigger(null,t)]}))}))}))}))),i.request(this,s,e).then((function(e){r.dispatch(new Y({messages:[e],source:I.EVENT_MESSAGE_SENT_SUCCESS})),ye((function(){return v(n,void 0,void 0,(function(){return m(this,(function(t){return[2,a._trigger(null,e)]}))}))}))})).catch((function(t){if(ge(t))throw t;_e(2).then((function(){var i=n._createPendingFileMessage(e,s,o),u=E.of(n._iid).cacheContext.localCacheEnabled&&V(t.code);n._markMessageAsFailed(i,t,u),r.dispatch(new Y({messages:[i],source:i.sendingStatus===j.PENDING?I.REQUEST_RESEND_MESSAGE:I.EVENT_MESSAGE_SENT_FAILED})),ye((function(){return v(n,void 0,void 0,(function(){return m(this,(function(e){return[2,a._trigger(t,i)]}))}))}))}))})),a},n.prototype._autoResendFileMessage=function(e){_(e instanceof F).throw(y.invalidParameters);var t=E.of(this._iid).logger;return t.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,e.reqId).onFailed((function(e){t.debug("autoResendFileMessage failed",e)})).onSucceeded((function(e){t.debug("autoResendFileMessage success",e)}))},n.prototype._createScheduledFileMessage=function(e,t,n,r){var i=this,s=E.of(this._iid).requestQueue,o=new ks(g(g({reqId:n,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));s.send(o).then((function(e){var n=e.as(Ss).message;ye((function(){return v(i,void 0,void 0,(function(){return m(this,(function(e){return[2,t._trigger(null,n)]}))}))}))})).catch((function(s){if(ge(s))throw s;_e(2).then((function(){var o=i._createPendingScheduledFileMessage(e,n,r);i._markMessageAsFailed(o,s),ye((function(){return v(i,void 0,void 0,(function(){return m(this,(function(e){return[2,t._trigger(s,o)]}))}))}))}))}))},n.prototype.sendFileMessages=function(e){var t,n;_(e.every((function(e){return xt(g(g({},Lt),e))}))).throw(y.invalidParameters);var r=new be;try{for(var i=D(e),s=i.next();!s.done;s=i.next()){var o=s.value;this.sendFileMessage(o).onPending((function(e){return r._trigger(null,e)})).onFailed((function(e,t){return r._trigger(e,t)})).onSucceeded((function(e){return r._trigger(null,e)}))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r},n.prototype.resendFileMessage=function(e,t){var n;return v(this,void 0,void 0,(function(){var r,i,s;return m(this,(function(o){return r=Boolean(e.url)||S(t)||S(null===(n=e.messageParams)||void 0===n?void 0:n.file),_(e instanceof F&&r&&!e.scheduledInfo).throw(y.invalidParameters),i=new ke,s=function(e,t){var n;return void 0===t&&(t=null),e.messageParams?(!e.url&&S(t)&&(e.messageParams.file=t),e.messageParams):u({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,file:null!=t?t:null===(n=e.messageParams)||void 0===n?void 0:n.file,fileUrl:e.url,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:e.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}}))})}(e,t),this._sendFileMessage(s,e.reqId).onFailed((function(e){return i.reject(e)})).onSucceeded((function(e){return i.resolve(e)})),[2,i.promise]}))}))},n.prototype.updateFileMessage=function(e,t){return v(this,void 0,void 0,(function(){var n,r,i,s;return m(this,(function(o){switch(o.label){case 0:return n=g(g({},mi),t),_(c("number",e)&&function(e){return fi(e)}(n)).throw(y.invalidParameters),r=E.of(this._iid).requestQueue,i=new fs(g({channelType:this.channelType,channelUrl:this.url,messageId:e},n)),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(ps).message]}}))}))},n.prototype.cancelUploadingFileMessage=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){return _(c("string",e)).throw(y.invalidParameters),B.of(this._iid).fileMessageQueue.cancel(this,e),[2,!0]}))}))},n.prototype.copyFileMessage=function(e,t){var r,i;return v(this,void 0,void 0,(function(){var s,o;return m(this,(function(a){return _(e instanceof n&&t instanceof F&&t.sendingStatus===j.SUCCEEDED&&this.url===t.channelUrl&&!t.scheduledInfo).throw(y.invalidParameters),s=new ke,o=g(g({},t),{fileUrl:t.url,fileName:t.name,fileSize:t.size,mimeType:t.type,mentionType:t.mentionType,mentionedUserIds:null!==(r=t.mentionedUserIds)&&void 0!==r?r:null===(i=t.mentionedUsers)||void 0===i?void 0:i.map((function(e){return e.userId})),pushNotificationDeliveryOption:L.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:t.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),requireAuth:t.requireAuth,isPinnedMessage:!1}),e._sendFileMessage(o).onSucceeded((function(e){return s.resolve(e)})).onFailed((function(e){return s.reject(e)})),[2,s.promise]}))}))},n.prototype.deleteMessage=function(e){return v(this,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return _(e instanceof Se).throw(y.invalidParameters),e.messageId>0?(t=E.of(this._iid).requestQueue,n=new vs({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId}),[4,t.send(n)]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},n.prototype.addReaction=function(e,t){return v(this,void 0,void 0,(function(){var n,r,i;return m(this,(function(s){switch(s.label){case 0:return _(e instanceof Se&&e.messageId>0&&c("string",t)).throw(y.invalidParameters),n=E.of(this._iid).requestQueue,r=new _s({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(ys).reactionEvent]}}))}))},n.prototype.deleteReaction=function(e,t){return v(this,void 0,void 0,(function(){var n,r,i;return m(this,(function(s){switch(s.label){case 0:return _(e instanceof Se&&e.messageId>0&&c("string",t)).throw(y.invalidParameters),n=E.of(this._iid).requestQueue,r=new gs({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(bs).reactionEvent]}}))}))},n.prototype._updateUserMessageMetaArray=function(e,t,n,r){return v(this,void 0,void 0,(function(){var i,s,o,a,u,c;return m(this,(function(l){switch(l.label){case 0:return i=E.of(this._iid),s=i.dispatcher,o=i.requestQueue,a=new hs({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:t,mode:n,upsert:r}}),[4,o.send(a)];case 1:return u=l.sent(),c=u.as(ds).message,s.dispatch(new Y({messages:[c],source:I.EVENT_MESSAGE_UPDATED})),[2,c]}}))}))},n.prototype._updateFileMessageMetaArray=function(e,t,n,r){return v(this,void 0,void 0,(function(){var i,s,o,a,u,c;return m(this,(function(l){switch(l.label){case 0:return i=E.of(this._iid),s=i.dispatcher,o=i.requestQueue,a=new fs({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:t,mode:n,upsert:r}}),[4,o.send(a)];case 1:return u=l.sent(),c=u.as(ps).message,s.dispatch(new Y({messages:[c],source:I.EVENT_MESSAGE_UPDATED})),[2,c]}}))}))},n.prototype.createMessageMetaArrayKeys=function(e,t){return v(this,void 0,void 0,(function(){var n;return m(this,(function(r){return _(e instanceof Se&&e.messageId>0&&M("string",t)).throw(y.invalidParameters),n=t.map((function(e){return new R({key:e})})),e instanceof F?[2,this._updateFileMessageMetaArray(e.messageId,n,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,n,"add",!0)]}))}))},n.prototype.deleteMessageMetaArrayKeys=function(e,t){return v(this,void 0,void 0,(function(){var n;return m(this,(function(r){return _(e instanceof Se&&e.messageId>0&&M("string",t)).throw(y.invalidParameters),n=t.map((function(e){return new R({key:e})})),e instanceof F?[2,this._updateFileMessageMetaArray(e.messageId,n,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,n,"remove",!0)]}))}))},n.prototype.addMessageMetaArrayValues=function(e,t){return v(this,void 0,void 0,(function(){return m(this,(function(n){return _(e instanceof Se&&e.messageId>0&&t.every((function(e){return e instanceof R}))).throw(y.invalidParameters),e instanceof F?[2,this._updateFileMessageMetaArray(e.messageId,t,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,t,"add",!0)]}))}))},n.prototype.removeMessageMetaArrayValues=function(e,t){return v(this,void 0,void 0,(function(){return m(this,(function(n){return _(e instanceof Se&&e.messageId>0&&t.every((function(e){return e instanceof R}))).throw(y.invalidParameters),e instanceof F?[2,this._updateFileMessageMetaArray(e.messageId,t,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,t,"remove",!0)]}))}))},n.prototype.report=function(e,t){return v(this,void 0,void 0,(function(){var n,r,i,s;return m(this,(function(o){switch(o.label){case 0:return _(d(ci,e)&&c("string",t)).throw(y.invalidParameters),n=E.of(this._iid),r=n.sdkState,i=n.requestQueue,s=new os({channelUrl:this.url,channelType:this.channelType,userId:r.userId,category:e,description:t}),[4,i.send(s)];case 1:return o.sent(),[2]}}))}))},n.prototype.reportUser=function(e,t,n){return v(this,void 0,void 0,(function(){var r,i,s,o;return m(this,(function(a){switch(a.label){case 0:return _(e instanceof T&&d(ci,t)&&c("string",n)).throw(y.invalidParameters),r=E.of(this._iid),i=r.sdkState,s=r.requestQueue,o=new as({channelUrl:this.url,channelType:this.channelType,userId:i.userId,offendingUserId:e.userId,category:t,description:n}),[4,s.send(o)];case 1:return a.sent(),[2]}}))}))},n.prototype.reportMessage=function(e,t,n){return v(this,void 0,void 0,(function(){var r,i,s,o;return m(this,(function(a){switch(a.label){case 0:return _(e instanceof O&&d(ci,t)&&c("string",n)).throw(y.invalidParameters),r=E.of(this._iid),i=r.sdkState,s=r.requestQueue,o=new us({channelUrl:this.url,channelType:this.channelType,userId:i.userId,offendingUserId:e.sender.userId,messageId:e.messageId,category:t,description:n}),[4,s.send(o)];case 1:return a.sent(),[2]}}))}))},n.prototype.updatePoll=function(e,t){return v(this,void 0,void 0,(function(){var n,r,i;return m(this,(function(s){switch(s.label){case 0:return _(c("number",e)&&function(e){return c("string",e.title,!0)&&h(e.data)&&c("boolean",e.allowUserSuggestion,!0)&&c("boolean",e.allowMultipleVotes,!0)&&c("number",e.closeAt,!0)}(t)).throw(y.invalidParameters),n=E.of(this._iid).requestQueue,r=new Cs(g({pollId:e},t)),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(Ns).poll]}}))}))},n.prototype.deletePoll=function(e){return v(this,void 0,void 0,(function(){var t,n,r;return m(this,(function(i){switch(i.label){case 0:return t=c("number",e),_(t).throw(y.invalidParameters),n=E.of(this._iid).requestQueue,r=new As({pollId:e}),[4,n.send(r)];case 1:return i.sent(),[2]}}))}))},n.prototype.closePoll=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i;return m(this,(function(s){switch(s.label){case 0:return t=c("number",e),_(t).throw(y.invalidParameters),n=E.of(this._iid).requestQueue,r=new Os({pollId:e}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(Ps).poll]}}))}))},n.prototype.addPollOption=function(e,t){return v(this,void 0,void 0,(function(){var n,r,i,s;return m(this,(function(o){switch(o.label){case 0:return n=c("number",e)&&c("string",t)&&""!==t.trim(),_(n).throw(y.invalidParameters),r=E.of(this._iid).requestQueue,i=new Us({channelUrl:this.url,channelType:this.channelType,pollId:e,optionText:t}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(Ms).poll]}}))}))},n.prototype.updatePollOption=function(e,t,n){return v(this,void 0,void 0,(function(){var r,i,s,o;return m(this,(function(a){switch(a.label){case 0:return r=c("number",e)&&c("number",t)&&c("string",n)&&""!==n.trim(),_(r).throw(y.invalidParameters),i=E.of(this._iid).requestQueue,s=new Rs({pollId:e,pollOptionId:t,optionText:n}),[4,i.send(s)];case 1:return o=a.sent(),[2,o.as(Ls).poll]}}))}))},n.prototype.deletePollOption=function(e,t){return v(this,void 0,void 0,(function(){var n,r,i;return m(this,(function(s){switch(s.label){case 0:return n=c("number",e)&&c("number",t),_(n).throw(y.invalidParameters),r=E.of(this._iid).requestQueue,i=new xs({pollId:e,pollOptionId:t}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},n.prototype.votePoll=function(e,t){return v(this,void 0,void 0,(function(){var n,r,i,s,o,a,u;return m(this,(function(l){switch(l.label){case 0:return n=c("number",e)&&M("number",t),_(n).throw(y.invalidParameters),r=E.of(this._iid),i=r.requestQueue,s=r.dispatcher,o=new Ds({reqId:this._generateRequestId(),channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionIds:t}),[4,i.send(o)];case 1:return a=l.sent(),u=a.as(qs).event,s.dispatch(new Ce({event:u,source:I.EVENT_POLL_VOTED})),[2,u]}}))}))},n.prototype.getPollChangeLogsSinceTimestamp=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return _(c("number",e)).throw(y.invalidParameters),[4,st.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,t.sent()]}}))}))},n.prototype.getPollChangeLogsSinceToken=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return _(c("string",e,!0)),[4,st.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,t.sent()]}}))}))},n.prototype.createPollListQuery=function(e){return void 0===e&&(e=10),new lt(this._iid,{channelUrl:this.url,channelType:this.channelType,limit:e})},n.prototype.createPollVoterListQuery=function(e,t,n){return void 0===n&&(n=20),new ft(this._iid,{channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionId:t,limit:n})},n}(K),Ks=function(t){function n(e,n){var r,i=this;return(i=t.call(this,e,n)||this).isMuted=!1,i.isMuted=null!==(r=n.is_muted)&&void 0!==r&&r,i}return e(n,t),n}(T),zs=null,Qs=function(){function e(e,t,n){var r=this;this._fcmPushToken=null,this._apnsPushToken=null,this._iid=e,this.options=t;var i=E.of(e),s=i.sdkState,o=i.cacheContext,a=i.dispatcher,u=i.sessionManager,c=i.requestQueue,l=i.logger,h=i.userEventHandlers,d=i.appStateToggleEnabled;this._onlineDetector=new nn({logger:l,connectionDelegate:{reconnect:function(){var t=E.of(e),n=t.sdkState,r=t.connectionManager,i=t.sessionManager;i.auth.hasSession?"foreground"===n.appState&&r.resetAndReconnect():r.connect(i.auth.authToken)},disconnect:function(){E.of(e).connectionManager.disconnect()}}});var f=new on(e,{localCacheEnabled:o.localCacheEnabled,dispatcher:a,sdkState:s,logger:l});n.forEach((function(t){t.init(e,{sdkState:s,cacheContext:o,dispatcher:a,sessionManager:u,requestQueue:c,logger:l,onlineDetector:r._onlineDetector}),r[t.name]=t})),this._appStateChangeDetector=new tn(d),this._appStateChangeDetector.on("resume",(function(){l.debug("the page resumes from freeze"),r.setForegroundState()})).on("pause",(function(){l.debug("the page freezes"),r.setBackgroundState()})),a.on((function(t){if(t instanceof H){if(t.stateType===G.CONNECTED)f.processNonAutoResendRegisteredPendingMessages()}else if(t instanceof X){if("USEV"===t.code){var n=t.as(cn).event;if(n.category===Qt.FRIEND_DISCOVERED){var i=an.getDataAsFriendDiscoveredEvent(e,n).friendDiscoveries;ye((function(){return v(r,void 0,void 0,(function(){return m(this,(function(e){return[2,h.forEach((function(e){e.onFriendsDiscovered(i)}))]}))}))}))}}}else if(t instanceof Pe){var a=E.of(r._iid).subscribedUnreadMessageCount,u=!1,c=t.ts;if("number"==typeof c&&c>a.ts){if(a.all!==t.all&&(u=!0),a.all=t.all>=0?t.all:0,t.customTypes)for(var l in t.customTypes)a.customTypes[l]!==t.customTypes[l]&&(u=!0),a.customTypes[l]=t.customTypes[l];u=u&&a.ts>0,a.ts=c}u&&ye((function(){return v(r,void 0,void 0,(function(){return m(this,(function(e){return[2,h.forEach((function(e){e.onTotalUnreadMessageCountUpdated(a.all,a.customTypes)}))]}))}))}))}else t instanceof Ue&&o.localCacheEnabled&&o.preference.set(r._getUserProfileCacheKey(s.userId),Me.payloadify(t.userProfile))}))}return e.init=function(t){var n=t.appId,r=t.appVersion,i=void 0===r?null:r,s=t.modules,o=void 0===s?[]:s,a=t.options,u=void 0===a?new Re:a,c=t.debugMode,l=void 0!==c&&c,h=t.customApiHost,d=t.customWebSocketHost,f=t.newInstance,p=void 0!==f&&f,v=t.logLevel,m=t.localCacheEnabled,_=void 0!==m&&m,y=t.localCacheEncryption,g=t.useAsyncStorageStore,b=void 0===g?null:g,I=t.appStateToggleEnabled,w=void 0===I||I;if(!zs||p){var T="su-".concat(fe()),k=null!=y?y:{encrypt:function(e){return e},decrypt:function(e){return e}},S=new ti({encryption:k});l||(S=b?new ri({AsyncStorage:b,encryption:k}):new ni({encryption:k})),new E(T,{appId:n,appVersion:i,options:u,apiHost:null!=h?h:"https://api-".concat(n,".sendbird.com"),websocketHost:null!=d?d:"wss://ws-".concat(n,".sendbird.com"),store:S,encryption:k,logLevel:v,localCacheEnabled:_,debugMode:l,appStateToggleEnabled:w});var C=[new Le,new pt],N=new e(T,u,te(te([],ne(o),!1),ne(C),!1));return zs||(zs=N),N}return zs},Object.defineProperty(e,"instance",{get:function(){return zs},enumerable:!1,configurable:!0}),Object.defineProperty(e,"version",{get:function(){return Ne},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appId",{get:function(){return E.of(this._iid).sdkState.appId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appInfo",{get:function(){return E.of(this._iid).appInfo},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appVersion",{get:function(){var e;return null!==(e=E.of(this._iid).sdkState.appVersion)&&void 0!==e?e:""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"debugMode",{get:function(){return E.of(this._iid).debugMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"logLevel",{get:function(){return E.of(this._iid).logger.level},set:function(e){E.of(this._iid).logger.level=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCacheEnabled",{get:function(){return E.of(this._iid).cacheContext.localCacheEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ekey",{get:function(){return E.of(this._iid).sessionManager.ekey},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentUser",{get:function(){var e;return null!==(e=E.of(this._iid).sessionManager.currentUser)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connectionState",{get:function(){var e=E.of(this._iid).connectionManager;return e.isConnected?Ae.OPEN:e.isConnecting?Ae.CONNECTING:Ae.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastConnectedAt",{get:function(){var e=E.of(this._iid),t=e.connectedAt;return e.connectionManager.isConnected?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fcmPushToken",{get:function(){return this._fcmPushToken},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"apnsPushToken",{get:function(){return this._apnsPushToken},enumerable:!1,configurable:!0}),e.prototype._getPreferenceCacheKey=function(e){return"sendbird@".concat(this.appId,"/").concat(e,".pref")},e.prototype._getUserProfileCacheKey=function(e){return"sendbird@".concat(this.appId,"/").concat(e,".profile")},e.prototype.getMemoryStoreForDebugging=function(){var e=E.of(this._iid),t=e.debugMode,n=e.cacheContext;if(t)return n.store instanceof ti?n.store:null;throw y.debugModeRequired},e.prototype.addExtension=function(e,t){var n=E.of(this._iid).sdkState;["sb_uikit","sb_syncmanager","device-os-platform"].indexOf(e)>-1&&(n.extensions[e]=t)},e.prototype.setOnlineListener=function(e){this._onlineDetector.setOnlineListener(e)},e.prototype.setOfflineListener=function(e){this._onlineDetector.setOfflineListener(e)},e.prototype.initializeCache=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o,a,u;return m(this,(function(c){switch(c.label){case 0:return t=E.of(this._iid),n=t.sdkState,r=t.cacheContext,i=t.connectionManager,s=t.dispatcher,n.userId&&n.userId===e?[3,9]:[4,i.logout()];case 1:return c.sent(),n.userId=e,o="sendbird@".concat(n.appId,"/").concat(e,".db"),r.localCacheEnabled?r.nestdb&&r.nestdb.state!==ii.CLOSED&&r.nestdb.name===o?[3,3]:((a=r.nestdb=new ui({name:"sendbird@".concat(n.appId,"/").concat(e,".db"),version:2,store:r.store})).on("upgrade",Zt(a,r.store)),[4,a.open()]):[3,4];case 2:c.sent(),s.dispatch(new un(this._iid,{userId:e})),c.label=3;case 3:return[3,6];case 4:return[4,r.store.init(o)];case 5:c.sent(),c.label=6;case 6:return[4,r.preference.init(this._getPreferenceCacheKey(e))];case 7:return c.sent(),[4,r.preference.get(this._getUserProfileCacheKey(e))];case 8:(u=c.sent())&&new Me(this._iid,u).apply(),c.label=9;case 9:return[2]}}))}))},e.prototype.clearCachedData=function(){return v(this,void 0,void 0,(function(){var e;return m(this,(function(t){switch(t.label){case 0:return(e=E.of(this._iid).cacheContext).localCacheEnabled&&e.nestdb?[4,e.nestdb.clear()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[4,e.preference.clear()];case 3:return t.sent(),[2]}}))}))},e.prototype.clearCachedMessages=function(e){return v(this,void 0,void 0,(function(){var t,n,r=this;return m(this,(function(i){switch(i.label){case 0:return _(M("string",e)).throw(y.invalidParameters),t=en.of(this._iid),n=Jt.of(this._iid),t&&n?[4,Promise.all(e.map((function(e){return v(r,void 0,void 0,(function(){return m(this,(function(r){switch(r.label){case 0:return[4,t.removeMessagesOfChannel(e)];case 1:return r.sent(),[4,n.removeMessagesOfChannel(e)];case 2:return r.sent(),[2]}}))}))})))]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},e.prototype.connect=function(e,t){return void 0===t&&(t=null),v(this,void 0,void 0,(function(){var n,r,i,s,o,a;return m(this,(function(u){switch(u.label){case 0:_(c("string",e)&&c("string",t,!0)).throw(y.invalidParameters),n=E.of(this._iid),r=n.sdkState,i=n.cacheContext,s=n.connectionManager,o=n.statLogCollector,u.label=1;case 1:return u.trys.push([1,3,,4]),[4,this.initializeCache(e)];case 2:return u.sent(),[3,4];case 3:return u.sent(),a=E.of(this._iid).logger,i.localCacheEnabled=!1,a.warn("Cache initialization failed - cache is not available."),[3,4];case 4:return[4,o.init("sendbird@".concat(r.appId,"/").concat(e,".statlog"))];case 5:return u.sent(),this._onlineDetector.start(),this._appStateChangeDetector.start(),[4,s.connect(t)];case 6:return u.sent(),[2,this.currentUser]}}))}))},e.prototype.reconnect=function(){var e=E.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.sessionManager.auth.hasSession;return r&&(this._appStateChangeDetector.start(),this._onlineDetector.start(),t.resetAndReconnect().then((function(){n.appState="foreground"})).catch((function(){}))),r},e.prototype.disconnect=function(){return v(this,void 0,void 0,(function(){var e,t,n;return m(this,(function(r){switch(r.label){case 0:return e=E.of(this._iid),t=e.connectionManager,n=e.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),n.cancelAll(),[4,t.logout()];case 1:return r.sent(),[4,this.clearCachedData()];case 2:return r.sent(),[2]}}))}))},e.prototype.disconnectWebSocket=function(){return v(this,void 0,void 0,(function(){var e,t,n;return m(this,(function(r){switch(r.label){case 0:return e=E.of(this._iid),t=e.connectionManager,n=e.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),n.cancelAll(),[4,t.disconnectWebSocket()];case 1:return r.sent(),[2]}}))}))},e.prototype.setBackgroundState=function(){var e=E.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"foreground"===n.appState&&(n.appState="background",r.debug("going background state"),t.background())},e.prototype.setForegroundState=function(){var e=E.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"background"===n.appState&&(n.appState="foreground",r.debug("going foreground state"),t.resetAndReconnect())},e.prototype.setSessionHandler=function(e){_(e instanceof mt).throw(y.invalidParameters),E.of(this._iid).sessionManager.handler=e},e.prototype.addUserEventHandler=function(e,t){_(c("string",e)&&t instanceof yt).throw(y.invalidParameters),E.of(this._iid).userEventHandlers.set(e,t)},e.prototype.removeUserEventHandler=function(e){E.of(this._iid).userEventHandlers.delete(e)},e.prototype.removeAllUserEventHandler=function(){E.of(this._iid).userEventHandlers.clear()},e.prototype.addConnectionHandler=function(e,t){_(c("string",e)&&t instanceof _t).throw(y.invalidParameters),E.of(this._iid).connectionHandlers.set(e,t)},e.prototype.removeConnectionHandler=function(e){E.of(this._iid).connectionHandlers.delete(e)},e.prototype.removeAllConnectionHandler=function(){E.of(this._iid).connectionHandlers.clear()},e.prototype.createApplicationUserListQuery=function(e){return void 0===e&&(e={}),new hr(this._iid,e)},e.prototype.createBlockedUserListQuery=function(e){return void 0===e&&(e={}),new pr(this._iid,e)},e.prototype.createFriendListQuery=function(e){return void 0===e&&(e={}),new _r(this._iid,e)},e.prototype.createMessageSearchQuery=function(e){return new Oe(this._iid,e)},e.prototype.createPollListQuery=function(e){return new lt(this._iid,g({},e))},e.prototype.createPollVoterListQuery=function(e){return new ft(this._iid,g({},e))},e.prototype.buildUserFromSerializedData=function(e){var t=p(e);return new T(this._iid,T.payloadify(t))},e.prototype.updateCurrentUserInfo=function(e){return void 0===e&&(e={}),v(this,void 0,void 0,(function(){var t,n,r,i,s,o,a;return m(this,(function(u){switch(u.label){case 0:return t=g(g({},vt),e),_(function(e){return S(e.profileImage,!0)&&c("string",e.profileUrl,!0)&&c("string",e.nickname,!0)}(t)).throw(y.invalidParameters),this.currentUser?(n=E.of(this._iid),r=n.sdkState,i=n.requestQueue,s=new ln(g({userId:r.userId},t)),[4,i.send(s)]):[3,2];case 1:return o=u.sent(),a=o.as(hn).user,this.currentUser&&(t.nickname&&(this.currentUser.nickname=a.nickname),(t.profileUrl||t.profileImage)&&(this.currentUser.plainProfileUrl=a.profileUrl)),[2,a];case 2:throw y.connectionRequired}}))}))},e.prototype.updateCurrentUserInfoWithPreferredLanguages=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o;return m(this,(function(a){switch(a.label){case 0:return _(M("string",e)).throw(y.invalidParameters),this.currentUser?(t=E.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new ln({userId:n.userId,preferredLanguages:e}),[4,r.send(i)]):[3,2];case 1:return s=a.sent(),o=s.as(hn).user,this.currentUser&&(this.currentUser.preferredLanguages=o.preferredLanguages),[2,o];case 2:throw y.connectionRequired}}))}))},e.prototype.registerFCMPushTokenForCurrentUser=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o=this;return m(this,(function(a){switch(a.label){case 0:if(_(c("string",e)).throw(y.invalidParameters),!this.currentUser)return[3,6];a.label=1;case 1:return a.trys.push([1,4,,5]),t=E.of(this._iid),n=t.sessionManager,r=t.sdkState,i=t.requestQueue,n.hasDeviceToken(Fe.FCM,e)?[2,De.SUCCESS]:(s=new fn({userId:r.userId,token:e}),[4,i.send(s)]);case 2:return a.sent(),[4,xe((function(){return v(o,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return n.setDeviceToken(Fe.FCM,e),[4,n.saveDeviceToken()];case 1:return t.sent(),[2]}}))}))}))];case 3:return a.sent(),this._fcmPushToken="",[2,De.SUCCESS];case 4:return a.sent(),[2,De.ERROR];case 5:return[3,7];case 6:return this._fcmPushToken=e,[2,De.PENDING];case 7:return[2]}}))}))},e.prototype.unregisterFCMPushTokenForCurrentUser=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o,a=this;return m(this,(function(u){switch(u.label){case 0:if(_(c("string",e)).throw(y.invalidParameters),!this.currentUser)return[3,6];u.label=1;case 1:return u.trys.push([1,4,,5]),t=E.of(this._iid),n=t.sessionManager,r=t.sdkState,i=t.requestQueue,s=new vn({userId:r.userId,token:e}),[4,i.send(s)];case 2:return o=u.sent().lastDeletedAt,[4,xe((function(){return v(a,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return n.unsetDeviceToken(Fe.FCM,e),n.setDeviceTokenDeletedAt(o),[4,n.saveDeviceToken()];case 1:return t.sent(),[2]}}))}))}))];case 3:return u.sent(),this._fcmPushToken="",[2,De.SUCCESS];case 4:return u.sent(),[2,De.ERROR];case 5:return[3,7];case 6:return this._fcmPushToken=e,[2,De.PENDING];case 7:return[2]}}))}))},e.prototype.unregisterFCMPushTokenAllForCurrentUser=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s,o=this;return m(this,(function(a){switch(a.label){case 0:return this.currentUser?(e=E.of(this._iid),t=e.sessionManager,n=e.sdkState,r=e.requestQueue,i=new _n({userId:n.userId}),[4,r.send(i)]):[3,3];case 1:return s=a.sent().lastDeletedAt,[4,xe((function(){return v(o,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return t.unsetDeviceTokens(Fe.FCM),t.setDeviceTokenDeletedAt(s),[4,t.saveDeviceToken()];case 1:return e.sent(),[2]}}))}))}))];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))},e.prototype.registerAPNSPushTokenForCurrentUser=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o=this;return m(this,(function(a){switch(a.label){case 0:if(_(c("string",e)).throw(y.invalidParameters),!this.currentUser)return[3,6];a.label=1;case 1:return a.trys.push([1,4,,5]),t=E.of(this._iid),n=t.sessionManager,r=t.sdkState,i=t.requestQueue,n.hasDeviceToken(Fe.APNS,e)?[2,De.SUCCESS]:(s=new dn({userId:r.userId,token:e}),[4,i.send(s)]);case 2:return a.sent(),[4,xe((function(){return v(o,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return n.setDeviceToken(Fe.APNS,e),[4,n.saveDeviceToken()];case 1:return t.sent(),[2]}}))}))}))];case 3:return a.sent(),this._apnsPushToken="",[2,De.SUCCESS];case 4:return a.sent(),[2,De.ERROR];case 5:return[3,7];case 6:return this._apnsPushToken=e,[2,De.PENDING];case 7:return[2]}}))}))},e.prototype.unregisterAPNSPushTokenForCurrentUser=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s,o,a=this;return m(this,(function(u){switch(u.label){case 0:if(_(c("string",e)).throw(y.invalidParameters),!this.currentUser)return[3,6];u.label=1;case 1:return u.trys.push([1,4,,5]),t=E.of(this._iid),n=t.sessionManager,r=t.sdkState,i=t.requestQueue,s=new pn({userId:r.userId,token:e}),[4,i.send(s)];case 2:return o=u.sent().lastDeletedAt,[4,xe((function(){return v(a,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return n.unsetDeviceToken(Fe.APNS,e),n.setDeviceTokenDeletedAt(o),[4,n.saveDeviceToken()];case 1:return t.sent(),[2]}}))}))}))];case 3:return u.sent(),this._apnsPushToken="",[2,De.SUCCESS];case 4:return u.sent(),[2,De.ERROR];case 5:return[3,7];case 6:return this._apnsPushToken=e,[2,De.PENDING];case 7:return[2]}}))}))},e.prototype.unregisterAPNSPushTokenAllForCurrentUser=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i,s,o=this;return m(this,(function(a){switch(a.label){case 0:return this.currentUser?(e=E.of(this._iid),t=e.sessionManager,n=e.sdkState,r=e.requestQueue,i=new mn({userId:n.userId}),[4,r.send(i)]):[3,3];case 1:return s=a.sent().lastDeletedAt,[4,xe((function(){return v(o,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return t.unsetDeviceTokens(Fe.APNS),t.setDeviceTokenDeletedAt(s),[4,t.saveDeviceToken()];case 1:return e.sent(),[2]}}))}))}))];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))},e.prototype.getChannelInvitationPreference=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i;return m(this,(function(s){switch(s.label){case 0:return e=E.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new bn({userId:t.userId}),[4,n.send(r)];case 1:return i=s.sent(),[2,{autoAccept:i.as(In).autoAccept}]}}))}))},e.prototype.setChannelInvitationPreference=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s;return m(this,(function(o){switch(o.label){case 0:return _(c("boolean",e)).throw(y.invalidParameters),t=E.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new wn({userId:n.userId,willAutoAccept:e}),[4,r.send(i)];case 1:return s=o.sent(),[2,{autoAccept:s.as(En).autoAccept}]}}))}))},e.prototype.getDoNotDisturb=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i;return m(this,(function(s){switch(s.label){case 0:return e=E.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Tn({userId:t.userId}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(kn).preference]}}))}))},e.prototype.setDoNotDisturb=function(e,t,n,r,i,s){return void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===s&&(s=""),v(this,void 0,void 0,(function(){var o,a,u,l,h;return m(this,(function(d){switch(d.label){case 0:return _(c("boolean",e)&&c("number",t)&&c("number",n)&&c("number",r)&&c("number",i)&&c("string",s)).throw(y.invalidParameters),o=E.of(this._iid),a=o.sdkState,u=o.requestQueue,l=new Sn({userId:a.userId,doNotDisturbOn:e,startHour:t,startMin:n,endHour:r,endMin:i,timezone:s}),[4,u.send(l)];case 1:return h=d.sent(),[2,h.as(Cn).preference]}}))}))},e.prototype.getSnoozePeriod=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i;return m(this,(function(s){switch(s.label){case 0:return e=E.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Nn({userId:t.userId}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(An).snoozePeriod]}}))}))},e.prototype.setSnoozePeriod=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),v(this,void 0,void 0,(function(){var r,i,s,o,a;return m(this,(function(u){switch(u.label){case 0:return _(c("boolean",e)&&c("number",t)&&c("number",n)).throw(y.invalidParameters),r=E.of(this._iid),i=r.sdkState,s=r.requestQueue,o=new On({userId:i.userId,snoozeOn:e,startTs:t,endTs:n}),[4,s.send(o)];case 1:return a=u.sent(),[2,a.as(Pn).snoozePeriod]}}))}))},e.prototype.getMyPushTokensByToken=function(e,t){return v(this,void 0,void 0,(function(){var n,r,i,s,o,a,u,l,h,f,p,v;return m(this,(function(m){switch(m.label){case 0:return _(c("string",e)&&d(Fe,t)).throw(y.invalidParameters),n=E.of(this._iid),r=n.sdkState,i=n.requestQueue,s=n.sessionManager,o=new yn({userId:r.userId,type:t,token:e}),[4,i.send(o)];case 1:a=m.sent(),u=a.as(gn).pushTokens;try{for(l=D(u.deviceTokens),h=l.next();!h.done;h=l.next())f=h.value,s.setDeviceToken(u.type,f)}catch(e){p={error:e}}finally{try{h&&!h.done&&(v=l.return)&&v.call(l)}finally{if(p)throw p.error}}return[4,s.saveDeviceToken()];case 2:return m.sent(),[2,u]}}))}))},e.prototype.getPushTriggerOption=function(){return v(this,void 0,void 0,(function(){var e,t,n,r;return m(this,(function(i){switch(i.label){case 0:return e=E.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Rn({userId:t.userId}),[4,n.send(r)];case 1:return[2,i.sent().as(Ln).pushTriggerOption]}}))}))},e.prototype.setPushTriggerOption=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i;return m(this,(function(s){switch(s.label){case 0:return _(d(qe,e)).throw(y.invalidParameters),t=E.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new xn({userId:n.userId,pushTriggerOption:e}),[4,r.send(i)];case 1:return[2,s.sent().as(Dn).pushTriggerOption]}}))}))},e.prototype.getPushTemplate=function(){return v(this,void 0,void 0,(function(){var e,t,n,r;return m(this,(function(i){switch(i.label){case 0:return e=E.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new qn({userId:t.userId}),[4,n.send(r)];case 1:return[2,i.sent().as(Fn).name]}}))}))},e.prototype.setPushTemplate=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i;return m(this,(function(s){switch(s.label){case 0:return _(d(Be,e)).throw(y.invalidParameters),t=E.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Bn({userId:n.userId,templateName:e}),[4,r.send(i)];case 1:return[2,s.sent().as(Kn).name]}}))}))},e.prototype.blockUser=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i;return m(this,(function(s){switch(s.label){case 0:return _(e instanceof T||c("string",e)).throw(y.invalidParameters),t=E.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Un({userId:n.userId,blockedUserId:e instanceof T?e.userId:e}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},e.prototype.blockUserWithUserId=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){return[2,this.blockUser(e)]}))}))},e.prototype.unblockUser=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i;return m(this,(function(s){switch(s.label){case 0:return _(e instanceof T||c("string",e)).throw(y.invalidParameters),t=E.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Mn({userId:n.userId,unblockedUserId:e instanceof T?e.userId:e}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},e.prototype.unblockUserWithUserId=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){return[2,this.unblockUser(e)]}))}))},e.prototype.getFriendChangeLogsByToken=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s;return m(this,(function(o){switch(o.label){case 0:return _(c("string",e)).throw(y.invalidParameters),t=E.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new zn({userId:n.userId,token:e}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(Qn).changelogs]}}))}))},e.prototype.getAllowFriendDiscovery=function(){return v(this,void 0,void 0,(function(){var e,t,n,r,i;return m(this,(function(s){switch(s.label){case 0:return e=E.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Xn({userId:t.userId}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(Jn).allowFriendDiscovery]}}))}))},e.prototype.setAllowFriendDiscovery=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i;return m(this,(function(s){switch(s.label){case 0:return _(c("boolean",e)).throw(y.invalidParameters),t=E.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Zn({userId:n.userId,allowFriendDiscovery:e}),[4,r.send(i)];case 1:return s.sent(),[2,e]}}))}))},e.prototype.uploadFriendDiscoveries=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s;return m(this,(function(o){switch(o.label){case 0:return t=E.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new jn({userId:n.userId,discoveries:e}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(Vn).friendDiscoveryRequestId]}}))}))},e.prototype.deleteFriendDiscovery=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){return[2,this.deleteFriendDiscoveries([e])]}))}))},e.prototype.deleteFriendDiscoveries=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i;return m(this,(function(s){switch(s.label){case 0:return _(M("string",e)).throw(y.invalidParameters),t=E.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Hn({userId:n.userId,discoveryKeys:e}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},e.prototype.addFriends=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i,s;return m(this,(function(o){switch(o.label){case 0:return _(M("string",e)).throw(y.invalidParameters),t=E.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Gn({userId:n.userId,userIds:e}),[4,r.send(i)];case 1:return s=o.sent(),[2,s.as(Wn).users]}}))}))},e.prototype.deleteFriend=function(e){return v(this,void 0,void 0,(function(){return m(this,(function(t){return[2,this.deleteFriends([e])]}))}))},e.prototype.deleteFriends=function(e){return v(this,void 0,void 0,(function(){var t,n,r,i;return m(this,(function(s){switch(s.label){case 0:return _(M("string",e)).throw(y.invalidParameters),t=E.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Yn({userId:n.userId,userIds:e}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},e.prototype.getAllEmoji=function(){return v(this,void 0,void 0,(function(){var e,t,n;return m(this,(function(r){switch(r.label){case 0:return e=E.of(this._iid).requestQueue,t=new rr,[4,e.send(t)];case 1:return n=r.sent(),[2,n.as(ir).emojiContainer]}}))}))},e.prototype.getEmojiCategory=function(e){return v(this,void 0,void 0,(function(){var t,n,r;return m(this,(function(i){switch(i.label){case 0:return t=E.of(this._iid).requestQueue,n=new sr({categoryId:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(or).emojiCategory]}}))}))},e.prototype.getEmoji=function(e){return v(this,void 0,void 0,(function(){var t,n,r;return m(this,(function(i){switch(i.label){case 0:return t=E.of(this._iid).requestQueue,n=new ar({key:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(ur).emoji]}}))}))},e}();export{er as $,rn as A,ts as B,qe as C,gt as D,Ts as E,ss as F,Ke as G,Fs as H,ze as I,Qe as J,ot as K,Ks as L,en as M,bt as N,pt as O,qs as P,lt as Q,hi as R,Ht as S,ft as T,Jt as U,at as V,Qs as W,hr as X,ki as Y,pr as Z,_t as _,un as a,tr as a0,nr as a1,_r as a2,ti as a3,wi as a4,gi as a5,Be as a6,De as a7,Fe as a8,ci as a9,li as aa,ai as ab,mt as ac,yt as ad,cn as b,Qt as c,an as d,Gi as e,xi as f,Et as g,rs as h,Ji as i,$i as j,ms as k,ds as l,ps as m,ls as n,It as o,st as p,Tt as q,di as r,pi as s,vi as t,on as u,fi as v,Gt as w,Wt as x,Yt as y,Bs as z};
