var Sendbird=function(e){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function c(e,t,n){return c=u()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&o(a,n.prototype),a},c.apply(null,arguments)}function l(e){var t="function"==typeof Map?new Map:void 0;return l=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return c(e,arguments,s(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),o(r,e)},l(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}function f(e){var t=u();return function(){var n,r=s(e);if(t){var a=s(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return d(this,n)}}function p(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}function v(){return v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=p(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},v.apply(this,arguments)}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,i=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);s=!0);}catch(e){o=!0,a=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw a}}return i}(e,t)||g(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||g(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=g(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */function E(e,t,n,r){return new(n||(n=Promise))((function(a,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function o(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((r=r.apply(e,t||[])).next())}))}var b,w="4.5.0",x=function(){function e(){n(this,e)}return a(e,null,[{key:"OS_VERSION",get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"}},{key:"SDK_VERSION",get:function(){return w}},{key:"SDK_MAJOR_VERSION",get:function(){return e.SDK_VERSION.split(".")[0]}},{key:"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",get:function(){return 100}},{key:"INTERNAL_CALL",get:function(){return"ic"}}]),e}();!function(e){e[e.NON_AUTHORIZED=400108]="NON_AUTHORIZED",e[e.INVALID_TOKEN=400111]="INVALID_TOKEN",e[e.NOT_FOUND_IN_DATABASE=400201]="NOT_FOUND_IN_DATABASE",e[e.SESSION_TOKEN_EXPIRED=400302]="SESSION_TOKEN_EXPIRED",e[e.SESSION_KEY_EXPIRED=400309]="SESSION_KEY_EXPIRED",e[e.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",e[e.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",e[e.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",e[e.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",e[e.LOST_INSTANCE=700100]="LOST_INSTANCE",e[e.CONNECTION_RENEW=700102]="CONNECTION_RENEW",e[e.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",e[e.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",e[e.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",e[e.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",e[e.INVALID_PARAMETER=800110]="INVALID_PARAMETER",e[e.NOT_SUPPORTED_ERROR=800111]="NOT_SUPPORTED_ERROR",e[e.NETWORK_ERROR=800120]="NETWORK_ERROR",e[e.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",e[e.MALFORMED_DATA=800130]="MALFORMED_DATA",e[e.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",e[e.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",e[e.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",e[e.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",e[e.ACK_TIMEOUT=800180]="ACK_TIMEOUT",e[e.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",e[e.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",e[e.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",e[e.REQUEST_FAILED=800220]="REQUEST_FAILED",e[e.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",e[e.REQUEST_CANCELED=800240]="REQUEST_CANCELED",e[e.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",e[e.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",e[e.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",e[e.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",e[e.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED"}(b||(b={}));var R,C=function(e){return!(e instanceof T&&!e.shouldThrowOutside)},T=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.code,s=void 0===i?0:i,o=e.message;return n(this,r),(a=t.call(this,o)).shouldThrowOutside=!1,a.name="SendbirdError",a.code=s,Object.setPrototypeOf(h(a),r.prototype),a}return a(r,[{key:"isInvalidTokenError",get:function(){return this.code===b.INVALID_TOKEN}},{key:"isSessionTokenExpiredError",get:function(){return this.code===b.SESSION_TOKEN_EXPIRED}},{key:"isSessionKeyExpiredError",get:function(){return this.code===b.SESSION_KEY_EXPIRED}},{key:"throwOutside",value:function(){throw this.shouldThrowOutside=!0,this}}],[{key:"debugModeRequired",get:function(){return new r({code:b.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})}},{key:"lostInstance",get:function(){return new r({code:b.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})}},{key:"connectionRenew",get:function(){return new r({code:b.CONNECTION_RENEW,message:"Connection restarts."})}},{key:"invalidConnectionStateTransition",get:function(){return new r({code:b.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})}},{key:"connectionRequired",get:function(){return new r({code:b.CONNECTION_REQUIRED,message:"Connection is required."})}},{key:"connectionCanceled",get:function(){return new r({code:b.CONNECTION_CANCELED,message:"Connection is canceled."})}},{key:"invalidParameters",get:function(){return new r({code:b.INVALID_PARAMETER,message:"Invalid parameters."})}},{key:"notSupportedError",get:function(){return new r({code:b.NOT_SUPPORTED_ERROR,message:"Given parameters are not supported."})}},{key:"networkError",get:function(){return new r({code:b.NETWORK_ERROR,message:"There was a network error."})}},{key:"markAsReadAllRateLimitExceeded",get:function(){return new r({code:b.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})}},{key:"queryInProgress",get:function(){return new r({code:b.QUERY_IN_PROGRESS,message:"Query in progress."})}},{key:"noAckTimeout",get:function(){return new r({code:b.ACK_TIMEOUT,message:"Command received no ack."})}},{key:"loginTimeout",get:function(){return new r({code:b.LOGIN_TIMEOUT,message:"Connection timeout."})}},{key:"connectionClosed",get:function(){return new r({code:b.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})}},{key:"requestFailed",get:function(){return new r({code:b.REQUEST_FAILED,message:"Request failed."})}},{key:"fileUploadCanceled",get:function(){return new r({code:b.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})}},{key:"requestCanceled",get:function(){return new r({code:b.REQUEST_CANCELED,message:"Request has been canceled."})}},{key:"sessionTokenRefreshFailed",get:function(){return new r({code:b.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})}},{key:"sessionTokenRequestFailed",get:function(){return new r({code:b.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})}}]),r}(l(Error)),S=[b.CONNECTION_REQUIRED,b.NETWORK_ERROR,b.ACK_TIMEOUT,b.WEBSOCKET_CONNECTION_CLOSED,b.WEBSOCKET_CONNECTION_FAILED,b.FILE_UPLOAD_CANCEL_FAILED,b.REQUEST_CANCELED,b.INTERNAL_SERVER_ERROR,b.RATE_LIMIT_EXCEEDED,b.UNKNOWN_SERVER_ERROR],I=[b.WEBSOCKET_CONNECTION_CLOSED,b.WEBSOCKET_CONNECTION_FAILED,b.CONNECTION_REQUIRED],N=function(e,t){if(e!==t){var n=Object.assign({},e),r=Object.assign({},t);return(!n.hasOwnProperty("messageId")||!r.hasOwnProperty("messageId")||n.messageId===r.messageId)&&((!n.hasOwnProperty("reqId")||!r.hasOwnProperty("reqId")||n.reqId===r.reqId)&&(n.hasOwnProperty("messageId")&&delete n.messageId,n.hasOwnProperty("reqId")&&delete n.reqId,r.hasOwnProperty("messageId")&&delete r.messageId,r.hasOwnProperty("reqId")&&delete r.reqId,JSON.stringify(n)===JSON.stringify(r)))}return!0},A=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!(!r||null!=n)||("string"!=typeof e?"object"===t(e)?M(e,n):U(e,n):t(n)===e)},M=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!(!n||null!=t)||Object.values(e).includes(t)},U=function(e,t){return t instanceof e},O=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!(!n||null!=t)||Array.isArray(t)&&t.every((function(t){return A(e,t)}))},D=function(e){return e>0&&I.indexOf(e)>=0},L=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t&&null===e)return!0;var n=A("object",e)&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type;if(!n){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return n},P=1e4,F=1e3,H=1e4,G=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.useMemberInfoInMessage,a=void 0===r||r,i=t.typingIndicatorInvalidateTime,s=void 0===i?P:i,o=t.typingIndicatorThrottle,u=void 0===o?F:o,c=t.websocketResponseTimeout,l=void 0===c?H:c,h=t.websocketPayloadDecompression,d=void 0===h||h,f=t.sessionTokenRefreshTimeout,p=void 0===f?60:f;n(this,e),this._useMemberInfoInMessage=!0,this._typingIndicatorInvalidateTime=P,this._typingIndicatorThrottle=F,this._websocketResponseTimeout=H,this._sessionTokenRefreshTimeout=60,this._useMemberInfoInMessage=a,this._typingIndicatorInvalidateTime=s,this._typingIndicatorThrottle=u,this._websocketResponseTimeout=l,this._sessionTokenRefreshTimeout=p,this.websocketPayloadDecompression=d}return a(e,[{key:"useMemberInfoInMessage",get:function(){return this._useMemberInfoInMessage},set:function(e){A("boolean",e)&&(this._useMemberInfoInMessage=e)}},{key:"typingIndicatorInvalidateTime",get:function(){return this._typingIndicatorInvalidateTime},set:function(e){A("number",e)&&(this._typingIndicatorInvalidateTime=e)}},{key:"typingIndicatorThrottle",get:function(){return this._typingIndicatorThrottle},set:function(e){A("number",e)&&e>=1e3&&e<=9e3&&(this._typingIndicatorThrottle=e)}},{key:"websocketResponseTimeout",get:function(){return this._websocketResponseTimeout},set:function(e){A("number",e)&&e>=5e3&&e<=3e4&&(this._websocketResponseTimeout=e)}},{key:"sessionTokenRefreshTimeout",get:function(){return this._sessionTokenRefreshTimeout},set:function(e){A("number",e)&&(e<60?e=60:e>1800&&(e=1800),this._sessionTokenRefreshTimeout=e)}}]),e}(),q={encrypt:function(e){return e},decrypt:function(e){return e}},j=function(){function e(t){var r=t.store;n(this,e),this._preference=new Map,this._store=r}return a(e,[{key:"_savePreferenceKeys",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._store.set({key:this._keysAddress,value:_(this._preference.keys()),generation:1});case 2:case"end":return e.stop()}}),e,this)})))}},{key:"init",value:function(e){var t;return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this._keysAddress=e,n.next=3,this._store.get(e);case 3:if(n.t1=t=n.sent,n.t0=null!==n.t1,!n.t0){n.next=7;break}n.t0=void 0!==t;case 7:if(!n.t0){n.next=11;break}n.t2=t,n.next=12;break;case 11:n.t2=[];case 12:r=n.t2,a=k(r),n.prev=14,a.s();case 16:if((i=a.n()).done){n.next=24;break}return s=i.value,n.next=20,this._store.get(s);case 20:(o=n.sent)&&this._preference.set(s,o);case 22:n.next=16;break;case 24:n.next=29;break;case 26:n.prev=26,n.t3=n.catch(14),a.e(n.t3);case 29:return n.prev=29,a.f(),n.finish(29);case 32:case"end":return n.stop()}}),n,this,[[14,26,29,32]])})))}},{key:"get",value:function(e){var t;return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",null!==(t=this._preference.get(e))&&void 0!==t?t:null);case 1:case"end":return n.stop()}}),n,this)})))}},{key:"set",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=!this._preference.has(e),n.next=3,this._store.set({key:e,value:t,generation:1});case 3:if(this._preference.set(e,t),!r){n.next=7;break}return n.next=7,this._savePreferenceKeys();case 7:case"end":return n.stop()}}),n,this)})))}},{key:"remove",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._store.remove(e);case 2:return this._preference.delete(e),t.next=5,this._savePreferenceKeys();case 5:case"end":return t.stop()}}),t,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._store.removeMany(_(this._preference.keys()));case 2:return this._preference.clear(),e.next=5,this._savePreferenceKeys();case 5:case"end":return e.stop()}}),e,this)})))}}]),e}(),z=a((function e(t){var r=t.encryption,a=void 0===r?null:r,i=t.store,s=void 0===i?null:i,o=t.localCacheEnabled,u=void 0===o||o;n(this,e),this.nestdb=null,this.store=s,this.preference=new j({store:s}),this.encryption=null!=a?a:q,this.localCacheEnabled=u})),V=function(){function e(){n(this,e),this.sessionKey=null,this.authToken=null}return a(e,[{key:"hasSession",get:function(){return!!this.sessionKey}},{key:"clear",value:function(){this.authToken=null,this.sessionKey=null}}]),e}(),B=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))},Q=function(){function e(t){var r=t.container;n(this,e),this._container={},this._container=r,this.key=B()}return a(e,[{key:"_register",value:function(e,t,n){return e in this._container||(this._container[e]=new Map),this._container[e].set(this.key,{occurence:t,handler:n}),this}},{key:"on",value:function(e,t){return this._register(e,-1,t)}},{key:"once",value:function(e,t){return this._register(e,1,t)}},{key:"close",value:function(){for(var e in this._container)this._container[e].delete(this.key)}}]),e}(),K=function(){function e(){n(this,e),this._container={}}return a(e,[{key:"on",value:function(e,t){return new Q({container:this._container}).on(e,t)}},{key:"once",value:function(e,t){return new Q({container:this._container}).once(e,t)}},{key:"dispatch",value:function(e,t){var n=this._container[e];if(n){var r,a=[],i=k(n.keys());try{for(i.s();!(r=i.n()).done;){var s=r.value,o=n.get(s);o.handler(t),o.occurence>0&&(o.occurence--,0===o.occurence&&a.push(s))}}catch(e){i.e(e)}finally{i.f()}a.forEach((function(e){return n.delete(e)}))}}}]),e}(),W=function(){function e(){n(this,e),this._dispatcher=new K}return a(e,[{key:"on",value:function(e){return this._dispatcher.on("event",e)}},{key:"once",value:function(e){return this._dispatcher.once("event",e)}},{key:"dispatch",value:function(e){this._dispatcher.dispatch("event",e)}}]),e}(),Y=a((function e(){n(this,e)})),Z=function(e){var t={};return e&&Object.keys(e).forEach((function(n){void 0!==e[n]&&NaN!==e[n]&&null!==e[n]&&(t[n]=e[n])})),t};!function(e){e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE"}(R||(R={}));var X,J=function(e){i(s,e);var r=f(s);function s(){var e;return n(this,s),(e=r.apply(this,arguments)).params={},e.requireAuth=!0,e.headers={},e.requestId=B(),e}return a(s,[{key:"stringifyParams",value:function(e){return"object"!==t(e)||Array.isArray(e)?String(e):e?JSON.stringify(e):""}},{key:"encodeParams",value:function(e){var n=this;return null==e||""===e?encodeURIComponent(""):Array.isArray(e)?e.map((function(e){return n.encodeParams(e)})).join(","):"object"===t(e)?encodeURIComponent(JSON.stringify(e)):encodeURIComponent(String(e))}},{key:"query",get:function(){var e=this,t=Z(this.params);return"?".concat(Object.keys(t).map((function(n){return"".concat(encodeURIComponent(n),"=").concat(e.encodeParams(t[n]))})).join("&"))}},{key:"payload",get:function(){var e=this,t=Z(this.params);if(Object.keys(t).some((function(e){return L(t[e])}))){var n=new FormData;return Object.keys(t).forEach((function(r){var a,i=t[r];if(L(i)){var s=i;n.append(r,s,null!==(a=s.name)&&void 0!==a?a:"filename")}else n.append(r,e.stringifyParams(i))})),n}return JSON.stringify(t)}}]),s}(Y),$=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this))._iid=e,i._payload=a,i}return a(r,[{key:"payload",get:function(){return Object.assign({},this._payload)}},{key:"as",value:function(e){return new e(this._iid,this.payload)}}]),r}(Y),ee=function(e){i(r,e);var t=f(r);function r(e){var a;return n(this,r),(a=t.call(this)).requestId=e,a}return a(r)}(Y),te=function(e){i(r,e);var t=f(r);function r(){return n(this,r),t.apply(this,arguments)}return a(r)}(Y),ne=function(e){i(r,e);var t=f(r);function r(e){var a;return n(this,r),(a=t.call(this)).statLog=e,a}return a(r)}(Y);!function(e){e.WEBSOCKET_CONNECT="ws:connect",e.API_RESULT="api:result"}(X||(X={}));var re=function(){function e(t){var r=t.type,a=t.data,i=t.ts,s=void 0===i?Date.now():i;n(this,e),this.type=r,this.createdAt=s,this.data=a}return a(e,null,[{key:"payloadify",value:function(e){return Z({stat_type:e.type,ts:e.createdAt,data:Z(e.data)})}}]),e}(),ae=function(){function e(t,r){var a=this,i=r.auth,s=r.sdkState,o=r.dispatcher,u=r.logger;n(this,e),this._abortControl=new Map,this._iid=t,this._auth=i,this._sdkState=s,this._dispatcher=o,this._dispatcher.on((function(e){e instanceof ee&&a.cancel(e.requestId)})),this._logger=u}return a(e,[{key:"_userAgentWithExtension",get:function(){var e=this._sdkState.extensions,t="undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product?"reactnative":"JS",n=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",r=e.sb_uikit?"u".concat(e.sb_uikit):"",a=e["device-os-platform"]?"o".concat(e["device-os-platform"]):"";return"".concat(t,"/c").concat(x.SDK_VERSION,"/").concat(n,"/").concat(r,"/").concat(a)}},{key:"_createHeader",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this._sdkState,r=n.appId,a=n.appVersion,i=Object.assign(Object.assign({},e.headers),{SendBird:"JS,".concat(x.OS_VERSION,",").concat(x.SDK_VERSION,",").concat(r).concat(a?",".concat(a):""),"SB-User-Agent":encodeURIComponent(this._userAgentWithExtension),"Request-Sent-Timestamp":Date.now().toString()});return t||(i["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&this._auth.hasSession&&(i["Session-Key"]=this._auth.sessionKey),this._auth&&this._auth.authToken&&(i["App-Id"]=r,i["Access-Token"]=this._auth.authToken),i}},{key:"_statLogApiResult",value:function(e,t,n){this._dispatcher.dispatch(new ne(new re({type:X.API_RESULT,data:{endpoint:e.path,method:e.method,success:!n,latency:Date.now()-t,error_code:null==n?void 0:n.code,error_description:null==n?void 0:n.message}})))}},{key:"send",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c,l,h,d,f,p,v,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.path,r=e.method,a=![R.GET,R.DELETE].includes(r),i=this._sdkState.api,s="".concat(i.host).concat(n).concat(a?"":e.query),o=a?e.payload:null,u=this._createHeader(e,o instanceof FormData?o:null),c=new AbortController,l=c.signal,this._abortControl.set(e.requestId,c),h=Date.now(),t.prev=10,t.next=13,fetch(s,{method:r,body:o,headers:u,signal:l});case 13:return d=t.sent,t.next=16,d.json();case 16:if(f=t.sent,!d.ok&&!d.redirected){t.next=23;break}return this._logger.debug("receive api response",e.requestId),this._statLogApiResult(e,h,null),t.abrupt("return",new $(this._iid,f));case 23:if(!f){t.next=30;break}throw p=new T(f),!e.requireAuth&&p.isSessionKeyExpiredError&&this._dispatcher.dispatch(new te),this._statLogApiResult(e,h,p),p;case 30:throw v=T.requestFailed,this._statLogApiResult(e,h,v),v;case 33:t.next=50;break;case 35:if(t.prev=35,t.t0=t.catch(10),this._statLogApiResult(e,h,t.t0),!(t.t0 instanceof T)){t.next=43;break}throw this._logger.debug("fail api request",t.t0),t.t0;case 43:if("AbortError"!==t.t0.name){t.next=47;break}throw T.requestCanceled;case 47:throw m=T.networkError,this._logger.debug("fail api request",m),m;case 50:case"end":return t.stop()}}),t,this,[[10,35]])})))}},{key:"cancel",value:function(e){this._abortControl.has(e)&&(this._abortControl.get(e).abort(),this._abortControl.delete(e))}},{key:"cancelAll",value:function(){var e,t=k(this._abortControl.values());try{for(t.s();!(e=t.n()).done;){e.value.abort()}}catch(e){t.e(e)}finally{t.f()}this._abortControl.clear()}}]),e}(),ie=function(e){i(r,e);var t=f(r);function r(e,a,i){var s,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return n(this,r),(s=t.call(this))._iid=e,s.code=a,s.payload=i,s.requestId=i?i.req_id:o,s}return a(r,[{key:"convertToMessage",value:function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")}},{key:"as",value:function(e){return new e(this._iid,this.code,this.payload)}}],[{key:"createFromRawMessage",value:function(e,t){var n=t.substring(0,4),a=null;try{a=JSON.parse(t.substring(4))}catch(e){n="NOOP"}finally{return new r(e,n,a)}}}]),r}(Y),se=function(){};function oe(e){let t=e.length;for(;--t>=0;)e[t]=0}const ue=256,ce=286,le=30,he=15,de=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),fe=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),pe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),ve=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),me=new Array(576);oe(me);const _e=new Array(60);oe(_e);const ge=new Array(512);oe(ge);const ye=new Array(256);oe(ye);const ke=new Array(29);oe(ke);const Ee=new Array(le);function be(e,t,n,r,a){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=a,this.has_stree=e&&e.length}let we,xe,Re;function Ce(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}oe(Ee);const Te=e=>e<256?ge[e]:ge[256+(e>>>7)],Se=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Ie=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,Se(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},Ne=(e,t,n)=>{Ie(e,n[2*t],n[2*t+1])},Ae=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},Me=(e,t,n)=>{const r=new Array(16);let a,i,s=0;for(a=1;a<=he;a++)s=s+n[a-1]<<1,r[a]=s;for(i=0;i<=t;i++){let t=e[2*i+1];0!==t&&(e[2*i]=Ae(r[t]++,t))}},Ue=e=>{let t;for(t=0;t<ce;t++)e.dyn_ltree[2*t]=0;for(t=0;t<le;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Oe=e=>{e.bi_valid>8?Se(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},De=(e,t,n,r)=>{const a=2*t,i=2*n;return e[a]<e[i]||e[a]===e[i]&&r[t]<=r[n]},Le=(e,t,n)=>{const r=e.heap[n];let a=n<<1;for(;a<=e.heap_len&&(a<e.heap_len&&De(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!De(t,r,e.heap[a],e.depth));)e.heap[n]=e.heap[a],n=a,a<<=1;e.heap[n]=r},Pe=(e,t,n)=>{let r,a,i,s,o=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+o++],r+=(255&e.pending_buf[e.sym_buf+o++])<<8,a=e.pending_buf[e.sym_buf+o++],0===r?Ne(e,a,t):(i=ye[a],Ne(e,i+ue+1,t),s=de[i],0!==s&&(a-=ke[i],Ie(e,a,s)),r--,i=Te(r),Ne(e,i,n),s=fe[i],0!==s&&(r-=Ee[i],Ie(e,r,s)))}while(o<e.sym_next);Ne(e,256,t)},Fe=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,a=t.stat_desc.has_stree,i=t.stat_desc.elems;let s,o,u,c=-1;for(e.heap_len=0,e.heap_max=573,s=0;s<i;s++)0!==n[2*s]?(e.heap[++e.heap_len]=c=s,e.depth[s]=0):n[2*s+1]=0;for(;e.heap_len<2;)u=e.heap[++e.heap_len]=c<2?++c:0,n[2*u]=1,e.depth[u]=0,e.opt_len--,a&&(e.static_len-=r[2*u+1]);for(t.max_code=c,s=e.heap_len>>1;s>=1;s--)Le(e,n,s);u=i;do{s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Le(e,n,1),o=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=o,n[2*u]=n[2*s]+n[2*o],e.depth[u]=(e.depth[s]>=e.depth[o]?e.depth[s]:e.depth[o])+1,n[2*s+1]=n[2*o+1]=u,e.heap[1]=u++,Le(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,r=t.max_code,a=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,u=t.stat_desc.max_length;let c,l,h,d,f,p,v=0;for(d=0;d<=he;d++)e.bl_count[d]=0;for(n[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)l=e.heap[c],d=n[2*n[2*l+1]+1]+1,d>u&&(d=u,v++),n[2*l+1]=d,l>r||(e.bl_count[d]++,f=0,l>=o&&(f=s[l-o]),p=n[2*l],e.opt_len+=p*(d+f),i&&(e.static_len+=p*(a[2*l+1]+f)));if(0!==v){do{for(d=u-1;0===e.bl_count[d];)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[u]--,v-=2}while(v>0);for(d=u;0!==d;d--)for(l=e.bl_count[d];0!==l;)h=e.heap[--c],h>r||(n[2*h+1]!==d&&(e.opt_len+=(d-n[2*h+1])*n[2*h],n[2*h+1]=d),l--)}})(e,t),Me(n,c,e.bl_count)},He=(e,t,n)=>{let r,a,i=-1,s=t[1],o=0,u=7,c=4;for(0===s&&(u=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)a=s,s=t[2*(r+1)+1],++o<u&&a===s||(o<c?e.bl_tree[2*a]+=o:0!==a?(a!==i&&e.bl_tree[2*a]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,i=a,0===s?(u=138,c=3):a===s?(u=6,c=3):(u=7,c=4))},Ge=(e,t,n)=>{let r,a,i=-1,s=t[1],o=0,u=7,c=4;for(0===s&&(u=138,c=3),r=0;r<=n;r++)if(a=s,s=t[2*(r+1)+1],!(++o<u&&a===s)){if(o<c)do{Ne(e,a,e.bl_tree)}while(0!=--o);else 0!==a?(a!==i&&(Ne(e,a,e.bl_tree),o--),Ne(e,16,e.bl_tree),Ie(e,o-3,2)):o<=10?(Ne(e,17,e.bl_tree),Ie(e,o-3,3)):(Ne(e,18,e.bl_tree),Ie(e,o-11,7));o=0,i=a,0===s?(u=138,c=3):a===s?(u=6,c=3):(u=7,c=4)}};let qe=!1;const je=(e,t,n,r)=>{Ie(e,0+(r?1:0),3),Oe(e),Se(e,n),Se(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var ze=(e,t,n,r)=>{let a,i,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<ue;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),Fe(e,e.l_desc),Fe(e,e.d_desc),s=(e=>{let t;for(He(e,e.dyn_ltree,e.l_desc.max_code),He(e,e.dyn_dtree,e.d_desc.max_code),Fe(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*ve[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),a=e.opt_len+3+7>>>3,i=e.static_len+3+7>>>3,i<=a&&(a=i)):a=i=n+5,n+4<=a&&-1!==t?je(e,t,n,r):4===e.strategy||i===a?(Ie(e,2+(r?1:0),3),Pe(e,me,_e)):(Ie(e,4+(r?1:0),3),((e,t,n,r)=>{let a;for(Ie(e,t-257,5),Ie(e,n-1,5),Ie(e,r-4,4),a=0;a<r;a++)Ie(e,e.bl_tree[2*ve[a]+1],3);Ge(e,e.dyn_ltree,t-1),Ge(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),Pe(e,e.dyn_ltree,e.dyn_dtree)),Ue(e),r&&Oe(e)},Ve={_tr_init:e=>{qe||((()=>{let e,t,n,r,a;const i=new Array(16);for(n=0,r=0;r<28;r++)for(ke[r]=n,e=0;e<1<<de[r];e++)ye[n++]=r;for(ye[n-1]=r,a=0,r=0;r<16;r++)for(Ee[r]=a,e=0;e<1<<fe[r];e++)ge[a++]=r;for(a>>=7;r<le;r++)for(Ee[r]=a<<7,e=0;e<1<<fe[r]-7;e++)ge[256+a++]=r;for(t=0;t<=he;t++)i[t]=0;for(e=0;e<=143;)me[2*e+1]=8,e++,i[8]++;for(;e<=255;)me[2*e+1]=9,e++,i[9]++;for(;e<=279;)me[2*e+1]=7,e++,i[7]++;for(;e<=287;)me[2*e+1]=8,e++,i[8]++;for(Me(me,287,i),e=0;e<le;e++)_e[2*e+1]=5,_e[2*e]=Ae(e,5);we=new be(me,de,257,ce,he),xe=new be(_e,fe,0,le,he),Re=new be(new Array(0),pe,0,19,7)})(),qe=!0),e.l_desc=new Ce(e.dyn_ltree,we),e.d_desc=new Ce(e.dyn_dtree,xe),e.bl_desc=new Ce(e.bl_tree,Re),e.bi_buf=0,e.bi_valid=0,Ue(e)},_tr_stored_block:je,_tr_flush_block:ze,_tr_tally:(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(ye[n]+ue+1)]++,e.dyn_dtree[2*Te(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{Ie(e,2,3),Ne(e,256,me),(e=>{16===e.bi_valid?(Se(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var Be=(e,t,n,r)=>{let a=65535&e|0,i=e>>>16&65535|0,s=0;for(;0!==n;){s=n>2e3?2e3:n,n-=s;do{a=a+t[r++]|0,i=i+a|0}while(--s);a%=65521,i%=65521}return a|i<<16|0};const Qe=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Ke=(e,t,n,r)=>{const a=Qe,i=r+n;e^=-1;for(let n=r;n<i;n++)e=e>>>8^a[255&(e^t[n])];return-1^e},We={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ye={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Ze,_tr_stored_block:Xe,_tr_flush_block:Je,_tr_tally:$e,_tr_align:et}=Ve,{Z_NO_FLUSH:tt,Z_PARTIAL_FLUSH:nt,Z_FULL_FLUSH:rt,Z_FINISH:at,Z_BLOCK:it,Z_OK:st,Z_STREAM_END:ot,Z_STREAM_ERROR:ut,Z_DATA_ERROR:ct,Z_BUF_ERROR:lt,Z_DEFAULT_COMPRESSION:ht,Z_FILTERED:dt,Z_HUFFMAN_ONLY:ft,Z_RLE:pt,Z_FIXED:vt,Z_DEFAULT_STRATEGY:mt,Z_UNKNOWN:_t,Z_DEFLATED:gt}=Ye,yt=258,kt=262,Et=42,bt=113,wt=666,xt=(e,t)=>(e.msg=We[t],t),Rt=e=>2*e-(e>4?9:0),Ct=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Tt=e=>{let t,n,r,a=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=a?n-a:0}while(--t);t=a,r=t;do{n=e.prev[--r],e.prev[r]=n>=a?n-a:0}while(--t)};let St=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const It=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},Nt=(e,t)=>{Je(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,It(e.strm)},At=(e,t)=>{e.pending_buf[e.pending++]=t},Mt=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Ut=(e,t,n,r)=>{let a=e.avail_in;return a>r&&(a=r),0===a?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),n),1===e.state.wrap?e.adler=Be(e.adler,t,a,n):2===e.state.wrap&&(e.adler=Ke(e.adler,t,a,n)),e.next_in+=a,e.total_in+=a,a)},Ot=(e,t)=>{let n,r,a=e.max_chain_length,i=e.strstart,s=e.prev_length,o=e.nice_match;const u=e.strstart>e.w_size-kt?e.strstart-(e.w_size-kt):0,c=e.window,l=e.w_mask,h=e.prev,d=e.strstart+yt;let f=c[i+s-1],p=c[i+s];e.prev_length>=e.good_match&&(a>>=2),o>e.lookahead&&(o=e.lookahead);do{if(n=t,c[n+s]===p&&c[n+s-1]===f&&c[n]===c[i]&&c[++n]===c[i+1]){i+=2,n++;do{}while(c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&i<d);if(r=yt-(d-i),i=d-yt,r>s){if(e.match_start=t,s=r,r>=o)break;f=c[i+s-1],p=c[i+s]}}}while((t=h[t&l])>u&&0!=--a);return s<=e.lookahead?s:e.lookahead},Dt=e=>{const t=e.w_size;let n,r,a;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-kt)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Tt(e),r+=t),0===e.strm.avail_in)break;if(n=Ut(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=St(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=St(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<kt&&0!==e.strm.avail_in)},Lt=(e,t)=>{let n,r,a,i=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,o=e.strm.avail_in;do{if(n=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a)break;if(a=e.strm.avail_out-a,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>a&&(n=a),n<i&&(0===n&&t!==at||t===tt||n!==r+e.strm.avail_in))break;s=t===at&&n===r+e.strm.avail_in?1:0,Xe(e,0,0,s),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,It(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(Ut(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===s);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==tt&&t!==at&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(Ut(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,i=a>e.w_size?e.w_size:a,r=e.strstart-e.block_start,(r>=i||(r||t===at)&&t!==tt&&0===e.strm.avail_in&&r<=a)&&(n=r>a?a:r,s=t===at&&0===e.strm.avail_in&&n===r?1:0,Xe(e,e.block_start,n,s),e.block_start+=n,It(e.strm)),s?3:1)},Pt=(e,t)=>{let n,r;for(;;){if(e.lookahead<kt){if(Dt(e),e.lookahead<kt&&t===tt)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=St(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-kt&&(e.match_length=Ot(e,n)),e.match_length>=3)if(r=$e(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=St(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=St(e,e.ins_h,e.window[e.strstart+1]);else r=$e(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Nt(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===at?(Nt(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Nt(e,!1),0===e.strm.avail_out)?1:2},Ft=(e,t)=>{let n,r,a;for(;;){if(e.lookahead<kt){if(Dt(e),e.lookahead<kt&&t===tt)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=St(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-kt&&(e.match_length=Ot(e,n),e.match_length<=5&&(e.strategy===dt||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,r=$e(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=St(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(Nt(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=$e(e,0,e.window[e.strstart-1]),r&&Nt(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=$e(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===at?(Nt(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Nt(e,!1),0===e.strm.avail_out)?1:2};function Ht(e,t,n,r,a){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=a}const Gt=[new Ht(0,0,0,0,Lt),new Ht(4,4,8,4,Pt),new Ht(4,5,16,8,Pt),new Ht(4,6,32,32,Pt),new Ht(4,4,16,16,Ft),new Ht(8,16,32,32,Ft),new Ht(8,16,128,128,Ft),new Ht(8,32,128,256,Ft),new Ht(32,128,258,1024,Ft),new Ht(32,258,258,4096,Ft)];function qt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=gt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Ct(this.dyn_ltree),Ct(this.dyn_dtree),Ct(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Ct(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Ct(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const jt=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Et&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==bt&&t.status!==wt?1:0},zt=e=>{if(jt(e))return xt(e,ut);e.total_in=e.total_out=0,e.data_type=_t;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Et:bt,e.adler=2===t.wrap?0:1,t.last_flush=-2,Ze(t),st},Vt=e=>{const t=zt(e);var n;return t===st&&((n=e.state).window_size=2*n.w_size,Ct(n.head),n.max_lazy_match=Gt[n.level].max_lazy,n.good_match=Gt[n.level].good_length,n.nice_match=Gt[n.level].nice_length,n.max_chain_length=Gt[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t},Bt=(e,t,n,r,a,i)=>{if(!e)return ut;let s=1;if(t===ht&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),a<1||a>9||n!==gt||r<8||r>15||t<0||t>9||i<0||i>vt||8===r&&1!==s)return xt(e,ut);8===r&&(r=9);const o=new qt;return e.state=o,o.strm=e,o.status=Et,o.wrap=s,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=i,o.method=n,Vt(e)};var Qt={deflateInit:(e,t)=>Bt(e,t,gt,15,8,mt),deflateInit2:Bt,deflateReset:Vt,deflateResetKeep:zt,deflateSetHeader:(e,t)=>jt(e)||2!==e.state.wrap?ut:(e.state.gzhead=t,st),deflate:(e,t)=>{if(jt(e)||t>it||t<0)return e?xt(e,ut):ut;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===wt&&t!==at)return xt(e,0===e.avail_out?lt:ut);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(It(e),0===e.avail_out)return n.last_flush=-1,st}else if(0===e.avail_in&&Rt(t)<=Rt(r)&&t!==at)return xt(e,lt);if(n.status===wt&&0!==e.avail_in)return xt(e,lt);if(n.status===Et&&0===n.wrap&&(n.status=bt),n.status===Et){let t=gt+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=ft||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,Mt(n,t),0!==n.strstart&&(Mt(n,e.adler>>>16),Mt(n,65535&e.adler)),e.adler=1,n.status=bt,It(e),0!==n.pending)return n.last_flush=-1,st}if(57===n.status)if(e.adler=0,At(n,31),At(n,139),At(n,8),n.gzhead)At(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),At(n,255&n.gzhead.time),At(n,n.gzhead.time>>8&255),At(n,n.gzhead.time>>16&255),At(n,n.gzhead.time>>24&255),At(n,9===n.level?2:n.strategy>=ft||n.level<2?4:0),At(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(At(n,255&n.gzhead.extra.length),At(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Ke(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(At(n,0),At(n,0),At(n,0),At(n,0),At(n,0),At(n,9===n.level?2:n.strategy>=ft||n.level<2?4:0),At(n,3),n.status=bt,It(e),0!==n.pending)return n.last_flush=-1,st;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let a=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=Ke(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=a,It(e),0!==n.pending)return n.last_flush=-1,st;t=0,r-=a}let a=new Uint8Array(n.gzhead.extra);n.pending_buf.set(a.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=Ke(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=Ke(e.adler,n.pending_buf,n.pending-r,r)),It(e),0!==n.pending)return n.last_flush=-1,st;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,At(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=Ke(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=Ke(e.adler,n.pending_buf,n.pending-r,r)),It(e),0!==n.pending)return n.last_flush=-1,st;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,At(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=Ke(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(It(e),0!==n.pending))return n.last_flush=-1,st;At(n,255&e.adler),At(n,e.adler>>8&255),e.adler=0}if(n.status=bt,It(e),0!==n.pending)return n.last_flush=-1,st}if(0!==e.avail_in||0!==n.lookahead||t!==tt&&n.status!==wt){let r=0===n.level?Lt(n,t):n.strategy===ft?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(Dt(e),0===e.lookahead)){if(t===tt)return 1;break}if(e.match_length=0,n=$e(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Nt(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===at?(Nt(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Nt(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===pt?((e,t)=>{let n,r,a,i;const s=e.window;for(;;){if(e.lookahead<=yt){if(Dt(e),e.lookahead<=yt&&t===tt)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=e.strstart-1,r=s[a],r===s[++a]&&r===s[++a]&&r===s[++a])){i=e.strstart+yt;do{}while(r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&a<i);e.match_length=yt-(i-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=$e(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=$e(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Nt(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===at?(Nt(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Nt(e,!1),0===e.strm.avail_out)?1:2})(n,t):Gt[n.level].func(n,t);if(3!==r&&4!==r||(n.status=wt),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),st;if(2===r&&(t===nt?et(n):t!==it&&(Xe(n,0,0,!1),t===rt&&(Ct(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),It(e),0===e.avail_out))return n.last_flush=-1,st}return t!==at?st:n.wrap<=0?ot:(2===n.wrap?(At(n,255&e.adler),At(n,e.adler>>8&255),At(n,e.adler>>16&255),At(n,e.adler>>24&255),At(n,255&e.total_in),At(n,e.total_in>>8&255),At(n,e.total_in>>16&255),At(n,e.total_in>>24&255)):(Mt(n,e.adler>>>16),Mt(n,65535&e.adler)),It(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?st:ot)},deflateEnd:e=>{if(jt(e))return ut;const t=e.state.status;return e.state=null,t===bt?xt(e,ct):st},deflateSetDictionary:(e,t)=>{let n=t.length;if(jt(e))return ut;const r=e.state,a=r.wrap;if(2===a||1===a&&r.status!==Et||r.lookahead)return ut;if(1===a&&(e.adler=Be(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===a&&(Ct(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}const i=e.avail_in,s=e.next_in,o=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Dt(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=St(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,Dt(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=o,e.avail_in=i,r.wrap=a,st},deflateInfo:"pako deflate (from Nodeca project)"};const Kt=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Wt=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)Kt(n,t)&&(e[t]=n[t])}}return e},Yt=e=>{let t=0;for(let n=0,r=e.length;n<r;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,r=0,a=e.length;t<a;t++){let a=e[t];n.set(a,r),r+=a.length}return n};let Zt=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Zt=!1}const Xt=new Uint8Array(256);for(let e=0;e<256;e++)Xt[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Xt[254]=Xt[254]=1;var Jt=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,a,i,s=e.length,o=0;for(a=0;a<s;a++)n=e.charCodeAt(a),55296==(64512&n)&&a+1<s&&(r=e.charCodeAt(a+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),a++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),i=0,a=0;i<o;a++)n=e.charCodeAt(a),55296==(64512&n)&&a+1<s&&(r=e.charCodeAt(a+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),a++)),n<128?t[i++]=n:n<2048?(t[i++]=192|n>>>6,t[i++]=128|63&n):n<65536?(t[i++]=224|n>>>12,t[i++]=128|n>>>6&63,t[i++]=128|63&n):(t[i++]=240|n>>>18,t[i++]=128|n>>>12&63,t[i++]=128|n>>>6&63,t[i++]=128|63&n);return t},$t=(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,a;const i=new Array(2*n);for(a=0,r=0;r<n;){let t=e[r++];if(t<128){i[a++]=t;continue}let s=Xt[t];if(s>4)i[a++]=65533,r+=s-1;else{for(t&=2===s?31:3===s?15:7;s>1&&r<n;)t=t<<6|63&e[r++],s--;s>1?i[a++]=65533:t<65536?i[a++]=t:(t-=65536,i[a++]=55296|t>>10&1023,i[a++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Zt)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(i,a)},en=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+Xt[e[n]]>t?n:t};var tn=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const nn=Object.prototype.toString,{Z_NO_FLUSH:rn,Z_SYNC_FLUSH:an,Z_FULL_FLUSH:sn,Z_FINISH:on,Z_OK:un,Z_STREAM_END:cn,Z_DEFAULT_COMPRESSION:ln,Z_DEFAULT_STRATEGY:hn,Z_DEFLATED:dn}=Ye;function fn(e){this.options=Wt({level:ln,method:dn,chunkSize:16384,windowBits:15,memLevel:8,strategy:hn},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new tn,this.strm.avail_out=0;let n=Qt.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==un)throw new Error(We[n]);if(t.header&&Qt.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Jt(t.dictionary):"[object ArrayBuffer]"===nn.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=Qt.deflateSetDictionary(this.strm,e),n!==un)throw new Error(We[n]);this._dict_set=!0}}function pn(e,t){const n=new fn(t);if(n.push(e,!0),n.err)throw n.msg||We[n.err];return n.result}fn.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let a,i;if(this.ended)return!1;for(i=t===~~t?t:!0===t?on:rn,"string"==typeof e?n.input=Jt(e):"[object ArrayBuffer]"===nn.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(i===an||i===sn)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(a=Qt.deflate(n,i),a===cn)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),a=Qt.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===un;if(0!==n.avail_out){if(i>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},fn.prototype.onData=function(e){this.chunks.push(e)},fn.prototype.onEnd=function(e){e===un&&(this.result=Yt(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var vn={Deflate:fn,deflate:pn,deflateRaw:function(e,t){return(t=t||{}).raw=!0,pn(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,pn(e,t)},constants:Ye};const mn=16209;var _n=function(e,t){let n,r,a,i,s,o,u,c,l,h,d,f,p,v,m,_,g,y,k,E,b,w,x,R;const C=e.state;n=e.next_in,x=e.input,r=n+(e.avail_in-5),a=e.next_out,R=e.output,i=a-(t-e.avail_out),s=a+(e.avail_out-257),o=C.dmax,u=C.wsize,c=C.whave,l=C.wnext,h=C.window,d=C.hold,f=C.bits,p=C.lencode,v=C.distcode,m=(1<<C.lenbits)-1,_=(1<<C.distbits)-1;e:do{f<15&&(d+=x[n++]<<f,f+=8,d+=x[n++]<<f,f+=8),g=p[d&m];t:for(;;){if(y=g>>>24,d>>>=y,f-=y,y=g>>>16&255,0===y)R[a++]=65535&g;else{if(!(16&y)){if(0==(64&y)){g=p[(65535&g)+(d&(1<<y)-1)];continue t}if(32&y){C.mode=16191;break e}e.msg="invalid literal/length code",C.mode=mn;break e}k=65535&g,y&=15,y&&(f<y&&(d+=x[n++]<<f,f+=8),k+=d&(1<<y)-1,d>>>=y,f-=y),f<15&&(d+=x[n++]<<f,f+=8,d+=x[n++]<<f,f+=8),g=v[d&_];n:for(;;){if(y=g>>>24,d>>>=y,f-=y,y=g>>>16&255,!(16&y)){if(0==(64&y)){g=v[(65535&g)+(d&(1<<y)-1)];continue n}e.msg="invalid distance code",C.mode=mn;break e}if(E=65535&g,y&=15,f<y&&(d+=x[n++]<<f,f+=8,f<y&&(d+=x[n++]<<f,f+=8)),E+=d&(1<<y)-1,E>o){e.msg="invalid distance too far back",C.mode=mn;break e}if(d>>>=y,f-=y,y=a-i,E>y){if(y=E-y,y>c&&C.sane){e.msg="invalid distance too far back",C.mode=mn;break e}if(b=0,w=h,0===l){if(b+=u-y,y<k){k-=y;do{R[a++]=h[b++]}while(--y);b=a-E,w=R}}else if(l<y){if(b+=u+l-y,y-=l,y<k){k-=y;do{R[a++]=h[b++]}while(--y);if(b=0,l<k){y=l,k-=y;do{R[a++]=h[b++]}while(--y);b=a-E,w=R}}}else if(b+=l-y,y<k){k-=y;do{R[a++]=h[b++]}while(--y);b=a-E,w=R}for(;k>2;)R[a++]=w[b++],R[a++]=w[b++],R[a++]=w[b++],k-=3;k&&(R[a++]=w[b++],k>1&&(R[a++]=w[b++]))}else{b=a-E;do{R[a++]=R[b++],R[a++]=R[b++],R[a++]=R[b++],k-=3}while(k>2);k&&(R[a++]=R[b++],k>1&&(R[a++]=R[b++]))}break}}break}}while(n<r&&a<s);k=f>>3,n-=k,f-=k<<3,d&=(1<<f)-1,e.next_in=n,e.next_out=a,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=a<s?s-a+257:257-(a-s),C.hold=d,C.bits=f};const gn=15,yn=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),kn=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),En=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),bn=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var wn=(e,t,n,r,a,i,s,o)=>{const u=o.bits;let c,l,h,d,f,p,v=0,m=0,_=0,g=0,y=0,k=0,E=0,b=0,w=0,x=0,R=null;const C=new Uint16Array(16),T=new Uint16Array(16);let S,I,N,A=null;for(v=0;v<=gn;v++)C[v]=0;for(m=0;m<r;m++)C[t[n+m]]++;for(y=u,g=gn;g>=1&&0===C[g];g--);if(y>g&&(y=g),0===g)return a[i++]=20971520,a[i++]=20971520,o.bits=1,0;for(_=1;_<g&&0===C[_];_++);for(y<_&&(y=_),b=1,v=1;v<=gn;v++)if(b<<=1,b-=C[v],b<0)return-1;if(b>0&&(0===e||1!==g))return-1;for(T[1]=0,v=1;v<gn;v++)T[v+1]=T[v]+C[v];for(m=0;m<r;m++)0!==t[n+m]&&(s[T[t[n+m]]++]=m);if(0===e?(R=A=s,p=20):1===e?(R=yn,A=kn,p=257):(R=En,A=bn,p=0),x=0,m=0,v=_,f=i,k=y,E=0,h=-1,w=1<<y,d=w-1,1===e&&w>852||2===e&&w>592)return 1;for(;;){S=v-E,s[m]+1<p?(I=0,N=s[m]):s[m]>=p?(I=A[s[m]-p],N=R[s[m]-p]):(I=96,N=0),c=1<<v-E,l=1<<k,_=l;do{l-=c,a[f+(x>>E)+l]=S<<24|I<<16|N|0}while(0!==l);for(c=1<<v-1;x&c;)c>>=1;if(0!==c?(x&=c-1,x+=c):x=0,m++,0==--C[v]){if(v===g)break;v=t[n+s[m]]}if(v>y&&(x&d)!==h){for(0===E&&(E=y),f+=_,k=v-E,b=1<<k;k+E<g&&(b-=C[k+E],!(b<=0));)k++,b<<=1;if(w+=1<<k,1===e&&w>852||2===e&&w>592)return 1;h=x&d,a[h]=y<<24|k<<16|f-i|0}}return 0!==x&&(a[f+x]=v-E<<24|64<<16|0),o.bits=y,0};const{Z_FINISH:xn,Z_BLOCK:Rn,Z_TREES:Cn,Z_OK:Tn,Z_STREAM_END:Sn,Z_NEED_DICT:In,Z_STREAM_ERROR:Nn,Z_DATA_ERROR:An,Z_MEM_ERROR:Mn,Z_BUF_ERROR:Un,Z_DEFLATED:On}=Ye,Dn=16180,Ln=16190,Pn=16191,Fn=16192,Hn=16194,Gn=16199,qn=16200,jn=16206,zn=16209,Vn=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Bn(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Qn=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Dn||t.mode>16211?1:0},Kn=e=>{if(Qn(e))return Nn;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Dn,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Tn},Wn=e=>{if(Qn(e))return Nn;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Kn(e)},Yn=(e,t)=>{let n;if(Qn(e))return Nn;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Nn:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,Wn(e))},Zn=(e,t)=>{if(!e)return Nn;const n=new Bn;e.state=n,n.strm=e,n.window=null,n.mode=Dn;const r=Yn(e,t);return r!==Tn&&(e.state=null),r};let Xn,Jn,$n=!0;const er=e=>{if($n){Xn=new Int32Array(512),Jn=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(wn(1,e.lens,0,288,Xn,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;wn(2,e.lens,0,32,Jn,0,e.work,{bits:5}),$n=!1}e.lencode=Xn,e.lenbits=9,e.distcode=Jn,e.distbits=5},tr=(e,t,n,r)=>{let a;const i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),r>=i.wsize?(i.window.set(t.subarray(n-i.wsize,n),0),i.wnext=0,i.whave=i.wsize):(a=i.wsize-i.wnext,a>r&&(a=r),i.window.set(t.subarray(n-r,n-r+a),i.wnext),(r-=a)?(i.window.set(t.subarray(n-r,n),0),i.wnext=r,i.whave=i.wsize):(i.wnext+=a,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=a))),0};var nr={inflateReset:Wn,inflateReset2:Yn,inflateResetKeep:Kn,inflateInit:e=>Zn(e,15),inflateInit2:Zn,inflate:(e,t)=>{let n,r,a,i,s,o,u,c,l,h,d,f,p,v,m,_,g,y,k,E,b,w,x=0;const R=new Uint8Array(4);let C,T;const S=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Qn(e)||!e.output||!e.input&&0!==e.avail_in)return Nn;n=e.state,n.mode===Pn&&(n.mode=Fn),s=e.next_out,a=e.output,u=e.avail_out,i=e.next_in,r=e.input,o=e.avail_in,c=n.hold,l=n.bits,h=o,d=u,w=Tn;e:for(;;)switch(n.mode){case Dn:if(0===n.wrap){n.mode=Fn;break}for(;l<16;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(2&n.wrap&&35615===c){0===n.wbits&&(n.wbits=15),n.check=0,R[0]=255&c,R[1]=c>>>8&255,n.check=Ke(n.check,R,2,0),c=0,l=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=zn;break}if((15&c)!==On){e.msg="unknown compression method",n.mode=zn;break}if(c>>>=4,l-=4,b=8+(15&c),0===n.wbits&&(n.wbits=b),b>15||b>n.wbits){e.msg="invalid window size",n.mode=zn;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&c?16189:Pn,c=0,l=0;break;case 16181:for(;l<16;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(n.flags=c,(255&n.flags)!==On){e.msg="unknown compression method",n.mode=zn;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=zn;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&4&n.wrap&&(R[0]=255&c,R[1]=c>>>8&255,n.check=Ke(n.check,R,2,0)),c=0,l=0,n.mode=16182;case 16182:for(;l<32;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}n.head&&(n.head.time=c),512&n.flags&&4&n.wrap&&(R[0]=255&c,R[1]=c>>>8&255,R[2]=c>>>16&255,R[3]=c>>>24&255,n.check=Ke(n.check,R,4,0)),c=0,l=0,n.mode=16183;case 16183:for(;l<16;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&4&n.wrap&&(R[0]=255&c,R[1]=c>>>8&255,n.check=Ke(n.check,R,2,0)),c=0,l=0,n.mode=16184;case 16184:if(1024&n.flags){for(;l<16;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&4&n.wrap&&(R[0]=255&c,R[1]=c>>>8&255,n.check=Ke(n.check,R,2,0)),c=0,l=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(f=n.length,f>o&&(f=o),f&&(n.head&&(b=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(i,i+f),b)),512&n.flags&&4&n.wrap&&(n.check=Ke(n.check,r,f,i)),o-=f,i+=f,n.length-=f),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===o)break e;f=0;do{b=r[i+f++],n.head&&b&&n.length<65536&&(n.head.name+=String.fromCharCode(b))}while(b&&f<o);if(512&n.flags&&4&n.wrap&&(n.check=Ke(n.check,r,f,i)),o-=f,i+=f,b)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===o)break e;f=0;do{b=r[i+f++],n.head&&b&&n.length<65536&&(n.head.comment+=String.fromCharCode(b))}while(b&&f<o);if(512&n.flags&&4&n.wrap&&(n.check=Ke(n.check,r,f,i)),o-=f,i+=f,b)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;l<16;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(4&n.wrap&&c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=zn;break}c=0,l=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Pn;break;case 16189:for(;l<32;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}e.adler=n.check=Vn(c),c=0,l=0,n.mode=Ln;case Ln:if(0===n.havedict)return e.next_out=s,e.avail_out=u,e.next_in=i,e.avail_in=o,n.hold=c,n.bits=l,In;e.adler=n.check=1,n.mode=Pn;case Pn:if(t===Rn||t===Cn)break e;case Fn:if(n.last){c>>>=7&l,l-=7&l,n.mode=jn;break}for(;l<3;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}switch(n.last=1&c,c>>>=1,l-=1,3&c){case 0:n.mode=16193;break;case 1:if(er(n),n.mode=Gn,t===Cn){c>>>=2,l-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=zn}c>>>=2,l-=2;break;case 16193:for(c>>>=7&l,l-=7&l;l<32;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=zn;break}if(n.length=65535&c,c=0,l=0,n.mode=Hn,t===Cn)break e;case Hn:n.mode=16195;case 16195:if(f=n.length,f){if(f>o&&(f=o),f>u&&(f=u),0===f)break e;a.set(r.subarray(i,i+f),s),o-=f,i+=f,u-=f,s+=f,n.length-=f;break}n.mode=Pn;break;case 16196:for(;l<14;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(n.nlen=257+(31&c),c>>>=5,l-=5,n.ndist=1+(31&c),c>>>=5,l-=5,n.ncode=4+(15&c),c>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=zn;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;l<3;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}n.lens[S[n.have++]]=7&c,c>>>=3,l-=3}for(;n.have<19;)n.lens[S[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,C={bits:n.lenbits},w=wn(0,n.lens,0,19,n.lencode,0,n.work,C),n.lenbits=C.bits,w){e.msg="invalid code lengths set",n.mode=zn;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;x=n.lencode[c&(1<<n.lenbits)-1],m=x>>>24,_=x>>>16&255,g=65535&x,!(m<=l);){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(g<16)c>>>=m,l-=m,n.lens[n.have++]=g;else{if(16===g){for(T=m+2;l<T;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(c>>>=m,l-=m,0===n.have){e.msg="invalid bit length repeat",n.mode=zn;break}b=n.lens[n.have-1],f=3+(3&c),c>>>=2,l-=2}else if(17===g){for(T=m+3;l<T;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}c>>>=m,l-=m,b=0,f=3+(7&c),c>>>=3,l-=3}else{for(T=m+7;l<T;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}c>>>=m,l-=m,b=0,f=11+(127&c),c>>>=7,l-=7}if(n.have+f>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=zn;break}for(;f--;)n.lens[n.have++]=b}}if(n.mode===zn)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=zn;break}if(n.lenbits=9,C={bits:n.lenbits},w=wn(1,n.lens,0,n.nlen,n.lencode,0,n.work,C),n.lenbits=C.bits,w){e.msg="invalid literal/lengths set",n.mode=zn;break}if(n.distbits=6,n.distcode=n.distdyn,C={bits:n.distbits},w=wn(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,C),n.distbits=C.bits,w){e.msg="invalid distances set",n.mode=zn;break}if(n.mode=Gn,t===Cn)break e;case Gn:n.mode=qn;case qn:if(o>=6&&u>=258){e.next_out=s,e.avail_out=u,e.next_in=i,e.avail_in=o,n.hold=c,n.bits=l,_n(e,d),s=e.next_out,a=e.output,u=e.avail_out,i=e.next_in,r=e.input,o=e.avail_in,c=n.hold,l=n.bits,n.mode===Pn&&(n.back=-1);break}for(n.back=0;x=n.lencode[c&(1<<n.lenbits)-1],m=x>>>24,_=x>>>16&255,g=65535&x,!(m<=l);){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(_&&0==(240&_)){for(y=m,k=_,E=g;x=n.lencode[E+((c&(1<<y+k)-1)>>y)],m=x>>>24,_=x>>>16&255,g=65535&x,!(y+m<=l);){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}c>>>=y,l-=y,n.back+=y}if(c>>>=m,l-=m,n.back+=m,n.length=g,0===_){n.mode=16205;break}if(32&_){n.back=-1,n.mode=Pn;break}if(64&_){e.msg="invalid literal/length code",n.mode=zn;break}n.extra=15&_,n.mode=16201;case 16201:if(n.extra){for(T=n.extra;l<T;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;x=n.distcode[c&(1<<n.distbits)-1],m=x>>>24,_=x>>>16&255,g=65535&x,!(m<=l);){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(0==(240&_)){for(y=m,k=_,E=g;x=n.distcode[E+((c&(1<<y+k)-1)>>y)],m=x>>>24,_=x>>>16&255,g=65535&x,!(y+m<=l);){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}c>>>=y,l-=y,n.back+=y}if(c>>>=m,l-=m,n.back+=m,64&_){e.msg="invalid distance code",n.mode=zn;break}n.offset=g,n.extra=15&_,n.mode=16203;case 16203:if(n.extra){for(T=n.extra;l<T;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=zn;break}n.mode=16204;case 16204:if(0===u)break e;if(f=d-u,n.offset>f){if(f=n.offset-f,f>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=zn;break}f>n.wnext?(f-=n.wnext,p=n.wsize-f):p=n.wnext-f,f>n.length&&(f=n.length),v=n.window}else v=a,p=s-n.offset,f=n.length;f>u&&(f=u),u-=f,n.length-=f;do{a[s++]=v[p++]}while(--f);0===n.length&&(n.mode=qn);break;case 16205:if(0===u)break e;a[s++]=n.length,u--,n.mode=qn;break;case jn:if(n.wrap){for(;l<32;){if(0===o)break e;o--,c|=r[i++]<<l,l+=8}if(d-=u,e.total_out+=d,n.total+=d,4&n.wrap&&d&&(e.adler=n.check=n.flags?Ke(n.check,a,d,s-d):Be(n.check,a,d,s-d)),d=u,4&n.wrap&&(n.flags?c:Vn(c))!==n.check){e.msg="incorrect data check",n.mode=zn;break}c=0,l=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;l<32;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(4&n.wrap&&c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=zn;break}c=0,l=0}n.mode=16208;case 16208:w=Sn;break e;case zn:w=An;break e;case 16210:return Mn;default:return Nn}return e.next_out=s,e.avail_out=u,e.next_in=i,e.avail_in=o,n.hold=c,n.bits=l,(n.wsize||d!==e.avail_out&&n.mode<zn&&(n.mode<jn||t!==xn))&&tr(e,e.output,e.next_out,d-e.avail_out),h-=e.avail_in,d-=e.avail_out,e.total_in+=h,e.total_out+=d,n.total+=d,4&n.wrap&&d&&(e.adler=n.check=n.flags?Ke(n.check,a,d,e.next_out-d):Be(n.check,a,d,e.next_out-d)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Pn?128:0)+(n.mode===Gn||n.mode===Hn?256:0),(0===h&&0===d||t===xn)&&w===Tn&&(w=Un),w},inflateEnd:e=>{if(Qn(e))return Nn;let t=e.state;return t.window&&(t.window=null),e.state=null,Tn},inflateGetHeader:(e,t)=>{if(Qn(e))return Nn;const n=e.state;return 0==(2&n.wrap)?Nn:(n.head=t,t.done=!1,Tn)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,a,i;return Qn(e)?Nn:(r=e.state,0!==r.wrap&&r.mode!==Ln?Nn:r.mode===Ln&&(a=1,a=Be(a,t,n,0),a!==r.check)?An:(i=tr(e,t,n,n),i?(r.mode=16210,Mn):(r.havedict=1,Tn)))},inflateInfo:"pako inflate (from Nodeca project)"};var rr=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const ar=Object.prototype.toString,{Z_NO_FLUSH:ir,Z_FINISH:sr,Z_OK:or,Z_STREAM_END:ur,Z_NEED_DICT:cr,Z_STREAM_ERROR:lr,Z_DATA_ERROR:hr,Z_MEM_ERROR:dr}=Ye;function fr(e){this.options=Wt({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new tn,this.strm.avail_out=0;let n=nr.inflateInit2(this.strm,t.windowBits);if(n!==or)throw new Error(We[n]);if(this.header=new rr,nr.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Jt(t.dictionary):"[object ArrayBuffer]"===ar.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=nr.inflateSetDictionary(this.strm,t.dictionary),n!==or)))throw new Error(We[n])}function pr(e,t){const n=new fr(t);if(n.push(e),n.err)throw n.msg||We[n.err];return n.result}fr.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,a=this.options.dictionary;let i,s,o;if(this.ended)return!1;for(s=t===~~t?t:!0===t?sr:ir,"[object ArrayBuffer]"===ar.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),i=nr.inflate(n,s),i===cr&&a&&(i=nr.inflateSetDictionary(n,a),i===or?i=nr.inflate(n,s):i===hr&&(i=cr));n.avail_in>0&&i===ur&&n.state.wrap>0&&0!==e[n.next_in];)nr.inflateReset(n),i=nr.inflate(n,s);switch(i){case lr:case hr:case cr:case dr:return this.onEnd(i),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(0===n.avail_out||i===ur))if("string"===this.options.to){let e=en(n.output,n.next_out),t=n.next_out-e,a=$t(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(a)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(i!==or||0!==o){if(i===ur)return i=nr.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},fr.prototype.onData=function(e){this.chunks.push(e)},fr.prototype.onEnd=function(e){e===or&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Yt(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var vr={Inflate:fr,inflate:pr,inflateRaw:function(e,t){return(t=t||{}).raw=!0,pr(e,t)},ungzip:pr,constants:Ye};const{Deflate:mr,deflate:_r,deflateRaw:gr,gzip:yr}=vn,{Inflate:kr,inflate:Er,inflateRaw:br,ungzip:wr}=vr;var xr,Rr={Deflate:mr,deflate:_r,deflateRaw:gr,gzip:yr,Inflate:kr,inflate:Er,inflateRaw:br,ungzip:wr,constants:Ye},Cr=function(e){return E(void 0,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Rr.ungzip(e),t.abrupt("return",String.fromCharCode.apply(null,n));case 2:case"end":return t.stop()}}),t)})))};e.ConnectionState=void 0,(xr=e.ConnectionState||(e.ConnectionState={})).CONNECTING="CONNECTING",xr.OPEN="OPEN",xr.CLOSED="CLOSED";var Tr,Sr=function(t){i(s,t);var r=f(s);function s(e,t){var a,i=t.sdkState,o=t.dispatcher,u=t.logger;return n(this,s),(a=r.call(this)).lastActive=0,a._iid=e,a._sdkState=i,a._dispatcher=o,a._logger=u,a}return a(s,[{key:"isOpen",get:function(){return this.connectionState===e.ConnectionState.OPEN}},{key:"connectionState",get:function(){if(this._ws)switch(this._ws.readyState){case 0:return e.ConnectionState.CONNECTING;case 1:return e.ConnectionState.OPEN}return e.ConnectionState.CLOSED}},{key:"_handleMessage",value:function(e){var t=this;e.split("\n").forEach((function(e){if(e){var n=ie.createFromRawMessage(t._iid,e);t._logger.debug("receive websocket event",n),"LOGI"===n.code?t.dispatch("message",n):"PONG"===n.code?t.dispatch("pong"):"EXPR"===n.code?n.payload&&n.payload.expires_in>=0&&t._dispatcher.dispatch(new te):"NOOP"===n.code||t.dispatch("message",n)}}))}},{key:"connect",value:function(e){var t=this;this._ws=new WebSocket(e),this._ws.onopen=function(){t._logger.debug("websocket open"),t.dispatch("open")},this._ws.onmessage=function(e){return E(t,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(null===(n=this._sdkState.websocket)||void 0===n?void 0:n.compression)?e.data instanceof Blob?((r=new FileReader).readAsArrayBuffer(e.data),r.onloadend=function(){return E(a,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Cr(r.result);case 2:t=e.sent,this._handleMessage(t);case 4:case"end":return e.stop()}}),e,this)})))}):"string"==typeof e.data&&this._handleMessage(e.data):this._handleMessage(e.data);case 1:case"end":return t.stop()}}),t,this)})))},this._ws.onerror=function(){t._logger.debug("websocket error"),t.dispatch("error",T.networkError)},this._ws.onclose=function(){t._logger.debug("websocket close"),t.dispatch("close")},this.lastActive=Date.now()}},{key:"disconnect",value:function(){var t=this;return new Promise((function(n){t._logger.debug("websocket disconnect"),t._ws&&t.connectionState!==e.ConnectionState.CLOSED?(t._ws.onopen=se,t._ws.onmessage=se,t._ws.onerror=se,t._ws.onclose=function(){t.dispatch("close"),n()},t._ws.close(),t._ws=null):n()}))}},{key:"send",value:function(e){if(!this._ws)throw T.connectionClosed;"PING"!==e.code?this.dispatch("ping-refresh"):this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())}},{key:"error",value:function(e){this._logger.debug("websocket error",e),this.dispatch("error",e)}}]),s}(K),Ir=function(e){i(r,e);var t=f(r);function r(e){var a,i,s=e.code,o=e.ackRequired,u=e.payload,c=void 0===u?null:u;return n(this,r),(a=t.call(this)).code=s,a.payload=c,a.requestId=null!==(i=a.payload.req_id)&&void 0!==i?i:B(),a.ackRequired=o,a.payload.req_id=a.requestId,a}return a(r,[{key:"convertToMessage",value:function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")}}]),r}(Y),Nr=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.all,s=e.custom_types,o=e.ts;return n(this,r),(a=t.call(this)).all=i,a.customTypes=s,a.ts=o,a}return a(r)}(Y),Ar=a((function e(){var t=this;n(this,e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))})),Mr=function(){function e(t,r){var a=this,i=r.auth,s=r.sdkState,o=r.dispatcher,u=r.logger;n(this,e),this._ackStateMap=new Map,this._sdkState=s,this._dispatcher=o,this._logger=u,this.apiClient=new ae(t,{auth:i,sdkState:s,dispatcher:o,logger:u}),this.websocketClient=new Sr(t,{sdkState:s,dispatcher:o,logger:u}),this.websocketClient.on("message",(function(e){if(e.payload.unread_cnt&&a._dispatcher.dispatch(new Nr(e.payload.unread_cnt)),e.requestId){if(a._ackStateMap.has(e.requestId)){var t=a._ackStateMap.get(e.requestId);"EROR"!==e.code?t.resolve(e):t.reject(new T({code:e.payload.code,message:e.payload.message}))}}else a._dispatcher.dispatch(e)})).on("close",(function(){a._ackStateMap.forEach((function(e){e.reject(T.connectionClosed)})),a._ackStateMap.clear()}))}return a(e,[{key:"_sendApiRequest",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.apiClient.send(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"_sendWebsocketRequest",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=new Ar,e.ackRequired){r=null,a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i._ackStateMap.has(e.requestId)&&(i._ackStateMap.delete(e.requestId),r&&(clearTimeout(r),r=null),t?(i._logger.debug("fail websocket request",t),n.reject(t)):(i._logger.debug("receive websocket ack",e.requestId),n.resolve(a)))};try{r=setTimeout((function(){return a(T.noAckTimeout)}),this._sdkState.websocket.responseTimeout),this._ackStateMap.set(e.requestId,{resolve:function(e){return a(null,e)},reject:function(e){return a(e)}}),this.websocketClient.send(e)}catch(e){a(e)}}else try{this.websocketClient.send(e),n.resolve(null)}catch(e){n.reject(e)}return t.abrupt("return",n.promise);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"send",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof J)){t.next=6;break}return t.next=3,this._sendApiRequest(e);case 3:case 9:return t.abrupt("return",t.sent);case 6:if(!(e instanceof Ir)){t.next=10;break}return t.next=9,this._sendWebsocketRequest(e);case 10:throw T.invalidParameters;case 11:case"end":return t.stop()}}),t,this)})))}},{key:"cancel",value:function(e){this.apiClient.cancel(e)}},{key:"cancelAll",value:function(){this.apiClient.cancelAll()}}]),e}();!function(e){e[e.NONE=0]="NONE",e[e.INITIALIZED=1]="INITIALIZED",e[e.CONNECTING=2]="CONNECTING",e[e.CONNECTED=3]="CONNECTED",e[e.RECONNECTING=4]="RECONNECTING",e[e.INTERNAL_DISCONNECTED=5]="INTERNAL_DISCONNECTED",e[e.EXTERNAL_DISCONNECTED=6]="EXTERNAL_DISCONNECTED",e[e.LOGOUT=7]="LOGOUT"}(Tr||(Tr={}));var Ur,Or=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.stateType;return n(this,r),(a=t.call(this)).stateType=i,a}return a(r)}(Y),Dr=function(){function e(t,r){var a=this,i=r.auth,s=r.sdkState,o=r.dispatcher,u=r.logger;n(this,e),this._currentConnectionStateType=Tr.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new Mr(t,{auth:i,sdkState:s,dispatcher:o,logger:u}),this._auth=i,this._logger=u,this._dispatcher=o,this._dispatcher.on((function(e){if(e instanceof Or){var t=e.stateType;switch(a._currentConnectionStateType=t,t){case Tr.CONNECTED:var n=a._lazyCallQueue;a._lazyCallQueue=[],n.forEach((function(e){return E(a,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.command,r=e.deferred,a=e.timeout,clearTimeout(a),t.prev=2,t.next=5,this.send(n);case 5:i=t.sent,r.resolve(i),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),r.reject(t.t0);case 12:case"end":return t.stop()}}),t,this,[[2,9]])})))}));break;case Tr.INITIALIZED:case Tr.INTERNAL_DISCONNECTED:case Tr.EXTERNAL_DISCONNECTED:case Tr.LOGOUT:var r=a._lazyCallQueue;a._lazyCallQueue=[],r.forEach((function(e){return E(a,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.deferred,r=e.timeout,clearTimeout(r),this._auth&&this._auth.hasSession?n.reject(T.connectionClosed):n.reject(T.connectionRequired);case 3:case"end":return t.stop()}}),t,this)})))}))}}}))}return a(e,[{key:"isReady",get:function(){return this._currentConnectionStateType===Tr.CONNECTED}},{key:"isLazyCallActivated",get:function(){return this._currentConnectionStateType===Tr.CONNECTING||this._currentConnectionStateType===Tr.RECONNECTING}},{key:"send",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof Ir)){t.next=19;break}if(!this.isReady){t.next=8;break}return this._logger.debug("send websocket request",e),t.next=5,this.commandRouter.send(e);case 5:case 24:return t.abrupt("return",t.sent);case 8:if(!this.isLazyCallActivated){t.next=15;break}return this._logger.debug("wait websocket request",e),n=new Ar,this._lazyCallQueue.push({command:e,deferred:n,timeout:setTimeout((function(){return i.timeout(e.requestId)}),1e4)}),t.abrupt("return",n.promise);case 15:throw this._logger.debug("fail websocket request"),T.connectionRequired;case 17:t.next=37;break;case 19:if(!(e instanceof J)){t.next=37;break}if(!this._auth.hasSession){t.next=27;break}return this._logger.debug("send api request",e),t.next=24,this.commandRouter.send(e);case 27:if(!this.isLazyCallActivated){t.next=34;break}return this._logger.debug("wait api request",e),r=new Ar,this._lazyCallQueue.push({command:e,deferred:r,timeout:setTimeout((function(){return i.timeout(e.requestId)}),1e4)}),t.abrupt("return",r.promise);case 34:throw a=T.connectionRequired,this._logger.debug("fail api request",a),a;case 37:case"end":return t.stop()}}),t,this)})))}},{key:"forceSend",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.debug("send forced request",e),t.next=3,this.commandRouter.send(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"timeout",value:function(e){this._logger.debug("timeout request",e);var t=this._lazyCallQueue.findIndex((function(t){return t.command.requestId===e}));t>-1&&(this._lazyCallQueue[t].deferred.reject(T.connectionRequired),this._lazyCallQueue.splice(t,1))}},{key:"cancel",value:function(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e)}},{key:"cancelAll",value:function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()}}]),e}(),Lr="sendbird@devicetokens",Pr=function(){function e(t){var r=t.type,a=t.token;n(this,e),this.type=r,this.token=a}return a(e,null,[{key:"payloadify",value:function(e){return{type:e.type,token:e.token}}}]),e}(),Fr="v3",Hr="/".concat(Fr,"/users"),Gr="/".concat(Fr,"/storage/file"),qr="/".concat(Fr,"/group_channels"),jr="/".concat(Fr,"/sdk/group_channels"),zr="/".concat(Fr,"/open_channels"),Vr="/".concat(Fr,"/sdk/open_channels"),Br="/".concat(Fr,"/search"),Qr="/".concat(Fr,"/report"),Kr="/".concat(Fr,"/emojis"),Wr="/".concat(Fr,"/emoji_categories"),Yr="/".concat(Fr,"/polls"),Zr="/".concat(Fr,"/scheduled_messages"),Xr="/".concat(Fr,"/sdk/statistics"),Jr=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.authToken,o=e.expiringSession,u=void 0===o||o;return n(this,r),(a=t.call(this)).path="".concat(Hr,"/").concat(i,"/session_key"),a.method=R.POST,a.params={token:s,expiring_session:!!u},a.requireAuth=!1,a}return a(r)}(J),$r=function(e){i(r,e);var t=f(r);function r(e){var a=e.authToken,i=e.expiringSession,s=void 0===i||i,o=e.requestId,u=void 0===o?null:o;return n(this,r),t.call(this,{code:"LOGI",payload:{token:a,expiring_session:s?1:0,req_id:u},ackRequired:!0})}return a(r)}(Ir),ea=function(e){i(r,e);var t=f(r);function r(e,a){var i;n(this,r),i=t.call(this,e,a);var s=a.key;return i.key=s,i}return a(r)}($),ta=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"LOGI",i)).error=null,s.newKey=i.new_key,s.error=i.error?new T(i.error):null,s}return a(r)}(ie),na=function(e){i(r,e);var t=f(r);function r(){return n(this,r),t.apply(this,arguments)}return a(r)}(Y),ra=function(e){return E(void 0,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){return setTimeout(t,e)})));case 1:case"end":return t.stop()}}),t)})))},aa=function(){function e(){n(this,e)}return a(e,[{key:"calcTimeout",value:function(){return 0}}]),e}(),ia=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new aa;return E(void 0,void 0,void 0,regeneratorRuntime.mark((function r(){var a,i,s,o,u;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=0,i=null,s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return i=null!=e?e:new Error("Halted")},o=function(){a=0};case 4:if(!(-1===t||a<t)){r.next=29;break}return r.prev=5,r.next=8,e(s,o);case 8:if(u=r.sent,i){r.next=13;break}return r.abrupt("return",u);case 13:throw i;case 14:r.next=27;break;case 16:if(r.prev=16,r.t0=r.catch(5),i){r.next=26;break}if(++a!==t){r.next=22;break}throw r.t0;case 22:return r.next=24,ra(n.calcTimeout(a));case 24:r.next=27;break;case 26:throw i;case 27:r.next=4;break;case 29:case"end":return r.stop()}}),r,null,[[5,16]])})))},sa=function(e){return E(void 0,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:t.next=12;break;case 5:if(t.prev=5,t.t0=t.catch(0),!(t.t0 instanceof T)){t.next=11;break}t.t0.throwOutside(),t.next=12;break;case 11:throw t.t0;case 12:case"end":return t.stop()}}),t,null,[[0,5]])})))},oa=function(e){return E(void 0,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:t.next=7;break;case 5:t.prev=5,t.t0=t.catch(0);case 7:case"end":return t.stop()}}),t,null,[[0,5]])})))},ua=new WeakMap,ca=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.auth,s=e.cacheContext,o=e.sdkState,u=e.dispatcher,c=e.requestQueue,l=e.logger;return n(this,r),(a=t.call(this))._currentConnectionStateType=Tr.INITIALIZED,a._deviceTokenCacheEnabled=!1,a._isRefreshingAuthToken=!1,a._isRefreshingSessionKey=!1,a.auth=i,a._cacheContext=s,a._sdkState=o,a._dispatcher=u,a._requestQueue=c,a._logger=l,a._deviceTokens=[],a._dispatcher.on((function(e){if(e instanceof Or){var t=e.stateType;a._currentConnectionStateType=t}else e instanceof te&&a.handler&&(a._logger.debug("session expired"),a.handler.onSessionExpired(),a.refresh())})),a}return a(r,[{key:"ekey",get:function(){return ua.get(this)}},{key:"deviceTokens",get:function(){return this._deviceTokens}},{key:"deviceTokenLastDeletedAt",get:function(){return this._deviceTokenLastDeletedAt}},{key:"indexOfDeviceToken",value:function(e,t){return this._deviceTokens.findIndex((function(n){return n.type===e&&n.token===t}))}},{key:"hasDeviceToken",value:function(e,t){return!1}},{key:"createRefreshWebsocketCommand",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new $r({authToken:e,expiringSession:!0,requestId:t})}},{key:"_refreshSessionKeyByWebSocket",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.createRefreshWebsocketCommand(e),t.next=3,this._requestQueue.forceSend(n);case 3:if(r=t.sent,a=r.as(ta),i=a.newKey,!(s=a.error)){t.next=7;break}throw s;case 7:this.auth.sessionKey=null!=i?i:this.auth.sessionKey;case 8:case"end":return t.stop()}}),t,this)})))}},{key:"_refreshSessionKeyByApi",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Jr({userId:this._sdkState.userId,authToken:e,expiringSession:!0}),t.next=3,ia((function(e){return E(r,void 0,void 0,regeneratorRuntime.mark((function t(){var r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._requestQueue.forceSend(n);case 3:r=t.sent,a=r.as(ea),i=a.key,this.auth.sessionKey=i,t.next=15;break;case 8:if(t.prev=8,t.t0=t.catch(0),!this._isSessionRelatedError(t.t0)){t.next=14;break}e(t.t0),t.next=15;break;case 14:throw t.t0;case 15:case"end":return t.stop()}}),t,this,[[0,8]])})))}),3);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"_refreshSessionKey",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this._currentConnectionStateType!==Tr.CONNECTED){n.next=25;break}return n.prev=1,n.next=4,this._refreshSessionKeyByWebSocket(e);case 4:return this.complete(),n.abrupt("return");case 8:if(n.prev=8,n.t0=n.catch(1),!this._isSessionRelatedError(n.t0)){n.next=25;break}if(!t){n.next=25;break}return n.next=14,this._receiveNewAuthToken();case 14:if(this.auth.authToken=n.sent,!this.auth.authToken){n.next=21;break}return n.next=18,this._refreshSessionKey(this.auth.authToken,!1);case 18:this.complete(),n.next=24;break;case 21:return n.next=23,this.clear();case 23:this.close();case 24:return n.abrupt("return");case 25:return n.prev=25,n.next=28,this._refreshSessionKeyByApi(e);case 28:this.complete(),n.next=53;break;case 31:if(n.prev=31,n.t1=n.catch(25),!this._isSessionRelatedError(n.t1)){n.next=52;break}if(!t){n.next=49;break}return n.next=37,this._receiveNewAuthToken();case 37:if(this.auth.authToken=n.sent,!this.auth.authToken){n.next=44;break}return n.next=41,this._refreshSessionKeyByApi(this.auth.authToken);case 41:this.complete(),n.next=47;break;case 44:return n.next=46,this.clear();case 46:this.close();case 47:n.next=50;break;case 49:throw n.t1;case 50:n.next=53;break;case 52:throw n.t1;case 53:case"end":return n.stop()}}),n,this,[[1,8],[25,31]])})))}},{key:"_receiveNewAuthToken",value:function(){var e=this,t=new Ar;return sa((function(){return E(e,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._isRefreshingAuthToken=!0,this.auth.clear(),n=null,r=function(){n&&(clearTimeout(n),n=null)},n=setTimeout((function(){a._isRefreshingAuthToken=!1,t.reject()}),1e3*this._sdkState.sessionTokenRefreshTimeout),this.handler.onSessionTokenRequired((function(e){r(),a._isRefreshingAuthToken&&(a._isRefreshingAuthToken=!1,a.dispatch("refresh-authtoken"),t.resolve(e))}),(function(e){r(),a._isRefreshingAuthToken=!1,t.reject(e)}));case 6:case"end":return e.stop()}}),e,this)})))})),t.promise}},{key:"_isSessionRelatedError",value:function(e){return e instanceof T&&(e.isSessionKeyExpiredError||e.isSessionTokenExpiredError)}},{key:"isSessionKeyRefreshing",get:function(){return this._isRefreshingSessionKey}},{key:"isRefreshingAuthToken",get:function(){return this._isRefreshingAuthToken}},{key:"login",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.auth.sessionKey=e.key,ua.set(this,e.ekey),n=this._cacheContext.preference,!this._deviceTokenCacheEnabled){t.next=16;break}return t.next=6,n.get(Lr);case 6:if((r=t.sent)&&!(r.lastDeletedAt<e.deviceTokenLastDeletedAt)){t.next=14;break}return this._deviceTokens=[],this._deviceTokenLastDeletedAt=e.deviceTokenLastDeletedAt,t.next=12,this.saveDeviceToken();case 12:t.next=16;break;case 14:this._deviceTokens=r.tokens.map((function(e){return new Pr(Pr.payloadify(e))})),this._deviceTokenLastDeletedAt=r.lastDeletedAt;case 16:case"end":return t.stop()}}),t,this)})))}},{key:"complete",value:function(){var e=this;this.dispatch("refresh"),sa((function(){return E(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._logger.debug("session refreshed"),this.handler.onSessionRefreshed();case 2:case"end":return e.stop()}}),e,this)})))}))}},{key:"error",value:function(e){var t=this;sa((function(){return E(t,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.handler.onSessionError(e);case 1:case"end":return t.stop()}}),t,this)})))}))}},{key:"close",value:function(){var e=this;this.dispatch("close"),sa((function(){return E(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._logger.debug("session closed"),this.handler.onSessionClosed();case 2:case"end":return e.stop()}}),e,this)})))}))}},{key:"refresh",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.handler){e.next=40;break}if(this._isRefreshingSessionKey){e.next=40;break}if(this._isRefreshingSessionKey=!0,this.auth.authToken){e.next=27;break}return e.prev=4,e.next=7,this._receiveNewAuthToken();case 7:if(!(t=e.sent)){e.next=13;break}this._logger.debug("session refreshing.."),this.auth.authToken=t,e.next=18;break;case 13:return e.next=15,this.clear();case 15:return this.close(),this._isRefreshingSessionKey=!1,e.abrupt("return");case 18:e.next=27;break;case 20:throw e.prev=20,e.t0=e.catch(4),n=T.sessionTokenRequestFailed,this._dispatcher.dispatch(new na),this.error(n),this._isRefreshingSessionKey=!1,n;case 27:return e.prev=27,e.next=30,this._refreshSessionKey(this.auth.authToken);case 30:this._isRefreshingSessionKey=!1,e.next=40;break;case 33:throw e.prev=33,e.t1=e.catch(27),r=T.sessionTokenRefreshFailed,this._dispatcher.dispatch(new na),this.error(r),this._isRefreshingSessionKey=!1,r;case 40:case"end":return e.stop()}}),e,this,[[4,20],[27,33]])})))}},{key:"setDeviceToken",value:function(e,t){return this.indexOfDeviceToken(e,t)<0&&(this._deviceTokens.push(new Pr({type:e,token:t})),!0)}},{key:"unsetDeviceToken",value:function(e,t){var n=this.indexOfDeviceToken(e,t);n>=0&&this._deviceTokens.splice(n,1)}},{key:"unsetDeviceTokens",value:function(e){this._deviceTokens=this._deviceTokens.filter((function(t){return t.type!==e}))}},{key:"setDeviceTokenDeletedAt",value:function(e){e>0&&(this._deviceTokenLastDeletedAt=e)}},{key:"saveDeviceToken",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._deviceTokenCacheEnabled){e.next=4;break}return t=this._cacheContext.preference,e.next=4,t.set(Lr,{tokens:this._deviceTokens,lastDeletedAt:this._deviceTokenLastDeletedAt});case 4:case"end":return e.stop()}}),e,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentUser=null,this.auth.clear(),ua.delete(this),this._deviceTokens=[],this._deviceTokenLastDeletedAt=0,e.next=7,this.saveDeviceToken();case 7:case"end":return e.stop()}}),e,this)})))}}]),r}(K),la=function(){function e(){n(this,e),this.type=Tr.NONE,this.name="none"}return a(e,[{key:"run",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"onConnect",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"onReconnect",value:function(e,t){return t.resetReconnectCount,E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"onDisconnect",value:function(e,t){return t.error,t.autoReconnect,E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"onDisconnectWebSocket",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"onLogout",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}}]),e}(),ha=function(e){i(r,e);var t=f(r);function r(){var e;return n(this,r),(e=t.apply(this,arguments)).type=Tr.LOGOUT,e.name="logout",e}return a(r,[{key:"run",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),r=e.sdkState.userId,t.next=4,e.logout();case 4:return t.next=6,e.changeState(new _a,n);case 6:sa((function(){return E(a,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.connectionHandlers.forEach((function(e){e.onDisconnected(r)}));case 1:case"end":return t.stop()}}),t)})))}));case 7:case"end":return t.stop()}}),t)})))}}]),r}(la),da=function(e){i(r,e);var t=f(r);function r(){var e;return n(this,r),(e=t.call(this)).type=Tr.EXTERNAL_DISCONNECTED,e.name="externaldisconnected",e}return a(r,[{key:"run",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.disconnect();case 2:case"end":return t.stop()}}),t)})))}},{key:"onConnect",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Date.now(),n.next=3,e.disconnect();case 3:return n.next=5,e.changeState(new ma({authToken:t}),r);case 5:case"end":return n.stop()}}),n)})))}},{key:"onReconnect",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),t.next=3,e.changeState(new pa,n);case 3:case"end":return t.stop()}}),t)})))}},{key:"onLogout",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),t.next=3,e.changeState(new ha,n);case 3:case"end":return t.stop()}}),t)})))}}]),r}(la),fa=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.autoReconnect;return n(this,r),(a=t.call(this)).type=Tr.INTERNAL_DISCONNECTED,a.name="internaldisconnected",a._autoReconnect=!1,a._autoReconnect=i,a}return a(r,[{key:"run",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),t.next=3,e.disconnect();case 3:if(!this._autoReconnect){t.next=6;break}return t.next=6,e.changeState(new pa,n);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"onConnect",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Date.now(),n.next=3,e.disconnect();case 3:return n.next=5,e.changeState(new ma({authToken:t}),r);case 5:case"end":return n.stop()}}),n)})))}},{key:"onReconnect",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),t.next=3,e.changeState(new pa,n);case 3:case"end":return t.stop()}}),t)})))}},{key:"onDisconnectWebSocket",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),t.next=3,e.changeState(new da,n);case 3:case"end":return t.stop()}}),t)})))}},{key:"onLogout",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),t.next=3,e.changeState(new ha,n);case 3:case"end":return t.stop()}}),t)})))}}]),r}(la),pa=function(e){i(r,e);var t=f(r);function r(){var e;return n(this,r),(e=t.apply(this,arguments)).type=Tr.RECONNECTING,e.name="reconnecting",e._haltConnect=null,e._resetConnect=null,e._callbacks=[],e}return a(r,[{key:"_halt",value:function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=null)}},{key:"_flushCallbacks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._haltConnect=null,this._resetConnect=null,this._callbacks.forEach((function(t){return t(e)}))}},{key:"run",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),r=new Ar,this._callbacks.push((function(e){return e?r.reject(e):r.resolve()})),sa((function(){return E(o,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.connectionHandlers.forEach((function(e){e.onReconnectStarted()}));case 1:case"end":return t.stop()}}),t)})))})),t.prev=4,a=e.sdkState.websocket,i=a.reconnectMaxRetry,s=a.reconnectRetryStrategy,t.next=8,ia((function(t,n){return E(o,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this._haltConnect=t,this._resetConnect=n,r.prev=2,r.next=5,e.connect();case 5:r.next=17;break;case 7:if(r.prev=7,r.t0=r.catch(2),e.clearLoginTimer(),!(r.t0 instanceof T)){r.next=16;break}r.t1=r.t0.code,r.next=r.t1===b.CONNECTION_CANCELED?14:16;break;case 14:return t(r.t0),r.abrupt("return");case 16:throw r.t0;case 17:case"end":return r.stop()}}),r,this,[[2,7]])})))}),i,s);case 8:return t.next=10,e.changeState(new va,n);case 10:sa((function(){return E(o,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._flushCallbacks(null),e.connectionHandlers.forEach((function(e){e.onReconnectSucceeded()}));case 2:case"end":return t.stop()}}),t,this)})))})),t.next=24;break;case 13:if(t.prev=13,t.t0=t.catch(4),C(t.t0)){t.next=23;break}if(!(t.t0 instanceof T)){t.next=20;break}if(t.t0.code===b.CONNECTION_CANCELED){t.next=20;break}return t.next=20,e.changeState(new fa({autoReconnect:!1}),n);case 20:sa((function(){return E(o,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this._flushCallbacks(t.t0),e.connectionHandlers.forEach((function(e){e.onReconnectFailed()}));case 2:case"end":return n.stop()}}),n,this)})))})),t.next=24;break;case 23:throw t.t0;case 24:return t.abrupt("return",r.promise);case 25:case"end":return t.stop()}}),t,this,[[4,13]])})))}},{key:"onConnect",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=new Ar,this._halt(T.connectionCanceled),e.cancelConnectForRetry(),this._callbacks.push((function(){var n=Date.now();e.changeState(new ma({authToken:t}),n).then((function(){r.resolve()})).catch((function(e){r.reject(e)}))})),n.abrupt("return",r.promise);case 5:case"end":return n.stop()}}),n,this)})))}},{key:"onReconnect",value:function(e,t){var n=t.resetReconnectCount,r=void 0!==n&&n;return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Ar,this._resetConnect&&r&&this._resetConnect(),this._callbacks.push((function(e){return e?t.reject(e):t.resolve()})),e.abrupt("return",t.promise);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"onDisconnect",value:function(e,t){t.error;var n=t.autoReconnect,r=void 0===n||n;return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),this._halt(T.connectionCanceled),t.next=4,e.changeState(new fa({autoReconnect:r}),n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"onDisconnectWebSocket",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),this._halt(T.connectionCanceled),t.next=4,e.changeState(new da,n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"onLogout",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),this._halt(T.connectionCanceled),t.next=4,e.changeState(new ha,n);case 4:case"end":return t.stop()}}),t,this)})))}}]),r}(la),va=function(e){i(r,e);var t=f(r);function r(){var e;return n(this,r),(e=t.apply(this,arguments)).type=Tr.CONNECTED,e.name="connected",e}return a(r,[{key:"onReconnect",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),t.next=3,e.disconnect();case 3:return t.next=5,e.changeState(new pa,n);case 5:case"end":return t.stop()}}),t)})))}},{key:"onDisconnect",value:function(e,t){var n=t.autoReconnect;return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.changeState(new fa({autoReconnect:n}),r);case 3:case"end":return t.stop()}}),t)})))}},{key:"onDisconnectWebSocket",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),t.next=3,e.changeState(new da,n);case 3:case"end":return t.stop()}}),t)})))}},{key:"onLogout",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),t.next=3,e.changeState(new ha,n);case 3:case"end":return t.stop()}}),t)})))}}]),r}(la),ma=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.authToken;return n(this,r),(a=t.call(this)).type=Tr.CONNECTING,a.name="connecting",a._authToken="",a._haltConnect=null,a._callbacks=[],a._authToken=i,a}return a(r,[{key:"_halt",value:function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=null)}},{key:"_flushCallbacks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._haltConnect=null,this._callbacks.forEach((function(t){return t(e)}))}},{key:"run",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),r=new Ar,this._callbacks.push((function(e){return e?r.reject(e):r.resolve()})),t.prev=3,t.next=6,ia((function(t){return E(a,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this._haltConnect=t,n.prev=1,n.next=4,e.connect(this._authToken);case 4:n.next=16;break;case 6:if(n.prev=6,n.t0=n.catch(1),e.clearLoginTimer(),!(n.t0 instanceof T)){n.next=15;break}n.t1=n.t0.code,n.next=n.t1===b.CONNECTION_CANCELED?13:15;break;case 13:return t(n.t0),n.abrupt("return");case 15:throw n.t0;case 16:case"end":return n.stop()}}),n,this,[[1,6]])})))}),e.sdkState.websocket.connectMaxRetry);case 6:return t.next=8,e.changeState(new va,n);case 8:sa((function(){return E(a,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._flushCallbacks(null),e.connectionHandlers.forEach((function(t){t.onConnected(e.sdkState.userId)}));case 2:case"end":return t.stop()}}),t,this)})))})),t.next=24;break;case 11:if(t.prev=11,t.t0=t.catch(3),C(t.t0)){t.next=23;break}return t.next=16,e.disconnect();case 16:if(!(t.t0 instanceof T)){t.next=20;break}if(t.t0.code===b.CONNECTION_CANCELED){t.next=20;break}return t.next=20,e.changeState(new _a,n);case 20:sa((function(){return E(a,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._flushCallbacks(t.t0);case 1:case"end":return e.stop()}}),e,this)})))})),t.next=24;break;case 23:throw t.t0;case 24:return t.abrupt("return",r.promise);case 25:case"end":return t.stop()}}),t,this,[[3,11]])})))}},{key:"onConnect",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Ar,this._callbacks.push((function(e){return e?t.reject(e):t.resolve()})),e.abrupt("return",t.promise);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"onDisconnect",value:function(e,t){var n=t.error,r=void 0===n?null:n,a=t.autoReconnect;return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Date.now(),this._halt(null!=r?r:T.connectionCanceled),!e.hasSession){t.next=7;break}return t.next=5,e.changeState(new fa({autoReconnect:a}),n);case 5:t.next=9;break;case 7:return t.next=9,e.changeState(new ha,n);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"onDisconnectWebSocket",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Date.now(),this._halt(T.connectionCanceled),!e.hasSession){t.next=7;break}return t.next=5,e.changeState(new da,n);case 5:t.next=9;break;case 7:return t.next=9,e.changeState(new ha,n);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"onLogout",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),this._halt(T.connectionCanceled),t.next=4,e.changeState(new ha,n);case 4:case"end":return t.stop()}}),t,this)})))}}]),r}(la),_a=function(e){i(r,e);var t=f(r);function r(){var e;return n(this,r),(e=t.apply(this,arguments)).type=Tr.INITIALIZED,e.name="initialized",e}return a(r,[{key:"onConnect",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Date.now(),n.next=3,e.changeState(new ma({authToken:t}),r);case 3:case"end":return n.stop()}}),n)})))}}]),r}(la),ga=function(e){i(r,e);var t=f(r);function r(){return n(this,r),t.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})}return a(r)}(Ir),ya=function(){function e(t){var r=t.pingDelegate,a=t.sdkState,i=t.logger;n(this,e),this._pingTimer=null,this._pingTimeoutTimer=null,this.pingDelegate=r,this.sdkState=a,this._logger=i}return a(e,[{key:"isWaiting",get:function(){return!!this._pingTimeoutTimer}},{key:"ping",value:function(){var e,t=this,n=new ga;try{var r=null!==(e=this.sdkState.websocket.pongTimeout)&&void 0!==e?e:5e3;this._pingTimeoutTimer=setTimeout((function(){t._logger.debug("pinger.ping() timeout"),t.pingDelegate.error(null)}),r),this.pingDelegate.send(n),this._logger.debug("pinger.ping()")}catch(e){this._logger.debug("pinger.ping() error",e),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null),this.pingDelegate.error(null)}return n}},{key:"pong",value:function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)}},{key:"refreshTimer",value:function(){var e,t=this;this._logger.debug("pinger.refreshTimer()");var n=null!==(e=this.sdkState.websocket.pingInterval)&&void 0!==e?e:15e3;this.stop(),this._pingTimer=setInterval((function(){t.ping()}),n)}},{key:"start",value:function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()}},{key:"stop",value:function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=null),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)}}]),e}(),ka=1048576,Ea=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),this.emojiHash=t.emoji_hash||"",this.uploadSizeLimit=t.file_upload_size_limit?t.file_upload_size_limit*ka:Number.MAX_SAFE_INTEGER,this.useReaction=!!t.use_reaction,this.applicationAttributes=t.application_attributes||[],this.premiumFeatureList=t.premium_feature_list||[],this.enabledChannelMemberShipHistory=this.applicationAttributes.includes("channel_membership_history")}return a(e,null,[{key:"payloadify",value:function(e){return{emoji_hash:e.emojiHash,file_upload_size_limit:e.uploadSizeLimit/ka,application_attributes:e.applicationAttributes,premium_feature_list:e.premiumFeatureList,use_reaction:e.useReaction}}}]),e}(),ba=function(){function e(t){n(this,e),this._iid="",this._iid=t}return a(e,null,[{key:"payloadify",value:function(e){return e?{}:null}}]),e}(),wa=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.metadata;return n(this,r),(a=t.call(this)).method=R.POST,a.path="".concat(Hr,"/").concat(i,"/metadata"),a.params={metadata:s},a}return a(r)}(J),xa=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).metaData=a,i}return a(r)}($),Ra=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.metadata,o=e.upsert;return n(this,r),(a=t.call(this)).method=R.PUT,a.path="".concat(Hr,"/").concat(i,"/metadata"),a.params={metadata:s,upsert:o},a}return a(r)}(J),Ca=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).metadata=a,i}return a(r)}($),Ta=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.metadataKey;return n(this,r),(a=t.call(this)).method=R.DELETE,a.path="".concat(Hr,"/").concat(i,"/metadata/").concat(s),a}return a(r)}(J),Sa=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId;return n(this,r),(a=t.call(this)).method=R.DELETE,a.path="".concat(Hr,"/").concat(i,"/metadata"),a}return a(r)}(J),Ia=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=JSON.parse(JSON.stringify(e));return n._iid&&delete n._iid,t&&t(n),n},Na=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=JSON.parse(JSON.stringify(e));return t&&t(n),n},Aa=function(e){return{do:function(t){e||t()},throw:function(t){if(!e)throw t}}};e.UserOnlineState=void 0,(Ur=e.UserOnlineState||(e.UserOnlineState={})).ONLINE="online",Ur.OFFLINE="offline",Ur.NON_AVAILABLE="nonavailable";var Ma,Ua=function(t){i(o,t);var r=f(o);function o(t,a){var i,s,u,c,l,h,d,f,p,v,m,g,y;return n(this,o),(i=r.call(this,t)).userId=null!==(u=null!==(s=a.guest_id)&&void 0!==s?s:a.user_id)&&void 0!==u?u:"",i.nickname=null!==(l=null!==(c=a.nickname)&&void 0!==c?c:a.name)&&void 0!==l?l:"",i.plainProfileUrl=null!==(d=null!==(h=a.profile_url)&&void 0!==h?h:a.image)&&void 0!==d?d:"",i.requireAuth=null!==(f=a.require_auth_for_profile_image)&&void 0!==f&&f,i.metaData=null!==(p=a.metadata)&&void 0!==p?p:{},i.connectionStatus=e.UserOnlineState.NON_AVAILABLE,M(e.UserOnlineState,a.is_online)?i.connectionStatus=a.is_online:A("boolean",a.is_online)&&(i.connectionStatus=a.is_online?e.UserOnlineState.ONLINE:e.UserOnlineState.OFFLINE),i.isActive=null===(v=a.is_active)||void 0===v||v,i.lastSeenAt=null!==(m=a.last_seen_at)&&void 0!==m?m:null,i.preferredLanguages=a.preferred_languages?_(a.preferred_languages):null,i.friendDiscoveryKey=null!==(g=a.friend_discovery_key)&&void 0!==g?g:null,i.friendName=null!==(y=a.friend_name)&&void 0!==y?y:null,i}return a(o,[{key:"profileUrl",get:function(){var e=Ya.of(this._iid).sessionManager;return this.requireAuth?"".concat(this.plainProfileUrl,"?auth=").concat(e.ekey):this.plainProfileUrl}},{key:"serialize",value:function(){return Ia(this)}},{key:"_isValidMetaData",value:function(e){return!Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return A("string",e)}))}},{key:"_applyMetaData",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object.keys(e).forEach((function(r){n?delete t.metaData[r]:t.metaData[r]=e[r]}))}},{key:"createMetaData",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(this._isValidMetaData(e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new wa({userId:r.userId,metadata:e}),t.next=5,a.send(i);case 5:return s=t.sent,o=s.as(xa),u=o.metaData,this._applyMetaData(u),t.abrupt("return",this.metaData);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"updateMetaData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Aa(this._isValidMetaData(e)).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new Ra({userId:a.userId,metadata:e,upsert:t}),n.next=5,i.send(s);case 5:return o=n.sent,u=o.as(Ca),c=u.metadata,this._applyMetaData(c),n.abrupt("return",this.metaData);case 9:case"end":return n.stop()}}),n,this)})))}},{key:"deleteMetaData",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(A("string",e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new Ta({userId:r.userId,metadataKey:e}),t.next=5,a.send(i);case 5:return this._applyMetaData((u=!0,(o=e)in(s={})?Object.defineProperty(s,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):s[o]=u,s),!0),t.abrupt("return",this.metaData);case 7:case"end":return t.stop()}var s,o,u}),t,this)})))}},{key:"deleteAllMetaData",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.sdkState,r=t.requestQueue,a=new Sa({userId:n.userId}),e.next=4,r.send(a);case 4:this.metaData={};case 5:case"end":return e.stop()}}),e,this)})))}}],[{key:"payloadify",value:function(e){return e?Z(Object.assign(Object.assign({},v(s(o),"payloadify",this).call(this,e)),{user_id:e.userId,nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth,metadata:e.metaData,is_online:e.connectionStatus,is_active:e.isActive,last_seen_at:e.lastSeenAt,preferred_languages:e.preferredLanguages,friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName})):null}}]),o}(ba),Oa=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userProfile;return n(this,r),(a=t.call(this)).userProfile=i,a}return a(r)}(Y),Da=function(){function e(t,r){var a,i,s,o,u,c,l,h,d,f,p,v,m,_;n(this,e),this._iid=t,this.appInfo=new Ea(r),this.user=new Ua(t,r),this.connectedAt=null!==(a=r.login_ts)&&void 0!==a?a:0,this.firstConnectedAt=0,this.pingInterval=null!==(i=r.ping_interval)&&void 0!==i?i:15e3,this.pongTimeout=null!==(s=r.pong_timeout)&&void 0!==s?s:5e3,this.reconnectInterval=null!==(u=null===(o=r.reconnect)||void 0===o?void 0:o.interval)&&void 0!==u?u:3e3,this.reconnectMaxInterval=null!==(l=null===(c=r.reconnect)||void 0===c?void 0:c.max_interval)&&void 0!==l?l:6e4,this.reconnectRetryCount=null!==(d=null===(h=r.reconnect)||void 0===h?void 0:h.retry_cnt)&&void 0!==d?d:5,this.reconnectIntervalMultiple=null!==(p=null===(f=r.reconnect)||void 0===f?void 0:f.mul)&&void 0!==p?p:2,this.maxUnreadCountOnSuperGroup=null!==(v=r.max_unread_cnt_on_super_group)&&void 0!==v?v:100,this.profileImageEncryption=!!r.profile_image_encryption,this.concurrentCallLimit=null!==(m=r.concurrent_call_limit)&&void 0!==m?m:5,this.backOffDelay=null!==(_=r.back_off_delay)&&void 0!==_?_:100}return a(e,[{key:"apply",value:function(){var e=this.reconnectInterval,t=this.reconnectMaxInterval,n=this.reconnectIntervalMultiple,r=Ya.of(this._iid);r.sdkState.websocket.pingInterval=1e3*this.pingInterval,r.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,r.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,r.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(r){return r>0?1e3*Math.min(e*Math.pow(n,r-1),t):10}},r.appInfo=this.appInfo,r.sessionManager.currentUser=this.user,r.connectedAt=this.connectedAt,this.firstConnectedAt||(r.firstConnectedAt=this.connectedAt),r.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,r.concurrentCallLimit=this.concurrentCallLimit,r.backOffDelay=this.backOffDelay,r.dispatcher.dispatch(new Oa({userProfile:this}))}}],[{key:"payloadify",value:function(e){return Object.assign(Object.assign(Object.assign({},Ua.payloadify(e.user)),Ea.payloadify(e.appInfo)),{login_ts:e.connectedAt,ping_interval:e.pingInterval,pong_timeout:e.pongTimeout,reconnect:{interval:e.reconnectInterval,max_interval:e.reconnectMaxInterval,retry_cnt:e.reconnectRetryCount,mul:e.reconnectIntervalMultiple},max_unread_cnt_on_super_group:e.maxUnreadCountOnSuperGroup,profile_image_encryption:e.profileImageEncryption,concurrent_call_limit:e.concurrentCallLimit,back_off_delay:e.backOffDelay})}}]),e}(),La=function(e){i(r,e);var t=f(r);function r(e,a,i){var s,o;return n(this,r),(s=t.call(this,e,a,i)).error=null,s.userProfile=new Da(e,i),s.deviceTokenLastDeletedAt=i.device_token_last_deleted_at,s.key=i.key,s.ekey=null!==(o=i.ekey)&&void 0!==o?o:"",s.error=i.error?new T(i):null,s}return a(r,[{key:"applyTo",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.error){t.next=12;break}if(!(n=Ya.of(e))){t.next=9;break}return r=n.sessionManager,t.next=6,r.login(this);case 6:this.userProfile.apply(),t.next=10;break;case 9:throw T.lostInstance;case 10:t.next=13;break;case 12:throw this.error;case 13:case"end":return t.stop()}}),t,this)})))}}],[{key:"asError",value:function(e){return new r(null,"LOGI",Object.assign({user_id:null,error:!0},e))}}]),r}(ie),Pa=function(e){i(r,e);var t=f(r);function r(e){var a;return n(this,r),(a=t.call(this)).enabled=e,a}return a(r)}(Y),Fa=function(e){i(r,e);var t=f(r);function r(e,a){var i,s=a.sdkState,o=a.cacheContext,u=a.connectionHandlers,c=a.sessionManager,l=a.websocketClient,h=a.dispatcher,d=a.logger,f=a.entryState,p=void 0===f?new _a:f;return n(this,r),(i=t.call(this))._currentState=null,i._loginTimer=null,i._unresolvedLogi=null,i._stateUpdatedAt=0,i._connectingAt=0,i._connectionRequestQueue=[],i._iid=e,i.sdkState=s,i.cacheContext=o,i.connectionHandlers=u,i._sessionManager=c,i._websocketClient=l,i._dispatcher=h,i._logger=d,i._currentState=p,i.sdkState.websocket.pingerDisabled||(i._pinger=new ya({pingDelegate:{send:function(e){return i._websocketClient.send(e)},error:function(e){return i._websocketClient.error(e)}},sdkState:i.sdkState,logger:d})),i._websocketClient.on("open",(function(){i._tryResolveConnectionRequest()})).on("message",(function(e){if("LOGI"===e.code)i.clearLoginTimer(),i._dispatcher.dispatch(e.as(La))})).on("ping-refresh",(function(){var e;return null===(e=i._pinger)||void 0===e?void 0:e.refreshTimer()})).on("pong",(function(){var e;return null===(e=i._pinger)||void 0===e?void 0:e.pong()})).on("error",(function(){var e;return null===(e=i._pinger)||void 0===e?void 0:e.stop()})).on("close",(function(){return i._rejectConnectionRequest(T.networkError)})),i._dispatcher.on((function(e){e instanceof La&&(i._unresolvedLogi=e,i._tryResolveConnectionRequest())})),i}return a(r,[{key:"currentState",get:function(){return this._currentState}},{key:"hasSession",get:function(){return this._sessionManager.auth.hasSession}},{key:"changeState",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(t>=this._stateUpdatedAt)){n.next=8;break}return this._currentState=e,this._stateUpdatedAt=t,this._dispatcher.dispatch(new Or({stateType:e.type})),this._logger.debug("connection state changes to ".concat(e.name)),n.next=7,this._currentState.run(this);case 7:return n.abrupt("return",!0);case 8:return n.abrupt("return",!1);case 9:case"end":return n.stop()}}),n,this)})))}},{key:"_tryResolveConnectionRequest",value:function(){var e;return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this._unresolvedLogi,!this._websocketClient.isOpen||!n){t.next=18;break}if(this._unresolvedLogi=null,n.error){t.next=15;break}return t.next=6,n.applyTo(this._iid);case 6:r=n.userProfile,this._enableStatLog(r.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish")),this._statLogConnection(null),null===(e=this._pinger)||void 0===e||e.start(),this._connectionRequestQueue.forEach((function(e){return e.resolve()})),this._connectionRequestQueue=[],this.sdkState.appState="foreground",t.next=18;break;case 15:this._sessionManager.auth.authToken=null,(n.error.isSessionKeyExpiredError||n.error.isSessionTokenExpiredError)&&this._dispatcher.dispatch(new te),this._rejectConnectionRequest(n.error);case 18:case"end":return t.stop()}}),t,this)})))}},{key:"_rejectConnectionRequest",value:function(e){var t;null===(t=this._pinger)||void 0===t||t.stop(),this.clearLoginTimer(),this._connectionRequestQueue.length>0&&(this._connectionRequestQueue.forEach((function(t){return t.reject(e)})),this._connectionRequestQueue=[],this._statLogConnection(e))}},{key:"_url",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=this.sdkState,r=n.appId,a=n.appVersion,i=n.userId,s=n.extensions,o=this.cacheContext.localCacheEnabled,u=this._sessionManager.auth,c=null===(e=this.sdkState.websocket)||void 0===e?void 0:e.compression,l=["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash"],h=["gcm","huawei","apns"],d=s.sb_syncmanager?"s".concat(s.sb_syncmanager):"",f=s.sb_uikit?"u".concat(s.sb_uikit):"",p="JS/c".concat(x.SDK_VERSION,"/").concat(d,"/").concat(f);return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(x.OS_VERSION),"&sv=").concat(encodeURIComponent(x.SDK_VERSION),"&ai=").concat(r).concat(a?"&av=".concat(a):"").concat(u.hasSession?"&key=".concat(encodeURIComponent(u.sessionKey)):"&user_id=".concat(encodeURIComponent(i),"&access_token=").concat(encodeURIComponent(t)),"&pmce=").concat(c?1:0,"&active=1&device_token_types=").concat(encodeURIComponent(h.join(",")),"&SB-User-Agent=").concat(p,"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(l))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=").concat(o?1:0,"&include_poll_details=1")}},{key:"_enableStatLog",value:function(e){this._dispatcher.dispatch(new Pa(e))}},{key:"_statLogConnection",value:function(e){this._dispatcher.dispatch(new ne(new re({type:X.WEBSOCKET_CONNECT,data:{host_url:this.sdkState.websocket.host,success:!e,latency:Date.now()-this._connectingAt,error_code:null==e?void 0:e.code,error_description:null==e?void 0:e.message}})))}},{key:"connect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this._url(e),r=new Ar,this._connectionRequestQueue.push(r),1===this._connectionRequestQueue.length&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout((function(){a._loginTimer=null,a._dispatcher.dispatch(La.asError(T.loginTimeout))}),this.sdkState.websocket.responseTimeout),this._sessionManager.auth.authToken=e,this._websocketClient.connect(n)),t.abrupt("return",r.promise);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"cancelConnectForRetry",value:function(){this._dispatcher.dispatch(La.asError(T.connectionRenew))}},{key:"disconnect",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._websocketClient.disconnect();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"logout",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.sdkState.userId=null,this._unresolvedLogi=null,e.next=4,this._sessionManager.clear();case 4:return e.next=6,this.disconnect();case 6:case"end":return e.stop()}}),e,this)})))}},{key:"clearLoginTimer",value:function(){this._loginTimer&&(clearTimeout(this._loginTimer),this._loginTimer=null)}}]),r}(K),Ha=function(){function e(t,r){var a=r.sdkState,i=r.cacheContext,s=r.connectionHandlers,o=r.sessionManager,u=r.websocketClient,c=r.dispatcher,l=r.logger,h=r.disableWebSocketCloseEventHandling,d=void 0!==h&&h;n(this,e),this._context=null,this._disableWebSocketCloseEventHandling=!1,this._logger=l,this._disableWebSocketCloseEventHandling=d,this._context=new Fa(t,{sdkState:a,cacheContext:i,connectionHandlers:s,sessionManager:o,websocketClient:u,dispatcher:c,logger:l}),this._sdkState=a,this._sessionManager=o,this._websocketClient=u}return a(e,[{key:"_registerEventDispatcher",value:function(){var e=this;this._disableWebSocketCloseEventHandling||(this._clearEventDispatcher(),this._sessionEventDispatcherContext=this._sessionManager.on("refresh-authtoken",(function(){e.isConnected||(e._logger.debug("try reconnect by session token refresh"),e.reconnect())})).on("refresh",(function(){e.isConnecting||e.isConnected||(e._logger.debug("try reconnect by session key refresh"),e.reconnect())})),this._websocketEventDispatcherContext=this._websocketClient.on("close",(function(){"foreground"===e._sdkState.appState&&(e._sessionManager.isRefreshingAuthToken||(e._logger.debug("try reconnect by websocket connection closed"),e.reconnect()))})))}},{key:"_clearEventDispatcher",value:function(){this._sessionEventDispatcherContext&&(this._sessionEventDispatcherContext.close(),this._sessionEventDispatcherContext=null),this._websocketEventDispatcherContext&&(this._websocketEventDispatcherContext.close(),this._websocketEventDispatcherContext=null)}},{key:"isConnected",get:function(){return this._context.currentState.type===Tr.CONNECTED}},{key:"isConnecting",get:function(){var e=this._context.currentState;return e.type===Tr.CONNECTING||e.type===Tr.RECONNECTING}},{key:"connect",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this._context.currentState,t.next=3,n.onConnect(this._context,e);case 3:this._registerEventDispatcher();case 4:case"end":return t.stop()}}),t,this)})))}},{key:"reconnect",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._context.currentState,e.next=3,t.onReconnect(this._context,{});case 3:case"end":return e.stop()}}),e,this)})))}},{key:"resetAndReconnect",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._context.currentState,e.next=3,t.onReconnect(this._context,{resetReconnectCount:!0});case 3:case"end":return e.stop()}}),e,this)})))}},{key:"background",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._context.currentState,e.next=3,t.onDisconnect(this._context,{autoReconnect:!1});case 3:case"end":return e.stop()}}),e,this)})))}},{key:"disconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this._context.currentState,t.next=3,n.onDisconnect(this._context,{error:e,autoReconnect:!0});case 3:case"end":return t.stop()}}),t,this)})))}},{key:"disconnectWebSocket",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._context.currentState,e.next=3,t.onDisconnectWebSocket(this._context);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"logout",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._context.currentState,this._clearEventDispatcher(),e.next=4,t.onLogout(this._context);case 4:case"end":return e.stop()}}),e,this)})))}}]),e}(),Ga=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.deviceId,s=e.statLogs;return n(this,r),(a=t.call(this)).method=R.POST,a.path="".concat(Xr),a.params={device_id:i,log_entries:s.map((function(e){return re.payloadify(e)}))},a}return a(r)}(J);!function(e){e[e.PENDING=0]="PENDING",e[e.ENABLED=1]="ENABLED",e[e.DISABLED=2]="DISABLED"}(Ma||(Ma={}));var qa,ja=function(){function e(t){var r=t.cacheContext,a=t.requestQueue,i=t.dispatcher,s=t.baseLimit,o=void 0===s?100:s,u=t.maxLimit,c=void 0===u?1e3:u,l=t.minLimit,h=void 0===l?10:l;n(this,e),this.queue=[],this.enabledstate=Ma.PENDING,this.isFlushing=!1,this.generation=1,this.lastFlushedAt=0,this.deviceId=B(),this.cacheContext=r,this.requestQueue=a,this.dispatcher=i,this.baseLimit=o,this.limit=o,this.maxLimit=c,this.minLimit=h}return a(e,[{key:"isEnabled",get:function(){return this.enabledstate===Ma.ENABLED}},{key:"_save",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cacheContext.localCacheEnabled){e.next=3;break}return e.next=3,this.cacheContext.preference.set(this.key,{deviceId:this.deviceId,statLogs:this.queue.map((function(e){return re.payloadify(e)})),generation:this.generation++,lastFlushedAt:this.lastFlushedAt});case 3:case"end":return e.stop()}}),e,this)})))}},{key:"_flush",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isEnabled){e.next=22;break}if(this.isFlushing){e.next=22;break}if(this.isFlushing=!0,e.prev=3,!((t=this.queue.slice(0,Math.min(this.limit,this.maxLimit))).length>0)){e.next=12;break}return n=new Ga({deviceId:this.deviceId,statLogs:t}),e.next=9,this.requestQueue.send(n);case 9:return this.queue=this.queue.slice(t.length),e.next=12,this._save();case 12:this.limit=this.baseLimit,this.lastFlushedAt=Date.now(),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),this.limit=this.limit+20;case 19:return e.prev=19,this.isFlushing=!1,e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[3,16,19,22]])})))}},{key:"init",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.key=e,!this.cacheContext.localCacheEnabled){t.next=16;break}return t.next=4,this.cacheContext.preference.get(this.key);case 4:if(!(n=t.sent)){t.next=16;break}if(this.deviceId=n.deviceId,this.queue=n.statLogs.map((function(e){return new re({type:e.stat_type,ts:e.ts,data:e.data})})),this.generation=n.generation,this.lastFlushedAt=n.lastFlushedAt,!(Date.now()-this.lastFlushedAt>=108e5&&this.queue.length>=this.minLimit)){t.next=16;break}return r=Math.min(Math.floor(18e4*Math.random()),100),t.next=14,ra(r);case 14:return t.next=16,this._flush();case 16:this.dispatcher.on((function(e){if(e instanceof ne){var t=e.statLog;a.put(t)}else e instanceof Pa&&(a.enabledstate=e.enabled?Ma.ENABLED:Ma.DISABLED,a.isEnabled?a.queue.length>=a.limit&&a._flush():a.clear())}));case 17:case"end":return t.stop()}}),t,this)})))}},{key:"put",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.enabledstate===Ma.DISABLED){t.next=7;break}return this.queue.push(e),t.next=4,this._save();case 4:if(!(this.queue.length>=this.limit)){t.next=7;break}return t.next=7,this._flush();case 7:case"end":return t.stop()}}),t,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.queue=[],this.generation=1,e.next=4,this._save();case 4:case"end":return e.stop()}}),e,this)})))}}]),e}();e.LogLevel=void 0,(qa=e.LogLevel||(e.LogLevel={}))[qa.NONE=0]="NONE",qa[qa.VERBOSE=1]="VERBOSE",qa[qa.DEBUG=2]="DEBUG",qa[qa.INFO=3]="INFO",qa[qa.WARN=4]="WARN",qa[qa.ERROR=5]="ERROR";var za,Va,Ba,Qa,Ka=function(){function t(){n(this,t),this.level=e.LogLevel.WARN}return a(t,[{key:"verbose",value:function(){if(this.level<=e.LogLevel.VERBOSE){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];(t=console).log.apply(t,["[verbose]"].concat(r))}}},{key:"debug",value:function(){if(this.level<=e.LogLevel.DEBUG){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];(t=console).log.apply(t,["[debug]"].concat(r))}}},{key:"info",value:function(){if(this.level<=e.LogLevel.INFO){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];(t=console).log.apply(t,["[info]"].concat(r))}}},{key:"warn",value:function(){if(this.level<=e.LogLevel.WARN){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];(t=console).warn.apply(t,["[warn]"].concat(r))}}},{key:"error",value:function(){if(this.level<=e.LogLevel.ERROR){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];(t=console).error.apply(t,["[error]"].concat(r))}}}]),t}(),Wa={},Ya=function(){function t(r,a){var i,s,o,u,c,l,h,d,f;if(n(this,t),this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!Wa[r]){Wa[r]=this;var p=null!==(i=a.options)&&void 0!==i?i:new G,v=this.sdkState={appId:a.appId,appVersion:null!==(s=a.appVersion)&&void 0!==s?s:"",appState:"foreground",userId:null,extensions:{},api:{host:null!==(o=a.apiHost)&&void 0!==o?o:"https://api-".concat(a.appId,".sendbird.com")},websocket:{host:null!==(u=a.websocketHost)&&void 0!==u?u:"wss://ws-".concat(a.appId,".sendbird.com"),pingerDisabled:!!a.noPingpong,pingInterval:null,pongTimeout:null,connectMaxRetry:2,compression:!0,reconnectMaxRetry:-1,reconnectRetryStrategy:new aa,responseTimeout:p.websocketResponseTimeout},sessionTokenRefreshTimeout:p.sessionTokenRefreshTimeout};this.appInfo=null,this.subscribedUnreadMessageCount={all:0,customTypes:{},ts:0};var m=this.logger=new Ka;this.logger.level=null!==(c=a.logLevel)&&void 0!==c?c:e.LogLevel.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map;var _=this.cacheContext=new z({encryption:a.encryption,store:a.store,localCacheEnabled:null!==(l=a.localCacheEnabled)&&void 0!==l&&l});this.debugMode=null!==(h=a.debugMode)&&void 0!==h&&h,this.maxSuperGroupChannelUnreadCount=x.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=p.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=p.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=p.typingIndicatorThrottle,this.concurrentCallLimit=null,this.backOffDelay=null;var g=this.dispatcher=new W,y=new V;this.requestQueue=new Dr(r,{auth:y,sdkState:v,dispatcher:g,logger:m}),this.sessionManager=new ca({auth:y,cacheContext:_,sdkState:v,dispatcher:g,requestQueue:this.requestQueue,logger:m}),this.connectionManager=new Ha(r,{sdkState:v,cacheContext:this.cacheContext,connectionHandlers:this.connectionHandlers,dispatcher:g,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,disableWebSocketCloseEventHandling:null!==(d=a.disableWebSocketCloseEventHandling)&&void 0!==d&&d,logger:m}),this.statLogCollector=new ja({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:g}),this.appStateToggleEnabled=null===(f=a.appStateToggleEnabled)||void 0===f||f}return Wa[r]}return a(t,null,[{key:"of",value:function(e){if(Wa[e])return Wa[e];throw T.lostInstance}},{key:"clear",value:function(e){Wa[e]&&delete Wa[e]}}]),t}();e.PushTokenRegistrationState=void 0,(za=e.PushTokenRegistrationState||(e.PushTokenRegistrationState={})).SUCCESS="success",za.PENDING="pending",za.ERROR="error",e.PushTriggerOption=void 0,(Va=e.PushTriggerOption||(e.PushTriggerOption={})).DEFAULT="default",Va.ALL="all",Va.MENTION_ONLY="mention_only",Va.OFF="off",e.PushTokenType=void 0,(Ba=e.PushTokenType||(e.PushTokenType={})).FCM="gcm",Ba.APNS="apns",Ba.UNKNOWN="unknown",e.PushTemplate=void 0,(Qa=e.PushTemplate||(e.PushTemplate={})).ALTERNATIVE="alternative",Qa.DEFAULT="default";var Za,Xa,Ja,$a,ei,ti,ni,ri=function(){function e(){n(this,e)}return a(e,[{key:"init",value:function(e,t){var n=t.sdkState,r=t.dispatcher,a=t.sessionManager,i=t.requestQueue,s=t.logger;t.onlineDetector;var o=t.cacheContext,u=void 0===o?null:o;this._iid=e,this._cacheContext=u,this._sdkState=n,this._dispatcher=r,this._sessionManager=a,this._requestQueue=i,this._logger=s}}]),e}(),ai=function(e){i(r,e);var t=f(r);function r(e){var a;if(n(this,r),(a=t.call(this)).method=R.POST,a.path="".concat(Gr),a.params=Z({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(var i=0;i<e.thumbnailSizes.length;i++){var s=e.thumbnailSizes[i],o=s.maxWidth,u=s.maxHeight;a.params["thumbnail".concat(i+1)]="".concat(o,",").concat(u)}return a.requestId=e.requestId,a}return a(r)}(J),ii=function(e){i(r,e);var t=f(r);function r(e,a){var i,s,o,u;return n(this,r),(i=t.call(this,e,a)).url=a.url,i.fileSize=null!==(s=a.file_size)&&void 0!==s?s:0,i.thumbnailSizes=null!==(o=a.thumbnails)&&void 0!==o?o:[],i.requireAuth=null!==(u=a.require_auth)&&void 0!==u&&u,i}return a(r)}($);e.MessageType=void 0,(Za=e.MessageType||(e.MessageType={})).BASE="base",Za.USER="user",Za.FILE="file",Za.ADMIN="admin",e.MessageTypeFilter=void 0,(Xa=e.MessageTypeFilter||(e.MessageTypeFilter={})).ALL="",Xa.USER="MESG",Xa.FILE="FILE",Xa.ADMIN="ADMM",function(e){e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM"}(Ja||(Ja={})),e.MentionType=void 0,($a=e.MentionType||(e.MentionType={})).USERS="users",$a.CHANNEL="channel",e.ReplyType=void 0,(ei=e.ReplyType||(e.ReplyType={})).ALL="all",ei.NONE="none",ei.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel",e.PushNotificationDeliveryOption=void 0,(ti=e.PushNotificationDeliveryOption||(e.PushNotificationDeliveryOption={})).DEFAULT="default",ti.SUPPRESS="suppress",e.SendingStatus=void 0,(ni=e.SendingStatus||(e.SendingStatus={})).PENDING="pending",ni.SCHEDULED="scheduled",ni.SUCCEEDED="succeeded",ni.FAILED="failed",ni.CANCELED="canceled";var si,oi=function(e){i(r,e);var t=f(r);function r(e,a){var i,s,o,u;return n(this,r),(i=t.call(this,e)).replyCount=0,i.mostRepliedUsers=null,i.lastRepliedAt=0,i.updatedAt=0,i.replyCount=null!==(s=a.reply_count)&&void 0!==s?s:0,i.mostRepliedUsers=a.hasOwnProperty("most_replies")&&O("object",a.most_replies)?a.most_replies.map((function(e){return new Ua(i._iid,e)})):[],i.lastRepliedAt=null!==(o=a.last_replied_at)&&void 0!==o?o:0,i.updatedAt=null!==(u=a.updated_at)&&void 0!==u?u:0,i}return a(r,null,[{key:"payloadify",value:function(e){return e?Z(Object.assign(Object.assign({},v(s(r),"payloadify",this).call(this,e)),{reply_count:e.replyCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map((function(e){return Ua.payloadify(e)})):[],last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})):null}}]),r}(ba);e.ReactionEventOperation=void 0,(si=e.ReactionEventOperation||(e.ReactionEventOperation={})).ADD="add",si.DELETE="delete";var ui,ci,li,hi,di=a((function t(r){n(this,t),this.messageId=0,this.userId=null,this.key=null,this.operation=null,this.updatedAt=0;var a=A("string",r.msg_id)?parseInt(r.msg_id):r.msg_id,i=r.user_id,s=r.operation?r.operation.toLowerCase():null,o=r.reaction,u=r.updated_at;a&&A("string",i)&&A("string",s)&&M(e.ReactionEventOperation,s)&&A("string",o)&&o&&A("number",u)&&(this.messageId=a,this.userId=i,this.key=o,this.operation=s,this.updatedAt=u)})),fi=function(){function t(e){var r;n(this,t);var a=e.key,i=null!==(r=_(e.user_ids))&&void 0!==r?r:[],s=e.updated_at;A("string",a)&&a&&O("string",i)&&i.length>0&&A("number",s)&&(this.key=a,this.userIds=i,this.updatedAt=s);var o,u={},c=k(this.userIds);try{for(c.s();!(o=c.n()).done;){u[o.value]=this.updatedAt}}catch(e){c.e(e)}finally{c.f()}this._version=u}return a(t,[{key:"isEmpty",get:function(){return 0===this.userIds.length}},{key:"applyEvent",value:function(t){if(t.key===this.key&&this.updatedAt<=t.updatedAt){if(!this._version[t.userId]||this._version[t.userId]<=t.updatedAt){var n=this.userIds.indexOf(t.userId);switch(t.operation){case e.ReactionEventOperation.ADD:n<0&&this.userIds.push(t.userId);break;case e.ReactionEventOperation.DELETE:n>=0&&this.userIds.splice(n,1)}this._version[t.userId]=t.updatedAt}this.updatedAt=Math.max(this.updatedAt,t.updatedAt)}}}],[{key:"payloadify",value:function(e){return e?Z({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}):null}}]),t}(),pi=function(){function e(t){n(this,e),this.key=t.key,this.value=O("string",t.value)?_(t.value):[]}return a(e,null,[{key:"payloadify",value:function(e){var t;return e?Z({key:e.key,value:null!==(t=e.value)&&void 0!==t?t:[]}):null}}]),e}(),vi=function(){function e(t){n(this,e),this.url=null,this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=t.url,t.hasOwnProperty("secure_url")&&(this.secureUrl=t.secure_url),t.hasOwnProperty("type")&&(this.type=t.type),t.hasOwnProperty("width")&&(this.width=t.width),t.hasOwnProperty("height")&&(this.height=t.height),t.hasOwnProperty("alt")&&(this.alt=t.alt)}return a(e,null,[{key:"payloadify",value:function(e){var t,n;return e?Z({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!==(t=e.width)&&void 0!==t?t:0,height:null!==(n=e.height)&&void 0!==n?n:0,alt:e.alt}):null}}]),e}(),mi=function(){function e(t){n(this,e),this.title=null,this.url=null,this.description=null,this.defaultImage=null,t.hasOwnProperty("og:title")&&(this.title=t["og:title"]),t.hasOwnProperty("og:url")&&(this.url=t["og:url"]),t.hasOwnProperty("og:description")&&(this.description=t["og:description"]),t.hasOwnProperty("og:image")&&(this.defaultImage=new vi(t["og:image"]))}return a(e,null,[{key:"payloadify",value:function(e){return e?Z({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?vi.payloadify(e.defaultImage):null}):null}}]),e}(),_i=function(){function e(t){var r,a;n(this,e),this.name=null,this.volume=0,this.name=null!==(r=t.name)&&void 0!==r?r:"default",this.volume=null!==(a=t.volume)&&void 0!==a?a:1}return a(e,[{key:"serialize",value:function(){return{name:this.name,volume:this.volume}}}],[{key:"payloadify",value:function(e){return e?Z({name:e.name,volume:e.volume}):null}}]),e}();e.ChannelType=void 0,(ui=e.ChannelType||(e.ChannelType={})).BASE="base",ui.GROUP="group",ui.OPEN="open",e.Role=void 0,(ci=e.Role||(e.Role={})).OPERATOR="operator",ci.NONE="none",e.ScheduledStatus=void 0,(li=e.ScheduledStatus||(e.ScheduledStatus={})).PENDING="pending",li.SENT="sent",li.FAILED="failed",li.CANCELED="canceled",function(e){e.PENDING="pending",e.IN_QUEUE="in_queue",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled",e.REMOVED="removed"}(hi||(hi={}));var gi,yi=function(t){switch(t){case e.MessageType.BASE:return"";case e.MessageType.USER:return"MESG";case e.MessageType.FILE:return"FILE";case e.MessageType.ADMIN:return"ADMM"}},ki=function(t){i(o,t);var r=f(o);function o(t,a){var i,s,u,c,l,h,d,f,p,v,m,_,g,y,k;n(this,o),(i=r.call(this,t)).channelUrl=null,i.channelType=e.ChannelType.BASE,i.messageId=0,i.parentMessageId=null,i.parentMessage=null,i.silent=!1,i.isOperatorMessage=!1,i.messageType=e.MessageType.BASE,i.data=null,i.customType=null,i.mentionType=null,i.mentionedUsers=[],i.mentionedUserIds=[],i.mentionedMessageTemplate=null,i.threadInfo=null,i.reactions=[],i.metaArrays=[],i.ogMetaData=null,i.appleCriticalAlertOptions=null,i.createdAt=0,i.updatedAt=0,i.scheduledInfo=null,i.extendedMessage={},i._scheduledStatus=null,i.messageId=null!==(u=null!==(s=a.msg_id)&&void 0!==s?s:a.message_id)&&void 0!==u?u:0,i.channelUrl=a.channel_url,i.channelType=M(e.ChannelType,a.channel_type)?a.channel_type:e.ChannelType.GROUP,a.channel&&(a.channel.channel_url&&(i.channelUrl=a.channel.channel_url),a.channel.channel_type&&(i.channelType=a.channel.channel_type)),i.parentMessageId=null!==(c="string"==typeof a.parent_message_id?parseInt(a.parent_message_id):a.parent_message_id)&&void 0!==c?c:0,i.data=null!==(l=a.data)&&void 0!==l?l:"",i.customType=null!==(h=a.custom_type)&&void 0!==h?h:"",i.mentionType=M(e.MentionType,a.mention_type)?a.mention_type:null;var E=a.mentioned_users;i.mentionedUsers=E?E.map((function(e){return new Ua(i._iid,e)})):null;var b=a.mentioned_user_ids;i.mentionedUserIds=null!=b?b:null,i.mentionedUsers&&!i.mentionedUserIds&&(i.mentionedUserIds=i.mentionedUsers.map((function(e){return e.userId}))),i.mentionedMessageTemplate=null!==(d=a.mentioned_message_template)&&void 0!==d?d:"",i.threadInfo=a.thread_info?new oi(i._iid,a.thread_info):null,i.reactions=a.reactions?a.reactions.map((function(e){return new fi(e)})):[];for(var w=null!==(f=a.metaarray)&&void 0!==f?f:{},x=null!==(p=a.metaarray_key_order)&&void 0!==p?p:Object.keys(w).sort((function(e,t){return e.localeCompare(t)})),R=0;R<x.length;R++){var C=x[R];i.metaArrays.push(new pi({key:C,value:w[C]||[]}))}return a.sorted_metaarray&&(i.metaArrays=a.sorted_metaarray.map((function(e){return new pi(e)}))),i.ogMetaData=a.og_tag?new mi(a.og_tag):null,i.silent=null!==(v=a.silent)&&void 0!==v&&v,i.isOperatorMessage=null!==(m=a.is_op_msg)&&void 0!==m&&m,i.appleCriticalAlertOptions=a.apple_critical_alert_options?new _i(a.apple_critical_alert_options):null,i.createdAt=null!==(g=null!==(_=a.created_at)&&void 0!==_?_:a.ts)&&void 0!==g?g:0,i.updatedAt=null!==(y=a.updated_at)&&void 0!==y?y:0,"number"==typeof a.scheduled_message_id&&"number"==typeof a.scheduled_at&&a.scheduled_status&&(i.scheduledInfo={scheduledMessageId:a.scheduled_message_id,scheduledAt:a.scheduled_at},i._scheduledStatus=a.scheduled_status),i.extendedMessage=null!==(k=a.extended_message)&&void 0!==k?k:{},i}return a(o,[{key:"isIdentical",value:function(e){return this.messageId===e.messageId}},{key:"isEqual",value:function(e){return N(this,e)}},{key:"isUserMessage",value:function(){return this.messageType===e.MessageType.USER}},{key:"isFileMessage",value:function(){return this.messageType===e.MessageType.FILE}},{key:"isAdminMessage",value:function(){return this.messageType===e.MessageType.ADMIN}},{key:"serialize",value:function(){return Ia(this)}},{key:"getMetaArraysByKeys",value:function(e){return this.metaArrays.filter((function(t){return e.includes(t.key)}))}},{key:"applyThreadInfoUpdateEvent",value:function(e){return this.messageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1}},{key:"applyReactionEvent",value:function(e){if(this.messageId===e.messageId){for(var t=!1,n=0;n<this.reactions.length;n++)if(this.reactions[n].key===e.key){this.reactions[n].applyEvent(e),this.reactions[n].isEmpty&&this.reactions.splice(n,1),t=!0;break}t||"add"!==e.operation||this.reactions.push(new fi(fi.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}}},{key:"applyParentMessage",value:function(e){if(this.parentMessageId===e.messageId){var t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return!1}}],[{key:"payloadify",value:function(e){var t,n,r,a;return e?Z(Object.assign(Object.assign({},v(s(o),"payloadify",this).call(this,e)),{channel_url:e.channelUrl,channel_type:e.channelType,message_id:e.messageId,type:yi(e.messageType),parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null===(t=e.mentionedUsers)||void 0===t?void 0:t.map((function(e){return Ua.payloadify(e)})),mentioned_message_template:e.mentionedMessageTemplate,thread_info:e.threadInfo?oi.payloadify(e.threadInfo):null,reactions:e.reactions.map((function(e){return fi.payloadify(e)})),sorted_metaarray:null===(n=e.metaArrays)||void 0===n?void 0:n.map((function(e){return pi.payloadify(e)})),og_tag:mi.payloadify(e.ogMetaData),silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:_i.payloadify(e.appleCriticalAlertOptions),created_at:e.createdAt,updated_at:e.updatedAt,scheduled_message_id:null===(r=e.scheduledInfo)||void 0===r?void 0:r.scheduledMessageId,scheduled_at:null===(a=e.scheduledInfo)||void 0===a?void 0:a.scheduledAt,scheduled_status:e._scheduledStatus,extended_message:e.extendedMessage})):null}}]),o}(ba),Ei=function(t){i(o,t);var r=f(o);function o(t,a){var i;return n(this,o),(i=r.call(this,t,a)).role=null,i.isBlockedByMe=!1,i.role=M(e.Role,a.role)?a.role:e.Role.NONE,a.hasOwnProperty("is_blocked_by_me")&&(i.isBlockedByMe=a.is_blocked_by_me),i}return a(o,null,[{key:"payloadify",value:function(e){return e?Z(Object.assign(Object.assign({},v(s(o),"payloadify",this).call(this,e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})):null}}]),o}(Ua),bi=function(t){i(o,t);var r=f(o);function o(t,a){var i,s,u,c,l;if(n(this,o),(i=r.call(this,t,a)).sender=null,i.reqId="",i.replyToChannel=!1,i.sendingStatus=null,i.errorCode=0,i.sender=a.user?new Ei(i._iid,a.user):a.sender_id,i.reqId=null!==(u=null!==(s=a.req_id)&&void 0!==s?s:a.request_id)&&void 0!==u?u:"",i.replyToChannel=null!==(c=a.is_reply_to_channel)&&void 0!==c&&c,a.request_state&&M(e.SendingStatus,a.request_state)&&(i.sendingStatus=a.request_state),!i.sendingStatus)if(i.messageId>0)i.sendingStatus=e.SendingStatus.SUCCEEDED;else if(i.scheduledInfo)switch(i._scheduledStatus=a.scheduled_status,a.scheduled_status){case hi.SENT:case hi.IN_QUEUE:i.sendingStatus=e.SendingStatus.SUCCEEDED;break;case hi.PENDING:i.sendingStatus=e.SendingStatus.SCHEDULED;break;case hi.FAILED:case hi.REMOVED:i.sendingStatus=e.SendingStatus.FAILED;break;case hi.CANCELED:i.sendingStatus=e.SendingStatus.CANCELED}else i.sendingStatus=e.SendingStatus.PENDING;return i.errorCode=null!==(l=a.error_code)&&void 0!==l?l:0,i}return a(o,[{key:"isResendable",get:function(){return this.sendingStatus===e.SendingStatus.FAILED&&((t=this.errorCode)>0&&S.indexOf(t)>=0);var t}},{key:"isIdentical",value:function(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId}}],[{key:"payloadify",value:function(e){return e?Z(Object.assign(Object.assign({},v(s(o),"payloadify",this).call(this,e)),{user:Ei.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode})):null}}]),o}(ki),wi=function(){function e(t){var r,a;n(this,e),this.url=null,this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=t.url,this.width=t.width,this.height=t.height,this.realWidth=null!==(r=t.real_width)&&void 0!==r?r:t.width,this.realHeight=null!==(a=t.real_height)&&void 0!==a?a:t.height}return a(e,[{key:"plainUrl",get:function(){return this.url.split("?auth=")[0]}}],[{key:"payloadify",value:function(e){return e?Z({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}):null}}]),e}(),xi={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:e.MessageTypeFilter.ALL,customTypesFilter:null,senderUserIdsFilter:null,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},Ri=function(t){return A("number",t.prevResultSize)&&A("number",t.nextResultSize)&&A("boolean",t.isInclusive)&&A("boolean",t.reverse)&&A("string",t.messageTypeFilter)&&M(e.MessageTypeFilter,t.messageTypeFilter)&&O("string",t.customTypesFilter,!0)&&O("string",t.senderUserIdsFilter,!0)&&A("boolean",t.includeMetaArray)&&A("boolean",t.includeReactions)&&A("boolean",t.includeParentMessageInfo)},Ci=function(t){i(o,t);var r=f(o);function o(t,a){var i,s,u,c,l;if(n(this,o),(i=r.call(this,t,a)).message=null,i.translations={},i.message=null!==(s=a.message)&&void 0!==s?s:"",i.messageType=e.MessageType.ADMIN,i.translations=null!==(u=a.translations)&&void 0!==u?u:{},a.parent_message_info){var h=a.parent_message_info,d=Object.assign(Object.assign({},h),{message_id:i.parentMessageId,channel_url:i.channelUrl,channel_type:i.channelType,file:h.file,url:null===(c=h.file)||void 0===c?void 0:c.url,require_auth:null===(l=h.file)||void 0===l?void 0:l.require_auth});i.parentMessage=Li(t,d)}return i}return a(o,[{key:"getThreadedMessagesByTimestamp",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Object.assign(Object.assign({},xi),t),Aa(this.messageId>0&&A("number",e)&&Ri(r)).throw(T.invalidParameters),a=vs.of(this._iid),n.next=5,a.getThreadedMessagesByTimestamp(this,e,r);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}),n,this)})))}}],[{key:"payloadify",value:function(e){return e?Z(Object.assign(Object.assign({},v(s(o),"payloadify",this).call(this,e)),{message:e.message,translations:e.translations,parent_message_info:Di(e.parentMessage)})):null}}]),o}(ki),Ti=function(){function e(t){var r,a;n(this,e),this.type=null,this.vendor=null,this.detail={},this.type=null!==(r=t.type)&&void 0!==r?r:"",this.vendor=null!==(a=t.vendor)&&void 0!==a?a:"",t.hasOwnProperty("detail")&&A("object",t.detail)&&!Array.isArray(t.detail)&&(this.detail=t.detail)}return a(e,null,[{key:"payloadify",value:function(e){return e?Z({type:e.type,vendor:e.vendor,detail:e.detail}):null}}]),e}();!function(e){e.OPEN="open",e.CLOSED="closed"}(gi||(gi={}));var Si,Ii="removed",Ni=function(e){switch(e){case gi.OPEN:return gi.OPEN;case gi.CLOSED:return gi.CLOSED}},Ai=function(e){return!e||e.text&&A("string",e.text)},Mi=function(e){i(r,e);var t=f(r);function r(e,a){var i,s,o,u,c,l,h,d;return n(this,r),(i=t.call(this,e)).pollId=0,i.id=0,i.text=null,i.voteCount=0,i.createdBy=null,i.createdAt=0,i.updatedAt=0,i._lastVotedAt=0,i.pollId=null!==(s=a.poll_id)&&void 0!==s?s:0,i.id=null!==(o=a.id)&&void 0!==o?o:0,i.text=null!==(u=a.text)&&void 0!==u?u:null,i.voteCount=null!==(c=a.vote_count)&&void 0!==c?c:0,i.createdBy=null!==(l=a.created_by)&&void 0!==l?l:null,i.createdAt=null!==(h=a.created_at)&&void 0!==h?h:0,i.updatedAt=null!==(d=a.updated_at)&&void 0!==d?d:0,i}return a(r,null,[{key:"payloadify",value:function(e){return e?Z(Object.assign(Object.assign({},v(s(r),"payloadify",this).call(this,e)),{vote_count:e.voteCount,poll_id:e.pollId,text:e.text,created_at:e.createdAt,id:e.id,created_by:e.createdBy,updated_at:e.updatedAt})):null}}]),r}(ba),Ui=function(e){i(r,e);var t=f(r);function r(e,a){var i,s,o,u,c,l,h,d,f,p,v,m,_,g;return n(this,r),(i=t.call(this,e)).id=0,i.title=null,i.createdAt=0,i.updatedAt=0,i.closeAt=-1,i.status=gi.CLOSED,i.messageId=0,i.data=null,i.voterCount=-1,i.options=[],i.createdBy=null,i.allowUserSuggestion=!1,i.allowMultipleVotes=!1,i.votedPollOptionIds=[],i.id=null!==(s=a.id)&&void 0!==s?s:0,i.title=null!==(o=a.title)&&void 0!==o?o:null,i.createdAt=null!==(u=a.created_at)&&void 0!==u?u:0,i.updatedAt=null!==(c=a.updated_at)&&void 0!==c?c:0,i.closeAt=null!==(l=a.close_at)&&void 0!==l?l:-1,i.status=null!==(h=Ni(a.status))&&void 0!==h?h:gi.CLOSED,i.messageId=null!==(d=a.message_id)&&void 0!==d?d:0,i.data=null!==(f=a.data)&&void 0!==f?f:null,i.voterCount=null!==(p=a.voter_count)&&void 0!==p?p:-1,i.options=a.options?a.options.map((function(e){return new Mi(i._iid,e)})):[],i.createdBy=null!==(v=a.created_by)&&void 0!==v?v:null,i.allowUserSuggestion=null!==(m=a.allow_user_suggestion)&&void 0!==m&&m,i.allowMultipleVotes=null!==(_=a.allow_multiple_votes)&&void 0!==_&&_,i.votedPollOptionIds=null!==(g=a.voted_option_ids)&&void 0!==g?g:[],i}return a(r,[{key:"_applyPollUpdatePayload",value:function(e){var t,n,r,a,i,s,o,u,c=this;this.title=null!==(t=e.title)&&void 0!==t?t:this.title,this.updatedAt=null!==(n=e.updated_at)&&void 0!==n?n:this.updatedAt,this.closeAt=null!==(r=e.close_at)&&void 0!==r?r:this.closeAt,this.status=null!==(a=Ni(e.status))&&void 0!==a?a:this.status,this.data=null!==(i=e.data)&&void 0!==i?i:this.data,this.voterCount=null!==(s=e.voter_count)&&void 0!==s?s:this.voterCount,e.options&&(this.options=e.options.map((function(e){return new Mi(c._iid,e)})),this.votedPollOptionIds=e.options.filter((function(e){return e.vote_count>0})).map((function(e){return e.id}))),this.allowUserSuggestion=null!==(o=e.allow_user_suggestion)&&void 0!==o?o:this.allowUserSuggestion,this.allowMultipleVotes=null!==(u=e.allow_multiple_votes)&&void 0!==u?u:this.allowMultipleVotes}},{key:"applyPollUpdateEvent",value:function(e){var t=e._payload.poll;return!(!t||this.id!==t.id||t.updated_at<this.updatedAt)&&(this._applyPollUpdatePayload(t),!0)}},{key:"applyPollVoteEvent",value:function(e){if(this.id!==e.pollId)return!1;var t=this.options,n=t.map((function(e){return e.id})),r=e._payload,a=Math.floor(r.ts/1e3);return r.updated_vote_counts.forEach((function(e){var r=n.indexOf(e.option_id);if(r>-1){var i=t[r];a>=i._lastVotedAt&&(i.voteCount=e.vote_count,i._lastVotedAt=a)}})),r.req_id&&r.voted_option_ids&&(this.votedPollOptionIds=r.voted_option_ids),!0}},{key:"serialize",value:function(){return Ia(this)}}],[{key:"payloadify",value:function(e){return e?Z(Object.assign(Object.assign({},v(s(r),"payloadify",this).call(this,e)),{id:e.id,title:e.title,created_at:e.createdAt,updated_at:e.updatedAt,close_at:e.closeAt,status:e.status,message_id:e.messageId,data:e.data,voter_count:e.voterCount,options:e.options.map((function(e){return Mi.payloadify(e)})),created_by:e.createdBy,allow_user_suggestion:e.allowUserSuggestion,allow_multiple_votes:e.allowMultipleVotes,voted_option_ids:e.votedPollOptionIds})):null}}]),r}(ba),Oi=function(t){i(o,t);var r=f(o);function o(t,a){var i,s,u,c,l,h;if(n(this,o),(i=r.call(this,t,a)).message="",i.messageParams=null,i.translations={},i.translationTargetLanguages=[],i.messageSurvivalSeconds=-1,i.plugins=[],i._poll=null,i.message=a.message,i.messageType=e.MessageType.USER,i.translations=null!==(s=a.translations)&&void 0!==s?s:{},i.translationTargetLanguages=null!==(u=a.target_langs)&&void 0!==u?u:[],0===Object.keys(i.translations).length&&i.translationTargetLanguages.length>0){var d,f=k(i.translationTargetLanguages);try{for(f.s();!(d=f.n()).done;){var p=d.value;i.translations[p]=""}}catch(e){f.e(e)}finally{f.f()}}if(i.messageSurvivalSeconds=null!==(c=a.message_survival_seconds)&&void 0!==c?c:-1,i.plugins=a.plugins?a.plugins.map((function(e){return new Ti(e)})):[],i._poll=a.poll?new Ui(i._iid,a.poll):null,a.parent_message_info){var v=a.parent_message_info,m=Object.assign(Object.assign({},v),{created_at:v.ts,message_id:i.parentMessageId,channel_url:i.channelUrl,channel_type:i.channelType,file:v.file,url:null===(l=v.file)||void 0===l?void 0:l.url,require_auth:null===(h=v.file)||void 0===h?void 0:h.require_auth});i.parentMessage=Li(t,Z(m))}return i}return a(o,[{key:"getThreadedMessagesByTimestamp",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Object.assign(Object.assign({},xi),t),Aa(this.messageId>0&&A("number",e)&&Ri(r)).throw(T.invalidParameters),a=vs.of(this._iid),n.next=5,a.getThreadedMessagesByTimestamp(this,e,r);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}),n,this)})))}},{key:"applyPoll",value:function(e){return!(this._poll&&this._poll.id===e.id&&this._poll.updatedAt>e.updatedAt)&&(this._poll=e,!0)}},{key:"poll",get:function(){return this._poll}}],[{key:"payloadify",value:function(e){return e?Z(Object.assign(Object.assign({},v(s(o),"payloadify",this).call(this,e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map((function(e){return Ti.payloadify(e)})),poll:Ui.payloadify(e._poll),parent_message_info:Di(e.parentMessage)})):null}}]),o}(bi),Di=function(t){if(t)switch(t.messageType){case e.MessageType.USER:return Oi.payloadify(t);case e.MessageType.FILE:return Pi.payloadify(t);case e.MessageType.ADMIN:return Ci.payloadify(t)}return null},Li=function(e,t){switch(t.type){case"MESG":return new Oi(e,t);case"FILE":return new Pi(e,t);case"ADMM":case"BRDM":return new Ci(e,t)}return null},Pi=function(t){i(o,t);var r=f(o);function o(t,a){var i,s,u,c,l,h,d,f,p,v,m,_,g,y,k,E;n(this,o),(i=r.call(this,t,a)).messageParams=null,i.plainUrl="",i.requireAuth=!1,i.name=null,i.size=0,i.type=null,i.thumbnails=[],i.messageSurvivalSeconds=-1,i.messageType=e.MessageType.FILE;var b=null!==(s=a.file)&&void 0!==s?s:null;i.plainUrl=(null!==(c=null!==(u=null==b?void 0:b.url)&&void 0!==u?u:a.url)&&void 0!==c?c:"").split("?auth=")[0],i.name=null!==(h=null!==(l=null==b?void 0:b.name)&&void 0!==l?l:a.name)&&void 0!==h?h:"File",i.size=null!==(f=null!==(d=null==b?void 0:b.size)&&void 0!==d?d:a.size)&&void 0!==f?f:0,i.data=null!==(v=null!==(p=null==b?void 0:b.data)&&void 0!==p?p:a.custom)&&void 0!==v?v:"",i.type=b?null!==(m=b.type)&&void 0!==m?m:"":null!==(_=a.type)&&void 0!==_?_:"";var w=Ya.of(i._iid).sessionManager;if(i.requireAuth=null!==(g=a.require_auth)&&void 0!==g&&g,i.thumbnails=a.thumbnails?a.thumbnails.map((function(e){return new wi(Object.assign(Object.assign({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(i.requireAuth?"?auth=".concat(w.ekey):"")}))})):[],i.messageSurvivalSeconds=null!==(y=a.message_survival_seconds)&&void 0!==y?y:-1,a.parent_message_info){var x=a.parent_message_info,R=Object.assign(Object.assign({},x),{message_id:i.parentMessageId,channel_url:i.channelUrl,channel_type:i.channelType,file:x.file,url:null===(k=x.file)||void 0===k?void 0:k.url,require_auth:null===(E=x.file)||void 0===E?void 0:E.require_auth});i.parentMessage=Li(t,R)}return i}return a(o,[{key:"url",get:function(){var e=Ya.of(this._iid).sessionManager;return this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl}},{key:"getThreadedMessagesByTimestamp",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Object.assign(Object.assign({},xi),t),Aa(this.messageId>0&&A("number",e)&&Ri(r)).throw(T.invalidParameters),a=vs.of(this._iid),n.next=5,a.getThreadedMessagesByTimestamp(this,e,r);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}),n,this)})))}}],[{key:"payloadify",value:function(e){return e?Z(Object.assign(Object.assign({},v(s(o),"payloadify",this).call(this,e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:e.thumbnails.map((function(e){return{url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:Di(e.parentMessage)})):null}}]),o}(bi),Fi=function(t){switch(t){case e.ChannelType.GROUP:return qr;case e.ChannelType.OPEN:return zr;default:return null}},Hi=function(t){switch(t){case e.ChannelType.GROUP:return"".concat(Qr,"/group_channels");case e.ChannelType.OPEN:return"".concat(Qr,"/open_channels");default:return null}},Gi=function(t,n,r){switch(t){case e.MentionType.CHANNEL:return!0;case e.MentionType.USERS:if(n){var a,i=k(n);try{for(i.s();!(a=i.n()).done;){if(a.value===r)return!0}}catch(e){i.e(e)}finally{i.f()}}}return!1},qi=function(e,t,n){var r=Gi(e.mentionType,e.mentionedUserIds,n),a=Gi(t.mentionType,t.mentionedUserIds,n);return!r&&a?1:r&&!a?-1:0},ji=function(t){i(s,t);var r=f(s);function s(t){var a,i,o;n(this,s);var u=[];return t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?u=t.mentionedUserIds:t.mentionedUsers&&(u=t.mentionedUsers.map((function(e){return e.userId})))),r.call(this,{code:"FILE",ackRequired:!0,payload:Z({channel_url:t.channelUrl,url:t.url,name:null!==(a=t.fileName)&&void 0!==a?a:"",type:null!==(i=t.mimeType)&&void 0!==i?i:"",size:null!==(o=t.fileSize)&&void 0!==o?o:0,custom:t.data,custom_type:t.customType,thumbnails:t.thumbnailSizes,require_auth:t.requireAuth,metaarray:t.metaArrays,mention_type:t.mentionType,mentioned_user_ids:u,push_option:t.pushNotificationDeliveryOption&&t.pushNotificationDeliveryOption!==e.PushNotificationDeliveryOption.DEFAULT?t.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:t.appleCriticalAlertOptions,silent:t.silent,reply_to_channel:t.isReplyToChannel,parent_message_id:t.parentMessageId>0?t.parentMessageId:null,req_id:t.reqId,pin_message:t.isPinnedMessage})})}return a(s)}(Ir),zi=function(t){i(s,t);var r=f(s);function s(t){var a,i;n(this,s),a=r.call(this);var o=[];return t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?o=t.mentionedUserIds:t.mentionedUsers&&(o=t.mentionedUsers.map((function(e){return e.userId})))),a.method=R.POST,a.path="".concat(Fi(t.channelType),"/").concat(encodeURIComponent(t.channelUrl),"/messages"),a.params=Z({message_type:e.MessageType.FILE,user_id:t.userId,url:t.fileUrl,mention_type:t.mentionType,mentioned_user_ids:o,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,data:t.data,custom_type:t.customType,thumbnails:t.thumbnailSizes.map((function(e){return wi.payloadify(e)})),require_auth:t.requireAuth,sorted_metaarray:null===(i=t.metaArrays)||void 0===i?void 0:i.map((function(e){return pi.payloadify(e)})),push_option:t.pushNotificationDeliveryOption,parent_message_id:t.parentMessageId>0?t.parentMessageId:null,apple_critical_alert_options:_i.payloadify(t.appleCriticalAlertOptions),reply_to_channel:t.isReplyToChannel,req_id:t.reqId,pin_message:t.isPinnedMessage}),a}return a(s)}(J),Vi=function(e){i(r,e);var t=f(r);function r(e,a,i){var s,o,u,c;n(this,r),(s=t.call(this,e,"FILE",i)).message=new Pi(e,i);var l=Ya.of(e).sdkState;return s.isMentioned=Gi(s.message.mentionType,null!==(o=s.message.mentionedUserIds)&&void 0!==o?o:null===(u=s.message.mentionedUsers)||void 0===u?void 0:u.map((function(e){return e.userId})),l.userId),s.forceUpdateLastMessage=null!==(c=i.force_update_last_message)&&void 0!==c&&c,s}return a(r)}(ie),Bi=function(e){i(r,e);var t=f(r);function r(e,a){var i,s,o;n(this,r),(i=t.call(this,e,a)).message=new Pi(e,a);var u=Ya.of(e).sdkState;return i.isMentioned=Gi(i.message.mentionType,null!==(s=i.message.mentionedUserIds)&&void 0!==s?s:i.message.mentionedUsers.map((function(e){return e.userId})),u.userId),i.forceUpdateLastMessage=null!==(o=a.force_update_last_message)&&void 0!==o&&o,i}return a(r)}($);!function(e){e[e.PENDING=0]="PENDING",e[e.UPLOADING=1]="UPLOADING",e[e.UPLOADED=2]="UPLOADED",e[e.SENDING=3]="SENDING",e[e.FAILED=4]="FAILED"}(Si||(Si={}));var Qi,Ki=function(){function e(t,r){var a=this,i=r.sdkState,s=r.dispatcher,o=r.requestQueue,u=r.onlineDetector,c=r.cacheContext;n(this,e),this._queueMap=new Map,this._connectionState=null,this._onlineDetector=null,this._iid=t,this._sdkState=i,this._requestQueue=o,this._cacheContext=c,this._dispatcher=s,this._dispatcher.on((function(e){e instanceof Or&&(a._connectionState=e.stateType)})),this._onlineDetector=u}return a(e,[{key:"_shouldSendThroughWebSocket",get:function(){return this._connectionState===Tr.CONNECTED||this._connectionState===Tr.CONNECTING||this._connectionState===Tr.RECONNECTING}},{key:"_sendFileMessage",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._shouldSendThroughWebSocket){n.next=9;break}return r=new ji(Object.assign(Object.assign({},t.params),{channelUrl:e.url,channelType:e.channelType,url:t.params.fileUrl,requireAuth:t.requireAuth,reqId:t.requestId})),n.next=4,this._requestQueue.send(r);case 4:return a=n.sent,i=a.as(Vi),s=i.message,n.abrupt("return",s);case 9:return o=new zi(Object.assign(Object.assign({},t.params),{channelUrl:e.url,channelType:e.channelType,url:t.params.fileUrl,userId:this._sdkState.userId,requireAuth:t.requireAuth,reqId:t.requestId})),n.next=12,this._requestQueue.send(o);case 12:return u=n.sent,c=u.as(Bi),l=c.message,n.abrupt("return",l);case 15:case"end":return n.stop()}}),n,this)})))}},{key:"_resolveMessageQueue",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=this._queueMap.get(e.url))){t.next=57;break}if(n.isResolving){t.next=56;break}n.isResolving=!0,r=[],a=!0,i=k(n.messageQueue),t.prev=7,i.s();case 9:if((s=i.n()).done){t.next=39;break}o=s.value,t.t0=o.state,t.next=t.t0===Si.PENDING||t.t0===Si.UPLOADING?14:t.t0===Si.UPLOADED?17:t.t0===Si.FAILED?35:37;break;case 14:return a=!1,r.push(o),t.abrupt("break",37);case 17:if(!a){t.next=33;break}return t.prev=18,o.state=Si.SENDING,t.next=22,this._sendFileMessage(e,o);case 22:return u=t.sent,o.deferred.resolve(u),t.next=26,ra(100);case 26:t.next=31;break;case 28:t.prev=28,t.t1=t.catch(18),o.deferred.reject(t.t1);case 31:t.next=34;break;case 33:r.push(o);case 34:return t.abrupt("break",37);case 35:return o.deferred.reject(o.error.code===b.REQUEST_CANCELED?T.fileUploadCanceled:o.error),t.abrupt("break",37);case 37:t.next=9;break;case 39:t.next=44;break;case 41:t.prev=41,t.t2=t.catch(7),i.e(t.t2);case 44:return t.prev=44,i.f(),t.finish(44);case 47:if(c=n.isResolveRequestPending,n.messageQueue=r,n.isResolving=!1,n.isResolveRequestPending=!1,!c){t.next=54;break}return t.next=54,this._resolveMessageQueue(e);case 54:t.next=57;break;case 56:n.isResolveRequestPending=!0;case 57:case"end":return t.stop()}}),t,this,[[7,41,44,47],[18,28]])})))}},{key:"_uploadNextPendingItem",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c,l,h,d,f,p,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this._queueMap.get(e.url),!(r=n.messageQueue.find((function(e){return e.state===Si.PENDING})))){t.next=49;break}if(!L(r.params.file)){t.next=45;break}if(!(n.uploadQueue.length<6)){t.next=43;break}return r.state=Si.UPLOADING,n.uploadQueue.push(r),t.next=9,this._onlineDetector.isOnline();case 9:if(!t.sent){t.next=37;break}return t.prev=11,a=new ai({file:r.params.file,channelUrl:e.url,thumbnailSizes:r.params.thumbnailSizes,requestId:r.requestId}),t.next=15,this._requestQueue.send(a);case 15:i=t.sent,s=i.as(ii),o=s.url,u=s.fileSize,c=void 0===u?r.params.fileSize:u,l=s.thumbnailSizes,h=void 0===l?r.params.thumbnailSizes:l,d=s.requireAuth,f=void 0!==d&&d,r.params.fileUrl=o,r.params.fileSize=c,r.params.thumbnailSizes=h,r.params.requireAuth=f,r.requireAuth=f,r.state=Si.UPLOADED,t.next=29;break;case 25:t.prev=25,t.t0=t.catch(11),t.t0.code===b.REQUEST_FAILED?r.error=new T({code:b.NETWORK_ERROR,message:"Failed to upload a file."}):r.error=t.t0,r.state=Si.FAILED;case 29:return t.prev=29,(p=n.uploadQueue.findIndex((function(e){return e.requestId===r.requestId})))>=0&&(n.uploadQueue.splice(p,1),this._uploadNextPendingItem(e)),t.next=34,this._resolveMessageQueue(e);case 34:return t.finish(29);case 35:t.next=43;break;case 37:return r.state=Si.FAILED,r.error=T.connectionRequired,(v=n.uploadQueue.findIndex((function(e){return e.requestId===r.requestId})))>=0&&(n.uploadQueue.splice(v,1),this._uploadNextPendingItem(e)),t.next=43,this._resolveMessageQueue(e);case 43:t.next=49;break;case 45:return r.params.thumbnailSizes=[],r.state=Si.UPLOADED,t.next=49,this._resolveMessageQueue(e);case 49:case"end":return t.stop()}}),t,this,[[11,25,29,35]])})))}},{key:"request",value:function(e,t,n){var r,a,i;return E(this,void 0,void 0,regeneratorRuntime.mark((function s(){var o;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return o=new Ar,L(n.file)&&(n.fileName=null!==(r=n.fileName)&&void 0!==r?r:n.file.name,n.mimeType=null!==(a=n.mimeType)&&void 0!==a?a:n.file.type,n.fileSize=null!==(i=n.fileSize)&&void 0!==i?i:n.file.size),this._queueMap.has(e.url)||this._queueMap.set(e.url,{messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1}),this._queueMap.get(e.url).messageQueue.push({requestId:t,params:n,state:Si.PENDING,deferred:o,requireAuth:n.requireAuth}),this._uploadNextPendingItem(e),s.abrupt("return",o.promise);case 7:case"end":return s.stop()}}),s,this)})))}},{key:"cancel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this._queueMap.get(e.url);if(n){var r,a=t?[n.messageQueue.find((function(e){return e.requestId===t}))]:_(n.messageQueue),i=k(a);try{for(i.s();!(r=i.n()).done;){var s=r.value;if(s)switch(s.state){case Si.PENDING:s.state=Si.FAILED,s.error=T.requestCanceled,this._resolveMessageQueue(e);break;case Si.UPLOADING:this._requestQueue.cancel(s.requestId)}}}catch(e){i.e(e)}finally{i.f()}}}}]),e}(),Wi={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:e.MessageTypeFilter.ALL,customTypesFilter:null,senderUserIdsFilter:null,replyType:e.ReplyType.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},Yi=function(t){return A("number",t.prevResultSize)&&A("number",t.nextResultSize)&&A("boolean",t.isInclusive)&&A("boolean",t.reverse)&&A("string",t.messageTypeFilter)&&M(e.MessageTypeFilter,t.messageTypeFilter)&&O("string",t.customTypesFilter,!0)&&O("string",t.senderUserIdsFilter,!0)&&M(e.ReplyType,t.replyType)&&A("boolean",t.includeMetaArray)&&A("boolean",t.includeReactions)&&A("boolean",t.includeParentMessageInfo)&&A("boolean",t.includeThreadInfo)&&A("boolean",t.showSubchannelMessagesOnly)},Zi={replyType:e.ReplyType.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1},Xi=function(t){return M(e.ReplyType,t.replyType)&&A("boolean",t.includeReactions)&&A("boolean",t.includeMetaArray)&&A("boolean",t.includeParentMessageInfo)&&A("boolean",t.includeThreadInfo)};e.MessageEventSource=void 0,(Qi=e.MessageEventSource||(e.MessageEventSource={})).UNKNOWN="UNKNOWN",Qi.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",Qi.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",Qi.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",Qi.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",Qi.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",Qi.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",Qi.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",Qi.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",Qi.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",Qi.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",Qi.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",Qi.REQUEST_MESSAGE="REQUEST_MESSAGE",Qi.EVENT_POLL_UPDATED="EVENT_POLL_UPDATED",Qi.EVENT_POLL_VOTED="EVENT_POLL_VOTED",Qi.SYNC_POLL_CHANGELOGS="SYNC_POLL_CHANGELOGS",Qi.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",Qi.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",Qi.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",Qi.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",Qi.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",Qi.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",Qi.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",Qi.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",Qi.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",Qi.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED";var Ji,$i=function(t){return t.startsWith("EVENT_")||t===e.MessageEventSource.SYNC_MESSAGE_FILL||t===e.MessageEventSource.SYNC_MESSAGE_CHANGELOGS||t===e.MessageEventSource.SYNC_POLL_CHANGELOGS},es=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.messages,s=e.source;return n(this,r),(a=t.call(this)).messages=i,a.source=s,a}return a(r)}(Y),ts=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.messageIds,s=e.source;return n(this,r),(a=t.call(this)).messageIds=i,a.source=s,a}return a(r)}(Y),ns=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.reqId,s=e.source;return n(this,r),(a=t.call(this)).reqId=i,a.source=s,a}return a(r)}(Y),rs=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.polls,s=e.source;return n(this,r),(a=t.call(this)).polls=i,a.source=s,a}return a(r)}(Y),as=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.event,s=e.source;return n(this,r),(a=t.call(this)).event=i,a.source=s,a}return a(r)}(Y),is=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.event,s=e.source;return n(this,r),(a=t.call(this)).event=null,a.source=null,a.event=i,a.source=s,a}return a(r)}(Y),ss=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelType,s=e.channelUrl,o=e.messageId,u=e.includeMetaArray,c=e.includeReactions,l=e.includeThreadInfo,h=e.includeParentMessageInfo;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Fi(i),"/").concat(encodeURIComponent(s),"/messages/").concat(encodeURIComponent(o)),a.params={is_sdk:!0,with_sorted_meta_array:u,include_reactions:c,include_thread_info:l,include_parent_message_info:h,include_poll_details:!0},a}return a(r)}(J),os=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).message=a?Li(e,Object.assign({},a)):null,i}return a(r)}($),us=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelType,s=e.channelUrl,o=e.timestamp,u=void 0===o?null:o,c=e.token,l=void 0===c?null:c,h=e.prevResultSize,d=e.nextResultSize,f=e.isInclusive,p=e.reverse,v=e.messageTypeFilter,m=e.customTypesFilter,_=e.senderUserIdsFilter,g=e.replyType,y=e.includeMetaArray,k=e.includeReactions,E=e.parentMessageId,b=e.includeThreadInfo,w=e.includeParentMessageInfo,x=e.showSubchannelMessagesOnly;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Fi(i),"/").concat(encodeURIComponent(s),"/messages"),a.params=Z({is_sdk:!0,prev_limit:h,next_limit:d,include:f,reverse:p,message_ts:u,message_id:l,message_type:null!=v?v:null,custom_types:m,sender_ids:_,include_reply_type:g,with_sorted_meta_array:y,include_reactions:k,parent_message_id:E,include_thread_info:b,include_parent_message_info:w,show_subchannel_message_only:x,include_poll_details:!0}),a}return a(r)}(J),cs=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).messages=a.messages.map((function(t){return Li(e,t)})),i}return a(r)}($),ls=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelType,s=e.channelUrl,o=e.timestamp,u=e.token,c=e.replyType,l=e.includeMetaArray,h=e.includeReactions,d=e.includeThreadInfo,f=e.includeParentMessageInfo;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Fi(i),"/").concat(encodeURIComponent(s),"/messages/changelogs"),a.params={change_ts:o,token:u,with_sorted_meta_array:l,include_reactions:h,include_thread_info:d,include_reply_type:c,include_parent_message_info:f,include_poll_details:!0},a}return a(r)}(J),hs=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).updatedMessages=a.updated.map((function(t){return Li(e,t)})),i.deletedMessagesInfo=a.deleted.map((function(e){return{messageId:e.message_id,deletedAt:e.deleted_at}})),i.hasMore=a.has_more,i.nextToken=a.next,i}return a(r)}($),ds=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelUrl,s=e.scheduledMessageId;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(qr,"/").concat(encodeURIComponent(i),"/scheduled_messages/").concat(encodeURIComponent(s)),a.params={},a}return a(r)}(J),fs=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).message=a?Li(e,Object.assign({},a)):null,i}return a(r)}($),ps={},vs=function(){function t(e,r){var a=r.sdkState,i=r.dispatcher,s=r.requestQueue,o=r.onlineDetector,u=r.cacheContext;n(this,t),this._iid=e,this._sdkState=a,this._requestQueue=s,this._dispatcher=i,this._cacheContext=u,this.fileMessageQueue=new Ki(e,{sdkState:a,dispatcher:i,requestQueue:s,onlineDetector:o,cacheContext:u}),ps[e]=this}return a(t,[{key:"buildMessageFromSerializedData",value:function(t){var n=Na(t);switch(n.messageType){case e.MessageType.USER:return new Oi(this._iid,Oi.payloadify(n));case e.MessageType.FILE:return new Pi(this._iid,Pi.payloadify(n));case e.MessageType.ADMIN:return new Ci(this._iid,Ci.payloadify(n))}return null}},{key:"buildUserMessageCreateParamsFromSerializedData",value:function(e,t){return Z({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,message:t.message,translationTargetLanguages:Object.keys(t.translations),pollId:e.pollId})}},{key:"buildFileMessageCreateParamsFromSerializedData",value:function(e,t){return Z({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,file:e.file,fileKey:e.fileKey,fileUrl:t.plainUrl,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:t.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),fileType:e.fileType,requireAuth:t.requireAuth})}},{key:"buildScheduledUserMessageCreateParamsFromSerializedData",value:function(e,t){return Object.assign(Object.assign({},this.buildUserMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})}},{key:"buildScheduledFileMessageCreateParamsFromSerializedData",value:function(e,t){return Object.assign(Object.assign({},this.buildFileMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})}},{key:"buildSenderFromSerializedData",value:function(e){var t=Na(e);return new Ei(this._iid,Ei.payloadify(t))}},{key:"getMessage",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new ss(e),t.next=3,this._requestQueue.send(n);case 3:return r=t.sent,a=r.as(os),i=a.message,t.abrupt("return",i);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"getScheduledMessage",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new ds(e),t.next=3,this._requestQueue.send(n);case 3:return r=t.sent,a=r.as(fs),i=a.message,t.abrupt("return",i);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"getMessagesByMessageId",value:function(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.MessageEventSource.REQUEST_MESSAGE;return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var s,o,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new us(Object.assign(Object.assign({channelType:n,channelUrl:t,token:String(r)},Wi),a)),e.next=3,this._requestQueue.send(s);case 3:return o=e.sent,u=o.as(cs),c=u.messages,this._dispatcher.dispatch(new es({messages:c,source:i})),e.abrupt("return",c);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getMessagesByTimestamp",value:function(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.MessageEventSource.REQUEST_MESSAGE;return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var s,o,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new us(Object.assign(Object.assign({channelType:n,channelUrl:t,timestamp:r},Wi),a)),e.next=3,this._requestQueue.send(s);case 3:return o=e.sent,u=o.as(cs),c=u.messages,this._dispatcher.dispatch(new es({messages:c,source:i})),e.abrupt("return",c);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getThreadedMessagesByTimestamp",value:function(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.MessageEventSource.REQUEST_THREADED_MESSAGE;return E(this,void 0,void 0,regeneratorRuntime.mark((function i(){var s,o,u,c,l;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return s=new us(Object.assign(Object.assign(Object.assign({channelUrl:t.channelUrl,channelType:t.channelType,timestamp:n},xi),r),{replyType:e.ReplyType.ALL,parentMessageId:t.messageId,includeThreadInfo:!0})),i.next=3,this._requestQueue.send(s);case 3:return o=i.sent,u=o.as(cs),c=u.messages,(l=c.slice(1)).forEach((function(e){e.parentMessage=t})),this._dispatcher.dispatch(new es({messages:l,source:a})),i.abrupt("return",{parentMessage:c[0],threadedMessages:l});case 9:case"end":return i.stop()}}),i,this)})))}},{key:"getMessageChangelogs",value:function(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.MessageEventSource.REQUEST_MESSAGE_CHANGELOGS;return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var s,o,u,c,l,h,d,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new ls(Z(Object.assign(Object.assign({channelType:n,channelUrl:t,timestamp:"number"==typeof r?r:null,token:"string"==typeof r?r:null},Zi),a))),e.next=3,this._requestQueue.send(s);case 3:return o=e.sent,u=o.as(hs),c=u.updatedMessages,l=u.deletedMessagesInfo,h=u.hasMore,d=u.nextToken,f=l.map((function(e){return e.messageId})),c.length>0&&this._dispatcher.dispatch(new es({messages:c,source:i})),f.length>0&&this._dispatcher.dispatch(new ts({messageIds:f,source:i})),e.abrupt("return",{updatedMessages:c,deletedMessageIds:f,hasMore:h,token:d});case 9:case"end":return e.stop()}}),e,this)})))}}],[{key:"of",value:function(e){return ps[e]}}]),t}(),ms=function(){function t(){n(this,t),this._onPending=se,this._onFailed=se,this._onSucceeded=se}return a(t,[{key:"_trigger",value:function(t,n){switch(n.sendingStatus){case e.SendingStatus.PENDING:0===n.errorCode&&this._onPending(n);break;case e.SendingStatus.FAILED:case e.SendingStatus.CANCELED:this._onFailed(t,n.scheduledInfo?null:n);break;case e.SendingStatus.SCHEDULED:case e.SendingStatus.SUCCEEDED:this._onSucceeded(n)}}},{key:"onPending",value:function(e){return this._onPending=e,this}},{key:"onFailed",value:function(e){return this._onFailed=e,this}},{key:"onSucceeded",value:function(e){return this._onSucceeded=e,this}}]),t}(),_s=function(e){i(r,e);var t=f(r);function r(e,a){var i;n(this,r),(i=t.call(this,e)).threadInfo=null,i.targetMessageId=0,i.channelUrl=null,i.channelType=null;var s=a.thread_info,o=a.parent_message_id,u=a.channel_url,c=a.channel_type;return s&&A("object",s)&&A("number",o)&&A("string",u)&&A("string",c)&&(i.threadInfo=new oi(e,s),i.targetMessageId=o,i.channelUrl=u,i.channelType=c),i}return a(r)}(ba),gs={channelUrl:null,channelType:null,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1},ys=function(t){return A("string",t.channelUrl)&&A("string",t.channelType)&&M(e.ChannelType,t.channelType)&&A("number",t.messageId)&&A("boolean",t.includeMetaArray)&&A("boolean",t.includeParentMessageInfo)&&A("boolean",t.includeThreadInfo)},ks=function(){function e(t,r){var a;n(this,e),this._iid=null,this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=t,this.limit=null!==(a=r.limit)&&void 0!==a?a:20}return a(e,[{key:"hasNext",get:function(){return this._hasNext}},{key:"isLoading",get:function(){return this._isLoading}},{key:"_validate",value:function(){return A("number",this.limit)&&this.limit>0}}]),e}(),Es=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelCustomType,s=e.keyword,o=e.limit,u=e.reverse,c=e.exactMatch,l=e.channelUrl,h=e.order,d=e.messageTimestampFrom,f=e.messageTimestampTo,p=e.advancedQuery,v=e.targetFields,m=e.nextToken;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Br,"/messages"),a.params={custom_type:i,query:s,limit:o,reverse:u,exact_match:c,channel_url:l,message_ts_from:d,message_ts_to:f,sort_field:h,advanced_query:p,target_fields:v,after:m},a}return a(r)}(J),bs=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).messages=a.results.map((function(t){return Li(e,t)})),i.hasNext=a.has_next,i.nextToken=a.end_cursor,i.totalCount=a.total_count,i}return a(r)}($);e.MessageSearchOrder=void 0,(Ji=e.MessageSearchOrder||(e.MessageSearchOrder={})).SCORE="score",Ji.TIMESTAMP="ts";var ws,xs,Rs,Cs=function(t){i(o,t);var r=f(o);function o(t,a){var i,s,u,c,l,h,d,f,p,v;return n(this,o),(i=r.call(this,t,a)).keyword="",i.reverse=!1,i.exactMatch=!1,i.channelUrl="",i.channelCustomType="",i.messageTimestampFrom=null,i.messageTimestampTo=null,i.order=e.MessageSearchOrder.SCORE,i.advancedQuery=!1,i.targetFields=null,i._nextToken="",i.totalCount=-1,i.keyword=a.keyword,i.reverse=null!==(s=a.reverse)&&void 0!==s&&s,i.exactMatch=null!==(u=a.exactMatch)&&void 0!==u&&u,i.channelUrl=null!==(c=a.channelUrl)&&void 0!==c?c:"",i.channelCustomType=null!==(l=a.channelCustomType)&&void 0!==l?l:"",i.messageTimestampFrom=null!==(h=a.messageTimestampFrom)&&void 0!==h?h:null,i.messageTimestampTo=null!==(d=a.messageTimestampTo)&&void 0!==d?d:null,i.order=null!==(f=a.order)&&void 0!==f?f:e.MessageSearchOrder.SCORE,i.advancedQuery=null!==(p=a.advancedQuery)&&void 0!==p&&p,i.targetFields=null!==(v=a.targetFields)&&void 0!==v?v:null,i}return a(o,[{key:"_validate",value:function(){return v(s(o.prototype),"_validate",this).call(this)&&A("string",this.keyword)&&this.keyword.length>0&&A("boolean",this.reverse)&&A("boolean",this.exactMatch)&&A("string",this.channelUrl)&&A("string",this.channelCustomType)&&(A("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(A("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&M(e.MessageSearchOrder,this.order)&&A("boolean",this.advancedQuery)&&O("string",this.targetFields,!0)}},{key:"next",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=21;break}if(this._isLoading){e.next=18;break}if(!this._hasNext){e.next=15;break}return this._isLoading=!0,t=Ya.of(this._iid),n=t.requestQueue,r=new Es(Object.assign(Object.assign({},this),{nextToken:this._nextToken?this._nextToken:null})),e.next=8,n.send(r);case 8:return a=e.sent,i=a.as(bs),s=i.messages,o=i.hasNext,u=i.nextToken,c=i.totalCount,this._nextToken=u,this._hasNext=o,this._isLoading=!1,this.totalCount=c,e.abrupt("return",s);case 15:return e.abrupt("return",[]);case 18:throw T.queryInProgress;case 19:e.next=22;break;case 21:throw T.invalidParameters;case 22:case"end":return e.stop()}}),e,this)})))}}]),o}(ks),Ts=function(t){i(o,t);var r=f(o);function o(e,t,a,i){var s;return n(this,o),(s=r.call(this,e,i)).channelUrl=t,s.channelType=a,s}return a(o,[{key:"_validate",value:function(){return v(s(o.prototype),"_validate",this).call(this)&&A("string",this.channelUrl)&&M(e.ChannelType,this.channelType)}}]),o}(ks),Ss=function(t){i(o,t);var r=f(o);function o(t,a,i,s){var u,c,l,h,d,f,p,v,m,_,g;return n(this,o),(u=r.call(this,t,a,i,s)).reverse=!1,u.messageTypeFilter=e.MessageTypeFilter.ALL,u.customTypesFilter=null,u.senderUserIdsFilter=null,u.replyType=e.ReplyType.NONE,u.includeMetaArray=!1,u.includeReactions=!1,u.includeParentMessageInfo=!1,u.includeThreadInfo=!1,u.showSubchannelMessagesOnly=!1,u._edge=Number.MAX_SAFE_INTEGER,u.reverse=null!==(c=s.reverse)&&void 0!==c&&c,u.messageTypeFilter=null!==(l=s.messageTypeFilter)&&void 0!==l?l:e.MessageTypeFilter.ALL,u.customTypesFilter=null!==(h=s.customTypesFilter)&&void 0!==h?h:null,u.senderUserIdsFilter=null!==(d=s.senderUserIdsFilter)&&void 0!==d?d:null,u.replyType=null!==(f=s.replyType)&&void 0!==f?f:e.ReplyType.NONE,u.includeMetaArray=null!==(p=s.includeMetaArray)&&void 0!==p&&p,u.includeReactions=null!==(v=s.includeReactions)&&void 0!==v&&v,u.includeParentMessageInfo=null!==(m=s.includeParentMessageInfo)&&void 0!==m&&m,u.includeThreadInfo=null!==(_=s.includeThreadInfo)&&void 0!==_&&_,u.showSubchannelMessagesOnly=null!==(g=s.showSubchannelMessagesOnly)&&void 0!==g&&g,u}return a(o,[{key:"_validate",value:function(){return v(s(o.prototype),"_validate",this).call(this)&&A("boolean",this.reverse)&&M(e.MessageTypeFilter,this.messageTypeFilter)&&M(e.ReplyType,this.replyType)&&O("string",this.customTypesFilter,!0)&&O("string",this.senderUserIdsFilter,!0)&&A("boolean",this.includeMetaArray)&&A("boolean",this.includeReactions)&&A("boolean",this.includeParentMessageInfo)&&A("boolean",this.includeThreadInfo)&&A("boolean",this.showSubchannelMessagesOnly)}},{key:"load",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=18;break}if(this._isLoading){e.next=15;break}if(!this._hasNext){e.next=12;break}return this._isLoading=!0,t=vs.of(this._iid),e.next=7,t.getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,{prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly});case 7:return n=e.sent,this._edge=Math.min.apply(Math,[Number.MAX_SAFE_INTEGER].concat(_(n.map((function(e){return e.createdAt}))))),this._hasNext=n.length>=this.limit,this._isLoading=!1,e.abrupt("return",n);case 12:return e.abrupt("return",[]);case 15:throw T.queryInProgress;case 16:e.next=19;break;case 18:throw T.invalidParameters;case 19:case"end":return e.stop()}}),e,this)})))}}]),o}(Ts),Is={channelUrl:null,scheduledMessageId:0},Ns=function(e){return A("string",e.channelUrl)&&A("number",e.scheduledMessageId)},As=function(e){i(r,e);var t=f(r);function r(){var e;return n(this,r),(e=t.apply(this,arguments)).name="message",e}return a(r,[{key:"init",value:function(e,t){var n=t.sdkState,a=t.dispatcher,i=t.sessionManager,o=t.requestQueue,u=t.logger,c=t.onlineDetector,l=t.cacheContext;v(s(r.prototype),"init",this).call(this,e,{sdkState:n,dispatcher:a,sessionManager:i,requestQueue:o,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new vs(e,{sdkState:n,dispatcher:a,requestQueue:o,onlineDetector:c,cacheContext:l})}},{key:"buildMessageFromSerializedData",value:function(e){return this._manager.buildMessageFromSerializedData(e)}},{key:"buildSenderFromSerializedData",value:function(e){return this._manager.buildSenderFromSerializedData(e)}},{key:"getMessage",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object.assign(Object.assign({},gs),e),Aa(ys(n)).throw(T.invalidParameters),t.abrupt("return",this._manager.getMessage(n));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"getScheduledMessage",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object.assign(Object.assign({},Is),e),Aa(Ns(n)).throw(T.invalidParameters),t.abrupt("return",this._manager.getScheduledMessage(n));case 3:case"end":return t.stop()}}),t,this)})))}}]),r}(ri),Ms=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.title,s=e.optionTexts,o=e.data,u=e.allowUserSuggestion,c=e.allowMultipleVotes,l=e.closeAt;return n(this,r),(a=t.call(this)).method=R.POST,a.path=Yr,a.params={title:i,options:s,data:o,allow_user_suggestion:u,allow_multiple_votes:c,close_at:l},a}return a(r)}(J),Us=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).poll=new Ui(e,a),i}return a(r)}($),Os=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelUrl,s=e.channelType,o=e.pollId;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Yr,"/").concat(encodeURIComponent(o)),a.params={channel_url:i,channel_type:s},a}return a(r)}(J),Ds=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).poll=new Ui(e,a),i}return a(r)}($),Ls=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelUrl,s=e.channelType,o=e.pollId,u=e.pollOptionId;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Yr,"/").concat(encodeURIComponent(o),"/options/").concat(encodeURIComponent(u)),a.params={channel_url:i,channel_type:s},a}return a(r)}(J),Ps=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).pollOption=new Mi(e,a),i}return a(r)}($),Fs=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelType,s=e.channelUrl,o=e.timestamp,u=e.token;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Fi(i),"/").concat(encodeURIComponent(s),"/polls/changelogs"),a.params=Z({change_ts:o,token:u}),a}return a(r)}(J),Hs=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).updatedPolls=a.updated.map((function(t){return function(e,t){return t?new Ui(e,t):null}(e,t)})),i.deletedPollIds=a.deleted.map((function(e){return e})),i.hasMore=a.has_more,i.nextToken=a.next,i}return a(r)}($),Gs={title:null,optionTexts:null,data:null,allowUserSuggestion:null,allowMultipleVotes:null,closeAt:-1},qs=function(e){return A("string",e.title)&&(t=e.optionTexts,O("string",t)&&t.every((function(e){return""!==e.trim()})))&&Ai(e.data)&&A("boolean",e.allowUserSuggestion,!0)&&A("boolean",e.allowMultipleVotes,!0)&&A("number",e.closeAt,!0);var t},js={channelUrl:null,channelType:null,pollId:null,pollOptionId:null},zs=function(t){return A("string",t.channelUrl)&&M(e.ChannelType,t.channelType)&&A("number",t.pollId)&&A("number",t.pollOptionId)},Vs={channelUrl:null,channelType:null,pollId:null},Bs=function(t){return A("string",t.channelUrl)&&""!==t.channelUrl&&M(e.ChannelType,t.channelType)&&A("number",t.pollId)},Qs={},Ks=function(){function t(e,r){var a=r.sdkState,i=r.dispatcher,s=r.sessionManager,o=r.requestQueue,u=r.logger;n(this,t),this._iid=e,this._sdkState=a,this._sessionManager=s,this._requestQueue=o,this._dispatcher=i,this._logger=u,Qs[e]=this}return a(t,[{key:"buildPollFromSerializedData",value:function(e){var t=Na(e);return new Ui(this._iid,Ui.payloadify(t))}},{key:"get",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(Bs(e)).throw(T.invalidParameters),n=new Os(Object.assign({},e)),t.next=4,this._requestQueue.send(n);case 4:return r=t.sent,a=r.as(Ds),i=a.poll,t.abrupt("return",i);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"create",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(qs(e)).throw(T.invalidParameters),n=e.data,r=new Ms(Object.assign(Object.assign({},e),{data:n})),t.next=5,this._requestQueue.send(r);case 5:return a=t.sent,i=a.as(Us),s=i.poll,t.abrupt("return",s);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"getOption",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(zs(e)).throw(T.invalidParameters),n=new Ls(Object.assign({},e)),t.next=4,this._requestQueue.send(n);case 4:return r=t.sent,a=r.as(Ps),i=a.pollOption,t.abrupt("return",i);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"getPollChangeLogs",value:function(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.MessageEventSource.SYNC_POLL_CHANGELOGS;return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,s,o,u,c,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Fs(Z({channelType:n,channelUrl:t,timestamp:"number"==typeof r?r:null,token:"string"==typeof r?r:null})),e.next=3,this._requestQueue.send(i);case 3:return s=e.sent,o=s.as(Hs),u=o.updatedPolls,c=o.deletedPollIds,l=o.hasMore,h=o.nextToken,u.length>0&&this._dispatcher.dispatch(new rs({polls:u,source:a})),e.abrupt("return",{updatedPolls:u,deletedPollIds:c,hasMore:l,token:h});case 7:case"end":return e.stop()}}),e,this)})))}}],[{key:"of",value:function(e){return Qs[e]}}]),t}(),Ws=a((function e(t,r){n(this,e),this.pollId=0,this.messageId=0,this.pollId=r.poll.id,this.messageId=r.poll.message_id,this._iid=t,this._payload=r})),Ys=a((function e(t){n(this,e),this.pollId=0,this.messageId=0,this.pollId=t.poll_id,this.messageId=t.message_id,this._payload=t})),Zs=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelUrl,s=e.channelType,o=e.token,u=e.limit;return n(this,r),(a=t.call(this)).method=R.GET,a.path=Yr,a.params={channel_url:i,channel_type:s,token:o,limit:u},a}return a(r)}(J),Xs=function(e){i(r,e);var t=f(r);function r(e,a){var i,s;return n(this,r),(i=t.call(this,e,a)).polls=(null!==(s=a.polls)&&void 0!==s?s:[]).map((function(t){return new Ui(e,t)})),i.token=a.next,i}return a(r)}($),Js=function(e){i(r,e);var t=f(r);function r(e,a){return n(this,r),t.call(this,e,a.channelUrl,a.channelType,a)}return a(r,[{key:"next",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,t=Ya.of(this._iid),n=t.requestQueue,r=new Zs(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,n.send(r);case 8:return a=e.sent,i=a.as(Xs),s=i.polls,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,e.abrupt("return",s);case 14:return e.abrupt("return",[]);case 17:throw T.queryInProgress;case 18:e.next=21;break;case 20:throw T.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),r}(Ts),$s=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelUrl,s=e.channelType,o=e.pollId,u=e.pollOptionId,c=e.token,l=e.limit;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Yr,"/").concat(encodeURIComponent(o),"/options/").concat(encodeURIComponent(u),"/voters"),a.params={channel_url:i,channel_type:s,token:c,limit:l},a}return a(r)}(J),eo=function(e){i(r,e);var t=f(r);function r(e,a){var i,s;return n(this,r),(i=t.call(this,e,a)).voters=(null!==(s=a.voters)&&void 0!==s?s:[]).map((function(t){return new Ua(e,t)})),i.token=a.next,i}return a(r)}($),to=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a.channelUrl,a.channelType,a)).pollId=a.pollId,i.pollOptionId=a.pollOptionId,i}return a(r,[{key:"_validate",value:function(){return v(s(r.prototype),"_validate",this).call(this)&&A("number",this.pollId)&&A("number",this.pollOptionId)}},{key:"next",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,t=Ya.of(this._iid),n=t.requestQueue,r=new $s(Object.assign(Object.assign({},this),{pollId:this.pollId,pollOptionId:this.pollOptionId,token:this._token})),e.next=8,n.send(r);case 8:return a=e.sent,i=a.as(eo),s=i.voters,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,e.abrupt("return",s);case 14:return e.abrupt("return",[]);case 17:throw T.queryInProgress;case 18:e.next=21;break;case 20:throw T.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),r}(Ts),no=function(e){i(r,e);var t=f(r);function r(){var e;return n(this,r),(e=t.apply(this,arguments)).name="poll",e}return a(r,[{key:"init",value:function(e,t){var n=t.sdkState,a=t.dispatcher,i=t.sessionManager,o=t.requestQueue,u=t.logger,c=t.onlineDetector,l=t.cacheContext;v(s(r.prototype),"init",this).call(this,e,{sdkState:n,dispatcher:a,sessionManager:i,requestQueue:o,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Ks(e,{sdkState:n,dispatcher:a,sessionManager:i,requestQueue:o,logger:u,onlineDetector:c,cacheContext:l})}},{key:"create",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object.assign(Object.assign({},Gs),e),Aa(qs(n)).throw(T.invalidParameters),t.abrupt("return",this._manager.create(n));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"get",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object.assign(Object.assign({},Vs),e),Aa(Bs(n)).throw(T.invalidParameters),t.abrupt("return",this._manager.get(n));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"getOption",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object.assign(Object.assign({},js),e),Aa(zs(n)).throw(T.invalidParameters),t.abrupt("return",this._manager.getOption(n));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"buildPollFromSerializedData",value:function(e){return this._manager.buildPollFromSerializedData(e)}}]),r}(ri),ro={profileImage:null,profileUrl:null,nickname:null},ao=function(e){return L(e.profileImage,!0)&&A("string",e.profileUrl,!0)&&A("string",e.nickname,!0)},io=function(e){i(r,e);var t=f(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,r),e=t.call(this),Object.keys(a).forEach((function(t){e.hasOwnProperty(t)&&(e[t]=a[t])})),e}return a(r)}(a((function e(){n(this,e),this.onSessionExpired=se,this.onSessionTokenRequired=function(e){return e(null)},this.onSessionError=se,this.onSessionRefreshed=se,this.onSessionClosed=se}))),so=function(e){i(r,e);var t=f(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,r),e=t.call(this),Object.keys(a).forEach((function(t){e.hasOwnProperty(t)&&(e[t]=a[t])})),e}return a(r)}(a((function e(){n(this,e),this.onConnected=se,this.onReconnectStarted=se,this.onReconnectSucceeded=se,this.onReconnectFailed=se,this.onDisconnected=se}))),oo=function(e){i(r,e);var t=f(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,r),e=t.call(this),Object.keys(a).forEach((function(t){e.hasOwnProperty(t)&&(e[t]=a[t])})),e}return a(r)}(a((function e(){n(this,e),this.onFriendsDiscovered=se,this.onTotalUnreadMessageCountUpdated=se}))),uo="GroupChannel",co=100,lo="Message";e.GroupChannelListOrder=void 0,(ws=e.GroupChannelListOrder||(e.GroupChannelListOrder={})).LATEST_LAST_MESSAGE="latest_last_message",ws.CHRONOLOGICAL="chronological",ws.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",ws.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical",e.PublicGroupChannelListOrder=void 0,(xs=e.PublicGroupChannelListOrder||(e.PublicGroupChannelListOrder={})).CHRONOLOGICAL="chronological",xs.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",xs.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical",e.ScheduledMessageListOrder=void 0,(Rs=e.ScheduledMessageListOrder||(e.ScheduledMessageListOrder={})).CREATED_AT="created_at",Rs.SCHEDULED_AT="scheduled_at";var ho,fo=function(t){switch(t){case e.GroupChannelListOrder.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case e.GroupChannelListOrder.CHRONOLOGICAL:return["-createdAt","syncIndex"];case e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL:return["name"]}},po=function(){function t(){n(this,t),this.messageTypeFilter=e.MessageTypeFilter.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=e.ReplyType.NONE}return a(t,[{key:"clone",value:function(){var e=new t,n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(t){e[t]=n[t]})),e}},{key:"match",value:function(t){switch(this.messageTypeFilter){case e.MessageTypeFilter.USER:if(t.messageType!==e.MessageType.USER)return!1;break;case e.MessageTypeFilter.FILE:if(t.messageType!==e.MessageType.FILE)return!1;break;case e.MessageTypeFilter.ADMIN:if(t.messageType!==e.MessageType.ADMIN)return!1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(t.customType))return!1;if(this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0){if(!(t instanceof bi))return!1;if(!this.senderUserIdsFilter.includes(t.sender.userId))return!1}switch(this.replyType){case e.ReplyType.NONE:if(t.parentMessageId>0)return!1;break;case e.ReplyType.ONLY_REPLY_TO_CHANNEL:if(t instanceof bi&&t.parentMessageId>0&&!t.replyToChannel)return!1}return!0}}]),t}();!function(e){e.CHANNEL_LATEST="channel_latest",e.NEWEST_CHILD_MESSAGE="newest_child_message"}(ho||(ho={}));var vo,mo=function(e){switch(e){case ho.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case ho.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}},_o={data:null,customType:null,mentionType:e.MentionType.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,parentMessageId:null,isReplyToChannel:!1,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null,isPinnedMessage:!1},go=function(t){return A("string",t.data,!0)&&A("string",t.customType,!0)&&M(e.MentionType,t.mentionType)&&O("string",t.mentionedUserIds,!0)&&O(Ua,t.mentionedUsers,!0)&&A("string",t.mentionedMessageTemplate,!0)&&O(pi,t.metaArrays,!0)&&A("number",t.parentMessageId,!0)&&A("boolean",t.isReplyToChannel)&&M(e.PushNotificationDeliveryOption,t.pushNotificationDeliveryOption,!0)&&A(_i,t.appleCriticalAlertOptions,!0)&&A("boolean",t.isPinnedMessage,!0)},yo=function(e){return e?{isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,pollId:e.pollId}:null},ko=Object.assign(Object.assign({},_o),{message:null,translationTargetLanguages:null,pollId:null}),Eo=function(e){var t;return Z({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,pollId:null===(t=e.poll)||void 0===t?void 0:t.id,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,message:e.message,translationTargetLanguages:Object.keys(e.translations)})},bo=function(e){return go(e)&&A("string",e.message)&&O("string",e.translationTargetLanguages,!0)&&A("number",e.pollId,!0)};!function(e){e.FILE="file",e.BLOB="blob",e.BLOB_LIKE_OBJECT="blobLikeObject",e.URL="url"}(vo||(vo={}));var wo=function(e){return"undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob},xo=function(e){return e===vo.BLOB||e===vo.FILE},Ro=function(e){return e?{file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null},Co=Object.assign(Object.assign({},_o),{file:null,fileKey:null,fileUrl:null,fileName:null,fileType:null,fileSize:null,mimeType:null,thumbnailSizes:null,requireAuth:!1}),To=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.messageParams?(!e.url&&L(n)&&(e.messageParams.file=n),e.messageParams):Z({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,file:null!=n?n:null===(t=e.messageParams)||void 0===t?void 0:t.file,fileUrl:e.url,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:e.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}}))})},So=function(e){return go(e)&&(L(e.file)||A("string",e.fileUrl))&&A("string",e.fileName,!0)&&A("string",e.mimeType,!0)&&A("number",e.fileSize,!0)&&(null===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((function(e){return A("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},Io="undefined"!=typeof document&&"undefined"!=typeof navigator;Io&&navigator.userAgent&&navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/");var No=Io&&navigator.userAgent&&navigator.userAgent.includes("Firefox/")&&!navigator.userAgent.includes("Seamonkey/");Io&&navigator.userAgent&&navigator.userAgent.includes("Safari/")&&!navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/"),Io&&navigator.userAgent&&(navigator.userAgent.includes("OPR/")||navigator.userAgent.includes("Opera/")),Io&&navigator.userAgent&&navigator.userAgent.includes("Trident/7.0");var Ao,Mo,Uo=Io&&navigator.userAgent&&navigator.userAgent.includes("Edge/"),Oo=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))};!function(e){e[e.PROCESSING=0]="PROCESSING",e[e.DONE=1]="DONE"}(Ao||(Ao={})),function(e){e.NEWNODE="newnode",e.REMOVENODE="removenode",e.CLAIM_HOST="claimhost",e.SYNC_HOST="synchost",e.REQUEST_LOCK="requestlock",e.ACQUIRE_LOCK="acquirelock",e.RELEASE_LOCK="releaselock"}(Mo||(Mo={}));var Do,Lo={},Po=function(){function e(t){var r=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n(this,e),this._state=Ao.PROCESSING,this._hostId=null,this._queue=[],this._currentItem=null,this._activationTimeout=null,this._activationQueue=[],Lo[t]&&!a.forceCreate||(this.nodeId=Oo(),this.key=t,Io&&(a.startAsInvisible?this.registerNode():"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&r.claimHost()})),window.addEventListener("message",(function(e){var t=e.data,n=t.nodeId,a=t.requestId,i=t.key,s=t.op,o=t.data;if(n!==r.nodeId&&i===r.key)switch(s){case Mo.NEWNODE:r._sendSync();break;case Mo.CLAIM_HOST:r._sendSync(),r._hostId=n;break;case Mo.SYNC_HOST:if(!r.isInSync){r._activationTimeout&&clearTimeout(r._activationTimeout);var u,c=o.currentItemRequestId,l=k(o.queue);try{var h=function(){var e=u.value,t=r._queue.findIndex((function(t){return t.requestId===e.requestId}));t<0&&r._requestLock({nodeId:e.nodeId,requestId:e.requestId,key:r.key,op:Mo.REQUEST_LOCK,ts:e.ts})};for(l.s();!(u=l.n()).done;)h()}catch(e){l.e(e)}finally{l.f()}r._currentItem=r._queue.find((function(e){return e.requestId===c})),r._completeSync()}break;case Mo.REMOVENODE:r._queue=r._queue.filter((function(e){return e.nodeId!==t.nodeId})),r._currentItem&&r._currentItem.nodeId===t.nodeId&&(r._currentItem=null,r._acquire(r._queue[0]));break;case Mo.REQUEST_LOCK:r._requestLock(t);break;case Mo.ACQUIRE_LOCK:var d=r._queue.find((function(e){return e.requestId===a}));r._acquire(d);break;case Mo.RELEASE_LOCK:r._release(a)}})),window.addEventListener("beforeunload",(function(){r._send(Mo.REMOVENODE)}))),Lo[t]=this),Lo[t]}return a(e,[{key:"locked",get:function(){return!!this._currentItem}},{key:"isHost",get:function(){return this._hostId===this.nodeId}},{key:"isInSync",get:function(){return this._state==Ao.DONE}},{key:"_send",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={nodeId:this.nodeId,requestId:null!==(t=null==r?void 0:r.requestId)&&void 0!==t?t:Oo(),key:this.key,op:e,data:null!==(n=r.data)&&void 0!==n?n:null,ts:Date.now()};return Io&&window.postMessage(a,"*"),a}},{key:"_acquire",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?(this._currentItem=e,this._currentItem.onAcquired(e.requestId)):this._currentItem=null}},{key:"_release",value:function(e){if(this._currentItem&&this._currentItem.requestId===e){var t=this._currentItem;this._currentItem=null,t.nodeId===this.nodeId&&this._send(Mo.RELEASE_LOCK,{requestId:t.requestId});var n=this._queue.findIndex((function(t){return t.requestId===e}));n>-1&&this._queue.splice(n,1),t.onReleased(e)}}},{key:"_requestLock",value:function(e){var t=this;return new Promise((function(n){var r={nodeId:e.nodeId,requestId:e.requestId,ts:e.ts,onAcquired:function(e){t.isHost&&t._send(Mo.ACQUIRE_LOCK,{requestId:e}),n()},onReleased:function(){t._acquire(t._queue[0])}},a=!1;for(var i in t._queue)if(t._queue[i].ts>r.ts){t._queue.splice(parseInt(i),0,r),a=!0;break}a||t._queue.push(r),t._currentItem||t._acquire(t._queue[0])}))}},{key:"_sendSync",value:function(){var e;this.isHost&&this._send(Mo.SYNC_HOST,{data:{currentItemRequestId:null===(e=this._currentItem)||void 0===e?void 0:e.requestId,queue:this._queue.map((function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}}))}})}},{key:"_waitUntilSyncCompleted",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isHost||this.isInSync){e.next=2;break}return e.abrupt("return",new Promise((function(e){t._activationQueue.push(e)})));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"_waitSync",value:function(){var e=this;this.isInSync||(this._activationTimeout=setTimeout((function(){e._completeSync()}),8))}},{key:"_completeSync",value:function(){this.isInSync||(this._state=Ao.DONE,this._activationQueue.forEach((function(e){return e()})),this._activationQueue=[])}},{key:"registerNode",value:function(){this._send(Mo.NEWNODE),this._waitSync()}},{key:"claimHost",value:function(){this._hostId=this.nodeId,this._send(Mo.CLAIM_HOST),this._waitSync()}},{key:"lock",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._waitUntilSyncCompleted();case 2:return t=this._send(Mo.REQUEST_LOCK),e.next=5,this._requestLock(t);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"unlock",value:function(){var e;this._release(null===(e=this._currentItem)||void 0===e?void 0:e.requestId)}}]),e}(),Fo=Object.assign(Object.assign({},ko),{scheduledAt:null}),Ho=Object.assign(Object.assign({},_o),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1}),Go="UnsentMessage",qo={},jo=function(e){i(r,e);var t=f(r);function r(e,a){var i,s=a.sdkState,o=a.cacheContext;return n(this,r),(i=t.call(this,e))._sdkState=s,i._cacheContext=o,qo[e]=h(i),i._mutex=new Po("unsendmessagecache.lock"),i}return a(r,[{key:"collection",get:function(){var e=this._cacheContext.nestdb;return e&&e.collection(Go)}},{key:"localCacheEnabled",get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection}},{key:"_serialize",value:function(e){if(e.messageId>0)throw T.invalidParameters;var t,n=Object.assign({},e.serialize());return e instanceof Oi?(e.messageParams&&(n.messageParams=yo(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,Object.assign(Object.assign({},yo(t)),{scheduledAt:t.scheduledAt})))):e instanceof Pi&&(e.messageParams&&(n.messageParams=Ro(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=function(e){return Object.assign(Object.assign({},Ro(e)),{scheduledAt:e.scheduledAt})}(e.scheduledInfo.scheduledMessageParams))),n}},{key:"_deserialize",value:function(e){return e?(e=Object.assign(Object.assign({},e),{messageId:parseInt(e.messageId)}),vs.of(this._iid).buildMessageFromSerializedData(e)):null}},{key:"_deserializeWithMessageCreateParams",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=vs.of(this._iid),r=this._deserialize(e),!e.messageParams){t.next=15;break}if(!(r instanceof Oi)){t.next=8;break}a=e.messageParams,r.messageParams=n.buildUserMessageCreateParamsFromSerializedData(a,r),t.next=15;break;case 8:if(!(r instanceof Pi)){t.next=15;break}if(!(i=e.messageParams).fileKey||"string"!=typeof i.fileKey||!xo(i.fileType)){t.next=14;break}return t.next=13,this.collection.getBlob(i.fileKey);case 13:i.file=t.sent;case 14:r.messageParams=n.buildFileMessageCreateParamsFromSerializedData(i,r);case 15:if(!(r.scheduledInfo&&e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams)){t.next=28;break}if(!(r instanceof Oi)){t.next=21;break}s=e.scheduledInfo.scheduledMessageParams,r.scheduledInfo.scheduledMessageParams=n.buildScheduledUserMessageCreateParamsFromSerializedData(s,r),t.next=28;break;case 21:if(!(r instanceof Pi)){t.next=28;break}if(!(o=e.scheduledInfo.scheduledMessageParams).fileKey||"string"!=typeof o.fileKey||!xo(o.fileType)){t.next=27;break}return t.next=26,this.collection.getBlob(o.fileKey);case 26:o.file=t.sent;case 27:r.scheduledInfo.scheduledMessageParams=n.buildScheduledFileMessageCreateParamsFromSerializedData(o,r);case 28:return t.abrupt("return",r);case 29:case"end":return t.stop()}}),t,this)})))}},{key:"get",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=6;break}return t.next=3,this.collection.getByKey("".concat(e));case 3:if(!(n=t.sent)){t.next=6;break}return t.abrupt("return",this._deserializeWithMessageCreateParams(n));case 6:return t.abrupt("return",null);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"fetch",value:function(e){var t=e.channelUrl,n=void 0===t?null:t,r=e.filter,a=void 0===r?new po:r,i=e.order,s=void 0===i?ho.CHANNEL_LATEST:i,o=e.sendingStatus,u=void 0===o?null:o,c=e.backward,l=void 0!==c&&c,h=e.parentMessageId,d=void 0===h?null:h;return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,r,i,o,c,h=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.localCacheEnabled){e.next=13;break}return t=mo(s),r={"/where":function(e){return!!(s!==ho.NEWEST_CHILD_MESSAGE||d&&0!==e.parentMessageId&&e.parentMessageId===d)&&a.match(h._deserialize(e))}},n&&(r.channelUrl=n),u&&(r.sendingStatus=u),i={where:r,index:t,backward:l},e.next=8,this.collection.query(i);case 8:return o=e.sent,e.next=11,o.fetch({});case 11:return c=e.sent,e.abrupt("return",Promise.all(c.map((function(e){return E(h,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._deserializeWithMessageCreateParams(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}))));case 13:return e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e,this)})))}},{key:"getAllChildMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new po;return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.fetch({filter:t,order:ho.NEWEST_CHILD_MESSAGE,channelUrl:e.channelUrl,backward:!1,parentMessageId:e.messageId});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"upsert",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=3;break}return t.next=3,Promise.all(e.map((function(e){return E(n,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof Pi)){t.next=7;break}return t.next=3,this._mutex.lock();case 3:return t.next=5,this.saveBlob(e);case 5:return t.next=7,this._mutex.unlock();case 7:return n=this._serialize(e),t.next=10,this.collection.upsertOne(n);case 10:case"end":return t.stop()}}),t,this)})))})));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"upsertChildMessages",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=3;break}return t.next=3,Promise.all(e.map((function(e){return E(n,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=[],!((null===(n=e.threadInfo)||void 0===n?void 0:n.replyCount)>0)){t.next=5;break}return t.next=4,this.getAllChildMessages(e);case 4:r=t.sent;case 5:if(!(r.length>0)){t.next=9;break}return r.forEach((function(t){return t.applyParentMessage(e)})),t.next=9,this.upsert(r);case 9:case"end":return t.stop()}}),t,this)})))})));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"remove",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=18;break}n=k(e),t.prev=2,n.s();case 4:if((r=n.n()).done){t.next=10;break}return a=r.value,t.next=8,this.collection.remove(a);case 8:t.next=4;break;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),n.e(t.t0);case 15:return t.prev=15,n.f(),t.finish(15);case 18:case"end":return t.stop()}}),t,this,[[2,12,15,18]])})))}},{key:"removeMessagesOfChannel",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=3;break}return t.next=3,this.collection.removeIf({where:{channelUrl:e}});case 3:case"end":return t.stop()}}),t,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.localCacheEnabled){e.next=3;break}return e.next=3,this.collection.clear();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"saveBlob",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof Pi)){t.next=17;break}if(!e.messageParams){t.next=9;break}if(!(n=e.messageParams).file||!wo(n.file)){t.next=9;break}return t.next=6,this.collection.saveBlob(n.file,e.reqId);case 6:r=t.sent,n.fileKey=r,n.fileType=vo.BLOB;case 9:if(!e.scheduledInfo||!e.scheduledInfo.scheduledMessageParams){t.next=17;break}if(!(a=e.scheduledInfo.scheduledMessageParams).file||!wo(a.file)){t.next=17;break}return t.next=14,this.collection.saveBlob(a.file,e.reqId);case 14:i=t.sent,a.fileKey=i,a.fileType=vo.BLOB;case 17:case"end":return t.stop()}}),t,this)})))}}],[{key:"of",value:function(e){return qo[e]}}]),r}(ba),zo=function(t,n){return function(r,a){if(1===r)t.clear().then((function(){n.clear().then((function(){(function(t){return E(void 0,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t.commitSchema([{collectionName:uo,keyName:"url",index:[fo(e.GroupChannelListOrder.LATEST_LAST_MESSAGE),fo(e.GroupChannelListOrder.CHRONOLOGICAL),fo(e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:lo,keyName:"messageId",index:[mo(ho.CHANNEL_LATEST),mo(ho.NEWEST_CHILD_MESSAGE)]},{collectionName:Go,keyName:"reqId",index:[mo(ho.CHANNEL_LATEST),mo(ho.NEWEST_CHILD_MESSAGE)]},{collectionName:"Poll",keyName:"pollId"}]));case 1:case"end":return n.stop()}}),n)})))})(t).then((function(){return a()})).catch((function(e){return a(e)}))})).catch((function(e){return a(e)}))})).catch((function(e){return a(e)}));else a()}},Vo={},Bo=function(e){i(r,e);var t=f(r);function r(e,a){var i,s=a.sdkState,o=a.cacheContext,u=a.unsentMessageCache;return n(this,r),(i=t.call(this,e))._sdkState=s,i._cacheContext=o,i._unsentMessageCache=u,Vo[e]=h(i),i}return a(r,[{key:"collection",get:function(){var e=this._cacheContext.nestdb;return e?e.collection(lo):null}},{key:"localCacheEnabled",get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection}},{key:"_serialize",value:function(e){return Object.assign(Object.assign({},e.serialize()),{messageId:"".concat(e.messageId)})}},{key:"_deserialize",value:function(e){return e=Object.assign(Object.assign({},e),{messageId:parseInt(e.messageId)}),vs.of(this._iid).buildMessageFromSerializedData(e)}},{key:"get",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=6;break}return t.next=3,this.collection.getByKey("".concat(e));case 3:if(!(n=t.sent)){t.next=6;break}return t.abrupt("return",this._deserialize(n));case 6:return t.abrupt("return",null);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"fetch",value:function(e){var t=e.channelUrl,n=e.token,r=e.limit,a=void 0===r?co:r,i=e.filter,s=void 0===i?new po:i,o=e.order,u=void 0===o?ho.CHANNEL_LATEST:o,c=e.backward,l=void 0!==c&&c,h=e.parentMessageId,d=void 0===h?null:h,f=e.isPollOnly,p=void 0!==f&&f;return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var r,i,o,c,h=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.localCacheEnabled){e.next=10;break}return r=mo(u),i={where:{channelUrl:t,"/where":function(e){if(n)switch(u){case ho.CHANNEL_LATEST:if(!l&&e.createdAt>n||l&&e.createdAt<n)return!1;break;case ho.NEWEST_CHILD_MESSAGE:if(!d||0===e.parentMessageId||e.parentMessageId!==d)return!1}return!(p&&!e._poll)&&s.match(h._deserialize(e))}},index:r,backward:l},e.next=5,this.collection.query(i);case 5:return o=e.sent,e.next=8,o.fetch({limit:a});case 8:return c=e.sent,e.abrupt("return",Promise.all(c.map((function(e){return E(h,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._deserialize(e));case 1:case"end":return t.stop()}}),t,this)})))}))));case 10:return e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,this)})))}},{key:"getAllChildMessages",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new po;return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.fetch({channelUrl:e.channelUrl,token:Date.now(),limit:null,backward:!1,filter:t,order:ho.NEWEST_CHILD_MESSAGE,parentMessageId:e.messageId});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"upsert",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=10;break}return t.next=3,this.saveBlobs(e);case 3:return n=e.map((function(e){return r._serialize(e)})),t.next=6,this.collection.upsertMany(n);case 6:return t.next=8,this.upsertChildMessages(e);case 8:return t.next=10,this._unsentMessageCache.upsertChildMessages(e);case 10:case"end":return t.stop()}}),t,this)})))}},{key:"upsertChildMessages",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=3;break}return t.next=3,Promise.all(e.map((function(e){return E(n,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=[],!((null===(n=e.threadInfo)||void 0===n?void 0:n.replyCount)>0)){t.next=5;break}return t.next=4,this.getAllChildMessages(e);case 4:r=t.sent;case 5:if(!(r.length>0)){t.next=9;break}return r.forEach((function(t){return t.applyParentMessage(e)})),t.next=9,this.upsert(r);case 9:case"end":return t.stop()}}),t,this)})))})));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"remove",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=18;break}n=k(e),t.prev=2,n.s();case 4:if((r=n.n()).done){t.next=10;break}return a=r.value,t.next=8,this.collection.remove("".concat(a));case 8:t.next=4;break;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),n.e(t.t0);case 15:return t.prev=15,n.f(),t.finish(15);case 18:case"end":return t.stop()}}),t,this,[[2,12,15,18]])})))}},{key:"removeMessagesOfChannel",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=12;break}return t.next=3,this.collection.removeIf({where:{channelUrl:e},index:mo(ho.CHANNEL_LATEST)});case 3:return n=this._cacheContext.preference,t.next=6,n.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"));case 6:return t.next=8,n.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"));case 8:return t.next=10,n.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"));case 10:return t.next=12,n.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"));case 12:case"end":return t.stop()}}),t,this)})))}},{key:"removeUnderOffset",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.localCacheEnabled){n.next=3;break}return n.next=3,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":t}},index:mo(ho.CHANNEL_LATEST)});case 3:case"end":return n.stop()}}),n,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.localCacheEnabled){e.next=3;break}return e.next=3,this.collection.clear();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"countBetween",value:function(e,t,n){return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){var a,i,s=this;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!this.localCacheEnabled){r.next=6;break}return a=mo(ho.CHANNEL_LATEST),i=this.collection.query({where:{channelUrl:e,"/where":function(e){var r=s._deserialize(e);return n.includes(r.createdAt)&&t.match(r)}},index:a}),r.next=5,i.count();case 5:return r.abrupt("return",r.sent);case 6:return r.abrupt("return",0);case 7:case"end":return r.stop()}}),r,this)})))}},{key:"saveBlobs",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(e.map((function(e){return E(n,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof Pi&&e.messageParams)){t.next=7;break}if(!(n=e.messageParams).file||!wo(n.file)){t.next=7;break}return t.next=5,this.collection.saveBlob(n.file,e.reqId);case 5:r=t.sent,n.fileKey=r;case 7:case"end":return t.stop()}}),t,this)})))})));case 2:case"end":return t.stop()}}),t)})))}}],[{key:"of",value:function(e){return Vo[e]}}]),r}(ba),Qo=function(e){i(r,e);var t=f(r);function r(){var e,a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return n(this,r),(e=t.call(this))._pauseDelayTimer=null,e._currentState="visible",e._isEnabled=a,e._toggleState=e._toggleState.bind(h(e)),e}return a(r,[{key:"isAvailable",get:function(){return"undefined"!=typeof window&&!!window.addEventListener&&!!window.removeEventListener}},{key:"_toggleState",value:function(){var e=this;"hidden"!==document.visibilityState?"hidden"===this._currentState&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=null),this.dispatch("resume")):"hidden"!==this._currentState&&(this._pauseDelayTimer=setTimeout((function(){e._pauseDelayTimer=null,e.dispatch("pause")}),3e4)),this._currentState=document.visibilityState}},{key:"start",value:function(){this._isEnabled&&this.isAvailable&&window.addEventListener("visibilitychange",this._toggleState,{capture:!0})}},{key:"stop",value:function(){this._isEnabled&&this.isAvailable&&window.removeEventListener("visibilitychange",this._toggleState,{capture:!0})}}]),r}(K),Ko=function(){function e(t){var r=this,a=t.logger,i=t.connectionDelegate,s=void 0===i?null:i;n(this,e),this._onlineWorker=function(){var e;return null===(e=r.connectionDelegate)||void 0===e?void 0:e.reconnect()},this._offlineWorker=function(){var e;return null===(e=r.connectionDelegate)||void 0===e?void 0:e.disconnect()},this.unsubscribes=[],this._onlineListener=function(e){if(r.isAvailableOnWeb)return window.addEventListener("online",e),function(){return window.removeEventListener("online",e,!1)}},this._offlineListener=function(e){if(r.isAvailableOnWeb)return window.addEventListener("offline",e),function(){return window.removeEventListener("offline",e,!1)}},this.logger=a,s&&(this.connectionDelegate=s)}return a(e,[{key:"isAvailableOnWeb",get:function(){return"undefined"!=typeof window&&window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&void 0!==navigator.onLine}},{key:"setOnlineListener",value:function(e){Boolean(e)&&"function"==typeof e&&(this._onlineListener=e)}},{key:"setOfflineListener",value:function(e){Boolean(e)&&"function"==typeof e&&(this._offlineListener=e)}},{key:"start",value:function(){this.unsubscribes=[this._onlineListener(this._onlineWorker),this._offlineListener(this._offlineWorker)]}},{key:"stop",value:function(){var e=this;this.unsubscribes.forEach((function(t){try{null==t||t()}catch(t){e.logger.warn(t.message)}})),this.unsubscribes=[]}},{key:"isOnline",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isAvailableOnWeb){e.next=4;break}return e.abrupt("return",navigator.onLine);case 4:return e.abrupt("return",new Promise((function(e){fetch("https://www.google.com",{method:R.GET,mode:"no-cors"}).then((function(){return e(!0)})).catch((function(){return e(!1)}))})));case 5:case"end":return e.stop()}}),e,this)})))}}]),e}(),Wo=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.message;return n(this,r),(a=t.call(this)).message=i,a}return a(r)}(Y),Yo={},Zo=function(){function t(e,r){var a=this,i=r.localCacheEnabled,s=r.dispatcher,o=r.sdkState,u=r.logger;n(this,t),Yo[e]=this,this._iid=e,Yo[e]=this,this._localCacheEnabled=i,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=s,this._logger=u,this._sdkState=o,this._localCacheEnabled&&s.on((function(e){if(e instanceof Or)switch(e.stateType){case Tr.CONNECTED:a._isProcessingAutoResend||a.processAutoResendRegisteredPendingMessages().then((function(){return a._processNextAutoResend()}));break;case Tr.INTERNAL_DISCONNECTED:case Tr.EXTERNAL_DISCONNECTED:a._isProcessingAutoResend=!1}}))}return a(t,[{key:"processNonAutoResendRegisteredPendingMessages",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._fetchAllCachedPendingMessages();case 2:n=t.sent,r=k(n);try{for(r.s();!(a=r.n()).done;)0===(i=a.value).errorCode&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",i.reqId),i.sendingStatus=e.SendingStatus.FAILED,i.errorCode=b.ACK_TIMEOUT,this._dispatcher.dispatch(new es({messages:[i],source:e.MessageEventSource.LOCAL_MESSAGE_FAILED})))}catch(e){r.e(e)}finally{r.f()}case 5:case"end":return t.stop()}}),t,this)})))}},{key:"processAutoResendRegisteredPendingMessages",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._fetchAllCachedPendingMessages();case 2:n=t.sent,r=k(n);try{for(r.s();!(a=r.n()).done;)(i=a.value).errorCode&&D(i.errorCode)&&(s=(new Date).getTime(),o=i.createdAt+2592e5,s<=o?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(i.reqId)<0&&this._autoResendQueue.push(i):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(o).toLocaleString()),i.sendingStatus=e.SendingStatus.FAILED,this._dispatcher.dispatch(new es({messages:[i],source:e.MessageEventSource.LOCAL_MESSAGE_FAILED}))))}catch(e){r.e(e)}finally{r.f()}case 5:case"end":return t.stop()}}),t,this)})))}},{key:"completeCurrentAndProcessNextAutoResend",value:function(t){if(this._localCacheEnabled&&(t.sendingStatus===e.SendingStatus.SUCCEEDED||t.sendingStatus===e.SendingStatus.FAILED&&!D(t.errorCode))){var n=this.indexOf(t);n>=0&&this._autoResendQueue.splice(n,1),0===n&&this._processNextAutoResend()}}},{key:"_fetchAllCachedPendingMessages",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=jo.of(this._iid))){t.next=7;break}return t.next=4,n.fetch({sendingStatus:e.SendingStatus.PENDING,backward:!0});case 4:t.t0=t.sent,t.next=8;break;case 7:t.t0=[];case 8:return t.abrupt("return",t.t0);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"indexOf",value:function(e){return this._autoResendQueue.length>0?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId):-1}},{key:"_isNotInQueue",value:function(e){return-1===this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId)}},{key:"_processNextAutoResend",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._localCacheEnabled&&"foreground"===this._sdkState.appState)try{this._autoResendQueue.length>0?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),t=this._autoResendQueue[0],this._dispatcher.dispatch(new Wo({message:t})),this._logger.debug("processing auto-resend for message request id: ",t.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1)}catch(e){this._logger.warn("process auto-resend error: ",e),this._isProcessingAutoResend=!1}case 1:case"end":return e.stop()}}),e,this)})))}}],[{key:"of",value:function(e){return Yo[e]}}]),t}();!function(e){e[e.USER_BLOCK=20001]="USER_BLOCK",e[e.USER_UNBLOCK=2e4]="USER_UNBLOCK",e[e.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED"}(Do||(Do={}));var Xo,Jo=function(){function e(t){n(this,e),this.category=t.cat,this.data=t.data}return a(e,null,[{key:"getDataAsUserBlockEvent",value:function(e,t){var n=t.data,r=n.blocker,a=n.blockee;return{blocker:new Ua(e,r),blockee:new Ua(e,a)}}},{key:"getDataAsFriendDiscoveredEvent",value:function(e,t){var n=t.data.friend_discoveries;return{friendDiscoveries:Array.isArray(n)?n.map((function(t){return new Ua(e,t)})):[]}}}]),e}(),$o=function(e){i(r,e);var t=f(r);function r(e,a){var i,s=a.userId;return n(this,r),(i=t.call(this))._iid=e,i.userId=s,i}return a(r)}(Y),eu=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"USEV",i)).event=new Jo(i),s}return a(r)}(ie),tu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.nickname,o=void 0===s?null:s,u=e.profileUrl,c=void 0===u?null:u,l=e.profileImage,h=void 0===l?null:l,d=e.preferredLanguages,f=void 0===d?null:d;return n(this,r),(a=t.call(this)).method=R.PUT,a.path="".concat(Hr,"/").concat(encodeURIComponent(i)),a.params=Z({nickname:o,profile_url:c,profile_file:h,preferred_languages:f}),a}return a(r)}(J),nu=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).user=null,i.user=new Ua(e,Object.assign({},a)),i}return a(r)}($),ru=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.token;return n(this,r),(a=t.call(this)).method=R.POST,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/push/apns"),a.params={apns_device_token:s,always_push:!0},a}return a(r)}(J),au=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.token;return n(this,r),(a=t.call(this)).method=R.POST,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/push/gcm"),a.params={gcm_reg_token:s,always_push:!0},a}return a(r)}(J),iu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.token;return n(this,r),(a=t.call(this)).method=R.DELETE,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/push/apns/").concat(encodeURIComponent(s)),a}return a(r)}(J),su=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.token;return n(this,r),(a=t.call(this)).method=R.DELETE,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/push/gcm/").concat(encodeURIComponent(s)),a}return a(r)}(J),ou=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId;return n(this,r),(a=t.call(this)).method=R.DELETE,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/push/apns"),a}return a(r)}(J),uu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId;return n(this,r),(a=t.call(this)).method=R.DELETE,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/push/gcm"),a}return a(r)}(J),cu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.type,o=e.token,u=e.ts;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/push/").concat(encodeURIComponent(s),"/device_tokens"),a.params={created_ts:u,token:o},a}return a(r)}(J),lu=function(t){i(s,t);var r=f(s);function s(t,a){var i;return n(this,s),(i=r.call(this,t,a)).pushTokens={type:a.type?e.PushTokenType[a.type.toLowerCase()]:e.PushTokenType.UNKNOWN,deviceTokens:a.device_tokens,hasMore:a.has_more,token:a.token},i}return a(s)}($),hu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/channel_invitation_preference"),a}return a(r)}(J),du=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).autoAccept=a.auto_accept,i}return a(r)}($),fu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.willAutoAccept;return n(this,r),(a=t.call(this)).method=R.PUT,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/channel_invitation_preference"),a.params={auto_accept:s},a}return a(r)}(J),pu=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).autoAccept=a.auto_accept,i}return a(r)}($),vu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/push_preference"),a}return a(r)}(J),mu=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).preference={doNotDisturbOn:a.do_not_disturb,startHour:a.start_hour,startMin:a.start_min,endHour:a.end_hour,endMin:a.end_min,timezone:a.timezone},i}return a(r)}($),_u=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.doNotDisturbOn,o=e.startHour,u=e.startMin,c=e.endHour,l=e.endMin,h=e.timezone;return n(this,r),(a=t.call(this)).method=R.PUT,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/push_preference"),a.params={do_not_disturb:s,start_hour:o,start_min:u,end_hour:c,end_min:l,timezone:h},a}return a(r)}(J),gu=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).preference={doNotDisturbOn:a.do_not_disturb,startHour:a.start_hour,startMin:a.start_min,endHour:a.end_hour,endMin:a.end_min,timezone:a.timezone},i}return a(r)}($),yu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/push_preference"),a}return a(r)}(J),ku=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).snoozePeriod={isSnoozeOn:a.snooze_enabled},"number"==typeof a.snooze_start_ts&&(i.snoozePeriod.startTs=a.snooze_start_ts),"number"==typeof a.snooze_end_ts&&(i.snoozePeriod.endTs=a.snooze_end_ts),i}return a(r)}($),Eu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.snoozeOn,o=e.startTs,u=e.endTs;return n(this,r),(a=t.call(this)).method=R.PUT,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/push_preference"),a.params={snooze_enabled:s,snooze_start_ts:o,snooze_end_ts:u},a}return a(r)}(J),bu=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).snoozePeriod={isSnoozeOn:a.snooze_enabled},"number"==typeof a.snooze_start_ts&&(i.snoozePeriod.startTs=a.snooze_start_ts),"number"==typeof a.snooze_end_ts&&(i.snoozePeriod.endTs=a.snooze_end_ts),i}return a(r)}($),wu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.blockedUserId;return n(this,r),(a=t.call(this)).method=R.POST,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/block"),a.params={target_id:s},a}return a(r)}(J),xu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.unblockedUserId;return n(this,r),(a=t.call(this)).method=R.DELETE,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/block/").concat(encodeURIComponent(s)),a}return a(r)}(J),Ru=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/push_preference"),a}return a(r)}(J),Cu=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).pushTriggerOption=a.push_trigger_option,i}return a(r)}($),Tu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.pushTriggerOption;return n(this,r),(a=t.call(this)).method=R.PUT,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/push_preference"),a.params={push_trigger_option:s},a}return a(r)}(J),Su=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).pushTriggerOption=a.push_trigger_option,i}return a(r)}($),Iu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/push/template"),a}return a(r)}(J),Nu=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).name=a.name,i}return a(r)}($),Au=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.templateName;return n(this,r),(a=t.call(this)).method=R.PUT,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/push/template"),a.params={name:s},a}return a(r)}(J),Mu=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).name=a.name,i}return a(r)}($),Uu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.token;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/friends/changelogs"),a.params={token:s},a}return a(r)}(J),Ou=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).changelogs={addedUsers:a.added.map((function(t){return new Ua(e,t)})),updatedUsers:a.updated.map((function(t){return new Ua(e,t)})),deletedUserIds:a.deleted,hasMore:a.has_more,token:a.next},i}return a(r)}($),Du=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.discoveries;return n(this,r),(a=t.call(this)).method=R.PUT,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/friend_discoveries"),a.params={friend_discoveries:s.map((function(e){return{friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName}}))},a}return a(r)}(J),Lu=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).friendDiscoveryRequestId=a.friend_discovery_request_id,i}return a(r)}($),Pu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.discoveryKeys;return n(this,r),(a=t.call(this)).method=R.DELETE,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/friend_discoveries"),a.params={friend_discovery_keys:s},a}return a(r)}(J),Fu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.userIds;return n(this,r),(a=t.call(this)).method=R.POST,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/friends"),a.params={user_ids:s},a}return a(r)}(J),Hu=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).users=a.users.map((function(t){return new Ua(e,t)})),i}return a(r)}($),Gu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.userIds;return n(this,r),(a=t.call(this)).method=R.DELETE,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/friends"),a.params={user_ids:s},a}return a(r)}(J),qu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Hr,"/").concat(i,"/allow_friend_discovery"),a.params={},a}return a(r)}(J),ju=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).allowFriendDiscovery=a.allow_friend_discovery,i}return a(r)}($),zu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.allowFriendDiscovery;return n(this,r),(a=t.call(this)).method=R.PUT,a.path="".concat(Hr,"/").concat(i,"/allow_friend_discovery"),a.params={allow_friend_discovery:s},a}return a(r)}(J),Vu=a((function e(t){n(this,e),this.key=null,this.url=null,this.key=t.key,this.url=t.url})),Bu=a((function e(t){var r,a,i;n(this,e),this.id=0,this.name=null,this.url=null,this.emojis=[],this.id=null!==(r=t.id)&&void 0!==r?r:0,this.name=null!==(a=t.name)&&void 0!==a?a:"",this.url=null!==(i=t.url)&&void 0!==i?i:"",this.emojis=t.emojis?t.emojis.map((function(e){return new Vu(e)})):[]})),Qu=a((function e(t){n(this,e),this.emojiHash=null,this.emojiCategories=[],this.emojiHash=t.emoji_hash||"",this.emojiCategories=t.emoji_categories?t.emoji_categories.map((function(e){return new Bu(e)})):[]})),Ku=function(e){i(r,e);var t=f(r);function r(){var e;return n(this,r),(e=t.call(this)).method=R.GET,e.path=Wr,e}return a(r)}(J),Wu=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).emojiContainer=new Qu(a),i}return a(r)}($),Yu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.categoryId;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Wr,"/").concat(i),a}return a(r)}(J),Zu=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).emojiCategory=new Bu(a),i}return a(r)}($),Xu=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.key;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Kr,"/").concat(i),a}return a(r)}(J),Ju=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).emoji=new Vu(a),i}return a(r)}($),$u=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.limit,s=e.token,o=e.userIdsFilter,u=e.metaDataKeyFilter,c=e.metaDataValuesFilter,l=e.nicknameStartsWithFilter;return n(this,r),(a=t.call(this)).method=R.GET,a.path=Hr,a.params=Z({limit:i,token:s,user_ids:o,metadatakey:u,metadatavalues_in:c,nickname_startswith:l}),a}return a(r)}(J),ec=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).users=a.users.map((function(t){return new Ua(e,t)})),i.next=a.next,i}return a(r)}($),tc=function(e){i(r,e);var t=f(r);function r(e,a){var i,s,o,u;return n(this,r),(i=t.call(this,e,a)).userIdsFilter=null,i.metaDataKeyFilter=null,i.metaDataValuesFilter=null,i.nicknameStartsWithFilter=null,i.userIdsFilter=null!==(s=a.userIdsFilter)&&void 0!==s?s:null,i.metaDataKeyFilter=null!==(o=a.metaDataKeyFilter)&&void 0!==o?o:null,i.metaDataValuesFilter=null!==(u=a.metaDataValuesFilter)&&void 0!==u?u:null,i.nicknameStartsWithFilter=a.nicknameStartsWithFilter||null,i}return a(r,[{key:"_validate",value:function(){return v(s(r.prototype),"_validate",this).call(this)&&O("string",this.userIdsFilter,!0)&&A("string",this.metaDataKeyFilter,!0)&&O("string",this.metaDataValuesFilter,!0)&&A("string",this.metaDataKeyFilter,!0)}},{key:"next",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,t=Ya.of(this._iid),n=t.requestQueue,r=new $u(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,n.send(r);case 8:return a=e.sent,i=a.as(ec),s=i.users,o=i.next,this._token=o,this._hasNext=!!o,this._isLoading=!1,e.abrupt("return",s);case 14:return e.abrupt("return",[]);case 17:throw T.queryInProgress;case 18:e.next=21;break;case 20:throw T.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),r}(ks),nc=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.limit,o=e.token,u=e.userIdsFilter;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Hr,"/").concat(i,"/block"),a.params=Z({limit:s,token:o,user_ids:u}),a}return a(r)}(J),rc=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).users=a.users.map((function(t){return new Ua(e,t)})),i.next=a.next,i}return a(r)}($),ac=function(e){i(r,e);var t=f(r);function r(e,a){var i,s;return n(this,r),(i=t.call(this,e,a)).userIdsFilter=null,i.userIdsFilter=null!==(s=a.userIdsFilter)&&void 0!==s?s:null,i}return a(r,[{key:"_validate",value:function(){return v(s(r.prototype),"_validate",this).call(this)&&O("string",this.userIdsFilter,!0)}},{key:"next",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,t=Ya.of(this._iid),n=t.sdkState,r=t.requestQueue,a=new nc(Object.assign(Object.assign({},this),{userId:n.userId,token:this._token})),e.next=8,r.send(a);case 8:return i=e.sent,s=i.as(rc),o=s.users,u=s.next,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw T.queryInProgress;case 18:e.next=21;break;case 20:throw T.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),r}(ks),ic=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.limit,o=e.token;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/friends"),a.params={limit:s,token:o},a}return a(r)}(J),sc=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).hasMore=a.has_more,i.users=a.users.map((function(t){return new Ua(e,t)})),i.next=a.next,i}return a(r)}($),oc=function(e){i(r,e);var t=f(r);function r(){return n(this,r),t.apply(this,arguments)}return a(r,[{key:"_validate",value:function(){return v(s(r.prototype),"_validate",this).call(this)}},{key:"next",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,t=Ya.of(this._iid),n=t.sdkState,r=t.requestQueue,a=new ic(Object.assign(Object.assign({},this),{userId:n.userId,token:this._token})),e.next=8,r.send(a);case 8:return i=e.sent,s=i.as(sc),o=s.users,u=s.hasMore,c=s.next,this._token=c,this._hasNext=u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw T.queryInProgress;case 18:e.next=21;break;case 20:throw T.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),r}(ks),uc={},cc=function(){function e(t){var r=t.dbname,a=t.itemSizeLimit,i=void 0===a?1048576:a,s=t.cacheLimit,o=void 0===s?256:s,u=t.blockHashBase,c=void 0===u?2:u,l=t.blockHashMultiplier,h=void 0===l?10:l,d=t.blockHashConstant,f=void 0===d?11:d,p=t.transactionApplyDelay,v=void 0===p?200:p,m=t.disableLogger,_=void 0!==m&&m;return n(this,e),uc[r]||(this.itemSizeLimit=i,this.cacheLimit=o,this.blockHashBase=c,this.blockHashMultiplier=h,this.blockHashConstant=f,this.transactionApplyDelay=v,this.disableLogger=_,uc[r]=this),uc[r]}return a(e,null,[{key:"get",value:function(e){return uc[e]}}]),e}();!function(e){e[e.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",e[e.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",e[e.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",e[e.STORE_IS_FULL=61001003]="STORE_IS_FULL",e[e.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",e[e.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",e[e.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",e[e.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",e[e.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",e[e.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",e[e.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",e[e.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",e[e.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",e[e.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",e[e.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",e[e.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",e[e.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",e[e.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",e[e.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",e[e.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",e[e.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND"}(Xo||(Xo={}));var lc,hc=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.code,s=void 0===i?Xo.UNKNOWN_ERROR:i,o=e.message,u=void 0===o?"Unknown error occurred.":o;return n(this,r),(a=t.call(this,u)).code=s,Object.setPrototypeOf(h(a),r.prototype),a}return a(r,null,[{key:"storeNotDefined",get:function(){return new r({code:Xo.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})}},{key:"storeNotAvailable",get:function(){return new r({code:Xo.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})}},{key:"storeNotAvailableInPrivateBrowsing",get:function(){return new r({code:Xo.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})}},{key:"storeIsFull",get:function(){return new r({code:Xo.STORE_IS_FULL,message:"Store is full."})}},{key:"storeKeyTypeIsInvalid",get:function(){return new r({code:Xo.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})}},{key:"storeBrokenIntegrity",get:function(){return new r({code:Xo.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})}},{key:"storeBrokenBlob",get:function(){return new r({code:Xo.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})}},{key:"storeEncryptionInvalid",get:function(){return new r({code:Xo.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})}},{key:"storeItemSizeExceeded",get:function(){return new r({code:Xo.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})}},{key:"storeReadFailed",get:function(){return new r({code:Xo.STORE_READ_FAILED,message:"Failed to read from store."})}},{key:"storeWriteFailed",get:function(){return new r({code:Xo.STORE_WRITE_FAILED,message:"Failed to write to store."})}},{key:"databaseSchemaNotOnUpgrade",get:function(){return new r({code:Xo.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})}},{key:"collectionNotReady",get:function(){return new r({code:Xo.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})}},{key:"collectionKeyNotMatch",get:function(){return new r({code:Xo.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})}},{key:"collectionQueryNotValid",get:function(){return new r({code:Xo.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})}},{key:"collectionInsertDuplicate",get:function(){return new r({code:Xo.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})}},{key:"collectionKeyNotFound",get:function(){return new r({code:Xo.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})}},{key:"collectionKeyNotGiven",get:function(){return new r({code:Xo.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})}},{key:"collectionWriteFailed",get:function(){return new r({code:Xo.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})}},{key:"collectionItemSizeExceeded",get:function(){return new r({code:Xo.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})}},{key:"indexTableIsRequired",get:function(){return new r({code:Xo.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})}},{key:"indexTypesNotMatch",get:function(){return new r({code:Xo.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})}},{key:"compareTypesNotMatch",get:function(){return new r({code:Xo.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})}},{key:"circularReferenceFound",get:function(){return new r({code:Xo.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})}}]),r}(l(Error));!function(e){e.INIT="init",e.READY="ready",e.CLOSED="closed"}(lc||(lc={}));var dc,fc=function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new WeakMap;if("object"===t(n)&&null!==n){if(r.has(n))throw hc.circularReferenceFound;r.set(n,!0);var a=null;if(Array.isArray(n))a=n.map((function(t){return e(t,r)}));else if(n instanceof RegExp)a=n;else if(n instanceof Date)a=n;else for(var i in a={},n)a[i]=e(n[i],r);return r.delete(n),a}return n},pc=function(e,n){if(null==n)return 1;if(null==e)return-1;if(t(e)!==t(n))throw hc.compareTypesNotMatch;var r=0;switch(t(e)){case"boolean":case"number":r=e-n;break;case"string":r=e.localeCompare(n)}return r},vc=function(e,t){for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+(n<<6)+(n<<16)-n;return(n>>>0)%t},mc=function(e){return new Promise((function(t){setTimeout((function(){return t()}),e)}))},_c=function e(n,r){if(!r)return!1;if("function"!=typeof n){for(var a in n){if(["/and","&&"].includes(a)){if(n[a].some((function(t){return!e(t,r)})))return!1}else if(["/or","||"].includes(a)){if(n[a].every((function(t){return!e(t,r)})))return!1}else if("/where"===a){if(!(0,n[a])(r))return!1}else{var i=a;if("object"===t(n[i])){var s=n[i];for(var o in s)switch(o){case"/eq":case"=":if(r[i]!==s[o])return!1;break;case"/neq":case"!=":if(r[i]===s[o])return!1;break;case"/gt":case">":var u=r[i],c=s[o];if(!(pc(u,c)>0))return!1;break;case"/gte":case">=":var l=r[i],h=s[o];if(!(pc(l,h)>=0))return!1;break;case"/lt":case"<":var d=r[i],f=s[o];if(!(pc(d,f)<0))return!1;break;case"/lte":case"<=":var p=r[i],v=s[o];if(!(pc(p,v)<=0))return!1;break;case"/in":var m=r[i];if(!s[o].includes(m))return!1;break;case"/nin":var _=r[i];if(s[o].includes(_))return!1;break;case"/contain":var g=r[i],y=s[o];if(!g.includes(y))return!1;break;case"/regex":var k=r[i];if(!s[o].test(k))return!1;break;case"/where":var E=r[i];if(!(0,s[o])(E))return!1}}else if("function"==typeof n[i]){if(!n[i](r[i]))return!1}else if(n[i]!==r[i])return!1}}return!0}return n(r)},gc=function(){},yc=function(){return Promise.resolve()},kc=function(e){return e},Ec=function(e,t){t(null)};!function(e){e[e.FORWARD=0]="FORWARD",e[e.BACKWARD=1]="BACKWARD"}(dc||(dc={}));var bc,wc,xc,Rc=function(){function e(t){var r=t.initialPrevValue,a=void 0===r?null:r,i=t.initialNextValue,s=void 0===i?null:i,o=t.iterator,u=t.map,c=void 0===u?kc:u,l=t.backward,h=void 0===l?yc:l,d=t.forward,f=void 0===d?yc:d,p=t.complete,v=void 0===p?gc:p;n(this,e),this._prevValue=a,this._nextValue=s,this._error=null,this._map=c,this._backward=h,this._forward=f,this._iterator=o,this._complete=v}return a(e,[{key:"prevValue",get:function(){return this._map(this._prevValue)}},{key:"nextValue",get:function(){return this._map(this._nextValue)}},{key:"error",get:function(){return this._error}},{key:"hasPrevious",get:function(){return!!this._prevValue}},{key:"hasNext",get:function(){return!!this._nextValue}},{key:"prev",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasPrevious){e.next=20;break}return e.prev=1,t=this._prevValue,e.next=5,this._backward();case 5:if(e.t0=e.sent,e.t0){e.next=8;break}e.t0=null;case 8:this._prevValue=e.t0,this._nextValue=t,e.next=15;break;case 12:e.prev=12,e.t1=e.catch(1),this._error=e.t1;case 15:return e.next=17,this._iterator(this);case 17:return e.abrupt("return",e.sent);case 20:this._complete();case 21:case"end":return e.stop()}}),e,this,[[1,12]])})))}},{key:"next",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasNext){e.next=20;break}return e.prev=1,t=this._nextValue,e.next=5,this._forward();case 5:if(e.t0=e.sent,e.t0){e.next=8;break}e.t0=null;case 8:this._nextValue=e.t0,this._prevValue=t,e.next=15;break;case 12:e.prev=12,e.t1=e.catch(1),this._error=e.t1;case 15:return e.next=17,this._iterator(this);case 17:return e.abrupt("return",e.sent);case 20:this._complete();case 21:case"end":return e.stop()}}),e,this,[[1,12]])})))}},{key:"stop",value:function(){this._prevValue=null,this._nextValue=null,this._complete()}}]),e}(),Cc=function(){function e(t){var r=t.condition,a=void 0===r?{}:r,i=t.backward,s=void 0!==i&&i,o=t.blockManager,u=t.indexer;n(this,e),this.condition=a,this.backward=s,this._blockManager=o,this._indexer=u}return a(e,[{key:"findOptimizedStartPosition",value:function(){var e=this,n=["=","/eq",">",">=","/gt","/gte"],r=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var a=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(var i in this._indexer.fields){var s=this._indexer.fields[i],o=1;if("-"===s[0]&&(s=s.slice(1),o=-1),this.condition[s])if("object"===t(this.condition[s])){var u=o>0?r:n;for(var c in this.condition[s])if(u.includes(c))for(var l=a;l>=0;l--)if(o*pc(this._indexer.origin[l].columnValues[i],this.condition[s][c])<=0){a=l;break}}else for(var h=a;h>=0;h--)if(o*pc(this._indexer.origin[h].columnValues[i],this.condition[s])<=0){a=h;break}}return Math.min(a+1,this._indexer.origin.length-1)}var d=function(){var a=0;if("function"!=typeof e.condition)for(var i=function(i){var s=e._indexer.fields[i],o=1;if("-"===s[0]&&(s=s.slice(1),o=-1),e.condition[s])if("object"===t(e.condition[s]))Object.keys(e.condition[s]).forEach((function(t){if((o>0?n:r).includes(t))for(var u=a;u<e._indexer.origin.length;u++)if(o*pc(e._indexer.origin[u].columnValues[i],e.condition[s][t])>=0){a=u;break}}));else for(var u=a;u<e._indexer.origin.length;u++)if(o*pc(e._indexer.origin[u].columnValues[i],e.condition[s])>=0){a=u;break}},s=0;s<e._indexer.fields.length;s++)i(s);return{v:Math.max(a-1,0)}}();if("object"===t(d))return d.v}},{key:"each",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.findOptimizedStartPosition(),r=0,this.backward&&this._indexer.origin[n]&&(r=this._indexer.origin[n].keys.length-1),a=function(){if(c._indexer.origin[n]){if(!c._indexer.origin[n].keys[++r]){if(!c._indexer.origin[++n])return!1;r=0}return!0}return!1},i=function(){if(c._indexer.origin[n]){if(!c._indexer.origin[n].keys[--r]){if(!c._indexer.origin[--n])return!1;r=c._indexer.origin[n].keys.length-1}return!0}return!1},s=null,!this._indexer.origin[n]){t.next=15;break}o=this.backward?i:a;case 8:return t.next=10,this._blockManager.getFromBlock(this._indexer.origin[n].keys[r]);case 10:if(u=t.sent,!_c(this.condition,u)){t.next=14;break}return s=u,t.abrupt("break",15);case 14:if(o()){t.next=8;break}case 15:return t.next=17,new Promise((function(t){var o=new Rc({initialNextValue:fc(s),iterator:e,forward:function(){return E(c,void 0,void 0,regeneratorRuntime.mark((function e(){var t,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.backward?i:a;case 1:if(!t()){e.next=9;break}return e.next=4,this._blockManager.getFromBlock(this._indexer.origin[n].keys[r]);case 4:if(s=e.sent,!_c(this.condition,s)){e.next=7;break}return e.abrupt("return",fc(s));case 7:e.next=1;break;case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}}),e,this)})))},backward:function(){return E(c,void 0,void 0,regeneratorRuntime.mark((function e(){var t,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.backward?a:i;case 1:if(!t()){e.next=9;break}return e.next=4,this._blockManager.getFromBlock(this._indexer.origin[n].keys[r]);case 4:if(s=e.sent,!_c(this.condition,s)){e.next=7;break}return e.abrupt("return",fc(s));case 7:e.next=1;break;case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}}),e,this)})))},complete:t});e(o)}));case 17:return t.abrupt("return",t.sent);case 18:case"end":return t.stop()}}),t,this)})))}}]),e}(),Tc=function(){function e(t){var r=t.condition,a=void 0===r?{}:r,i=t.backward,s=void 0!==i&&i,o=t.mutex,u=t.blockManager,c=t.indexer;n(this,e),this._mutex=o,this._iterator=new Cc({condition:a,backward:s,blockManager:u,indexer:c})}return a(e,[{key:"fetch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Math.max(e.offset||0,0),0!==(r="number"==typeof e.limit?e.limit:Number.MAX_SAFE_INTEGER)){t.next=6;break}return t.abrupt("return",[]);case 6:if(!(r<0)){t.next=8;break}throw hc.collectionQueryNotValid;case 8:return t.prev=8,a=[],t.next=12,this._mutex.lock();case 12:return t.next=14,this._iterator.each((function(e){return E(i,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.error?e.stop():e.hasNext?0===n?(a.push(e.nextValue),0<r&&r<=a.length?e.stop():e.next()):(n--,e.next()):e.stop();case 1:case"end":return t.stop()}}),t)})))}));case 14:return this._mutex.unlock(),t.abrupt("return",a);case 18:throw t.prev=18,t.t0=t.catch(8),this._mutex.unlock(),t.t0;case 22:case"end":return t.stop()}}),t,this,[[8,18]])})))}},{key:"count",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=0,e.next=4,this._mutex.lock();case 4:return e.next=6,this._iterator.each((function(e){return E(n,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.error?e.stop():e.hasNext?(t++,e.next()):e.stop();case 1:case"end":return n.stop()}}),n)})))}));case 6:return this._mutex.unlock(),e.abrupt("return",t);case 10:throw e.prev=10,e.t0=e.catch(0),this._mutex.unlock(),e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,10]])})))}}]),e}(),Sc=function(e){return"".concat("nest","@").concat(e)},Ic=function(e,t){return"".concat(Sc(e),"/").concat(t)},Nc=function(e,t){return"".concat(Ic(e,t),".metadata")},Ac=function(e,t){return"".concat(Ic(e,t),"/block.")},Mc=function(e,t,n,r){return"".concat(Ac(e,t)).concat(n,".").concat(r)},Uc=function(e,t){return"".concat(Ic(e,t),"/blob.")},Oc=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return"".concat(Uc(e,t)).concat(n,".").concat(r)},Dc=function(){function e(t){var r=t.dbname,a=t.collectionName,i=t.store;n(this,e),this.dbname=r,this.collectionName=a,this.store=i}return a(e,[{key:"get",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c,l,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.store.get(e);case 2:if(!(n=t.sent)){t.next=19;break}if(r=n.data,a=n.type,"undefined"==typeof fetch){t.next=14;break}return t.next=8,fetch(r);case 8:return i=t.sent,t.next=11,i.blob();case 11:return t.abrupt("return",t.sent);case 14:for(512,s=[],o=atob(r.split(",")[1]),u=0;u<o.length;u+=512){for(c=o.slice(u,u+512),l=new Array(c.length),h=0;h<c.length;h++)l[h]=c.charCodeAt(h);s.push(new Uint8Array(l))}return t.abrupt("return",new Blob(s,{type:a}));case 19:return t.abrupt("return",null);case 20:case"end":return t.stop()}}),t,this)})))}},{key:"save",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"".concat(Date.now());return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,new Promise((function(n){var r=Oc(o.dbname,o.collectionName,t),a=new FileReader;a.onload=function(){n({blobId:r,data:a.result,type:e.type})},a.readAsDataURL(e)}));case 2:return r=n.sent,a=r.blobId,i=r.data,s=r.type,n.next=8,this.store.set({key:a,value:{data:i,type:s},generation:1});case 8:return n.abrupt("return",a);case 9:case"end":return n.stop()}}),n,this)})))}},{key:"remove",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.store.remove(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Uc(this.dbname,this.collectionName),e.next=3,this.store.getAllKeys();case 3:return n=e.sent,e.next=6,Promise.all(n.filter((function(e){return e.startsWith(t)})).map((function(e){return E(r,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.store.remove(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))})));case 6:case"end":return e.stop()}}),e,this)})))}}]),e}();!function(e){e[e.COMMIT=0]="COMMIT",e[e.WRITE=1]="WRITE",e[e.ERROR=2]="ERROR"}(bc||(bc={})),function(e){e.PENDING="pending",e.PERSISTENT="persistent",e.VOLATILE="volatile"}(wc||(wc={})),function(e){e[e.NO_CACHE=0]="NO_CACHE",e[e.DEFAULT=1]="DEFAULT",e[e.PERSISTENT=2]="PERSISTENT"}(xc||(xc={}));var Lc,Pc=[wc.PENDING,wc.VOLATILE],Fc={},Hc=function(){function e(t){var r=t.dbname,a=t.limit,i=void 0===a?256:a;return n(this,e),Fc[r]||(this.dbname=r,this._items=[],this._limit=i,Fc[r]=this),Fc[r]}return a(e,[{key:"items",get:function(){return this._items}},{key:"find",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xc.DEFAULT;return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){var a,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=this.get(t)){r.next=8;break}return r.next=4,e.get(t);case 4:(i=r.sent)&&(a={key:t,value:i,generation:1,state:n===xc.PERSISTENT?wc.PERSISTENT:wc.VOLATILE},this.put(a)),r.next=9;break;case 8:n===xc.PERSISTENT&&(a.state=wc.PERSISTENT);case 9:return r.abrupt("return",a);case 10:case"end":return r.stop()}}),r,this)})))}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xc.DEFAULT,n=this._items.map((function(e){return e.key})).indexOf(e);if(n>-1){var r=this._items[n];return t===xc.PERSISTENT&&(r.state=wc.PERSISTENT),t!==xc.NO_CACHE&&this.put(r),r}return null}},{key:"put",value:function(e){if(this._limit>0){var t=this._items.map((function(e){return e.key})).indexOf(e.key);if(t>-1)Pc.includes(this._items[t].state)&&Pc.includes(e.state)?(this._items.splice(t,1),this._items.push(e)):(this._items[t].state=e.state,this._items[t].generation=e.generation,this._items[t].value=e.value);else{this._items.push(e);var n=this._items.filter((function(e){return e.state===wc.VOLATILE})),r=n.length-this._limit;if(r>0){var a,i=[],s=k(this._items);try{for(s.s();!(a=s.n()).done;){var o=a.value;o.state===wc.VOLATILE&&r>0?r--:i.push(o)}}catch(e){s.e(e)}finally{s.f()}this._items=i}}}}},{key:"remove",value:function(e){var t=this._items.map((function(e){return e.key})).indexOf(e);t>-1&&this._items.splice(t,1)}},{key:"clearByCondition",value:function(e){this._items=this._items.filter((function(t){return!e(t)}))}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._items=e?[]:this._items.filter((function(e){return e.state!==wc.VOLATILE}))}}],[{key:"get",value:function(e){return Fc[e]}}]),e}(),Gc=function(){function e(t){var r=t.dbname,a=t.collectionName,i=t.store;n(this,e),this._metadata=null,this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=r,this.collectionName=a,this.metadataKey=function(e,t){return"".concat(Ic(e,t),"/trans.metadata")}(r,a),this.recordsetKey=function(e,t){return"".concat(Ic(e,t),"/trans.recordset")}(r,a),this._store=i}return a(e,[{key:"generation",get:function(){return this._metadata?this._metadata.generation:0}},{key:"requestCount",get:function(){return this._requests.length}},{key:"_getReducedRecordset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._store.get(this.recordsetKey);case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0=[];case 5:return(n=t.t0).push.apply(n,_(e)),t.abrupt("return",this._reduceRecordSet(n));case 8:case"end":return t.stop()}}),t,this)})))}},{key:"_reduceRecordSet",value:function(e){for(var t=[],n={},r=e.length-1;r>=0;r--){for(var a=e[r],i=[],s=a.requests.length-1;s>=0;s--){var o=a.requests[s],u=o.data;n[u.key]||(i.unshift(o),n[u.key]=!0)}i.length>0&&(a.requests=i,t.unshift(a))}return t}},{key:"_applyRecord",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Hc.get(this.dbname),a=t.generation,i=t.requests,s=null,n.prev=3,n.next=6,this._store.setMany(i.map((function(e){return Object.assign(Object.assign({},e.data),{generation:a})})));case 6:for(o=n.sent,u=0;u<i.length;u++)o[u]instanceof Error&&(s||(s=o[u]),c=i[u].data,r.put(Object.assign(Object.assign({},c),{generation:a,state:wc.PERSISTENT})));n.next=13;break;case 10:n.prev=10,n.t0=n.catch(3),s=n.t0;case 13:if(s){n.next=20;break}return l=e.filter((function(e){return e.generation!==a})),n.next=17,this._store.set({key:this.recordsetKey,value:l,generation:a});case 17:this._onWrite.forEach((function(e){e(i.map((function(e){return e.data})))})),n.next=21;break;case 20:this._onError.forEach((function(e){return e(s)}));case 21:case"end":return n.stop()}}),n,this,[[3,10]])})))}},{key:"init",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._store.get(this.metadataKey);case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0={generation:1};case 5:return this._metadata=e.t0,e.next=8,this._getReducedRecordset();case 8:t=e.sent,n=k(t),e.prev=10,n.s();case 12:if((r=n.n()).done){e.next=18;break}return a=r.value,e.next=16,this._applyRecord(t,a);case 16:e.next=12;break;case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(10),n.e(e.t1);case 23:return e.prev=23,n.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[10,20,23,26]])})))}},{key:"on",value:function(e,t,n){switch(e){case bc.COMMIT:this._onCommit.set(t,n);break;case bc.WRITE:this._onWrite.set(t,n);break;case bc.ERROR:this._onError.set(t,n)}}},{key:"requestWrite",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._requests.push({data:e,options:t});var n=Hc.get(this.dbname);n.put(Object.assign({state:wc.PENDING,generation:this.generation},e))}},{key:"requestMultipleWrite",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=Hc.get(this.dbname),a=k(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;this._requests.push({data:i,options:n}),r.put(Object.assign({state:wc.PENDING,generation:this.generation},i))}}catch(e){a.e(e)}finally{a.f()}}},{key:"clear",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Hc.get(this.dbname).clearByCondition((function(e){return e.state===wc.PENDING})),this._requests=[];case 3:case"end":return e.stop()}}),e,this)})))}},{key:"commit",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o,u,c,l,h,d,f,p,v=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=this._requests).length>0)){e.next=20;break}for(n=[],r={},a=t.length-1;a>=0;a--)i=t[a],s=i.data,r[s.key]||(r[s.key]=!0,n.unshift(i));return o={generation:this.generation,requests:n},e.next=8,this._getReducedRecordset([o]);case 8:return u=e.sent,e.next=11,this._store.set({key:this.recordsetKey,value:u,generation:this.generation});case 11:return this._metadata.generation++,e.next=14,this._store.set({key:this.metadataKey,value:this._metadata,generation:1});case 14:for(c=Hc.get(this.dbname),l=0;l<n.length;l++)h=n[l],d=h.data,f=h.options,c.put(Object.assign(Object.assign({},d),{generation:o.generation,state:f&&f.persistent?wc.PERSISTENT:wc.VOLATILE}));this._requests=[],this._onCommit.forEach((function(e){e(t.map((function(e){return e.data})))})),p=cc.get(this.dbname),setTimeout((function(){try{v._applyRecord(u,o)}catch(e){v._onError.forEach((function(t){return t(e)}))}}),p.transactionApplyDelay);case 20:case"end":return e.stop()}}),e,this)})))}}]),e}(),qc=function(){function e(t){var r=t.blockId,a=t.keyName,i=t.items,s=void 0===i?[]:i,o=t.limit;n(this,e),this.blockId=r,this.keyName=a,this.limit=o,this._items=_(s)}return a(e,[{key:"isEmpty",get:function(){return 0===this._items.length}},{key:"items",get:function(){return this._items}},{key:"serialize",value:function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}}},{key:"getItemByKey",value:function(e){var t=this;return this._items.find((function(n){var r=n[t.keyName];return e===r}))}},{key:"has",value:function(e){var t=this;return this._items.map((function(e){return e[t.keyName]})).includes(e)}},{key:"add",value:function(e){var t=this,n=this._items.map((function(e){return e[t.keyName]})).indexOf(e[this.keyName]);return n<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[n]=e,!0)}},{key:"remove",value:function(e){for(var t in this._items)if(this._items[t][this.keyName]===e)return this._items.splice(parseInt(t),1),!0;return!1}},{key:"clear",value:function(){this._items=[]}}],[{key:"createFromCacheItem",value:function(t){return t?new e(t.value):null}}]),e}(),jc=function(e,t,n){var r=n.base*Math.pow(n.multiplier,t)+n.constant;return(n.hashFunction||vc)(e,r)},zc=function(){function e(t){var r=t.dbname,a=t.collectionName,i=t.metadata,s=t.hashFunction,o=void 0===s?vc:s,u=t.transaction,c=t.store;n(this,e),this.dbname=r,this.collectionName=a,this.hashFunction=o,this.metadata=i,this._transaction=u,this._store=c}return a(e,[{key:"keyName",get:function(){return this.metadata.keyName}},{key:"createBlockId",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.metadata.blockLevel;return Mc(this.dbname,this.collectionName,t,"".concat(jc(e,t,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})))}},{key:"_findBlock",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=Hc.get(this.dbname),r=this.metadata.blockLevel;case 2:if(!(r>0)){t.next=15;break}return a=this.createBlockId(e,r),t.next=6,n.find(this._store,a);case 6:if(!(i=t.sent)){t.next=12;break}if(s=qc.createFromCacheItem(i),!s.getItemByKey(e)){t.next=12;break}return t.abrupt("return",s);case 12:r--,t.next=2;break;case 15:return t.abrupt("return",null);case 16:case"end":return t.stop()}}),t,this)})))}},{key:"getFromBlock",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._findBlock(e);case 2:return n=t.sent,t.abrupt("return",n?n.getItemByKey(e):null);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"putToBlock",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=cc.get(this.dbname),a=this.createBlockId(e),i=Math.floor(this._store.itemSizeLimit/r.itemSizeLimit),s=Hc.get(this.dbname),n.next=6,s.find(this._store,a);case 6:if(o=n.sent,!(u=o?qc.createFromCacheItem(o):new qc({blockId:a,keyName:this.keyName,items:[],limit:i})).add(t)){n.next=11;break}return this._transaction.requestWrite({key:u.blockId,value:u.serialize()}),n.abrupt("return",!0);case 11:return n.abrupt("return",!1);case 12:case"end":return n.stop()}}),n,this)})))}},{key:"removeFromBlock",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._findBlock(e);case 2:if(!(n=t.sent)){t.next=7;break}if(!n.remove(e)){t.next=7;break}return this._transaction.requestWrite({key:n.blockId,value:n.serialize()}),t.abrupt("return",!0);case 7:return t.abrupt("return",!1);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"clearAllBlocks",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ac(this.dbname,this.collectionName),e.next=3,this._store.getAllKeys();case 3:return n=e.sent,r=n.filter((function(e){return e.startsWith(t)})),e.next=7,this._store.removeMany(r);case 7:return e.next=9,this._transaction.clear();case 9:Hc.get(this.dbname).clearByCondition((function(e){return e.key.startsWith(t)}));case 11:case"end":return e.stop()}}),e,this)})))}}]),e}(),Vc={},Bc=function(){function e(t){var r=this,a=t.dbname,i=t.collectionName,s=t.keyName,o=t.fields,u=t.transaction,c=t.store;n(this,e),this._origin=[],this._table=[];var l=function(e,t,n){return"".concat(Ic(e,t),"/index.").concat(n)}(a,i,o.join(">"));return Vc[l]||(this.dbname=a,this.collectionName=i,this.keyName=s,this.fields=o,this.indexerKey=l,this._transaction=u,this._store=c,this._transaction.on(bc.COMMIT,this.indexerKey,(function(){return r.commit()})),this._transaction.on(bc.ERROR,this.indexerKey,(function(){return r.abort()}))),Vc[l]}return a(e,[{key:"_addItem",value:function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=m(this.indexOf(n),2),a=r[0];return r[1]?!this._table[a].keys.includes(t)&&(this._table[a].keys.push(t),!0):(this._table.splice(a,0,{columnValues:n,keys:[t]}),!0)}},{key:"_removeItem",value:function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=m(this.indexOf(n),2),a=r[0];if(r[1]){var i=this._table[a].keys.indexOf(t);if(i>-1)return this._table[a].keys.splice(i,1),0===this._table[a].keys.length&&this._table.splice(a,1),!0}return!1}},{key:"origin",get:function(){return this._origin}},{key:"table",get:function(){return this._table}},{key:"getColumnValues",value:function(e){var n,r,a,i=[],s=k(this.fields);try{for(s.s();!(n=s.n()).done;){var o=n.value;if("-"===o[0]&&(o=o.slice(1)),r=e[o],a=void 0,a=t(r),null!==r&&"undefined"!==a&&"boolean"!==a&&"number"!==a&&"string"!==a)throw hc.indexTypesNotMatch;i.push(e[o])}}catch(e){s.e(e)}finally{s.f()}return i}},{key:"diff",value:function(e,t){for(var n in this.fields){var r="-"===this.fields[n][0]?-1:1,a=pc(e[n],t[n]);if(0!==a)return r*a}return 0}},{key:"indexOf",value:function(e){if(this._table.length>0){for(var t=0,n=this._table.length-1;t<=n;){var r=Math.floor((t+n)/2),a=this.diff(e,this._table[r].columnValues);if(a>0)t=r+1;else{if(!(a<0))return[r,!0];n=r-1}}return[t,!1]}return[0,!1]}},{key:"ensure",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o,u,c,l,h,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Hc.get(this.dbname),e.next=3,t.find(this._store,this.indexerKey,xc.PERSISTENT);case 3:if(n=e.sent){e.next=34;break}return r=Ac(this.dbname,this.collectionName),e.next=8,this._store.getAllKeys();case 8:a=e.sent,i=k(a),e.prev=10,i.s();case 12:if((s=i.n()).done){e.next=23;break}if(!(o=s.value).startsWith(r)){e.next=21;break}return e.next=17,t.find(this._store,o,xc.NO_CACHE);case 17:u=e.sent,c=qc.createFromCacheItem(u),l=k(c.items);try{for(l.s();!(h=l.n()).done;)d=h.value,this._addItem(d)}catch(e){l.e(e)}finally{l.f()}case 21:e.next=12;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(10),i.e(e.t0);case 28:return e.prev=28,i.f(),e.finish(28);case 31:this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),e.next=36;break;case 34:this._origin=n.value,this._table=fc(this._origin);case 36:Vc[this.indexerKey]=this;case 37:case"end":return e.stop()}}),e,this,[[10,25,28,31]])})))}},{key:"drop",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Hc.get(this.dbname).remove(this.indexerKey),e.next=4,this._store.remove(this.indexerKey);case 4:delete Vc[this.indexerKey];case 5:case"end":return e.stop()}}),e,this)})))}},{key:"addItem",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._addItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0});case 1:case"end":return t.stop()}}),t,this)})))}},{key:"removeItem",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._removeItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0});case 1:case"end":return t.stop()}}),t,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0});case 2:case"end":return e.stop()}}),e,this)})))}},{key:"commit",value:function(){this._origin=this._table,this._table=fc(this._origin)}},{key:"abort",value:function(){this._table=fc(this._origin)}}],[{key:"createKey",value:function(e){return e.join(">")}},{key:"parseKey",value:function(e){return e.split(">")}},{key:"clearIndexerMap",value:function(){for(var e in Vc)delete Vc[e]}}]),e}(),Qc=function(){function e(t){var r=this,a=t.dbname,i=t.collectionName,s=t.keyName,o=t.keyHash,u=t.indexes,c=t.store;n(this,e),this._state=lc.INIT,this._metadata=null,this._indexers=[],this.dbname=a,this.name=i,this.keyName=s,this.indexes=[[s]].concat(_(u.filter((function(e){return Bc.createKey(e)!==r.keyName})))),this._keyHash=o,this._store=c,this._mutex=new Po(function(e,t){return"".concat(Ic(e,t),".lock")}(a,i)),this._blobContainer=new Dc({dbname:a,collectionName:i,store:c}),this._transaction=new Gc({dbname:a,collectionName:i,store:c})}return a(e,[{key:"state",get:function(){return this._state}},{key:"isReady",get:function(){return this._state===lc.READY}},{key:"init",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c,l,h,d,f=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._mutex.lock();case 2:return t.prev=2,n=cc.get(this.dbname),t.next=6,e.metadataOf(this.dbname,this.name,this._store);case 6:return r=t.sent,this._metadata=r||{keyName:this.keyName,blockLevel:1,blockHashBase:n.blockHashBase,blockHashMultiplier:n.blockHashMultiplier,blockHashConstant:n.blockHashConstant,indexes:this.indexes},t.next=10,this._transaction.init();case 10:this._blockManager=new zc({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),a=_(this.indexes),i=[],s=a.map((function(e){return Bc.createKey(e)})),o=r?r.indexes.map((function(e){return Bc.createKey(e)})):[],u=k(o);try{for(u.s();!(c=u.n()).done;)l=c.value,s.includes(l)||i.push(Bc.parseKey(l))}catch(e){u.e(e)}finally{u.f()}return(h=[]).push.apply(h,_(a.map((function(e){var t=new Bc({dbname:f.dbname,collectionName:f.name,keyName:f.keyName,fields:e,transaction:f._transaction,store:f._store});return f._indexers.push(t),t.ensure()})))),h.push.apply(h,_(i.map((function(e){return new Bc({dbname:f.dbname,collectionName:f.name,keyName:f.keyName,fields:e,transaction:f._transaction,store:f._store}).drop()})))),t.next=22,Promise.all(h);case 22:return t.next=24,this._transaction.commit();case 24:if(s.sort().join(",")===o.sort().join(",")){t.next=29;break}return d=Nc(this.dbname,this.name),this._metadata.indexes=a,t.next=29,this._store.set({key:d,value:this._metadata,generation:1});case 29:this._state=lc.READY,this._mutex.unlock(),t.next=37;break;case 33:throw t.prev=33,t.t0=t.catch(2),this._mutex.unlock(),t.t0;case 37:case"end":return t.stop()}}),t,this,[[2,33]])})))}},{key:"close",value:function(){this._state=lc.CLOSED}},{key:"_hasPropertyOfKeyName",value:function(e){var t=e[this.keyName];return"string"==typeof t&&!!t}},{key:"_getIndexerBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e||(e=[this.keyName]);var t,n=Bc.createKey(e),r=k(this._indexers);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(n===Bc.createKey(a.fields))return a}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"_upgradeBlockLevel",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Nc(this.dbname,this.name),this._metadata.blockLevel++,e.next=4,this._store.set({key:t,value:this._metadata,generation:1});case 4:case"end":return e.stop()}}),e,this)})))}},{key:"_requestInsert",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[this.keyName],t.next=3,this._blockManager.getFromBlock(n);case 3:if(t.sent){t.next=32;break}return t.next=7,this._blockManager.putToBlock(n,e);case 7:if(t.sent){t.next=13;break}return t.next=11,this._upgradeBlockLevel();case 11:return t.next=13,this._blockManager.putToBlock(n,e);case 13:r=k(this._indexers),t.prev=14,r.s();case 16:if((a=r.n()).done){t.next=22;break}return i=a.value,t.next=20,i.addItem(e);case 20:t.next=16;break;case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(14),r.e(t.t0);case 27:return t.prev=27,r.f(),t.finish(27);case 30:t.next=33;break;case 32:throw hc.collectionInsertDuplicate;case 33:case"end":return t.stop()}}),t,this,[[14,24,27,30]])})))}},{key:"_requestUpsert",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[this.keyName],t.next=3,this._blockManager.getFromBlock(n);case 3:if(r=t.sent){t.next=32;break}return t.next=7,this._blockManager.putToBlock(n,e);case 7:if(t.sent){t.next=13;break}return t.next=11,this._upgradeBlockLevel();case 11:return t.next=13,this._blockManager.putToBlock(n,e);case 13:a=k(this._indexers),t.prev=14,a.s();case 16:if((i=a.n()).done){t.next=22;break}return s=i.value,t.next=20,s.addItem(e);case 20:t.next=16;break;case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(14),a.e(t.t0);case 27:return t.prev=27,a.f(),t.finish(27);case 30:t.next=54;break;case 32:return t.next=34,this._blockManager.putToBlock(n,e);case 34:o=k(this._indexers),t.prev=35,o.s();case 37:if((u=o.n()).done){t.next=46;break}if(0===(c=u.value).diff(c.getColumnValues(r),c.getColumnValues(e))){t.next=44;break}return t.next=42,c.removeItem(r);case 42:return t.next=44,c.addItem(e);case 44:t.next=37;break;case 46:t.next=51;break;case 48:t.prev=48,t.t1=t.catch(35),o.e(t.t1);case 51:return t.prev=51,o.f(),t.finish(51);case 54:case"end":return t.stop()}}),t,this,[[14,24,27,30],[35,48,51,54]])})))}},{key:"_requestUpdate",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[this.keyName],t.next=3,this._blockManager.getFromBlock(n);case 3:if(!(r=t.sent)){t.next=27;break}return t.next=7,this._blockManager.putToBlock(n,e);case 7:a=k(this._indexers),t.prev=8,a.s();case 10:if((i=a.n()).done){t.next=19;break}if(0===(s=i.value).diff(s.getColumnValues(r),s.getColumnValues(e))){t.next=17;break}return t.next=15,s.removeItem(r);case 15:return t.next=17,s.addItem(e);case 17:t.next=10;break;case 19:t.next=24;break;case 21:t.prev=21,t.t0=t.catch(8),a.e(t.t0);case 24:return t.prev=24,a.f(),t.finish(24);case 27:case"end":return t.stop()}}),t,this,[[8,21,24,27]])})))}},{key:"_requestRemove",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._blockManager.getFromBlock(e);case 2:if(!(n=t.sent)){t.next=23;break}return t.next=6,this._blockManager.removeFromBlock(e);case 6:r=k(this._indexers),t.prev=7,r.s();case 9:if((a=r.n()).done){t.next=15;break}return i=a.value,t.next=13,i.removeItem(n);case 13:t.next=9;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),r.e(t.t0);case 20:return t.prev=20,r.f(),t.finish(20);case 23:case"end":return t.stop()}}),t,this,[[7,17,20,23]])})))}},{key:"_requestClear",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blockManager.clearAllBlocks();case 2:t=k(this._indexers),e.prev=3,t.s();case 5:if((n=t.n()).done){e.next=11;break}return r=n.value,e.next=9,r.clear();case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),t.e(e.t0);case 16:return e.prev=16,t.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[3,13,16,19]])})))}},{key:"getByKey",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=17;break}return t.next=3,this._mutex.lock();case 3:return t.prev=3,t.next=6,this._blockManager.getFromBlock(e);case 6:return n=t.sent,this._mutex.unlock(),t.abrupt("return",fc(n));case 11:throw t.prev=11,t.t0=t.catch(3),this._mutex.unlock(),t.t0;case 15:t.next=18;break;case 17:throw hc.collectionNotReady;case 18:case"end":return t.stop()}}),t,this,[[3,11]])})))}},{key:"query",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.isReady?new Tc({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward}):null}},{key:"insertOne",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=22;break}return t.next=3,this._mutex.lock();case 3:if(t.prev=3,this._hasPropertyOfKeyName(e)){t.next=6;break}throw hc.collectionKeyNotGiven;case 6:return t.next=8,this._requestInsert(fc(e));case 8:return t.next=10,this._transaction.commit();case 10:return this._mutex.unlock(),t.abrupt("return",e);case 14:return t.prev=14,t.t0=t.catch(3),t.next=18,this._transaction.clear();case 18:throw this._mutex.unlock(),t.t0;case 20:t.next=23;break;case 22:throw hc.collectionNotReady;case 23:case"end":return t.stop()}}),t,this,[[3,14]])})))}},{key:"insertMany",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=37;break}return t.next=3,this._mutex.lock();case 3:if(t.prev=3,!e.some((function(e){return!i._hasPropertyOfKeyName(e)}))){t.next=6;break}throw hc.collectionKeyNotGiven;case 6:n=k(e),t.prev=7,n.s();case 9:if((r=n.n()).done){t.next=15;break}return a=r.value,t.next=13,this._requestInsert(fc(a));case 13:t.next=9;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),n.e(t.t0);case 20:return t.prev=20,n.f(),t.finish(20);case 23:return t.next=25,this._transaction.commit();case 25:return this._mutex.unlock(),t.abrupt("return",e);case 29:return t.prev=29,t.t1=t.catch(3),t.next=33,this._transaction.clear();case 33:throw this._mutex.unlock(),t.t1;case 35:t.next=38;break;case 37:throw hc.collectionNotReady;case 38:case"end":return t.stop()}}),t,this,[[3,29],[7,17,20,23]])})))}},{key:"upsertOne",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=22;break}return t.next=3,this._mutex.lock();case 3:if(t.prev=3,this._hasPropertyOfKeyName(e)){t.next=6;break}throw hc.collectionKeyNotGiven;case 6:return t.next=8,this._requestUpsert(fc(e));case 8:return t.next=10,this._transaction.commit();case 10:return this._mutex.unlock(),t.abrupt("return",e);case 14:return t.prev=14,t.t0=t.catch(3),t.next=18,this._transaction.clear();case 18:throw this._mutex.unlock(),t.t0;case 20:t.next=23;break;case 22:throw hc.collectionNotReady;case 23:case"end":return t.stop()}}),t,this,[[3,14]])})))}},{key:"upsertMany",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=37;break}return t.next=3,this._mutex.lock();case 3:if(t.prev=3,!e.some((function(e){return!i._hasPropertyOfKeyName(e)}))){t.next=6;break}throw hc.collectionKeyNotGiven;case 6:n=k(e),t.prev=7,n.s();case 9:if((r=n.n()).done){t.next=15;break}return a=r.value,t.next=13,this._requestUpsert(fc(a));case 13:t.next=9;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),n.e(t.t0);case 20:return t.prev=20,n.f(),t.finish(20);case 23:return t.next=25,this._transaction.commit();case 25:return this._mutex.unlock(),t.abrupt("return",e);case 29:return t.prev=29,t.t1=t.catch(3),t.next=33,this._transaction.clear();case 33:throw this._mutex.unlock(),t.t1;case 35:t.next=38;break;case 37:throw hc.collectionNotReady;case 38:case"end":return t.stop()}}),t,this,[[3,29],[7,17,20,23]])})))}},{key:"update",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=22;break}return t.next=3,this._mutex.lock();case 3:if(t.prev=3,this._hasPropertyOfKeyName(e)){t.next=6;break}throw hc.collectionKeyNotGiven;case 6:return t.next=8,this._requestUpdate(fc(e));case 8:return t.next=10,this._transaction.commit();case 10:return this._mutex.unlock(),t.abrupt("return",e);case 14:return t.prev=14,t.t0=t.catch(3),t.next=18,this._transaction.clear();case 18:throw this._mutex.unlock(),t.t0;case 20:t.next=23;break;case 22:throw hc.collectionNotReady;case 23:case"end":return t.stop()}}),t,this,[[3,14]])})))}},{key:"updateIf",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c,l,h,d,f,p=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.isReady){n.next=31;break}return n.next=3,this._mutex.lock();case 3:return n.prev=3,r=e.where,a=void 0===r?{}:r,i=e.index,s=void 0===i?null:i,o=e.backward,u=void 0!==o&&o,c=[],l=new Cc({condition:a,blockManager:this._blockManager,backward:u,indexer:this._getIndexerBy(s)}),n.next=9,l.each((function(e){return E(p,void 0,void 0,regeneratorRuntime.mark((function n(){var r,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.error){n.next=4;break}if(e.hasNext){if(r=e.nextValue,_c(a,r)&&t.set){if("function"!=typeof t.set)for(i in t.set)r[i]=t.set[i];else t.set(r);c.push(r)}e.next()}else e.stop();n.next=6;break;case 4:throw e.stop(),e.error;case 6:case"end":return n.stop()}}),n)})))}));case 9:h=0,d=c;case 10:if(!(h<d.length)){n.next=17;break}return f=d[h],n.next=14,this._requestUpdate(fc(f));case 14:h++,n.next=10;break;case 17:return n.next=19,this._transaction.commit();case 19:return this._mutex.unlock(),n.abrupt("return",c);case 23:return n.prev=23,n.t0=n.catch(3),n.next=27,this._transaction.clear();case 27:throw this._mutex.unlock(),n.t0;case 29:n.next=33;break;case 31:throw this._transaction.clear(),hc.collectionNotReady;case 33:case"end":return n.stop()}}),n,this,[[3,23]])})))}},{key:"remove",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=19;break}return t.next=3,this._mutex.lock();case 3:return t.prev=3,t.next=6,this._requestRemove(e);case 6:return t.next=8,this._transaction.commit();case 8:this._mutex.unlock(),t.next=17;break;case 11:return t.prev=11,t.t0=t.catch(3),t.next=15,this._transaction.clear();case 15:throw this._mutex.unlock(),t.t0;case 17:t.next=20;break;case 19:throw hc.collectionNotReady;case 20:case"end":return t.stop()}}),t,this,[[3,11]])})))}},{key:"removeIf",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c,l,h,d,f=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=29;break}return t.next=3,this._mutex.lock();case 3:return t.prev=3,n=e.where,r=void 0===n?{}:n,a=e.index,i=void 0===a?null:a,s=e.backward,o=void 0!==s&&s,u=[],c=new Cc({condition:r,blockManager:this._blockManager,backward:o,indexer:this._getIndexerBy(i)}),t.next=9,c.each((function(e){return E(f,void 0,void 0,regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.error){t.next=4;break}e.hasNext?(n=e.nextValue,_c(r,n)&&(a=n[this.keyName],u.push(a)),e.next()):e.stop(),t.next=6;break;case 4:throw e.stop(),e.error;case 6:case"end":return t.stop()}}),t,this)})))}));case 9:l=0,h=u;case 10:if(!(l<h.length)){t.next=17;break}return d=h[l],t.next=14,this._requestRemove(d);case 14:l++,t.next=10;break;case 17:return t.next=19,this._transaction.commit();case 19:return this._mutex.unlock(),t.abrupt("return",u);case 23:throw t.prev=23,t.t0=t.catch(3),this._mutex.unlock(),t.t0;case 27:t.next=31;break;case 29:throw this._transaction.clear(),hc.collectionNotReady;case 31:case"end":return t.stop()}}),t,this,[[3,23]])})))}},{key:"clear",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isReady){e.next=19;break}return e.next=3,this._mutex.lock();case 3:return e.prev=3,e.next=6,this._requestClear();case 6:return e.next=8,this._transaction.commit();case 8:this._mutex.unlock(),e.next=17;break;case 11:return e.prev=11,e.t0=e.catch(3),e.next=15,this._transaction.clear();case 15:throw this._mutex.unlock(),e.t0;case 17:e.next=20;break;case 19:throw hc.collectionNotReady;case 20:case"end":return e.stop()}}),e,this,[[3,11]])})))}},{key:"getBlob",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._blobContainer.get(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"saveBlob",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this._blobContainer.save(e,t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"removeBlob",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._blobContainer.remove(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"removeAllBlobs",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blobContainer.clear();case 2:case"end":return e.stop()}}),e,this)})))}}],[{key:"metadataOf",value:function(e,t,n){return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=Nc(e,t),r.next=3,n.get(a);case 3:return r.abrupt("return",r.sent);case 4:case"end":return r.stop()}}),r)})))}}]),e}(),Kc=function(){function e(t){var r,a,i;n(this,e),this.encryption=null!==(r=t.encryption)&&void 0!==r?r:q,this.itemSizeLimit=null!==(a=t.itemSizeLimit)&&void 0!==a?a:4194304,this.metadataBuffer=null!==(i=t.metadataBuffer)&&void 0!==i?i:256}return a(e,[{key:"_getRawKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"".concat(e).concat(t)}},{key:"_generateShardPostfixArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return _(Array(e).keys())}},{key:"_shardify",value:function(e){var t=this,n=e.key,r=e.value,a=JSON.stringify(this.encryption.encrypt(r)),i=Math.ceil(a.length/this.adjustedItemSizeLimit);return this._generateShardPostfixArray(i).map((function(e){var r={key:t._getRawKey(n,".".concat(e)),data:a.substring(e*t.adjustedItemSizeLimit,(e+1)*t.adjustedItemSizeLimit)};return 0===e&&(r.metadata={shards:i}),r}))}},{key:"adjustedItemSizeLimit",get:function(){return Math.max(this.itemSizeLimit-this.metadataBuffer,4)}},{key:"usage",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=0,e.next=3,this._getAllRawKeys();case 3:n=e.sent,r=k(n),e.prev=5,r.s();case 7:if((a=r.n()).done){e.next=15;break}return i=a.value,e.next=11,this._getRaw(i);case 11:(s=e.sent)&&(t+=JSON.stringify(s).length);case 13:e.next=7;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(5),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return e.abrupt("return",t);case 24:case"end":return e.stop()}}),e,this,[[5,17,20,23]])})))}},{key:"getAllKeys",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getAllRawKeys();case 2:return t=e.sent,e.abrupt("return",t.filter((function(e){return e.endsWith(".0")})).map((function(e){return e.replace(/\.0$/,"")})));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"get",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this._getRawKey(e,".0"),t.next=3,this._getRaw(n);case 3:if(!(r=t.sent)){t.next=21;break}if(t.prev=5,a=r.data,!((null==(i=r.metadata)?void 0:i.shards)>1)){t.next=13;break}return t.next=10,Promise.all(this._generateShardPostfixArray(null==i?void 0:i.shards).map((function(t){return E(o,void 0,void 0,regeneratorRuntime.mark((function n(){var r,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(t>0)){n.next=10;break}return r=this._getRawKey(e,".".concat(t)),n.next=4,this._getRaw(r);case 4:if(i=n.sent){n.next=7;break}throw hc.storeBrokenIntegrity;case 7:return n.abrupt("return",i.data);case 10:return n.abrupt("return",a);case 11:case"end":return n.stop()}}),n,this)})))})));case 10:t.t0=t.sent,t.next=14;break;case 13:t.t0=[a];case 14:return s=t.t0,t.abrupt("return",this.encryption.decrypt(JSON.parse(s.join(""))));case 18:return t.prev=18,t.t1=t.catch(5),t.abrupt("return",null);case 21:return t.abrupt("return",null);case 22:case"end":return t.stop()}}),t,this,[[5,18]])})))}},{key:"set",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this._shardify(e),t.next=3,this._setRaw(n);case 3:return t.abrupt("return",Object.assign({},e.value));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"setMany",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._setRaw((n=[]).concat.apply(n,_(e.map((function(e){return r._shardify(e)})))));case 2:return t.abrupt("return",e.map((function(e){return e.value})));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"remove",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this._getRawKey(e,".0"),t.next=3,this._getRaw(n);case 3:if(!(r=t.sent)){t.next=9;break}return a=r.metadata,t.next=8,this._removeRaw(this._generateShardPostfixArray(null==a?void 0:a.shards).map((function(t){return i._getRawKey(e,".".concat(t))})));case 8:return t.abrupt("return",!0);case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,this)})))}},{key:"removeMany",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=[],r=k(e),t.prev=2,i=regeneratorRuntime.mark((function e(){var t,r,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.value,r=s._getRawKey(t,".0"),e.next=4,s._getRaw(r);case 4:(i=e.sent)&&(o=i.metadata,n.push.apply(n,_(s._generateShardPostfixArray(null==o?void 0:o.shards).map((function(e){return s._getRawKey(t,".".concat(e))})))));case 6:case"end":return e.stop()}}),e)})),r.s();case 5:if((a=r.n()).done){t.next=9;break}return t.delegateYield(i(),"t0",7);case 7:t.next=5;break;case 9:t.next=14;break;case 11:t.prev=11,t.t1=t.catch(2),r.e(t.t1);case 14:return t.prev=14,r.f(),t.finish(14);case 17:if(!(n.length>0)){t.next=20;break}return t.next=20,this._removeRaw(n);case 20:return t.abrupt("return",e);case 21:case"end":return t.stop()}}),t,this,[[2,11,14,17]])})))}}]),e}(),Wc=4194304,Yc={},Zc=function(e){i(r,e);var t=f(r);function r(){var e,a,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,r),e=t.call(this,Object.assign(Object.assign({},i),{itemSizeLimit:null!==(a=i.itemSizeLimit)&&void 0!==a?a:Wc}));var s=i.delay,o=void 0===s?1:s;return e.delay=o,e.observer={},e}return a(r,[{key:"rawData",get:function(){return Yc[this.dbname]},set:function(e){Yc[this.dbname]=e}},{key:"_getAllRawKeys",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Yc[this.dbname]){e.next=4;break}return e.abrupt("return",Object.keys(Yc[this.dbname]));case 4:throw hc.storeNotAvailable;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"_getRaw",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Yc[this.dbname]){t.next=6;break}return t.next=3,mc(this.delay);case 3:return t.abrupt("return",Yc[this.dbname][e]?Object.assign({key:e},Yc[this.dbname][e]):null);case 6:throw hc.storeNotAvailable;case 7:case"end":return t.stop()}}),t,this)})))}},{key:"_setRaw",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Yc[this.dbname]){t.next=7;break}return t.next=3,mc(this.delay);case 3:n=k(e);try{for(n.s();!(r=n.n()).done;)a=r.value,i=a.key,s=a.data,o=a.metadata,Yc[this.dbname][i]=Object.freeze({data:s,metadata:o})}catch(e){n.e(e)}finally{n.f()}t.next=8;break;case 7:throw hc.storeNotAvailable;case 8:case"end":return t.stop()}}),t,this)})))}},{key:"_removeRaw",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Yc[this.dbname]){t.next=7;break}return t.next=3,mc(this.delay);case 3:n=k(e);try{for(n.s();!(r=n.n()).done;)a=r.value,Yc[this.dbname][a]&&delete Yc[this.dbname][a]}catch(e){n.e(e)}finally{n.f()}t.next=8;break;case 7:throw hc.storeNotAvailable;case 8:case"end":return t.stop()}}),t,this)})))}},{key:"observe",value:function(e,t,n){var r=this;this.observer[e]||(this.observer[e]={}),t.forEach((function(t){return r.observer[e][t]=n}))}},{key:"isAvailable",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})))}},{key:"init",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.dbname=e,Yc[this.dbname]={};case 2:case"end":return t.stop()}}),t,this)})))}},{key:"set",value:function(e){var t=this,n=Object.create(null,{set:{get:function(){return v(s(r.prototype),"set",t)}}});return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.observer[e.key]||"function"!=typeof this.observer[e.key].set){t.next=4;break}if(!(r=this.observer[e.key].set())){t.next=4;break}throw r;case 4:return t.abrupt("return",n.set.call(this,e));case 5:case"end":return t.stop()}}),t,this)})))}},{key:"setMany",value:function(e){var t=this,n=Object.create(null,{setMany:{get:function(){return v(s(r.prototype),"setMany",t)}}});return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,a,i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=k(e),t.prev=1,r.s();case 3:if((a=r.n()).done){t.next=11;break}if(i=a.value,!this.observer[i.key]||"function"!=typeof this.observer[i.key].set){t.next=9;break}if(!(s=this.observer[i.key].set())){t.next=9;break}throw s;case 9:t.next=3;break;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),r.e(t.t0);case 16:return t.prev=16,r.f(),t.finish(16);case 19:return t.abrupt("return",n.setMany.call(this,e));case 20:case"end":return t.stop()}}),t,this,[[1,13,16,19]])})))}},{key:"clear",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mc(this.delay);case 2:Yc[this.dbname]={};case 3:case"end":return e.stop()}}),e,this)})))}}]),r}(Kc),Xc=104857600,Jc="NestDBStore",$c=function(e){i(r,e);var t=f(r);function r(){var e,a,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,r),(e=t.call(this,Object.assign(Object.assign({},i),{itemSizeLimit:null!==(a=i.itemSizeLimit)&&void 0!==a?a:Xc})))._storeName=Jc,e._window="undefined"!=typeof window?window:null,e._indexedDb=e._window?e._window.indexedDB||e._window.mozIndexedDB||e._window.webkitIndexedDB||e._window.msIndexedDB:null,e}return a(r,[{key:"_getObjectStore",value:function(e){return this._database.transaction(this._storeName,e).objectStore(this._storeName)}},{key:"_getAllRawKeys",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){var r=t._getObjectStore("readonly").getAllKeys();r.addEventListener("success",(function(t){e(t.target.result)})),r.addEventListener("error",(function(e){return n(e.target.error)}))}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}},{key:"_getRaw",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t,r){var a=n._getObjectStore("readonly").get(e);a.addEventListener("success",(function(e){var n;t(null===(n=null==e?void 0:e.target)||void 0===n?void 0:n.result)})),a.addEventListener("error",(function(e){return r(e.target.error)}))}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))}},{key:"_setRaw",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this._getObjectStore("readwrite"),t.next=3,Promise.all(e.map((function(e){return new Promise((function(t,r){var a=n.put(e);a.addEventListener("success",(function(e){t(e.target.result)})),a.addEventListener("error",(function(){r("Failed to write.")}))}))})));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"_removeRaw",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this._getObjectStore("readwrite"),t.next=3,Promise.all(e.map((function(e){return new Promise((function(t,r){var a=n.delete(e);a.addEventListener("success",(function(){return t(e)})),a.addEventListener("error",(function(e){return r(e.target.error)}))}))})));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"isAvailable",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((null==(t="undefined"!=typeof window?window:null)?void 0:t.indexedDB)||(null==t?void 0:t.mozIndexedDB)||(null==t?void 0:t.webkitIndexedDB)||(null==t?void 0:t.msIndexedDB))){e.next=15;break}return e.prev=2,this._indexedDb=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB,n="undefined"!=typeof document&&"undefined"!=typeof navigator,r=navigator.userAgent&&navigator.userAgent.includes("Firefox/")&&!navigator.userAgent.includes("Seamonkey/"),a=navigator.userAgent&&navigator.userAgent.includes("Edge/"),e.next=9,new Promise((function(e,s){if(n)if(r){var o=i._indexedDb.open("_testMozilla");o.onerror=function(){return s("Private browsing mode.")},o.onsuccess=function(){return e()}}else a?(t.PointerEvent||t.MSPointerEvent)&&s("Private browsing mode."):e()}));case 9:return e.abrupt("return",!0);case 12:return e.prev=12,e.t0=e.catch(2),e.abrupt("return",!1);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,this,[[2,12]])})))}},{key:"init",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.dbname=e,n=new Promise((function(e,t){if(r._window&&Io)if(No){var n=r._indexedDb.open("_testMozilla");n.onerror=function(){return t(hc.storeNotAvailableInPrivateBrowsing)},n.onsuccess=function(){return e()}}else Uo?r._window.indexedDB||!r._window.PointerEvent&&!r._window.MSPointerEvent||t(hc.storeNotAvailableInPrivateBrowsing):e();else t(hc.storeNotAvailable)})),t.next=4,n;case 4:return t.next=6,new Promise((function(t,n){var a=r._indexedDb.open(e);a.addEventListener("upgradeneeded",(function(e){e.target.result.createObjectStore(Jc,{keyPath:"key"})})),a.addEventListener("success",(function(e){return t(e.target.result)})),a.addEventListener("error",(function(e){return n(e.target.error)}))}));case 6:this._database=t.sent;case 7:case"end":return t.stop()}}),t,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){var r=t._getObjectStore("readwrite").clear();r.addEventListener("success",(function(){return e()})),r.addEventListener("error",(function(e){return n(e.target.error)}))}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}}]),r}(Kc),el=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.AsyncStorage,s=e.itemSizeLimit,o=void 0===s?6291456:s,u=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(e,["AsyncStorage","itemSizeLimit"]);return(a=t.call(this,Object.assign(Object.assign({},u),{itemSizeLimit:o})))._asyncStorage=i,a}return a(r,[{key:"_isBelonging",value:function(e){return e.startsWith("".concat(this.dbname,"/"))}},{key:"_getActualKey",value:function(e){return"".concat(this.dbname,"/").concat(e)}},{key:"_getAllRawKeys",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._asyncStorage.getAllKeys();case 2:return t=e.sent,n=t.filter((function(e){return r._isBelonging(e)})),e.abrupt("return",n.map((function(e){return e.substring("".concat(r.dbname,"/").length)})));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"_getRaw",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._asyncStorage.getItem(this._getActualKey(e));case 2:return n=t.sent,t.abrupt("return",n?JSON.parse(n):null);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"_setRaw",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=[],r=k(e);try{for(r.s();!(a=r.n()).done;)i=a.value,s=i.key,i.data.length<=this.adjustedItemSizeLimit&&n.push([this._getActualKey(s),JSON.stringify(i)])}catch(e){r.e(e)}finally{r.f()}return t.next=5,this._asyncStorage.multiSet(n);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"_removeRaw",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._asyncStorage.multiRemove(e.map((function(e){return n._getActualKey(e)})));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"isAvailable",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!!this._asyncStorage);case 1:case"end":return e.stop()}}),e,this)})))}},{key:"init",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.dbname=e;case 1:case"end":return t.stop()}}),t,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllKeys();case 2:return t=e.sent,e.next=5,this.removeMany(t);case 5:case"end":return e.stop()}}),e,this)})))}}]),r}(Kc),tl=function(e){return E(void 0,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.usage();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))},nl="[NESTDB]",rl=!0,al=function(){function e(){n(this,e)}return a(e,null,[{key:"off",value:function(){rl=!1}},{key:"log",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];rl&&(e=console).log.apply(e,["".concat(nl,"[LOG]")].concat(n))}},{key:"warning",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];rl&&(e=console).warn.apply(e,["".concat(nl,"[WARNING]")].concat(n))}},{key:"error",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];rl&&(e=console).error.apply(e,["".concat(nl,"[ERROR]")].concat(n))}}]),e}();!function(e){e.INIT="INIT",e.OPENING="OPENING",e.OPENED="OPENED",e.CLOSED="CLOSED"}(Lc||(Lc={}));var il,sl=function(){function e(t){var r=t.name,a=t.version,i=t.store,s=t.config;n(this,e),this.name=r,this._version=a,this._state=Lc.INIT,this._config=s||new cc({dbname:r}),this._store=i,this._event={success:gc,error:gc,upgrade:Ec},this._collections=new Map,this._globalMutex=new Po("".concat(this.name,".lock")),this._config.disableLogger&&al.off(),new Hc({dbname:r,limit:this._config.cacheLimit})}return a(e,[{key:"version",get:function(){return this._version}},{key:"state",get:function(){return this._state}},{key:"estimateUsage",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tl(this._store);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"commitSchema",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._state!==Lc.OPENING){t.next=5;break}return t.next=3,Promise.all(e.map((function(e){return E(n,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.collectionName,r=e.keyName,a=e.index,i=void 0===a?[]:a,this._collections.has(n)||this._collections.set(n,new Qc({dbname:this.name,collectionName:n,keyName:r,indexes:i,store:this._store})),t.next=4,this._collections.get(n).init();case 4:case"end":return t.stop()}}),t,this)})))})));case 3:t.next=6;break;case 5:throw hc.databaseSchemaNotOnUpgrade;case 6:case"end":return t.stop()}}),t,this)})))}},{key:"open",value:function(){var e;return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._globalMutex.lock();case 2:if(this._state===Lc.OPENED){t.next=55;break}return this._state=Lc.OPENING,t.prev=4,t.next=7,this._store.init(this.name);case 7:return s=this.name,n="".concat(Sc(s),".metadata"),r={version:0,collectionNames:[]},t.next=11,this._store.get(n);case 11:if(t.t1=e=t.sent,t.t0=null!==t.t1,!t.t0){t.next=15;break}t.t0=void 0!==e;case 15:if(!t.t0){t.next=19;break}t.t2=e,t.next=20;break;case 19:t.t2=r;case 20:return a=t.t2,t.abrupt("return",new Promise((function(e,t){var r=function(e){a.version<i._version?i._event.upgrade(a.version,(function(t){return E(i,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t){r.next=14;break}return a.version++,a.collectionNames=Array.from(this._collections.keys()),r.prev=3,r.next=6,this._store.set({key:n,value:a,generation:this._version});case 6:e({continued:!0}),r.next=12;break;case 9:r.prev=9,r.t0=r.catch(3),e({continued:!1,err:r.t0});case 12:r.next=15;break;case 14:e({continued:!1,err:t});case 15:case"end":return r.stop()}}),r,this,[[3,9]])})))})):e({continued:!1})};r((function n(s){var o=s.continued,u=void 0!==o&&o,c=s.err,l=void 0===c?null:c;if(u)setTimeout((function(){return r(n)}),10);else if(l)al.error(l.message),i._globalMutex.unlock(),i._event.error(l),t(l);else{var h=[];a.collectionNames.forEach((function(e){i._collections.has(e)||h.push(E(i,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Qc.metadataOf(this.name,e,this._store);case 2:if(!(n=t.sent)){t.next=8;break}return r=new Qc({dbname:this.name,collectionName:e,keyName:n.keyName,indexes:n.indexes,store:this._store}),this._collections.set(e,r),t.next=8,r.init();case 8:case"end":return t.stop()}}),t,this)}))))})),Promise.all(h).then((function(){i._state=Lc.OPENED,i._globalMutex.unlock(),i._event.success(),e()})).catch((function(e){al.error(e.message),i._globalMutex.unlock(),i._event.error(e),t(e)}))}}))})));case 24:t.prev=24,t.t3=t.catch(4),t.t4=t.t3.code,t.next=t.t4===Xo.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING?29:t.t4===Xo.STORE_NOT_AVAILABLE?36:t.t4===Xo.STORE_ENCRYPTION_INVALID?43:51;break;case 29:return al.warning("Access to the local storage is not allowed in private browsing. Switched to MemoryStore automatically."),this._store=new Zc({}),this._globalMutex.unlock(),this._event.error(t.t3),t.next=35,this.open();case 35:return t.abrupt("break",55);case 36:return al.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new Zc({}),this._globalMutex.unlock(),this._event.error(t.t3),t.next=42,this.open();case 42:return t.abrupt("break",55);case 43:return al.warning("Encryption algorithm has changed. Stored data would be cleared."),t.next=46,this._store.clear();case 46:return this._globalMutex.unlock(),this._event.error(t.t3),t.next=50,this.open();case 50:return t.abrupt("break",55);case 51:throw al.error(t.t3.message),this._globalMutex.unlock(),this._event.error(t.t3),t.t3;case 55:case"end":return t.stop()}var s}),t,this,[[4,24]])})))}},{key:"close",value:function(){this._collections.forEach((function(e){return e.close()})),this._state=Lc.CLOSED}},{key:"clear",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(Array.from(this._collections.values()).map((function(e){return e.clear()})));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"reset",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.close(),(t=Hc.get(this.name))&&t.clearByCondition((function(e){return e.key.startsWith(Sc(n.name))})),e.next=5,this._store.clear();case 5:case"end":return e.stop()}}),e,this)})))}},{key:"on",value:function(e,t){this._event[e]=t}},{key:"off",value:function(e){if("function"==typeof this._event[e])if("upgrade"===e)this._event[e]=Ec;else this._event[e]=gc}},{key:"collection",value:function(e){return this._collections.get(e)||null}}]),e}();e.RestrictionType=void 0,(il=e.RestrictionType||(e.RestrictionType={})).MUTED="muted",il.BANNED="banned";var ol,ul=function(){function t(r){var a,i,s;n(this,t),this.restrictionType=null,this.description=null,this.endAt=-1,M(e.RestrictionType,r.restriction_type)&&(this.restrictionType=r.restriction_type),this.description=null!==(a=r.description)&&void 0!==a?a:null,this.endAt=null!==(s=null!==(i=r.end_at)&&void 0!==i?i:r.muted_end_at)&&void 0!==s?s:-1}return a(t,null,[{key:"payloadify",value:function(e){return e?Z({restriction_type:e.restrictionType,description:e.description,end_at:e.endAt}):null}}]),t}(),cl=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).restrictionInfo=null,i.restrictionInfo=new ul(a),i}return a(r,null,[{key:"payloadify",value:function(e){return e?Z(Object.assign(Object.assign({},v(s(r),"payloadify",this).call(this,e)),ul.payloadify(e.restrictionInfo))):null}}]),r}(Ua),ll={data:null,customType:null,mentionType:e.MentionType.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},hl=function(t){return A("string",t.data,!0)&&A("string",t.customType,!0)&&M(e.MentionType,t.mentionType)&&O("string",t.mentionedUserIds,!0)&&O(Ua,t.mentionedUsers,!0)&&A("string",t.mentionedMessageTemplate,!0)&&O(pi,t.metaArrays,!0)&&M(e.PushNotificationDeliveryOption,t.pushNotificationDeliveryOption,!0)&&A(_i,t.appleCriticalAlertOptions,!0)},dl=Object.assign(Object.assign({},ll),{message:null,translationTargetLanguages:null,pollId:null}),fl=function(e){return hl(e)&&A("string",e.message,!0)&&O("string",e.translationTargetLanguages,!0)&&A("number",e.pollId,!0)},pl=Object.assign({},ll),vl=function(e){return hl(e)},ml=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelUrl,s=e.channelType,o=e.token,u=e.limit;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/operators"),a.params={token:o,limit:u},a}return a(r)}(J),_l=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).operators=a.operators.map((function(t){return new Ua(e,t)})),i.token=a.next,i}return a(r)}($),gl=function(e){i(r,e);var t=f(r);function r(e,a,i,s){return n(this,r),t.call(this,e,a,i,s)}return a(r,[{key:"_validate",value:function(){return v(s(r.prototype),"_validate",this).call(this)}},{key:"next",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=21;break}if(this._isLoading){e.next=18;break}if(t=[],!this._hasNext){e.next=15;break}return this._isLoading=!0,n=Ya.of(this._iid),r=n.requestQueue,a=new ml(Object.assign(Object.assign({},this),{channelUrl:this.channelUrl,token:this._token})),e.next=9,r.send(a);case 9:return i=e.sent,s=i.as(_l),o=s.operators,u=s.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 15:return e.abrupt("return",t);case 18:throw T.queryInProgress;case 19:e.next=22;break;case 21:throw T.invalidParameters;case 22:case"end":return e.stop()}}),e,this)})))}}]),r}(Ts),yl=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.limit,u=e.token;return(a=t.call(this)).method=R.GET,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/mute"),a.params={limit:o,token:u},a}return a(r)}(J),kl=function(e){i(r,e);var t=f(r);function r(e,a){var i;n(this,r),(i=t.call(this,e,a)).token=null,i.mutedUsers=[];var s=a.next,o=a.muted_list;return i.token=s,o&&o.length>0&&(i.mutedUsers=o.map((function(t){return new cl(e,t)}))),i}return a(r)}($),El=function(e){i(r,e);var t=f(r);function r(e,a,i,s){return n(this,r),t.call(this,e,a,i,s)}return a(r,[{key:"next",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,t=Ya.of(this._iid),n=t.requestQueue,r=new yl(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,n.send(r);case 8:return a=e.sent,i=a.as(kl),s=i.mutedUsers,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,e.abrupt("return",s);case 14:return e.abrupt("return",[]);case 17:throw T.queryInProgress;case 18:e.next=21;break;case 20:throw T.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),r}(Ts),bl=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.limit,u=e.token;return(a=t.call(this)).method=R.GET,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/ban"),a.params=Z({limit:o,token:u}),a}return a(r)}(J),wl=function(e){i(r,e);var t=f(r);function r(e,a){var i;n(this,r),(i=t.call(this,e,a)).token=null,i.bannedUsers=[];var s=a.next,o=a.banned_list;return i.token=s,o&&o.length>0&&(i.bannedUsers=o.map((function(t){return new cl(e,t.user)}))),i}return a(r)}($),xl=function(e){i(r,e);var t=f(r);function r(e,a,i,s){return n(this,r),t.call(this,e,a,i,s)}return a(r,[{key:"_validate",value:function(){return v(s(r.prototype),"_validate",this).call(this)}},{key:"next",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,t=Ya.of(this._iid),n=t.requestQueue,r=new bl(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,n.send(r);case 8:return a=e.sent,i=a.as(wl),s=i.bannedUsers,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,e.abrupt("return",s);case 14:return e.abrupt("return",[]);case 17:throw T.queryInProgress;case 18:e.next=21;break;case 20:throw T.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),r}(Ts);e.ReportCategory=void 0,(ol=e.ReportCategory||(e.ReportCategory={})).SPAM="spam",ol.HARASSING="harassing",ol.SUSPICIOUS="suspicious",ol.INAPPROPRIATE="inappropriate";var Rl,Cl=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.operatorUserIds;return(a=t.call(this)).method=R.POST,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/operators"),a.params={operator_ids:o},a}return a(r)}(J),Tl=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.operatorUserIds;return(a=t.call(this)).method=R.DELETE,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/operators"),a.params={operator_ids:o},a}return a(r)}(J),Sl=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.userId;return(a=t.call(this)).method=R.GET,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/mute/").concat(o),a}return a(r)}(J),Il=function(e){i(r,e);var t=f(r);function r(e,a){var i;n(this,r),(i=t.call(this,e,a)).isMuted=!1,i.startAt=null,i.endAt=null,i.remainingDuration=null,i.description=null;var s=a.is_muted,o=a.start_at,u=a.end_at,c=a.remaining_duration,l=a.description;return i.isMuted=s,i.startAt=o,i.endAt=u,i.remainingDuration=c,i.description=l,i}return a(r)}($),Nl=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.keys;return(a=t.call(this)).method=R.GET,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/metadata"),a.params={keys:o,include_ts:!0},a}return a(r)}(J),Al=function(e){i(r,e);var t=f(r);function r(e,a){var i;n(this,r),(i=t.call(this,e,a)).ts=null;var s=a.metadata,o=a.ts;return i.metadata=s,i.ts=null!=o?o:null,i}return a(r)}($),Ml=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.metadata;return(a=t.call(this)).method=R.POST,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/metadata"),a.params={metadata:o,include_ts:!0},a}return a(r)}(J),Ul=function(e){i(r,e);var t=f(r);function r(e,a){var i,s,o;return n(this,r),(i=t.call(this,e,a)).metaData=null!==(s=a.metadata)&&void 0!==s?s:{},i.ts=null!==(o=a.ts)&&void 0!==o?o:null,i}return a(r)}($),Ol=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.metadata,u=e.upsert;return(a=t.call(this)).method=R.PUT,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/metadata"),a.params={metadata:o,include_ts:!0,upsert:null!=u&&u},a}return a(r)}(J),Dl=function(e){i(r,e);var t=f(r);function r(e,a){var i;n(this,r),(i=t.call(this,e,a)).ts=null;var s=a.metadata,o=a.ts;return i.metadata=s,i.ts=null!=o?o:null,i}return a(r)}($),Ll=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"SYEV",i)).created=null,s.updated=null,s.deleted=null,i.data&&(s.created=i.data.created,s.updated=i.data.updated,s.deleted=i.data.deleted),s}return a(r)}(ie),Pl=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.key;return(a=t.call(this)).method=R.DELETE,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/metadata/").concat(o),a.params={include_ts:!0},a}return a(r)}(J),Fl=function(e){i(r,e);var t=f(r);function r(e,a){var i;n(this,r),(i=t.call(this,e,a)).ts=null;var s=a.ts;return i.ts=null!=s?s:null,i}return a(r)}($),Hl=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType;return(a=t.call(this)).method=R.DELETE,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/metadata"),a.params={include_ts:!0},a}return a(r)}(J),Gl=function(e){i(r,e);var t=f(r);function r(e,a){var i;n(this,r),(i=t.call(this,e,a)).ts=null;var s=a.ts;return i.ts=null!=s?s:null,i}return a(r)}($),ql=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.keys;return(a=t.call(this)).method=R.GET,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/metacounter"),a.params={keys:o},a}return a(r)}(J),jl=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).metaCounter=a,i}return a(r)}($),zl=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.metaCounter;return(a=t.call(this)).method=R.POST,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/metacounter"),a.params={metacounter:o},a}return a(r)}(J),Vl=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).metaCounter=a,i}return a(r)}($),Bl=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.metaCounter,u=e.upsert,c=void 0!==u&&u,l=e.mode,h=void 0===l?"set":l;return(a=t.call(this)).method=R.PUT,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/metacounter"),a.params={metacounter:o,upsert:c,mode:h},a}return a(r)}(J),Ql=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).metaCounter=a,i}return a(r)}($),Kl=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"SYEV",i)).created=null,s.updated=null,s.deleted=null,i.data&&(s.created=i.data.created,s.updated=i.data.updated,s.deleted=i.data.deleted),s}return a(r)}(ie),Wl=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.key;return(a=t.call(this)).method=R.DELETE,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/metacounter/").concat(o),a.params=null,a}return a(r)}(J),Yl=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType;return(a=t.call(this)).method=R.DELETE,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/metacounter"),a.params=null,a}return a(r)}(J),Zl=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.userId,u=e.seconds,c=e.description;return(a=t.call(this)).method=R.POST,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/mute"),a.params={user_id:o,seconds:u,description:c},a}return a(r)}(J),Xl=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"SYEV",i)).user=new cl(e,i.data),s}return a(r)}(ie),Jl=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.userId;return(a=t.call(this)).method=R.DELETE,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/mute/").concat(encodeURIComponent(o)),a}return a(r)}(J),$l=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"SYEV",i)).user=new cl(e,i.data),s}return a(r)}(ie),eh=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.userId,u=e.seconds,c=e.description;return(a=t.call(this)).method=R.POST,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/ban"),a.params=Z({user_id:o,seconds:u,description:c}),a}return a(r)}(J),th=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"SYEV",i)).memberCount=null,s.joinedMemberCount=null,s.user=new cl(e,i.data),i.data.member_count&&(s.memberCount=i.data.member_count),i.data.joined_member_count&&(s.joinedMemberCount=i.data.joined_member_count),s}return a(r)}(ie),nh=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.userId;return(a=t.call(this)).method=R.DELETE,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/ban/").concat(encodeURIComponent(o)),a}return a(r)}(J),rh=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"SYEV",i)).user=new cl(e,i.data),s}return a(r)}(ie),ah=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.freezing;return(a=t.call(this)).method=R.PUT,a.path="".concat(Fi(s),"/").concat(encodeURIComponent(i),"/freeze"),a.params={freeze:o},a}return a(r)}(J),ih=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"SYEV",i)).freeze=i.data.freeze,s}return a(r)}(ie),sh=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.category,u=e.userId,c=e.description;return(a=t.call(this)).method=R.POST,a.path="".concat(Hi(s),"/").concat(encodeURIComponent(i)),a.params={report_category:o,reporting_user_id:u,report_description:c},a}return a(r)}(J),oh=function(t){i(s,t);var r=f(s);function s(t){var a;n(this,s);var i=t.channelUrl,o=t.channelType,u=t.category,c=t.userId,l=t.offendingUserId,h=t.description;return(a=r.call(this)).method=R.POST,a.path="".concat(Qr,"/users/").concat(l),a.params={channel_url:i,channel_type:o===e.ChannelType.OPEN?"open_channels":"group_channels",report_category:u,reporting_user_id:c,report_description:h},a}return a(s)}(J),uh=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.channelType,o=e.category,u=e.userId,c=e.offendingUserId,l=e.messageId,h=e.description;return(a=t.call(this)).method=R.POST,a.path="".concat(Hi(s),"/").concat(encodeURIComponent(i),"/messages/").concat(l),a.params={report_category:o,reporting_user_id:u,report_description:h,offending_user_id:c},a}return a(r)}(J),ch=function(t){i(s,t);var r=f(s);function s(t){n(this,s);var a=[];return t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?a=t.mentionedUserIds:t.mentionedUsers&&(a=t.mentionedUsers.map((function(e){return e.userId})))),r.call(this,{code:"MESG",ackRequired:!0,payload:Z({channel_url:t.channelUrl,message:t.message,data:t.data,custom_type:t.customType,metaarray:t.metaArrays,mention_type:t.mentionType,mentioned_user_ids:a,mentioned_message_template:t.mentionedMessageTemplate,target_langs:t.translationTargetLanguages,push_option:t.pushNotificationDeliveryOption&&t.pushNotificationDeliveryOption!==e.PushNotificationDeliveryOption.DEFAULT?t.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:t.appleCriticalAlertOptions,silent:t.silent,reply_to_channel:t.isReplyToChannel,parent_message_id:t.parentMessageId>0?t.parentMessageId:null,req_id:t.reqId,poll_id:t.pollId,pin_message:t.isPinnedMessage})})}return a(s)}(Ir),lh=function(e){i(r,e);var t=f(r);function r(e,a,i){var s,o,u,c;n(this,r),(s=t.call(this,e,"MESG",i)).message=new Oi(e,i);var l=Ya.of(e).sdkState;return s.isMentioned=Gi(s.message.mentionType,null!==(o=s.message.mentionedUserIds)&&void 0!==o?o:null===(u=s.message.mentionedUsers)||void 0===u?void 0:u.map((function(e){return e.userId})),l.userId),s.forceUpdateLastMessage=null!==(c=i.force_update_last_message)&&void 0!==c&&c,s}return a(r)}(ie),hh=function(t){i(s,t);var r=f(s);function s(t){var a;n(this,s);var i=null;return t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?i=t.mentionedUserIds:t.mentionedUsers&&(i=t.mentionedUsers.map((function(e){return e.userId})))),r.call(this,{code:"MEDI",ackRequired:!0,payload:Z({channel_url:t.channelUrl,msg_id:t.messageId,message:t.message,data:t.data,custom_type:t.customType,metaarray:t.metaArrayParams,mention_type:t.mentionType,mentioned_user_ids:i,mentioned_message_template:t.mentionedMessageTemplate,apple_critical_alert_options:null===(a=t.appleCriticalAlertOptions)||void 0===a?void 0:a.serialize(),poll_id:t.pollId})})}return a(s)}(Ir),dh=function(e){i(r,e);var t=f(r);function r(e,a,i){var s,o,u,c,l,h,d;n(this,r),(s=t.call(this,e,"MEDI",i)).message=new Oi(e,i);var f=Ya.of(e).sdkState;return s.mentionCountChange=qi({mentionType:null!==(u=null===(o=i.old_values)||void 0===o?void 0:o.mention_type)&&void 0!==u?u:null,mentionedUserIds:null!==(l=null===(c=i.old_values)||void 0===c?void 0:c.mentioned_user_ids)&&void 0!==l?l:[]},{mentionType:s.message.mentionType,mentionedUserIds:null!==(h=s.message.mentionedUserIds)&&void 0!==h?h:null===(d=s.message.mentionedUsers)||void 0===d?void 0:d.map((function(e){return e.userId}))},f.userId),s}return a(r)}(ie),fh=function(t){i(s,t);var r=f(s);function s(t){n(this,s);var a=null;return t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?a=t.mentionedUserIds:t.mentionedUsers&&(a=t.mentionedUsers.map((function(e){return e.userId})))),r.call(this,{code:"FEDI",ackRequired:!0,payload:Z({channel_url:t.channelUrl,msg_id:t.messageId,data:t.data,custom_type:t.customType,metaarray:t.metaArrayParams,mention_type:t.mentionType,mentioned_user_ids:a,apple_critical_alert_options:t.appleCriticalAlertOptions})})}return a(s)}(Ir),ph=function(e){i(r,e);var t=f(r);function r(e,a,i){var s,o,u,c,l,h,d;n(this,r),(s=t.call(this,e,"FEDI",i)).message=new Pi(e,i);var f=Ya.of(e).sdkState;return s.mentionCountChange=qi({mentionType:null!==(u=null===(o=i.old_values)||void 0===o?void 0:o.mention_type)&&void 0!==u?u:null,mentionedUserIds:null!==(l=null===(c=i.old_values)||void 0===c?void 0:c.mentioned_user_ids)&&void 0!==l?l:[]},{mentionType:s.message.mentionType,mentionedUserIds:null!==(h=s.message.mentionedUserIds)&&void 0!==h?h:null===(d=s.message.mentionedUsers)||void 0===d?void 0:d.map((function(e){return e.userId}))},f.userId),s}return a(r)}(ie),vh=function(e){i(r,e);var t=f(r);function r(e){var a;return n(this,r),(a=t.call(this)).method=R.DELETE,a.path="".concat(Fi(e.channelType),"/").concat(e.channelUrl,"/messages/").concat(e.messageId),a}return a(r)}(J),mh=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"DELM",i)).channelUrl=i.channel_url,s.channelType=i.channel_type,s.messageId=Number(i.msg_id),s}return a(r)}(ie),_h=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelType,s=e.channelUrl,o=e.messageId,u=e.reactionKey;return n(this,r),(a=t.call(this)).method=R.POST,a.path="".concat(Fi(i),"/").concat(encodeURIComponent(s),"/messages/").concat(o,"/reactions"),a.params={reaction:u},a}return a(r)}(J),gh=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).reactionEvent=new di(a),i}return a(r)}($),yh=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelType,s=e.channelUrl,o=e.messageId,u=e.reactionKey;return n(this,r),(a=t.call(this)).method=R.DELETE,a.path="".concat(Fi(i),"/").concat(encodeURIComponent(s),"/messages/").concat(o,"/reactions"),a.params={reaction:u},a}return a(r)}(J),kh=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).reactionEvent=new di(Object.assign({},a)),i}return a(r)}($),Eh=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelType,s=e.channelUrl,o=e.messageId,u=e.translationTargetLanguages;return n(this,r),(a=t.call(this)).method=R.POST,a.path="".concat(Fi(i),"/").concat(encodeURIComponent(s),"/messages/").concat(encodeURIComponent(o),"/translation"),a.params={target_langs:u},a}return a(r)}(J),bh=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).message=new Oi(e,a),i}return a(r)}($),wh=function(t){i(s,t);var r=f(s);function s(t){var a,i;n(this,s),a=r.call(this);var o=[];t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?o=t.mentionedUserIds:t.mentionedUsers&&(o=t.mentionedUsers.map((function(e){return e.userId}))));var u=t.channelType,c=t.channelUrl;return a.method=R.POST,a.path="".concat(Fi(u),"/").concat(encodeURIComponent(c),"/scheduled_messages"),a.params={req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:Ja.USER,message:t.message,custom_type:t.customType,data:t.data,mention_type:t.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(i=t.metaArrays)||void 0===i?void 0:i.map((function(e){return pi.payloadify(e)})),apple_critical_alert_options:_i.payloadify(t.appleCriticalAlertOptions),target_langs:t.translationTargetLanguages,push_option:t.pushNotificationDeliveryOption},a}return a(s)}(J),xh=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).message=new Oi(e,a),i}return a(r)}($),Rh=function(t){i(s,t);var r=f(s);function s(t){var a,i;n(this,s),a=r.call(this);var o=[];t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?o=t.mentionedUserIds:t.mentionedUsers&&(o=t.mentionedUsers.map((function(e){return e.userId}))));var u=t.channelType,c=t.channelUrl;return a.method=R.POST,a.path="".concat(Fi(u),"/").concat(encodeURIComponent(c),"/scheduled_messages"),a.params={req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:Ja.FILE,url:t.fileUrl,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,thumbnails:t.thumbnailSizes?t.thumbnailSizes.map((function(e){return wi.payloadify(e)})):[],custom_type:t.customType,data:t.data,require_auth:t.requireAuth,mention_type:t.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(i=t.metaArrays)||void 0===i?void 0:i.map((function(e){return pi.payloadify(e)})),apple_critical_alert_options:_i.payloadify(t.appleCriticalAlertOptions),push_option:t.pushNotificationDeliveryOption},a}return a(s)}(J),Ch=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).message=new Pi(e,a),i}return a(r)}($),Th=function(e){return A("string",e.title,!0)&&Ai(e.data)&&A("boolean",e.allowUserSuggestion,!0)&&A("boolean",e.allowMultipleVotes,!0)&&A("number",e.closeAt,!0)},Sh=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.pollId,s=e.title,o=e.data,u=e.allowUserSuggestion,c=e.allowMultipleVotes,l=e.closeAt;return n(this,r),(a=t.call(this)).method=R.PUT,a.path="".concat(Yr,"/").concat(encodeURIComponent(i)),a.params={title:s,data:o,allow_user_suggestion:u,allow_multiple_votes:c,close_at:l},a}return a(r)}(J),Ih=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).poll=new Ui(e,a),i}return a(r)}($),Nh=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.pollId;return n(this,r),(a=t.call(this)).method=R.DELETE,a.path="".concat(Yr,"/").concat(encodeURIComponent(i)),a}return a(r)}(J),Ah=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.pollId;return n(this,r),(a=t.call(this)).method=R.PUT,a.path="".concat(Yr,"/").concat(encodeURIComponent(i),"/close"),a}return a(r)}(J),Mh=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).poll=new Ui(e,a),i}return a(r)}($),Uh=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelUrl,s=e.channelType,o=e.pollId,u=e.optionText;return n(this,r),(a=t.call(this)).method=R.POST,a.path="".concat(Yr,"/").concat(encodeURIComponent(o),"/options"),a.params={channel_url:i,channel_type:s,text:u},a}return a(r)}(J),Oh=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).poll=new Ui(e,a),i}return a(r)}($),Dh=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.pollId,s=e.pollOptionId,o=e.optionText;return n(this,r),(a=t.call(this)).method=R.PUT,a.path="".concat(Yr,"/").concat(encodeURIComponent(i),"/options/").concat(encodeURIComponent(s)),a.params={text:o},a}return a(r)}(J),Lh=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).poll=new Ui(e,a),i}return a(r)}($),Ph=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.pollId,s=e.pollOptionId;return n(this,r),(a=t.call(this)).method=R.DELETE,a.path="".concat(Yr,"/").concat(encodeURIComponent(i),"/options/").concat(encodeURIComponent(s)),a}return a(r)}(J),Fh=function(t){i(s,t);var r=f(s);function s(t){var a=t.reqId,i=t.channelType,o=t.channelUrl,u=t.pollId,c=t.pollOptionIds;return n(this,s),r.call(this,{code:"VOTE",ackRequired:!0,payload:Z({req_id:a,channel_type:i===e.ChannelType.OPEN?"open_channels":"group_channels",channel_url:o,poll_id:u,option_ids:c})})}return a(s)}(Ir),Hh=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"VOTE",i)).event=null,s.channelUrl=null,s.channelType=null,s.event=new Ys(i),s.channelUrl=i.channel_url,s.channelType=i.channel_type,s}return a(r)}(ie),Gh=function(t){i(o,t);var r=f(o);function o(t,a){var i,s,u,c,l;return n(this,o),(i=r.call(this,t)).url="",i.channelType=e.ChannelType.BASE,i.name="",i.coverUrl="",i.customType="",i.data="",i.isFrozen=!1,i.isEphemeral=!1,i.creator=null,i.createdAt=0,i.url=a.channel_url,i.name=null!==(s=a.name)&&void 0!==s?s:"",i.coverUrl=null!==(u=a.cover_url)&&void 0!==u?u:"",i.customType=null!==(c=a.custom_type)&&void 0!==c?c:"",i.data=null!==(l=a.data)&&void 0!==l?l:"",i.isFrozen=!!A("boolean",a.freeze)&&a.freeze,i.isEphemeral=!!A("boolean",a.is_ephemeral)&&a.is_ephemeral,i.creator=a.created_by?new Ua(i._iid,a.created_by):null,i.createdAt=1e3*a.created_at,i._cachedMetaData=new Map,a.metadata&&a.ts&&Object.keys(a.metadata).forEach((function(e){i._cachedMetaData.set(e,{value:a.metadata[e],isRemoved:!1,updatedAt:a.ts})})),i}return a(o,[{key:"isGroupChannel",value:function(){return this.channelType===e.ChannelType.GROUP}},{key:"isOpenChannel",value:function(){return this.channelType===e.ChannelType.OPEN}},{key:"cachedMetaData",get:function(){var e={};return this._cachedMetaData.forEach((function(t,n){t.isRemoved||(e[n]=t.value)})),e}},{key:"_upsertCachedMetaData",value:function(e,t){var n=this;Object.keys(e).forEach((function(r){var a=n._cachedMetaData.get(r);(!a||a.updatedAt<=t)&&n._cachedMetaData.set(r,{value:e[r],isRemoved:!1,updatedAt:t})}))}},{key:"_removeFromCachedMetaData",value:function(e,t){var n=this;e.forEach((function(e){var r=n._cachedMetaData.get(e);r&&r.updatedAt<t&&(r.isRemoved=!1,r.updatedAt=t)}))}},{key:"_generateRequestId",value:function(){return"rq-".concat(B())}},{key:"isIdentical",value:function(e){return e&&this.url===e.url}},{key:"isEqual",value:function(e){return N(this,e)}},{key:"createOperatorListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new gl(this._iid,this.url,this.channelType,e)}},{key:"createMutedUserListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new El(this._iid,this.url,this.channelType,e)}},{key:"createBannedUserListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new xl(this._iid,this.url,this.channelType,e)}},{key:"createPreviousMessageListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Ss(this._iid,this.url,this.channelType,e)}},{key:"addOperators",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(O("string",e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.requestQueue,a=new Cl({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),t.next=5,r.send(a);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"removeOperators",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(O("string",e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.requestQueue,a=new Tl({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),t.next=5,r.send(a);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"getMyMutedInfo",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o,u,c,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.sdkState,r=t.requestQueue,a=new Sl({channelUrl:this.url,channelType:this.channelType,userId:n.userId}),e.next=4,r.send(a);case 4:return i=e.sent,s=i.as(Il),o=s.isMuted,u=s.startAt,c=s.endAt,l=s.remainingDuration,h=s.description,e.abrupt("return",{isMuted:o,startAt:u,endAt:c,remainingDuration:l,description:h});case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getMetaData",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(O("string",e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.requestQueue,a=new Nl({channelUrl:this.url,channelType:this.channelType,keys:e}),t.next=5,r.send(a);case 5:return i=t.sent,s=i.as(Al),o=s.metadata,u=s.ts,this._upsertCachedMetaData(o,u),t.abrupt("return",o);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"getAllMetaData",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.requestQueue,r=new Nl({channelUrl:this.url,channelType:this.channelType,keys:[]}),e.next=4,n.send(r);case 4:return a=e.sent,i=a.as(Al),s=i.metadata,o=i.ts,this._upsertCachedMetaData(s,o),e.abrupt("return",s);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"createMetaData",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Ya.of(this._iid),r=n.requestQueue,a=new Ml({channelUrl:this.url,channelType:this.channelType,metadata:e}),t.next=4,r.send(a);case 4:return i=t.sent,s=i.as(Ul),o=s.metaData,this._upsertCachedMetaData(o,0),t.abrupt("return",o);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"updateMetaData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Ya.of(this._iid),a=r.requestQueue,i=new Ol({channelUrl:this.url,channelType:this.channelType,metadata:e,upsert:t}),n.next=4,a.send(i);case 4:return s=n.sent,o=s.as(Dl),u=o.metadata,c=o.ts,this._upsertCachedMetaData(u,c),n.abrupt("return",u);case 8:case"end":return n.stop()}}),n,this)})))}},{key:"deleteMetaData",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(A("string",e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.requestQueue,a=new Pl({channelUrl:this.url,channelType:this.channelType,key:e}),t.next=5,r.send(a);case 5:i=t.sent,s=i.as(Fl),o=s.ts,this._removeFromCachedMetaData([e],o);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"deleteAllMetaData",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.requestQueue,r=new Hl({channelUrl:this.url,channelType:this.channelType}),e.next=4,n.send(r);case 4:a=e.sent,i=a.as(Gl),s=i.ts,this._removeFromCachedMetaData(_(this._cachedMetaData.keys()),s);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getMetaCounters",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(O("string",e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.requestQueue,a=new ql({channelUrl:this.url,channelType:this.channelType,keys:e}),t.next=5,r.send(a);case 5:return i=t.sent,s=i.as(jl),o=s.metaCounter,t.abrupt("return",o);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"getAllMetaCounters",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.requestQueue,r=new ql({channelUrl:this.url,channelType:this.channelType,keys:[]}),e.next=4,n.send(r);case 4:return a=e.sent,i=a.as(jl),s=i.metaCounter,e.abrupt("return",s);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"createMetaCounters",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Ya.of(this._iid),r=n.requestQueue,a=new zl({channelUrl:this.url,channelType:this.channelType,metaCounter:e}),t.next=4,r.send(a);case 4:return i=t.sent,s=i.as(Vl),o=s.metaCounter,t.abrupt("return",o);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"updateMetaCounters",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Ya.of(this._iid),a=r.requestQueue,i=new Bl({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:t}),n.next=4,a.send(i);case 4:return s=n.sent,o=s.as(Ql),u=o.metaCounter,n.abrupt("return",u);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"increaseMetaCounters",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Ya.of(this._iid),r=n.requestQueue,a=new Bl({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"increase"}),t.next=4,r.send(a);case 4:return i=t.sent,s=i.as(Ql),o=s.metaCounter,t.abrupt("return",o);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"decreaseMetaCounters",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Ya.of(this._iid),r=n.requestQueue,a=new Bl({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"decrease"}),t.next=4,r.send(a);case 4:return i=t.sent,s=i.as(Ql),o=s.metaCounter,t.abrupt("return",o);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"deleteMetaCounter",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(A("string",e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.requestQueue,a=new Wl({channelUrl:this.url,channelType:this.channelType,key:e}),t.next=5,r.send(a);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"deleteAllMetaCounters",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.requestQueue,r=new Yl({channelUrl:this.url,channelType:this.channelType}),e.next=4,n.send(r);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"muteUser",value:function(e,t,n){return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.muteUserWithUserId(e.userId,t,n));case 1:case"end":return r.stop()}}),r,this)})))}},{key:"muteUserWithUserId",value:function(e,t,n){return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){var a,i,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Aa(A("string",e)&&A("number",t,!0)&&A("string",n,!0)).throw(T.invalidParameters),a=Ya.of(this._iid),i=a.requestQueue,s=new Zl({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:t,description:n}),r.next=5,i.send(s);case 5:case"end":return r.stop()}}),r,this)})))}},{key:"unmuteUser",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.unmuteUserWithUserId(e.userId));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"unmuteUserWithUserId",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(A("string",e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.requestQueue,a=new Jl({channelUrl:this.url,channelType:this.channelType,userId:e}),t.next=5,r.send(a);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"banUser",value:function(e,t,n){return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.banUserWithUserId(e.userId,t,n));case 1:case"end":return r.stop()}}),r,this)})))}},{key:"banUserWithUserId",value:function(e,t,n){return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){var a,i,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Aa(A("string",e)&&A("number",t,!0)&&A("string",n,!0)).throw(T.invalidParameters),a=Ya.of(this._iid),i=a.requestQueue,s=new eh({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:t,description:n}),r.next=5,i.send(s);case 5:case"end":return r.stop()}}),r,this)})))}},{key:"unbanUser",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.unbanUserWithUserId(e.userId));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"unbanUserWithUserId",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(A("string",e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.requestQueue,a=new nh({channelUrl:this.url,channelType:this.channelType,userId:e}),t.next=5,r.send(a);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"freeze",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.requestQueue,r=new ah({channelUrl:this.url,channelType:this.channelType,freezing:!0}),e.next=4,n.send(r);case 4:this.isFrozen=!0;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"unfreeze",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.requestQueue,r=new ah({channelUrl:this.url,channelType:this.channelType,freezing:!1}),e.next=4,n.send(r);case 4:this.isFrozen=!1;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"getMessagesByMessageId",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Object.assign(Object.assign({},Wi),t),Aa(A("number",e)&&Yi(r)).throw(T.invalidParameters),a=vs.of(this._iid),n.next=5,a.getMessagesByMessageId(this.url,this.channelType,e,r);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}),n,this)})))}},{key:"getMessagesByTimestamp",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Object.assign(Object.assign({},Wi),t),Aa(A("number",e)&&Yi(r)).throw(T.invalidParameters),a=vs.of(this._iid),n.next=5,a.getMessagesByTimestamp(this.url,this.channelType,e,r);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}),n,this)})))}},{key:"getMessageChangeLogsSinceTimestamp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Object.assign(Object.assign({},Zi),t),Aa(A("number",e)&&Xi(r)).throw(T.invalidParameters),a=vs.of(this._iid),n.next=5,a.getMessageChangelogs(this.url,this.channelType,e,r);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}),n,this)})))}},{key:"getMessageChangeLogsSinceToken",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Object.assign(Object.assign({},Zi),t),Aa(A("string",e)&&Xi(r)).throw(T.invalidParameters),a=vs.of(this._iid),n.next=5,a.getMessageChangelogs(this.url,this.channelType,e,r);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}),n,this)})))}},{key:"_createPendingSendableMessagePayload",value:function(t,n,r){var a=Ya.of(this._iid).sessionManager;return Z({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:t.parentMessageId,data:t.data,custom_type:t.customType,mention_type:t.mentionType,sorted_metaarray:t.metaArrays?t.metaArrays.map((function(e){return pi.payloadify(e)})):null,apple_critical_alert_options:t.appleCriticalAlertOptions?_i.payloadify(t.appleCriticalAlertOptions):null,created_at:r,user:Ei.payloadify(a.currentUser),req_id:n,request_state:e.SendingStatus.PENDING,mentioned_user_ids:t.mentionedUserIds,mentioned_users:t.mentionedUsers})}},{key:"_createPendingUserMessage",value:function(t,n,r){var a={};if(t.translationTargetLanguages){var i,s=k(t.translationTargetLanguages);try{for(s.s();!(i=s.n()).done;){a[i.value]=""}}catch(e){s.e(e)}finally{s.f()}}var o=Z(Object.assign(Object.assign({},this._createPendingSendableMessagePayload(t,n,r)),{type:e.MessageType.USER,message:t.message,translations:a})),u=new Oi(this._iid,o);return u.messageParams=t,u}},{key:"_createPendingScheduledUserMessage",value:function(e,t,n){var r=this._createPendingUserMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r}},{key:"_createPendingFileMessage",value:function(t,n,r){var a=Z(Object.assign(Object.assign({},this._createPendingSendableMessagePayload(t,n,r)),{type:e.MessageType.FILE,url:t.fileUrl,file:{name:t.fileName,size:t.fileSize,type:t.mimeType,data:t.data},thumbnails:t.thumbnailSizes?t.thumbnailSizes.map((function(e){return{url:"",width:e.maxWidth,height:e.maxHeight}})):[]})),i=new Pi(this._iid,a);return i.messageParams=t,i}},{key:"_createPendingScheduledFileMessage",value:function(e,t,n){var r=this._createPendingFileMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r}},{key:"_markMessageAsFailed",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t.errorCode=n.code,n.code===b.REQUEST_CANCELED?t.sendingStatus=e.SendingStatus.CANCELED:r||(t.sendingStatus=e.SendingStatus.FAILED)}},{key:"sendUserMessage",value:function(e){var t=Object.assign(Object.assign({},ko),e);return Aa(bo(t)).throw(T.invalidParameters),this._sendUserMessage(t)}},{key:"_sendUserMessage",value:function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=Ya.of(this._iid),i=a.dispatcher,s=a.requestQueue,o=r,u=Date.now(),c=new ms;if(!o){o=this._generateRequestId();var l=Ya.of(this._iid),h=l.dispatcher;ra(2).then((function(){var r=n._createPendingUserMessage(t,o,u);h.dispatch(new es({messages:[r],source:e.MessageEventSource.EVENT_MESSAGE_SENT_PENDING})),sa((function(){return E(n,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c._trigger(null,r));case 1:case"end":return e.stop()}}),e)})))}))}))}var d=new ch(Object.assign(Object.assign({},t),{channelUrl:this.url,channelType:this.channelType,reqId:o}));return s.send(d).then((function(t){var r=t.as(lh).message;i.dispatch(new es({messages:[r],source:e.MessageEventSource.EVENT_MESSAGE_SENT_SUCCESS})),sa((function(){return E(n,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c._trigger(null,r));case 1:case"end":return e.stop()}}),e)})))}))})).catch((function(r){if(C(r))throw r;ra(2).then((function(){var a=n._createPendingUserMessage(t,o,u),s=Ya.of(n._iid).cacheContext.localCacheEnabled&&D(r.code);n._markMessageAsFailed(a,r,s),i.dispatch(new es({messages:[a],source:a.sendingStatus===e.SendingStatus.PENDING?e.MessageEventSource.REQUEST_RESEND_MESSAGE:e.MessageEventSource.EVENT_MESSAGE_SENT_FAILED})),sa((function(){return E(n,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c._trigger(r,a));case 1:case"end":return e.stop()}}),e)})))}))}))})),c}},{key:"_autoResendUserMessage",value:function(e){return Aa(e instanceof Oi).throw(T.invalidParameters),this._sendUserMessage(e.messageParams,e.reqId)}},{key:"resendUserMessage",value:function(e){var t;return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Aa(e instanceof Oi&&!e.scheduledInfo).throw(T.invalidParameters),r=new Ar,a=null!==(t=e.messageParams)&&void 0!==t?t:Eo(e),this._sendUserMessage(a,e.reqId).onFailed((function(e){return r.reject(e)})).onSucceeded((function(e){return r.resolve(e)})),n.abrupt("return",r.promise);case 5:case"end":return n.stop()}}),n,this)})))}},{key:"updateUserMessage",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Object.assign(Object.assign({},dl),t),Aa(A("number",e)&&fl(r)).throw(T.invalidParameters),a=Ya.of(this._iid),i=a.requestQueue,s=new hh(Object.assign({channelType:this.channelType,channelUrl:this.url,messageId:e},r)),n.next=6,i.send(s);case 6:return o=n.sent,u=o.as(dh),c=u.message,n.abrupt("return",c);case 9:case"end":return n.stop()}}),n,this)})))}},{key:"copyUserMessage",value:function(t,n){var r,a,i;return E(this,void 0,void 0,regeneratorRuntime.mark((function s(){var u,c;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return Aa(t instanceof o&&n instanceof Oi&&n.sendingStatus===e.SendingStatus.SUCCEEDED&&this.url===n.channelUrl&&!n.scheduledInfo).throw(T.invalidParameters),Aa(!n.poll).throw(T.notSupportedError),u=new Ar,c=null!==(r=n.messageParams)&&void 0!==r?r:Object.assign(Object.assign({},n),{mentionType:n.mentionType,mentionedUserIds:null!==(a=n.mentionedUserIds)&&void 0!==a?a:null===(i=n.mentionedUsers)||void 0===i?void 0:i.map((function(e){return e.userId})),translationTargetLanguages:Object.keys(n.translations),pushNotificationDeliveryOption:e.PushNotificationDeliveryOption.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1}),t._sendUserMessage(c).onSucceeded((function(e){u.resolve(e)})).onFailed((function(e){return u.reject(e)})),s.abrupt("return",u.promise);case 6:case"end":return s.stop()}}),s,this)})))}},{key:"translateUserMessage",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Aa(e instanceof Oi&&e.messageId>0&&O("string",t)).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.requestQueue,i=new Eh({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,translationTargetLanguages:t}),n.next=5,a.send(i);case 5:return s=n.sent,o=s.as(bh),u=o.message,n.abrupt("return",u);case 8:case"end":return n.stop()}}),n,this)})))}},{key:"_createScheduledUserMessage",value:function(e,t){var n=this,r=Ya.of(this._iid).requestQueue,a=Date.now(),i=this._generateRequestId();ra(2).then((function(){var r=n._createPendingScheduledUserMessage(e,i,a);sa((function(){return E(n,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t._trigger(null,r));case 1:case"end":return e.stop()}}),e)})))}))}));var s=new wh(Object.assign({reqId:i,channelType:this.channelType,channelUrl:this.url},e));r.send(s).then((function(e){var r=e.as(xh).message;sa((function(){return E(n,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t._trigger(null,r));case 1:case"end":return e.stop()}}),e)})))}))})).catch((function(r){if(C(r))throw r;ra(2).then((function(){var s=n._createPendingScheduledUserMessage(e,i,a);n._markMessageAsFailed(s,r),sa((function(){return E(n,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t._trigger(r,s));case 1:case"end":return e.stop()}}),e)})))}))}))}))}},{key:"sendFileMessage",value:function(e){var t=Object.assign(Object.assign({},Co),e);return Aa(So(t)).throw(T.invalidParameters),this._sendFileMessage(t)}},{key:"_sendFileMessage",value:function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=Ya.of(this._iid),i=a.dispatcher,s=vs.of(this._iid),o=s.fileMessageQueue,u=r,c=Date.now(),l=new ms;return u||(u=this._generateRequestId(),ra(2).then((function(){var r=n._createPendingFileMessage(t,u,c);i.dispatch(new es({messages:[r],source:e.MessageEventSource.EVENT_MESSAGE_SENT_PENDING})),sa((function(){return E(n,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l._trigger(null,r));case 1:case"end":return e.stop()}}),e)})))}))}))),o.request(this,u,t).then((function(t){i.dispatch(new es({messages:[t],source:e.MessageEventSource.EVENT_MESSAGE_SENT_SUCCESS})),sa((function(){return E(n,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l._trigger(null,t));case 1:case"end":return e.stop()}}),e)})))}))})).catch((function(r){if(C(r))throw r;ra(2).then((function(){var a=n._createPendingFileMessage(t,u,c),s=Ya.of(n._iid).cacheContext.localCacheEnabled&&D(r.code);n._markMessageAsFailed(a,r,s),i.dispatch(new es({messages:[a],source:a.sendingStatus===e.SendingStatus.PENDING?e.MessageEventSource.REQUEST_RESEND_MESSAGE:e.MessageEventSource.EVENT_MESSAGE_SENT_FAILED})),sa((function(){return E(n,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l._trigger(r,a));case 1:case"end":return e.stop()}}),e)})))}))}))})),l}},{key:"_autoResendFileMessage",value:function(e){Aa(e instanceof Pi).throw(T.invalidParameters);var t=Ya.of(this._iid).logger;return t.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,e.reqId).onFailed((function(e){t.debug("autoResendFileMessage failed",e)})).onSucceeded((function(e){t.debug("autoResendFileMessage success",e)}))}},{key:"_createScheduledFileMessage",value:function(e,t,n,r){var a=this,i=Ya.of(this._iid).requestQueue,s=new Rh(Object.assign(Object.assign({reqId:n,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));i.send(s).then((function(e){var n=e.as(Ch).message;sa((function(){return E(a,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t._trigger(null,n));case 1:case"end":return e.stop()}}),e)})))}))})).catch((function(i){if(C(i))throw i;ra(2).then((function(){var s=a._createPendingScheduledFileMessage(e,n,r);a._markMessageAsFailed(s,i),sa((function(){return E(a,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t._trigger(i,s));case 1:case"end":return e.stop()}}),e)})))}))}))}))}},{key:"sendFileMessages",value:function(e){Aa(e.every((function(e){return So(Object.assign(Object.assign({},Co),e))}))).throw(T.invalidParameters);var t,n=new ms,r=k(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;this.sendFileMessage(a).onPending((function(e){return n._trigger(null,e)})).onFailed((function(e,t){return n._trigger(e,t)})).onSucceeded((function(e){return n._trigger(null,e)}))}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"resendFileMessage",value:function(e,t){var n;return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){var a,i,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=Boolean(e.url)||L(t)||L(null===(n=e.messageParams)||void 0===n?void 0:n.file),Aa(e instanceof Pi&&a&&!e.scheduledInfo).throw(T.invalidParameters),i=new Ar,s=To(e,t),this._sendFileMessage(s,e.reqId).onFailed((function(e){return i.reject(e)})).onSucceeded((function(e){return i.resolve(e)})),r.abrupt("return",i.promise);case 6:case"end":return r.stop()}}),r,this)})))}},{key:"updateFileMessage",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Object.assign(Object.assign({},pl),t),Aa(A("number",e)&&vl(r)).throw(T.invalidParameters),a=Ya.of(this._iid),i=a.requestQueue,s=new fh(Object.assign({channelType:this.channelType,channelUrl:this.url,messageId:e},r)),n.next=6,i.send(s);case 6:return o=n.sent,u=o.as(ph),c=u.message,n.abrupt("return",c);case 9:case"end":return n.stop()}}),n,this)})))}},{key:"cancelUploadingFileMessage",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(A("string",e)).throw(T.invalidParameters),n=vs.of(this._iid),n.fileMessageQueue.cancel(this,e),t.abrupt("return",!0);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"copyFileMessage",value:function(t,n){var r,a;return E(this,void 0,void 0,regeneratorRuntime.mark((function i(){var s,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return Aa(t instanceof o&&n instanceof Pi&&n.sendingStatus===e.SendingStatus.SUCCEEDED&&this.url===n.channelUrl&&!n.scheduledInfo).throw(T.invalidParameters),s=new Ar,u=Object.assign(Object.assign({},n),{fileUrl:n.url,fileName:n.name,fileSize:n.size,mimeType:n.type,mentionType:n.mentionType,mentionedUserIds:null!==(r=n.mentionedUserIds)&&void 0!==r?r:null===(a=n.mentionedUsers)||void 0===a?void 0:a.map((function(e){return e.userId})),pushNotificationDeliveryOption:e.PushNotificationDeliveryOption.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:n.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),requireAuth:n.requireAuth,isPinnedMessage:!1}),t._sendFileMessage(u).onSucceeded((function(e){return s.resolve(e)})).onFailed((function(e){return s.reject(e)})),i.abrupt("return",s.promise);case 5:case"end":return i.stop()}}),i,this)})))}},{key:"deleteMessage",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Aa(e instanceof ki).throw(T.invalidParameters),!(e.messageId>0)){t.next=6;break}return n=Ya.of(this._iid),r=n.requestQueue,a=new vh({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId}),t.next=6,r.send(a);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"addReaction",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Aa(e instanceof ki&&e.messageId>0&&A("string",t)).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.requestQueue,i=new _h({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:t}),n.next=5,a.send(i);case 5:return s=n.sent,o=s.as(gh),u=o.reactionEvent,n.abrupt("return",u);case 8:case"end":return n.stop()}}),n,this)})))}},{key:"deleteReaction",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Aa(e instanceof ki&&e.messageId>0&&A("string",t)).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.requestQueue,i=new yh({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:t}),n.next=5,a.send(i);case 5:return s=n.sent,o=s.as(kh),u=o.reactionEvent,n.abrupt("return",u);case 8:case"end":return n.stop()}}),n,this)})))}},{key:"_updateUserMessageMetaArray",value:function(t,n,r,a){return E(this,void 0,void 0,regeneratorRuntime.mark((function i(){var s,o,u,c,l,h,d;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return s=Ya.of(this._iid),o=s.dispatcher,u=s.requestQueue,c=new hh({channelType:this.channelType,channelUrl:this.url,messageId:t,metaArrayParams:{array:n,mode:r,upsert:a}}),i.next=4,u.send(c);case 4:return l=i.sent,h=l.as(dh),d=h.message,o.dispatch(new es({messages:[d],source:e.MessageEventSource.EVENT_MESSAGE_UPDATED})),i.abrupt("return",d);case 8:case"end":return i.stop()}}),i,this)})))}},{key:"_updateFileMessageMetaArray",value:function(t,n,r,a){return E(this,void 0,void 0,regeneratorRuntime.mark((function i(){var s,o,u,c,l,h,d;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return s=Ya.of(this._iid),o=s.dispatcher,u=s.requestQueue,c=new fh({channelType:this.channelType,channelUrl:this.url,messageId:t,metaArrayParams:{array:n,mode:r,upsert:a}}),i.next=4,u.send(c);case 4:return l=i.sent,h=l.as(ph),d=h.message,o.dispatch(new es({messages:[d],source:e.MessageEventSource.EVENT_MESSAGE_UPDATED})),i.abrupt("return",d);case 8:case"end":return i.stop()}}),i,this)})))}},{key:"createMessageMetaArrayKeys",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Aa(e instanceof ki&&e.messageId>0&&O("string",t)).throw(T.invalidParameters),r=t.map((function(e){return new pi({key:e})})),!(e instanceof Pi)){n.next=6;break}return n.abrupt("return",this._updateFileMessageMetaArray(e.messageId,r,"add",!0));case 6:return n.abrupt("return",this._updateUserMessageMetaArray(e.messageId,r,"add",!0));case 7:case"end":return n.stop()}}),n,this)})))}},{key:"deleteMessageMetaArrayKeys",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Aa(e instanceof ki&&e.messageId>0&&O("string",t)).throw(T.invalidParameters),r=t.map((function(e){return new pi({key:e})})),!(e instanceof Pi)){n.next=6;break}return n.abrupt("return",this._updateFileMessageMetaArray(e.messageId,r,"remove",!0));case 6:return n.abrupt("return",this._updateUserMessageMetaArray(e.messageId,r,"remove",!0));case 7:case"end":return n.stop()}}),n,this)})))}},{key:"addMessageMetaArrayValues",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Aa(e instanceof ki&&e.messageId>0&&t.every((function(e){return e instanceof pi}))).throw(T.invalidParameters),!(e instanceof Pi)){n.next=5;break}return n.abrupt("return",this._updateFileMessageMetaArray(e.messageId,t,"add",!0));case 5:return n.abrupt("return",this._updateUserMessageMetaArray(e.messageId,t,"add",!0));case 6:case"end":return n.stop()}}),n,this)})))}},{key:"removeMessageMetaArrayValues",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Aa(e instanceof ki&&e.messageId>0&&t.every((function(e){return e instanceof pi}))).throw(T.invalidParameters),!(e instanceof Pi)){n.next=5;break}return n.abrupt("return",this._updateFileMessageMetaArray(e.messageId,t,"remove",!0));case 5:return n.abrupt("return",this._updateUserMessageMetaArray(e.messageId,t,"remove",!0));case 6:case"end":return n.stop()}}),n,this)})))}},{key:"report",value:function(t,n){return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){var a,i,s,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Aa(M(e.ReportCategory,t)&&A("string",n)).throw(T.invalidParameters),a=Ya.of(this._iid),i=a.sdkState,s=a.requestQueue,o=new sh({channelUrl:this.url,channelType:this.channelType,userId:i.userId,category:t,description:n}),r.next=5,s.send(o);case 5:case"end":return r.stop()}}),r,this)})))}},{key:"reportUser",value:function(t,n,r){return E(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i,s,o,u;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return Aa(t instanceof Ua&&M(e.ReportCategory,n)&&A("string",r)).throw(T.invalidParameters),i=Ya.of(this._iid),s=i.sdkState,o=i.requestQueue,u=new oh({channelUrl:this.url,channelType:this.channelType,userId:s.userId,offendingUserId:t.userId,category:n,description:r}),a.next=5,o.send(u);case 5:case"end":return a.stop()}}),a,this)})))}},{key:"reportMessage",value:function(t,n,r){return E(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i,s,o,u;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return Aa(t instanceof bi&&M(e.ReportCategory,n)&&A("string",r)).throw(T.invalidParameters),i=Ya.of(this._iid),s=i.sdkState,o=i.requestQueue,u=new uh({channelUrl:this.url,channelType:this.channelType,userId:s.userId,offendingUserId:t.sender.userId,messageId:t.messageId,category:n,description:r}),a.next=5,o.send(u);case 5:case"end":return a.stop()}}),a,this)})))}},{key:"updatePoll",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Aa(A("number",e)&&Th(t)).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.requestQueue,i=new Sh(Object.assign({pollId:e},t)),n.next=5,a.send(i);case 5:return s=n.sent,o=s.as(Ih),u=o.poll,n.abrupt("return",u);case 8:case"end":return n.stop()}}),n,this)})))}},{key:"deletePoll",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=A("number",e),Aa(n).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.requestQueue,i=new Nh({pollId:e}),t.next=6,a.send(i);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"closePoll",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=A("number",e),Aa(n).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.requestQueue,i=new Ah({pollId:e}),t.next=6,a.send(i);case 6:return s=t.sent,o=s.as(Mh),u=o.poll,t.abrupt("return",u);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"addPollOption",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=A("number",e)&&A("string",t)&&""!==t.trim(),Aa(r).throw(T.invalidParameters),a=Ya.of(this._iid),i=a.requestQueue,s=new Uh({channelUrl:this.url,channelType:this.channelType,pollId:e,optionText:t}),n.next=6,i.send(s);case 6:return o=n.sent,u=o.as(Oh),c=u.poll,n.abrupt("return",c);case 9:case"end":return n.stop()}}),n,this)})))}},{key:"updatePollOption",value:function(e,t,n){return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){var a,i,s,o,u,c,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=A("number",e)&&A("number",t)&&A("string",n)&&""!==n.trim(),Aa(a).throw(T.invalidParameters),i=Ya.of(this._iid),s=i.requestQueue,o=new Dh({pollId:e,pollOptionId:t,optionText:n}),r.next=6,s.send(o);case 6:return u=r.sent,c=u.as(Lh),l=c.poll,r.abrupt("return",l);case 9:case"end":return r.stop()}}),r,this)})))}},{key:"deletePollOption",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=A("number",e)&&A("number",t),Aa(r).throw(T.invalidParameters),a=Ya.of(this._iid),i=a.requestQueue,s=new Ph({pollId:e,pollOptionId:t}),n.next=6,i.send(s);case 6:case"end":return n.stop()}}),n,this)})))}},{key:"votePoll",value:function(t,n){return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){var a,i,s,o,u,c,l,h;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=A("number",t)&&O("number",n),Aa(a).throw(T.invalidParameters),i=Ya.of(this._iid),s=i.requestQueue,o=i.dispatcher,u=new Fh({reqId:this._generateRequestId(),channelUrl:this.url,channelType:this.channelType,pollId:t,pollOptionIds:n}),r.next=6,s.send(u);case 6:return c=r.sent,l=c.as(Hh),h=l.event,o.dispatch(new is({event:h,source:e.MessageEventSource.EVENT_POLL_VOTED})),r.abrupt("return",h);case 10:case"end":return r.stop()}}),r,this)})))}},{key:"getPollChangeLogsSinceTimestamp",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(A("number",e)).throw(T.invalidParameters),n=Ks.of(this._iid),t.next=4,n.getPollChangeLogs(this.url,this.channelType,e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"getPollChangeLogsSinceToken",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(A("string",e,!0)),n=Ks.of(this._iid),t.next=4,n.getPollChangeLogs(this.url,this.channelType,e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"createPollListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return new Js(this._iid,{channelUrl:this.url,channelType:this.channelType,limit:e})}},{key:"createPollVoterListQuery",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;return new to(this._iid,{channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionId:t,limit:n})}}],[{key:"payloadify",value:function(e){return Z(Object.assign(Object.assign({},v(s(o),"payloadify",this).call(this,e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:Ua.payloadify(e.creator),created_at:e.createdAt/1e3}))}}]),o}(ba),qh=function(e){i(r,e);var t=f(r);function r(e,a){var i,s;return n(this,r),(i=t.call(this,e,a)).isMuted=!1,i.isMuted=null!==(s=a.is_muted)&&void 0!==s&&s,i}return a(r)}(Ua),jh=null,zh=function(){function t(e,r,a){var i=this;n(this,t),this._fcmPushToken=null,this._apnsPushToken=null,this._iid=e,this.options=r;var s=Ya.of(e),o=s.sdkState,u=s.cacheContext,c=s.dispatcher,l=s.sessionManager,h=s.requestQueue,d=s.logger,f=s.userEventHandlers,p=s.appStateToggleEnabled;this._onlineDetector=new Ko({logger:d,connectionDelegate:{reconnect:function(){var t=Ya.of(e),n=t.sdkState,r=t.connectionManager,a=t.sessionManager;a.auth.hasSession?"foreground"===n.appState&&r.resetAndReconnect():r.connect(a.auth.authToken)},disconnect:function(){Ya.of(e).connectionManager.disconnect()}}});var v=new Zo(e,{localCacheEnabled:u.localCacheEnabled,dispatcher:c,sdkState:o,logger:d});a.forEach((function(t){t.init(e,{sdkState:o,cacheContext:u,dispatcher:c,sessionManager:l,requestQueue:h,logger:d,onlineDetector:i._onlineDetector}),i[t.name]=t})),this._appStateChangeDetector=new Qo(p),this._appStateChangeDetector.on("resume",(function(){d.debug("the page resumes from freeze"),i.setForegroundState()})).on("pause",(function(){d.debug("the page freezes"),i.setBackgroundState()})),c.on((function(t){if(t instanceof Or){if(t.stateType===Tr.CONNECTED)v.processNonAutoResendRegisteredPendingMessages()}else if(t instanceof ie){if("USEV"===t.code){var n=t.as(eu).event;if(n.category===Do.FRIEND_DISCOVERED){var r=Jo.getDataAsFriendDiscoveredEvent(e,n).friendDiscoveries;sa((function(){return E(i,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",f.forEach((function(e){e.onFriendsDiscovered(r)})));case 1:case"end":return e.stop()}}),e)})))}))}}}else if(t instanceof Nr){var a=Ya.of(i._iid).subscribedUnreadMessageCount,s=!1,c=t.ts;if("number"==typeof c&&c>a.ts){if(a.all!==t.all&&(s=!0),a.all=t.all>=0?t.all:0,t.customTypes)for(var l in t.customTypes)a.customTypes[l]!==t.customTypes[l]&&(s=!0),a.customTypes[l]=t.customTypes[l];s=s&&a.ts>0,a.ts=c}s&&sa((function(){return E(i,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",f.forEach((function(e){e.onTotalUnreadMessageCountUpdated(a.all,a.customTypes)})));case 1:case"end":return e.stop()}}),e)})))}))}else t instanceof Oa&&u.localCacheEnabled&&u.preference.set(i._getUserProfileCacheKey(o.userId),Da.payloadify(t.userProfile))}))}return a(t,[{key:"appId",get:function(){return Ya.of(this._iid).sdkState.appId}},{key:"appInfo",get:function(){return Ya.of(this._iid).appInfo}},{key:"appVersion",get:function(){var e;return null!==(e=Ya.of(this._iid).sdkState.appVersion)&&void 0!==e?e:""}},{key:"debugMode",get:function(){return Ya.of(this._iid).debugMode}},{key:"logLevel",get:function(){return Ya.of(this._iid).logger.level},set:function(e){Ya.of(this._iid).logger.level=e}},{key:"isCacheEnabled",get:function(){return Ya.of(this._iid).cacheContext.localCacheEnabled}},{key:"ekey",get:function(){return Ya.of(this._iid).sessionManager.ekey}},{key:"currentUser",get:function(){var e;return null!==(e=Ya.of(this._iid).sessionManager.currentUser)&&void 0!==e?e:null}},{key:"connectionState",get:function(){var t=Ya.of(this._iid).connectionManager;return t.isConnected?e.ConnectionState.OPEN:t.isConnecting?e.ConnectionState.CONNECTING:e.ConnectionState.CLOSED}},{key:"lastConnectedAt",get:function(){var e=Ya.of(this._iid),t=e.connectedAt;return e.connectionManager.isConnected?t:0}},{key:"fcmPushToken",get:function(){return this._fcmPushToken}},{key:"apnsPushToken",get:function(){return this._apnsPushToken}},{key:"_getPreferenceCacheKey",value:function(e){return"sendbird@".concat(this.appId,"/").concat(e,".pref")}},{key:"_getUserProfileCacheKey",value:function(e){return"sendbird@".concat(this.appId,"/").concat(e,".profile")}},{key:"getMemoryStoreForDebugging",value:function(){var e=Ya.of(this._iid),t=e.debugMode,n=e.cacheContext;if(t)return n.store instanceof Zc?n.store:null;throw T.debugModeRequired}},{key:"addExtension",value:function(e,t){var n=Ya.of(this._iid).sdkState;["sb_uikit","sb_syncmanager","device-os-platform"].indexOf(e)>-1&&(n.extensions[e]=t)}},{key:"setOnlineListener",value:function(e){this._onlineDetector.setOnlineListener(e)}},{key:"setOfflineListener",value:function(e){this._onlineDetector.setOfflineListener(e)}},{key:"initializeCache",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Ya.of(this._iid),r=n.sdkState,a=n.cacheContext,i=n.connectionManager,s=n.dispatcher,r.userId&&r.userId===e){t.next=23;break}return t.next=4,i.logout();case 4:if(r.userId=e,o="sendbird@".concat(r.appId,"/").concat(e,".db"),!a.localCacheEnabled){t.next=15;break}if(a.nestdb&&a.nestdb.state!==Lc.CLOSED&&a.nestdb.name===o){t.next=13;break}return(u=a.nestdb=new sl({name:"sendbird@".concat(r.appId,"/").concat(e,".db"),version:2,store:a.store})).on("upgrade",zo(u,a.store)),t.next=12,u.open();case 12:s.dispatch(new $o(this._iid,{userId:e}));case 13:t.next=17;break;case 15:return t.next=17,a.store.init(o);case 17:return t.next=19,a.preference.init(this._getPreferenceCacheKey(e));case 19:return t.next=21,a.preference.get(this._getUserProfileCacheKey(e));case 21:(c=t.sent)&&new Da(this._iid,c).apply();case 23:case"end":return t.stop()}}),t,this)})))}},{key:"clearCachedData",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Ya.of(this._iid),!(n=t.cacheContext).localCacheEnabled){e.next=5;break}if(!n.nestdb){e.next=5;break}return e.next=5,n.nestdb.clear();case 5:return e.next=7,n.preference.clear();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"clearCachedMessages",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Aa(O("string",e)).throw(T.invalidParameters),n=Bo.of(this._iid),r=jo.of(this._iid),!n||!r){t.next=6;break}return t.next=6,Promise.all(e.map((function(e){return E(a,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.removeMessagesOfChannel(e);case 2:return t.next=4,r.removeMessagesOfChannel(e);case 4:case"end":return t.stop()}}),t)})))})));case 6:case"end":return t.stop()}}),t,this)})))}},{key:"connect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Aa(A("string",e)&&A("string",t,!0)).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.sdkState,i=r.cacheContext,s=r.connectionManager,o=r.statLogCollector,n.prev=2,n.next=5,this.initializeCache(e);case 5:n.next=12;break;case 7:n.prev=7,n.t0=n.catch(2),u=Ya.of(this._iid),c=u.logger,i.localCacheEnabled=!1,c.warn("Cache initialization failed - cache is not available.");case 12:return n.next=14,o.init("sendbird@".concat(a.appId,"/").concat(e,".statlog"));case 14:return this._onlineDetector.start(),this._appStateChangeDetector.start(),n.next=18,s.connect(t);case 18:return n.abrupt("return",this.currentUser);case 19:case"end":return n.stop()}}),n,this,[[2,7]])})))}},{key:"reconnect",value:function(){var e=Ya.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.sessionManager.auth.hasSession;return r&&(this._appStateChangeDetector.start(),this._onlineDetector.start(),t.resetAndReconnect().then((function(){n.appState="foreground"})).catch((function(){}))),r}},{key:"disconnect",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.connectionManager,r=t.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),r.cancelAll(),e.next=6,n.logout();case 6:return e.next=8,this.clearCachedData();case 8:case"end":return e.stop()}}),e,this)})))}},{key:"disconnectWebSocket",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.connectionManager,r=t.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),r.cancelAll(),e.next=6,n.disconnectWebSocket();case 6:case"end":return e.stop()}}),e,this)})))}},{key:"setBackgroundState",value:function(){var e=Ya.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"foreground"===n.appState&&(n.appState="background",r.debug("going background state"),t.background())}},{key:"setForegroundState",value:function(){var e=Ya.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"background"===n.appState&&(n.appState="foreground",r.debug("going foreground state"),t.resetAndReconnect())}},{key:"setSessionHandler",value:function(e){Aa(e instanceof io).throw(T.invalidParameters),Ya.of(this._iid).sessionManager.handler=e}},{key:"addUserEventHandler",value:function(e,t){Aa(A("string",e)&&t instanceof oo).throw(T.invalidParameters),Ya.of(this._iid).userEventHandlers.set(e,t)}},{key:"removeUserEventHandler",value:function(e){Ya.of(this._iid).userEventHandlers.delete(e)}},{key:"removeAllUserEventHandler",value:function(){Ya.of(this._iid).userEventHandlers.clear()}},{key:"addConnectionHandler",value:function(e,t){Aa(A("string",e)&&t instanceof so).throw(T.invalidParameters),Ya.of(this._iid).connectionHandlers.set(e,t)}},{key:"removeConnectionHandler",value:function(e){Ya.of(this._iid).connectionHandlers.delete(e)}},{key:"removeAllConnectionHandler",value:function(){Ya.of(this._iid).connectionHandlers.clear()}},{key:"createApplicationUserListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new tc(this._iid,e)}},{key:"createBlockedUserListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new ac(this._iid,e)}},{key:"createFriendListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new oc(this._iid,e)}},{key:"createMessageSearchQuery",value:function(e){return new Cs(this._iid,e)}},{key:"createPollListQuery",value:function(e){return new Js(this._iid,Object.assign({},e))}},{key:"createPollVoterListQuery",value:function(e){return new to(this._iid,Object.assign({},e))}},{key:"buildUserFromSerializedData",value:function(e){var t=Na(e);return new Ua(this._iid,Ua.payloadify(t))}},{key:"updateCurrentUserInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Object.assign(Object.assign({},ro),e),Aa(ao(n)).throw(T.invalidParameters),!this.currentUser){t.next=13;break}return r=Ya.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new tu(Object.assign({userId:a.userId},n)),t.next=7,i.send(s);case 7:return o=t.sent,u=o.as(nu),c=u.user,this.currentUser&&(n.nickname&&(this.currentUser.nickname=c.nickname),(n.profileUrl||n.profileImage)&&(this.currentUser.plainProfileUrl=c.profileUrl)),t.abrupt("return",c);case 13:throw T.connectionRequired;case 14:case"end":return t.stop()}}),t,this)})))}},{key:"updateCurrentUserInfoWithPreferredLanguages",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Aa(O("string",e)).throw(T.invalidParameters),!this.currentUser){t.next=12;break}return n=Ya.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new tu({userId:r.userId,preferredLanguages:e}),t.next=6,a.send(i);case 6:return s=t.sent,o=s.as(nu),u=o.user,this.currentUser&&(this.currentUser.preferredLanguages=u.preferredLanguages),t.abrupt("return",u);case 12:throw T.connectionRequired;case 13:case"end":return t.stop()}}),t,this)})))}},{key:"registerFCMPushTokenForCurrentUser",value:function(t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Aa(A("string",t)).throw(T.invalidParameters),!this.currentUser){n.next=20;break}if(n.prev=2,r=Ya.of(this._iid),a=r.sessionManager,i=r.sdkState,s=r.requestQueue,!a.hasDeviceToken(e.PushTokenType.FCM,t)){n.next=6;break}return n.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 6:return o=new au({userId:i.userId,token:t}),n.next=9,s.send(o);case 9:return n.next=11,oa((function(){return E(u,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a.setDeviceToken(e.PushTokenType.FCM,t),n.next=3,a.saveDeviceToken();case 3:case"end":return n.stop()}}),n)})))}));case 11:return this._fcmPushToken="",n.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 15:return n.prev=15,n.t0=n.catch(2),n.abrupt("return",e.PushTokenRegistrationState.ERROR);case 18:n.next=22;break;case 20:return this._fcmPushToken=t,n.abrupt("return",e.PushTokenRegistrationState.PENDING);case 22:case"end":return n.stop()}}),n,this,[[2,15]])})))}},{key:"unregisterFCMPushTokenForCurrentUser",value:function(t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c,l=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Aa(A("string",t)).throw(T.invalidParameters),!this.currentUser){n.next=20;break}return n.prev=2,r=Ya.of(this._iid),a=r.sessionManager,i=r.sdkState,s=r.requestQueue,o=new su({userId:i.userId,token:t}),n.next=7,s.send(o);case 7:return u=n.sent,c=u.lastDeletedAt,n.next=11,oa((function(){return E(l,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a.unsetDeviceToken(e.PushTokenType.FCM,t),a.setDeviceTokenDeletedAt(c),n.next=4,a.saveDeviceToken();case 4:case"end":return n.stop()}}),n)})))}));case 11:return this._fcmPushToken="",n.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 15:return n.prev=15,n.t0=n.catch(2),n.abrupt("return",e.PushTokenRegistrationState.ERROR);case 18:n.next=22;break;case 20:return this._fcmPushToken=t,n.abrupt("return",e.PushTokenRegistrationState.PENDING);case 22:case"end":return n.stop()}}),n,this,[[2,15]])})))}},{key:"unregisterFCMPushTokenAllForCurrentUser",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.currentUser){t.next=9;break}return n=Ya.of(this._iid),r=n.sessionManager,a=n.sdkState,i=n.requestQueue,s=new uu({userId:a.userId}),t.next=5,i.send(s);case 5:return o=t.sent,u=o.lastDeletedAt,t.next=9,oa((function(){return E(c,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.unsetDeviceTokens(e.PushTokenType.FCM),r.setDeviceTokenDeletedAt(u),t.next=4,r.saveDeviceToken();case 4:case"end":return t.stop()}}),t)})))}));case 9:case"end":return t.stop()}}),t,this)})))}},{key:"registerAPNSPushTokenForCurrentUser",value:function(t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Aa(A("string",t)).throw(T.invalidParameters),!this.currentUser){n.next=20;break}if(n.prev=2,r=Ya.of(this._iid),a=r.sessionManager,i=r.sdkState,s=r.requestQueue,!a.hasDeviceToken(e.PushTokenType.APNS,t)){n.next=6;break}return n.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 6:return o=new ru({userId:i.userId,token:t}),n.next=9,s.send(o);case 9:return n.next=11,oa((function(){return E(u,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a.setDeviceToken(e.PushTokenType.APNS,t),n.next=3,a.saveDeviceToken();case 3:case"end":return n.stop()}}),n)})))}));case 11:return this._apnsPushToken="",n.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 15:return n.prev=15,n.t0=n.catch(2),n.abrupt("return",e.PushTokenRegistrationState.ERROR);case 18:n.next=22;break;case 20:return this._apnsPushToken=t,n.abrupt("return",e.PushTokenRegistrationState.PENDING);case 22:case"end":return n.stop()}}),n,this,[[2,15]])})))}},{key:"unregisterAPNSPushTokenForCurrentUser",value:function(t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c,l=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Aa(A("string",t)).throw(T.invalidParameters),!this.currentUser){n.next=20;break}return n.prev=2,r=Ya.of(this._iid),a=r.sessionManager,i=r.sdkState,s=r.requestQueue,o=new iu({userId:i.userId,token:t}),n.next=7,s.send(o);case 7:return u=n.sent,c=u.lastDeletedAt,n.next=11,oa((function(){return E(l,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a.unsetDeviceToken(e.PushTokenType.APNS,t),a.setDeviceTokenDeletedAt(c),n.next=4,a.saveDeviceToken();case 4:case"end":return n.stop()}}),n)})))}));case 11:return this._apnsPushToken="",n.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 15:return n.prev=15,n.t0=n.catch(2),n.abrupt("return",e.PushTokenRegistrationState.ERROR);case 18:n.next=22;break;case 20:return this._apnsPushToken=t,n.abrupt("return",e.PushTokenRegistrationState.PENDING);case 22:case"end":return n.stop()}}),n,this,[[2,15]])})))}},{key:"unregisterAPNSPushTokenAllForCurrentUser",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.currentUser){t.next=9;break}return n=Ya.of(this._iid),r=n.sessionManager,a=n.sdkState,i=n.requestQueue,s=new ou({userId:a.userId}),t.next=5,i.send(s);case 5:return o=t.sent,u=o.lastDeletedAt,t.next=9,oa((function(){return E(c,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.unsetDeviceTokens(e.PushTokenType.APNS),r.setDeviceTokenDeletedAt(u),t.next=4,r.saveDeviceToken();case 4:case"end":return t.stop()}}),t)})))}));case 9:case"end":return t.stop()}}),t,this)})))}},{key:"getChannelInvitationPreference",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.sdkState,r=t.requestQueue,a=new hu({userId:n.userId}),e.next=4,r.send(a);case 4:return i=e.sent,s=i.as(du),o=s.autoAccept,e.abrupt("return",{autoAccept:o});case 7:case"end":return e.stop()}}),e,this)})))}},{key:"setChannelInvitationPreference",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(A("boolean",e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new fu({userId:r.userId,willAutoAccept:e}),t.next=5,a.send(i);case 5:return s=t.sent,o=s.as(pu),u=o.autoAccept,t.abrupt("return",{autoAccept:u});case 8:case"end":return t.stop()}}),t,this)})))}},{key:"getDoNotDisturb",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.sdkState,r=t.requestQueue,a=new vu({userId:n.userId}),e.next=4,r.send(a);case 4:return i=e.sent,s=i.as(mu),o=s.preference,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"setDoNotDisturb",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";return E(this,void 0,void 0,regeneratorRuntime.mark((function s(){var o,u,c,l,h,d,f;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return Aa(A("boolean",e)&&A("number",t)&&A("number",n)&&A("number",r)&&A("number",a)&&A("string",i)).throw(T.invalidParameters),o=Ya.of(this._iid),u=o.sdkState,c=o.requestQueue,l=new _u({userId:u.userId,doNotDisturbOn:e,startHour:t,startMin:n,endHour:r,endMin:a,timezone:i}),s.next=5,c.send(l);case 5:return h=s.sent,d=h.as(gu),f=d.preference,s.abrupt("return",f);case 8:case"end":return s.stop()}}),s,this)})))}},{key:"getSnoozePeriod",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.sdkState,r=t.requestQueue,a=new yu({userId:n.userId}),e.next=4,r.send(a);case 4:return i=e.sent,s=i.as(ku),o=s.snoozePeriod,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"setSnoozePeriod",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){var a,i,s,o,u,c,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Aa(A("boolean",e)&&A("number",t)&&A("number",n)).throw(T.invalidParameters),a=Ya.of(this._iid),i=a.sdkState,s=a.requestQueue,o=new Eu({userId:i.userId,snoozeOn:e,startTs:t,endTs:n}),r.next=5,s.send(o);case 5:return u=r.sent,c=u.as(bu),l=c.snoozePeriod,r.abrupt("return",l);case 8:case"end":return r.stop()}}),r,this)})))}},{key:"getMyPushTokensByToken",value:function(t,n){return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){var a,i,s,o,u,c,l,h,d,f,p;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Aa(A("string",t)&&M(e.PushTokenType,n)).throw(T.invalidParameters),a=Ya.of(this._iid),i=a.sdkState,s=a.requestQueue,o=a.sessionManager,u=new cu({userId:i.userId,type:n,token:t}),r.next=5,s.send(u);case 5:c=r.sent,l=c.as(lu),h=l.pushTokens,d=k(h.deviceTokens);try{for(d.s();!(f=d.n()).done;)p=f.value,o.setDeviceToken(h.type,p)}catch(e){d.e(e)}finally{d.f()}return r.next=11,o.saveDeviceToken();case 11:return r.abrupt("return",h);case 12:case"end":return r.stop()}}),r,this)})))}},{key:"getPushTriggerOption",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.sdkState,r=t.requestQueue,a=new Ru({userId:n.userId}),e.next=4,r.send(a);case 4:return i=e.sent,e.abrupt("return",i.as(Cu).pushTriggerOption);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"setPushTriggerOption",value:function(t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Aa(M(e.PushTriggerOption,t)).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new Tu({userId:a.userId,pushTriggerOption:t}),n.next=5,i.send(s);case 5:return o=n.sent,n.abrupt("return",o.as(Su).pushTriggerOption);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"getPushTemplate",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.sdkState,r=t.requestQueue,a=new Iu({userId:n.userId}),e.next=4,r.send(a);case 4:return i=e.sent,e.abrupt("return",i.as(Nu).name);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"setPushTemplate",value:function(t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Aa(M(e.PushTemplate,t)).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new Au({userId:a.userId,templateName:t}),n.next=5,i.send(s);case 5:return o=n.sent,n.abrupt("return",o.as(Mu).name);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"blockUser",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(e instanceof Ua||A("string",e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new wu({userId:r.userId,blockedUserId:e instanceof Ua?e.userId:e}),t.next=5,a.send(i);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"blockUserWithUserId",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.blockUser(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"unblockUser",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(e instanceof Ua||A("string",e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new xu({userId:r.userId,unblockedUserId:e instanceof Ua?e.userId:e}),t.next=5,a.send(i);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"unblockUserWithUserId",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.unblockUser(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getFriendChangeLogsByToken",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(A("string",e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new Uu({userId:r.userId,token:e}),t.next=5,a.send(i);case 5:return s=t.sent,o=s.as(Ou),u=o.changelogs,t.abrupt("return",u);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"getAllowFriendDiscovery",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.sdkState,r=t.requestQueue,a=new qu({userId:n.userId}),e.next=4,r.send(a);case 4:return i=e.sent,s=i.as(ju),o=s.allowFriendDiscovery,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"setAllowFriendDiscovery",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(A("boolean",e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new zu({userId:r.userId,allowFriendDiscovery:e}),t.next=5,a.send(i);case 5:return t.abrupt("return",e);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"uploadFriendDiscoveries",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Ya.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new Du({userId:r.userId,discoveries:e}),t.next=4,a.send(i);case 4:return s=t.sent,o=s.as(Lu),u=o.friendDiscoveryRequestId,t.abrupt("return",u);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"deleteFriendDiscovery",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.deleteFriendDiscoveries([e]));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"deleteFriendDiscoveries",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(O("string",e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new Pu({userId:r.userId,discoveryKeys:e}),t.next=5,a.send(i);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"addFriends",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(O("string",e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new Fu({userId:r.userId,userIds:e}),t.next=5,a.send(i);case 5:return s=t.sent,o=s.as(Hu),u=o.users,t.abrupt("return",u);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"deleteFriend",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.deleteFriends([e]));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"deleteFriends",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(O("string",e)).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new Gu({userId:r.userId,userIds:e}),t.next=5,a.send(i);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"getAllEmoji",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.requestQueue,r=new Ku,e.next=4,n.send(r);case 4:return a=e.sent,i=a.as(Wu),s=i.emojiContainer,e.abrupt("return",s);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getEmojiCategory",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Ya.of(this._iid),r=n.requestQueue,a=new Yu({categoryId:e}),t.next=4,r.send(a);case 4:return i=t.sent,s=i.as(Zu),o=s.emojiCategory,t.abrupt("return",o);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"getEmoji",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Ya.of(this._iid),r=n.requestQueue,a=new Xu({key:e}),t.next=4,r.send(a);case 4:return i=t.sent,s=i.as(Ju),o=s.emoji,t.abrupt("return",o);case 7:case"end":return t.stop()}}),t,this)})))}}],[{key:"init",value:function(e){var n=e.appId,r=e.appVersion,a=void 0===r?null:r,i=e.modules,s=void 0===i?[]:i,o=e.options,u=void 0===o?new G:o,c=e.debugMode,l=void 0!==c&&c,h=e.customApiHost,d=e.customWebSocketHost,f=e.newInstance,p=void 0!==f&&f,v=e.logLevel,m=e.localCacheEnabled,g=void 0!==m&&m,y=e.localCacheEncryption,k=e.useAsyncStorageStore,E=void 0===k?null:k,b=e.appStateToggleEnabled,w=void 0===b||b;if(!jh||p){var x="su-".concat(B()),R=null!=y?y:{encrypt:function(e){return e},decrypt:function(e){return e}},C=new Zc({encryption:R});l||(C=E?new el({AsyncStorage:E,encryption:R}):new $c({encryption:R})),new Ya(x,{appId:n,appVersion:a,options:u,apiHost:null!=h?h:"https://api-".concat(n,".sendbird.com"),websocketHost:null!=d?d:"wss://ws-".concat(n,".sendbird.com"),store:C,encryption:R,logLevel:v,localCacheEnabled:g,debugMode:l,appStateToggleEnabled:w});var T=[new As,new no],S=new t(x,u,[].concat(_(s),T));return jh||(jh=S),S}return jh}},{key:"instance",get:function(){return jh}},{key:"version",get:function(){return w}}]),t}();e.MemberState=void 0,(Rl=e.MemberState||(e.MemberState={})).NONE="none",Rl.JOINED="joined",Rl.INVITED="invited",Rl.LEFT="left";var Vh,Bh,Qh,Kh,Wh,Yh,Zh,Xh,Jh=function(t){i(o,t);var r=f(o);function o(t,a){var i;return n(this,o),(i=r.call(this,t,a)).state=null,i.role=null,i.isMuted=!1,i.isBlockedByMe=!1,i.isBlockingMe=!1,i.state=M(e.MemberState,a.state)?a.state:null,i.role=M(e.Role,a.role)?a.role:null,a.hasOwnProperty("is_muted")&&(i.isMuted=a.is_muted),a.hasOwnProperty("is_blocked_by_me")&&(i.isBlockedByMe=a.is_blocked_by_me),a.hasOwnProperty("is_blocking_me")&&(i.isBlockingMe=a.is_blocking_me),i}return a(o,null,[{key:"payloadify",value:function(e){return e?Z(Object.assign(Object.assign({},v(s(o),"payloadify",this).call(this,e)),{state:e.state,role:e.role,is_muted:e.isMuted,is_blocked_by_me:e.isBlockedByMe,is_blocking_me:e.isBlockingMe})):null}}]),o}(cl),$h=function(t){i(s,t);var r=f(s);function s(t,a){var i,o,u;return n(this,s),(i=r.call(this,t)).channelUrl=null!==(o=a.channel_url)&&void 0!==o?o:"",i.channelType=null!==(u=a.channel_type)&&void 0!==u?u:e.ChannelType.GROUP,i.reader=new Ua(i._iid,a.user),i.readAt=a.ts,i}return a(s)}(ba);e.PublicChannelFilter=void 0,(Vh=e.PublicChannelFilter||(e.PublicChannelFilter={})).ALL="all",Vh.PUBLIC="public",Vh.PRIVATE="private",e.MyMemberStateFilter=void 0,(Bh=e.MyMemberStateFilter||(e.MyMemberStateFilter={})).ALL="all",Bh.JOINED="joined_only",Bh.INVITED="invited_only",Bh.INVITED_BY_FRIEND="invited_by_friend",Bh.INVITED_BY_NON_FRIEND="invited_by_non_friend",e.SuperChannelFilter=void 0,(Qh=e.SuperChannelFilter||(e.SuperChannelFilter={})).ALL="all",Qh.SUPER="super",Qh.NON_SUPER="nonsuper",Qh.BROADCAST_ONLY="broadcast_only",Qh.EXCLUSIVE_ONLY="exclusive_only",e.UnreadChannelFilter=void 0,(Kh=e.UnreadChannelFilter||(e.UnreadChannelFilter={})).ALL="all",Kh.UNREAD_MESSAGE="unread_message",e.HiddenChannelFilter=void 0,(Wh=e.HiddenChannelFilter||(e.HiddenChannelFilter={})).ALL="all",Wh.UNHIDDEN="unhidden_only",Wh.HIDDEN="hidden_only",Wh.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",Wh.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide",e.OperatorFilter=void 0,(Yh=e.OperatorFilter||(e.OperatorFilter={})).ALL="all",Yh.OPERATOR="operator",Yh.NONOPERATOR="nonoperator",e.QueryType=void 0,(Zh=e.QueryType||(e.QueryType={})).AND="AND",Zh.OR="OR",e.GroupChannelSearchField=void 0,(Xh=e.GroupChannelSearchField||(e.GroupChannelSearchField={})).MEMBER_NICKNAME="member_nickname",Xh.CHANNEL_NAME="channel_name";var ed,td=function(){function t(){n(this,t),this._searchFilter=null,this._userIdsFilter=null,this.includeEmpty=!1,this.nicknameContainsFilter=null,this.nicknameStartsWithFilter=null,this.nicknameExactMatchFilter=null,this.channelNameContainsFilter="",this.myMemberStateFilter=e.MyMemberStateFilter.ALL,this.customTypesFilter=null,this.channelUrlsFilter=null,this.superChannelFilter=e.SuperChannelFilter.ALL,this.publicChannelFilter=e.PublicChannelFilter.ALL,this.customTypeStartsWithFilter=null,this.unreadChannelFilter=e.UnreadChannelFilter.ALL,this.hiddenChannelFilter=e.HiddenChannelFilter.UNHIDDEN,this.includeFrozen=!0}return a(t,[{key:"_isFriend",value:function(e){return!!e.friendDiscoveryKey||!!e.friendName}},{key:"searchFilter",get:function(){return this._searchFilter}},{key:"setSearchFilter",value:function(e,t){Array.isArray(e)&&0!==e.length&&"string"==typeof t&&t&&(this._searchFilter={query:t,fields:e})}},{key:"userIdsFilter",get:function(){return this._userIdsFilter}},{key:"setUserIdsFilter",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.QueryType.AND;this._userIdsFilter={userIds:t,includeMode:n,queryType:r}}},{key:"clone",value:function(){var e=new t;this.searchFilter&&e.setSearchFilter(this.searchFilter.fields,this.searchFilter.query),this.userIdsFilter&&e.setUserIdsFilter(this.userIdsFilter.userIds,this.userIdsFilter.includeMode,this.userIdsFilter.queryType);var n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(t){e[t]=n[t]})),e}},{key:"match",value:function(t,n){if(this._searchFilter){var r=this._searchFilter,a=r.query,i=r.fields;if(a&&i&&i.length>0&&!i.some((function(n){switch(n){case e.GroupChannelSearchField.CHANNEL_NAME:return t.name.toLowerCase().includes(a.toLowerCase());case e.GroupChannelSearchField.MEMBER_NICKNAME:return t.members.some((function(e){return e.nickname.toLowerCase().includes(a.toLowerCase())}));default:return!0}})))return!1}if(this._userIdsFilter){var s=this._userIdsFilter,o=s.userIds,u=s.includeMode,c=s.queryType,l=t.members.map((function(e){return e.userId}));if(u){if(o.length>0)switch(c){case e.QueryType.AND:if(o.some((function(e){return!l.includes(e)})))return!1;break;case e.QueryType.OR:if(o.every((function(e){return!l.includes(e)})))return!1}}else{if(o.includes(n)||o.push(n),t.members.length>o.length)return!1;if(!function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=_(e).sort(),r=_(t).sort(),a=0;a<n.length;++a)if(n[a]!==r[a])return!1;return!0}(o,l))return!1}}if(!this.includeEmpty&&!t.lastMessage)return!1;if(!this.includeFrozen&&t.isFrozen)return!1;if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(t.customType))return!1;if(this.customTypeStartsWithFilter&&!new RegExp("^".concat(this.customTypeStartsWithFilter)).test(t.customType))return!1;if(this.channelNameContainsFilter&&!t.name.toLowerCase().includes(this.channelNameContainsFilter.toLowerCase()))return!1;if(this.nicknameContainsFilter){var h=this.nicknameContainsFilter.toLowerCase();if(!t.members.some((function(e){return e.userId!==n&&e.nickname.toLowerCase().includes(h)})))return!1}if(this.nicknameStartsWithFilter){var d=this.nicknameStartsWithFilter.toLowerCase();if(!t.members.some((function(e){return e.userId!==n&&e.nickname.toLowerCase().startsWith(d)})))return!1}if(this.nicknameExactMatchFilter){var f=this.nicknameExactMatchFilter.toLowerCase();if(!t.members.some((function(e){return e.userId!==n&&e.nickname.toLowerCase()!=f})))return!1}if(this.channelUrlsFilter&&this.channelUrlsFilter.length>0&&!this.channelUrlsFilter.includes(t.url))return!1;if(this.myMemberStateFilter)switch(this.myMemberStateFilter){case e.MyMemberStateFilter.JOINED:if("joined"!==t.myMemberState)return!1;break;case e.MyMemberStateFilter.INVITED:if("invited"!==t.myMemberState)return!1;break;case e.MyMemberStateFilter.INVITED_BY_FRIEND:if("invited"!==t.myMemberState||!this._isFriend(t.inviter))return!1;break;case e.MyMemberStateFilter.INVITED_BY_NON_FRIEND:if("invited"!==t.myMemberState||this._isFriend(t.inviter))return!1}if(this.hiddenChannelFilter)switch(this.hiddenChannelFilter){case e.HiddenChannelFilter.UNHIDDEN:if(t.isHidden||"unhidden"!==t.hiddenState)return!1;break;case e.HiddenChannelFilter.HIDDEN:if(!t.isHidden)return!1;break;case e.HiddenChannelFilter.HIDDEN_ALLOW_AUTO_UNHIDE:if(!t.isHidden||"hidden_allow_auto_unhide"!==t.hiddenState)return!1;break;case e.HiddenChannelFilter.HIDDEN_PREVENT_AUTO_UNHIDE:if(!t.isHidden||"hidden_prevent_auto_unhide"!==t.hiddenState)return!1}if(this.unreadChannelFilter&&this.unreadChannelFilter===e.UnreadChannelFilter.UNREAD_MESSAGE)if(0===t.unreadMessageCount)return!1;if(this.publicChannelFilter)switch(this.publicChannelFilter){case e.PublicChannelFilter.PUBLIC:if(!t.isPublic)return!1;break;case e.PublicChannelFilter.PRIVATE:if(t.isPublic)return!1}if(this.superChannelFilter)switch(this.superChannelFilter){case e.SuperChannelFilter.SUPER:if(!t.isSuper)return!1;break;case e.SuperChannelFilter.NON_SUPER:if(t.isSuper)return!1}return!0}}]),t}(),nd=function(t){i(s,t);var r=f(s);function s(e,t){var a,i=t.sdkState,o=t.cacheContext;return n(this,s),(a=r.call(this,e))._channels=new Map,a._sdkState=i,a._cacheContext=o,a}return a(s,[{key:"collection",get:function(){var e=this._cacheContext.nestdb;return e?e.collection(uo):null}},{key:"localCacheEnabled",get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection}},{key:"_serialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object.assign(Object.assign({},e.serialize()),{lastMessageUpdatedAt:e.lastMessage?e.lastMessage.createdAt:0,syncIndex:t})}},{key:"_deserialize",value:function(e){return Rf.of(this._iid).buildGroupChannelFromSerializedData(e)}},{key:"channels",get:function(){return _(this._channels.values())}},{key:"isCachedInMemory",value:function(e){return this._channels.has(e)}},{key:"filterOffsetChanged",value:function(e){var t=this;return e.filter((function(e){if(t._channels.has(e.url))return t._channels.get(e.url).messageOffsetTimestamp<e.messageOffsetTimestamp}))}},{key:"get",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._channels.has(e)){t.next=12;break}if(!this.localCacheEnabled){t.next=9;break}return t.next=4,this.collection.getByKey(e);case 4:if(!(n=t.sent)){t.next=9;break}return r=this._deserialize(n),this._channels.set(e,r),t.abrupt("return",r);case 9:return t.abrupt("return",null);case 12:return t.abrupt("return",this._channels.get(e));case 13:case"end":return t.stop()}}),t,this)})))}},{key:"fetch",value:function(t){var n=t.token,r=t.limit,a=void 0===r?100:r,i=t.backward,s=void 0!==i&&i,o=t.filter,u=void 0===o?new td:o,c=t.order,l=void 0===c?e.GroupChannelListOrder.LATEST_LAST_MESSAGE:c;return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,i,o,c,h,d=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=12;break}return r=fo(l),i={where:function(t){if(n)switch(l){case e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL:if(!s&&t.name.localeCompare(n)<0||s&&t.name.localeCompare(n)>0)return!1;break;case e.GroupChannelListOrder.CHRONOLOGICAL:if(!s&&t.createdAt>n||s&&t.createdAt<n)return!1;break;case e.GroupChannelListOrder.LATEST_LAST_MESSAGE:if(!s&&t.lastMessageUpdatedAt>n||s&&t.lastMessageUpdatedAt<n)return!1}return u.match(d._deserialize(t),d._sdkState.userId)},index:r,backward:s},t.next=5,this.collection.query(i);case 5:return o=t.sent,t.next=8,o.fetch({limit:a});case 8:return c=t.sent,(h=c.map((function(e){return d._deserialize(e)}))).forEach((function(e){d._channels.has(e.url)||d._channels.set(e.url,e)})),t.abrupt("return",h);case 12:return t.abrupt("return",[]);case 13:case"end":return t.stop()}}),t,this)})))}},{key:"upsert",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.forEach((function(e){if(a._channels.has(e.url)){var t=a._channels.get(e.url);e._pinnedMessagesUpdatedAt<t._pinnedMessagesUpdatedAt&&(e._pinnedMessagesUpdatedAt=t._pinnedMessagesUpdatedAt),Object.assign(t,e,{_iid:a._iid})}else a._channels.set(e.url,e)})),!this.localCacheEnabled){t.next=6;break}for(r in n=[],e)n.push(this._serialize(e[r],parseInt(r)));return t.next=6,this.collection.upsertMany(n);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"remove",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=k(e),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=11;break}if(a=r.value,this._channels.delete(a),!this.localCacheEnabled){t.next=9;break}return t.next=9,this.collection.remove(a);case 9:t.next=3;break;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),n.e(t.t0);case 16:return t.prev=16,n.f(),t.finish(16);case 19:case"end":return t.stop()}}),t,this,[[1,13,16,19]])})))}},{key:"clear",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.clearMemoryCache(),!this.localCacheEnabled){e.next=4;break}return e.next=4,this.collection.clear();case 4:case"end":return e.stop()}}),e,this)})))}},{key:"clearMemoryCache",value:function(){this._channels.clear()}},{key:"_setBlockStateOfAllChannels",value:function(e,t,n){return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){var a,i,s,o,u,c,l,h,d,f,p,v,m;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=[],e!==this._sdkState.userId){r.next=38;break}i=k(this._channels.values()),r.prev=3,i.s();case 5:if((s=i.n()).done){r.next=28;break}o=s.value,u=k(o.members),r.prev=8,u.s();case 10:if((c=u.n()).done){r.next=18;break}if((l=c.value).userId!==t){r.next=16;break}return l.isBlockedByMe=n,a.push(o),r.abrupt("break",18);case 16:r.next=10;break;case 18:r.next=23;break;case 20:r.prev=20,r.t0=r.catch(8),u.e(r.t0);case 23:return r.prev=23,u.f(),r.finish(23);case 26:r.next=5;break;case 28:r.next=33;break;case 30:r.prev=30,r.t1=r.catch(3),i.e(r.t1);case 33:return r.prev=33,i.f(),r.finish(33);case 36:r.next=73;break;case 38:if(t!==this._sdkState.userId){r.next=73;break}h=k(this._channels.values()),r.prev=40,h.s();case 42:if((d=h.n()).done){r.next=65;break}f=d.value,p=k(f.members),r.prev=45,p.s();case 47:if((v=p.n()).done){r.next=55;break}if((m=v.value).userId!==e){r.next=53;break}return m.isBlockingMe=n,a.push(f),r.abrupt("break",55);case 53:r.next=47;break;case 55:r.next=60;break;case 57:r.prev=57,r.t2=r.catch(45),p.e(r.t2);case 60:return r.prev=60,p.f(),r.finish(60);case 63:r.next=42;break;case 65:r.next=70;break;case 67:r.prev=67,r.t3=r.catch(40),h.e(r.t3);case 70:return r.prev=70,h.f(),r.finish(70);case 73:if(!(a.length>0)){r.next=76;break}return r.next=76,this.upsert(a);case 76:case"end":return r.stop()}}),r,this,[[3,30,33,36],[8,20,23,26],[40,67,70,73],[45,57,60,63]])})))}},{key:"block",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this._setBlockStateOfAllChannels(e,t,!0);case 2:case"end":return n.stop()}}),n,this)})))}},{key:"unblock",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this._setBlockStateOfAllChannels(e,t,!1);case 2:case"end":return n.stop()}}),n,this)})))}},{key:"markAsRead",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_(this._channels.keys());return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=[],a=k(t),n.prev=2,a.s();case 4:if((i=a.n()).done){n.next=12;break}return s=i.value,n.next=8,this.get(s);case 8:(o=n.sent)._updateUnreadMemberState(this._sdkState.userId,e)&&(o._updateUnreadCount(0,0),r.push(o));case 10:n.next=4;break;case 12:n.next=17;break;case 14:n.prev=14,n.t0=n.catch(2),a.e(n.t0);case 17:return n.prev=17,a.f(),n.finish(17);case 20:if(!(r.length>0)){n.next=23;break}return n.next=23,this.upsert(r);case 23:case"end":return n.stop()}}),n,this,[[2,14,17,20]])})))}}]),s}(ba);!function(e){e[e.NONE=0]="NONE",e[e.CHANNEL_ENTER=10102]="CHANNEL_ENTER",e[e.CHANNEL_EXIT=10103]="CHANNEL_EXIT",e[e.USER_CHANNEL_MUTE=10201]="USER_CHANNEL_MUTE",e[e.USER_CHANNEL_UNMUTE=10200]="USER_CHANNEL_UNMUTE",e[e.USER_CHANNEL_BAN=10601]="USER_CHANNEL_BAN",e[e.USER_CHANNEL_UNBAN=10600]="USER_CHANNEL_UNBAN",e[e.CHANNEL_FREEZE=10701]="CHANNEL_FREEZE",e[e.CHANNEL_UNFREEZE=10700]="CHANNEL_UNFREEZE",e[e.TYPING_START=10900]="TYPING_START",e[e.TYPING_END=10901]="TYPING_END",e[e.CHANNEL_JOIN=1e4]="CHANNEL_JOIN",e[e.CHANNEL_LEAVE=10001]="CHANNEL_LEAVE",e[e.CHANNEL_OPERATOR_UPDATE=10002]="CHANNEL_OPERATOR_UPDATE",e[e.CHANNEL_INVITE=10020]="CHANNEL_INVITE",e[e.CHANNEL_ACCEPT_INVITE=10021]="CHANNEL_ACCEPT_INVITE",e[e.CHANNEL_DECLINE_INVITE=10022]="CHANNEL_DECLINE_INVITE",e[e.CHANNEL_PROP_CHANGED=11e3]="CHANNEL_PROP_CHANGED",e[e.CHANNEL_DELETED=12e3]="CHANNEL_DELETED",e[e.CHANNEL_META_DATA_CHANGED=11100]="CHANNEL_META_DATA_CHANGED",e[e.CHANNEL_META_COUNTERS_CHANGED=11200]="CHANNEL_META_COUNTERS_CHANGED",e[e.CHANNEL_HIDE=13e3]="CHANNEL_HIDE",e[e.CHANNEL_UNHIDE=13001]="CHANNEL_UNHIDE",e[e.PINNED_MESSAGE_CHANGED=11300]="PINNED_MESSAGE_CHANGED"}(ed||(ed={}));var rd,ad=function(){function t(e){n(this,t),this.channelUrl=e.channel_url,this.channelType=e.channel_type,this.category=e.cat,this.data=e.data,this.ts=e.ts}return a(t,[{key:"isGroupChannelEvent",get:function(){return this.channelType===e.ChannelType.GROUP}},{key:"isOpenChannelEvent",get:function(){return this.channelType===e.ChannelType.OPEN}}]),t}(),id={invitedUserIds:null,channelUrl:null,coverUrl:null,coverImage:null,isDistinct:null,isSuper:null,isBroadcast:null,isExclusive:null,isPublic:null,isDiscoverable:null,isStrict:null,isEphemeral:null,accessCode:null,name:null,data:null,customType:null,operatorUserIds:null,messageSurvivalSeconds:null},sd=function(e){return O("string",e.invitedUserIds,!0)&&A("string",e.channelUrl,!0)&&A("string",e.coverUrl,!0)&&(L(e.coverImage)||A("string",e.coverImage)||null===e.coverImage)&&A("boolean",e.isDistinct,!0)&&A("boolean",e.isSuper,!0)&&A("boolean",e.isBroadcast,!0)&&A("boolean",e.isExclusive,!0)&&A("boolean",e.isPublic,!0)&&A("boolean",e.isStrict,!0)&&A("boolean",e.isDiscoverable,!0)&&A("boolean",e.isEphemeral,!0)&&A("string",e.accessCode,!0)&&A("string",e.name,!0)&&A("string",e.data,!0)&&A("string",e.customType,!0)&&O("string",e.operatorUserIds,!0)&&A("number",e.messageSurvivalSeconds,!0)},od={customTypes:null,includeEmpty:!1,includeFrozen:!0},ud=function(e){return O("string",e.customTypes,!0)&&A("boolean",e.includeEmpty)&&A("boolean",e.includeFrozen)},cd={myMemberStateFilter:e.MyMemberStateFilter.ALL},ld=function(t){return M(e.MyMemberStateFilter,t.myMemberStateFilter)};e.UnreadItemKey=void 0,(rd=e.UnreadItemKey||(e.UnreadItemKey={})).GROUP_CHANNEL_UNREAD_MENTION_COUNT="group_channel_unread_mention_count",rd.NONSUPER_UNREAD_MENTION_COUNT="non_super_group_channel_unread_mention_count",rd.SUPER_UNREAD_MENTION_COUNT="super_group_channel_unread_mention_count",rd.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT="group_channel_unread_message_count",rd.NONSUPER_UNREAD_MESSAGE_COUNT="non_super_group_channel_unread_message_count",rd.SUPER_UNREAD_MESSAGE_COUNT="super_group_channel_unread_message_count",rd.GROUP_CHANNEL_INVITATION_COUNT="group_channel_invitation_count",rd.NONSUPER_INVITATION_COUNT="non_super_group_channel_invitation_count",rd.SUPER_INVITATION_COUNT="super_group_channel_invitation_count";var hd,dd={keys:[]},fd=function(t){return O(e.UnreadItemKey,t.keys)},pd={channelCustomTypesFilter:null,superChannelFilter:e.SuperChannelFilter.ALL},vd=function(t){return O("string",t.channelCustomTypesFilter,!0)&&M(e.SuperChannelFilter,t.superChannelFilter)},md={channelUrl:null,scheduledStatus:null,messageTypeFilter:e.MessageTypeFilter.ALL},_d=function(t){return A("string",t.channelUrl,!0)&&O(e.ScheduledStatus,t.scheduledStatus,!0)&&M(e.MessageTypeFilter,t.messageTypeFilter)};e.GroupChannelEventSource=void 0,(hd=e.GroupChannelEventSource||(e.GroupChannelEventSource={})).UNKNOWN="UNKNOWN",hd.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",hd.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",hd.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",hd.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",hd.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",hd.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",hd.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",hd.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",hd.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",hd.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",hd.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",hd.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",hd.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",hd.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",hd.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",hd.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",hd.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",hd.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",hd.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",hd.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",hd.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",hd.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",hd.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",hd.EVENT_PINNED_MESSAGE_UPDATED="EVENT_PINNED_MESSAGE_UPDATED",hd.REQUEST_CHANNEL="REQUEST_CHANNEL",hd.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",hd.REFRESH_CHANNEL="REFRESH_CHANNEL",hd.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",hd.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS";var gd,yd=function(t){return t.startsWith("EVENT_")||t===e.GroupChannelEventSource.SYNC_CHANNEL_BACKGROUND||t===e.GroupChannelEventSource.SYNC_CHANNEL_CHANGELOGS},kd=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channels,s=e.source;return n(this,r),(a=t.call(this)).channels=i,a.source=s,a}return a(r)}(Y),Ed=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelUrls,s=e.source;return n(this,r),(a=t.call(this)).channelUrls=i,a.source=s,a}return a(r)}(Y),bd=function(){function e(t){var r=this,a=t.groupChannelCache,i=t.messageCache,s=t.unsentMessageCache,o=t.dispatcher;n(this,e),this._observers=new Map,o.on((function(e){return E(r,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,o,u,c,l,h,d,f,p=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof kd)){t.next=26;break}n=e.channels,r=e.source,o=n.filter((function(e){return e instanceof Mp})),u=a.filterOffsetChanged(o),c=k(u),t.prev=5,c.s();case 7:if((l=c.n()).done){t.next=13;break}return h=l.value,t.next=11,i.removeUnderOffset(h.url,h.messageOffsetTimestamp);case 11:t.next=7;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),c.e(t.t0);case 18:return t.prev=18,c.f(),t.finish(18);case 21:return t.next=23,a.upsert(o);case 23:this._broadcastUpdateEvent(o,r),t.next=38;break;case 26:if(!(e instanceof Ed)){t.next=35;break}return d=e.channelUrls,f=e.source,t.next=30,a.remove(d);case 30:return t.next=32,oa((function(){return E(p,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(d),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=11;break}return r=n.value,e.next=7,i.removeMessagesOfChannel(r);case 7:return e.next=9,s.removeMessagesOfChannel(r);case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),t.e(e.t0);case 16:return e.prev=16,t.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[1,13,16,19]])})))}));case 32:this._broadcastRemoveEvent(d,f),t.next=38;break;case 35:if(!(e instanceof $o)){t.next=38;break}return t.next=38,a.fetch({token:Number.MAX_SAFE_INTEGER,limit:Number.MAX_SAFE_INTEGER});case 38:case"end":return t.stop()}}),t,this,[[5,15,18,21]])})))}))}return a(e,[{key:"_broadcastUpdateEvent",value:function(e,t){var n,r=k(this._observers.values());try{for(r.s();!(n=r.n()).done;){n.value.onUpdate(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_broadcastRemoveEvent",value:function(e,t){var n,r=k(this._observers.values());try{for(r.s();!(n=r.n()).done;){n.value.onRemove(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"subscribe",value:function(e,t){this._observers.set(e,t)}},{key:"unsubscribe",value:function(e){this._observers.delete(e)}},{key:"unsubscribeAll",value:function(){this._observers.clear()}}]),e}(),wd=function(){function e(t){var r=this,a=t.cacheContext,i=t.messageCache,s=t.unsentMessageCache,o=t.dispatcher,u=t.logger;n(this,e),this._cacheContext=null,this._observers=new Map,this._logger=null,this._cacheContext=a,this._logger=u,o.on((function(e){return E(r,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,o,u,c,l,h,d,f,p,v,m,_,g,y,k,b,w=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof es)){t.next=14;break}if(n=e.messages,r=e.source,a=n.filter((function(e){return e.messageId>0})),o=n.filter((function(e){return 0===e.messageId})),!(a.length>0)){t.next=8;break}return t.next=7,oa((function(){return E(w,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.upsert(a);case 2:return e.next=4,s.remove(a.map((function(e){return e instanceof bi?e.reqId:null})).filter((function(e){return null!==e})));case 4:case"end":return e.stop()}}),e)})))}));case 7:this._broadcastUpdateEvent(a,r);case 8:if(!(o.length>0)){t.next=12;break}return t.next=11,oa((function(){return E(w,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.upsert(o);case 2:case"end":return e.stop()}}),e)})))}));case 11:this._broadcastUpdateEvent(o,r);case 12:t.next=61;break;case 14:if(!(e instanceof ts)){t.next=21;break}return u=e.messageIds,c=e.source,t.next=18,oa((function(){return E(w,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.remove(u);case 2:case"end":return e.stop()}}),e)})))}));case 18:this._broadcastRemoveEvent(u,c),t.next=61;break;case 21:if(!(e instanceof ns)){t.next=28;break}return l=e.reqId,h=e.source,t.next=25,oa((function(){return E(w,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.remove([l]);case 2:case"end":return e.stop()}}),e)})))}));case 25:this._broadcastRemoveUnsentEvent(l,h),t.next=61;break;case 28:if(!(e instanceof rs)){t.next=41;break}if(d=e.polls,f=e.source,!this._cacheContext.localCacheEnabled){t.next=38;break}return p=d.map((function(e){return e.messageId})),t.next=34,Promise.all(p.map((function(e){return i.get(e)})));case 34:return v=t.sent.filter((function(e){return e})),v.length>0&&d.forEach((function(e){var t=v.find((function(t){return t.messageId===e.messageId}));t&&t.applyPoll(e)})),t.next=38,oa((function(){return E(w,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.upsert(v);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}));case 38:this._broadcastPollChangeLogEvent(d,f),t.next=61;break;case 41:if(!(e instanceof as)){t.next=52;break}return m=e.event,_=e.source,t.next=45,i.get(m.messageId);case 45:if(!((g=t.sent)&&g.isUserMessage()&&g.poll&&g.poll.applyPollUpdateEvent(m))){t.next=49;break}return t.next=49,oa((function(){return E(w,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.upsert([g]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}));case 49:this._broadcastPollUpdateEvent(m,_),t.next=61;break;case 52:if(!(e instanceof is)){t.next=61;break}return y=e.event,k=e.source,t.next=56,i.get(y.messageId);case 56:if(!((b=t.sent)&&b.isUserMessage()&&b.poll&&b.poll.applyPollVoteEvent(y))){t.next=60;break}return t.next=60,oa((function(){return E(w,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.upsert([b]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}));case 60:this._broadcastPollVoteEvent(y,k);case 61:case"end":return t.stop()}}),t,this)})))}))}return a(e,[{key:"_broadcastUpdateEvent",value:function(e,t){var n,r=k(this._observers.values());try{for(r.s();!(n=r.n()).done;){n.value.onUpdate(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_broadcastPollChangeLogEvent",value:function(e,t){var n,r=k(this._observers.values());try{for(r.s();!(n=r.n()).done;){n.value.onPollChangeLogUpdate(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_broadcastPollUpdateEvent",value:function(e,t){var n,r=k(this._observers.values());try{for(r.s();!(n=r.n()).done;){n.value.onPollUpdate(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_broadcastPollVoteEvent",value:function(e,t){var n,r=k(this._observers.values());try{for(r.s();!(n=r.n()).done;){n.value.onPollVote(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_broadcastRemoveEvent",value:function(e,t){var n,r=k(this._observers.values());try{for(r.s();!(n=r.n()).done;){n.value.onRemove(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_broadcastRemoveUnsentEvent",value:function(e,t){var n,r=k(this._observers.values());try{for(r.s();!(n=r.n()).done;){n.value.onRemoveUnsent(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"subscribe",value:function(e,t){this._observers.set(e,t)}},{key:"unsubscribe",value:function(e){this._observers.delete(e)}},{key:"unsubscribeAll",value:function(){this._observers.clear()}}]),e}(),xd=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.ts,o=e.token,u=e.filter;n(this,r),a=t.call(this);var c=Object.assign(Object.assign({},od),u),l=c.customTypes,h=c.includeEmpty,d=c.includeFrozen;return a.method=R.GET,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/my_group_channels/changelogs"),a.params=Z({show_delivery_receipt:!0,show_member:!0,show_read_receipt:!0,change_ts:s>0?s:null,token:o,custom_types:l,show_empty:h,show_frozen:d}),a}return a(r)}(J),Rd=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).updatedChannels=a.updated.map((function(t){return new Mp(e,t)})),i.deletedChannelUrls=a.deleted,i.hasMore=a.has_more,i.token=a.next,i}return a(r)}($),Cd=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelUrl,s=e.isInternalCall;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(s?jr:qr,"/").concat(encodeURIComponent(i)),a.params={show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0},a}return a(r)}(J),Td=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).channel=null,i.channel=new Mp(e,a),i}return a(r)}($),Sd=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.userId,s=e.token,o=e.limit,u=e.order,c=e.includeEmpty,l=e.myMemberStateFilter,h=e.superChannelFilter,d=e.publicChannelFilter,f=e.unreadChannelFilter,p=e.nicknameContainsFilter,v=e.nicknameStartsWithFilter,m=e.nicknameExactMatchFilter,_=e.channelNameContainsFilter,g=e.channelUrlsFilter,y=e.customTypesFilter,k=e.customTypeStartsWithFilter,E=e.hiddenChannelFilter,b=e.metadataOrderKeyFilter,w=e.metadataKey,x=e.metadataValues,C=e.metadataValueStartsWith,T=e.includeFrozen,S=e.includeMetaData,I=e.searchFilter,N=e.userIdsFilter;return(a=t.call(this)).method=R.GET,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/my_group_channels"),a.params=Z({token:s,limit:o,order:u,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:c,member_state_filter:l,super_mode:h,public_mode:d,unread_filter:f,members_nickname_contains:p,members_nickname_startswith:v,members_nickname:m,name_contains:_,channel_urls:g,custom_types:y,custom_type_startswith:k,hidden_mode:E,metadata_order_key:b,metadata_key:w,metadata_values:x,metadata_value_startswith:C,show_frozen:T,show_metadata:S}),I&&I.query&&I.fields&&(a.params.search_query=I.query,a.params.search_fields=I.fields),N&&N.userIds&&N.userIds.length>0&&(N.includeMode?(a.params.members_include_in=N.userIds,a.params.query_type=N.queryType.toUpperCase()):a.params.members_exactly_in=N.userIds),a}return a(r)}(J),Id=function(e){i(r,e);var t=f(r);function r(e,a){var i;n(this,r),(i=t.call(this,e,a)).token=null,i.channels=[],i.ts=null;var s=a.next,o=a.channels,u=a.ts;return i.token=s,o&&o.length>0&&(i.channels=o.map((function(t){return t.ts=u,new Mp(e,t)}))),i.ts=null!=u?u:null,i}return a(r)}($),Nd=function(t){i(s,t);var r=f(s);function s(t){var a,i=t.userId,o=t.filter;n(this,s),a=r.call(this);var u=o.myMemberStateFilter;return a.method=R.GET,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/group_channel_count"),a.params={state:null!=u?u:e.MyMemberStateFilter.ALL},a}return a(s)}(J),Ad=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).groupChannelCount=a.group_channel_count,i}return a(r)}($),Md=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.filter;n(this,r),a=t.call(this);var o=s.keys;return a.method=R.GET,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/unread_item_count"),a.params={item_keys:o},a}return a(r)}(J),Ud=function(t){i(s,t);var r=f(s);function s(t,a){var i;return n(this,s),i=r.call(this,t,a),"number"==typeof a[e.UnreadItemKey.GROUP_CHANNEL_UNREAD_MENTION_COUNT]&&(i.groupChannelUnreadMentionCount=a[e.UnreadItemKey.GROUP_CHANNEL_UNREAD_MENTION_COUNT]),"number"==typeof a[e.UnreadItemKey.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]&&(i.groupChannelUnreadMessageCount=a[e.UnreadItemKey.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]),"number"==typeof a[e.UnreadItemKey.GROUP_CHANNEL_INVITATION_COUNT]&&(i.groupChannelInvitationCount=a[e.UnreadItemKey.GROUP_CHANNEL_INVITATION_COUNT]),"number"==typeof a[e.UnreadItemKey.SUPER_UNREAD_MENTION_COUNT]&&(i.superGroupChannelUnreadMentionCount=a[e.UnreadItemKey.SUPER_UNREAD_MENTION_COUNT]),"number"==typeof a[e.UnreadItemKey.SUPER_UNREAD_MESSAGE_COUNT]&&(i.superGroupChannelUnreadMessageCount=a[e.UnreadItemKey.SUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof a[e.UnreadItemKey.SUPER_INVITATION_COUNT]&&(i.superGroupChannelInvitationCount=a[e.UnreadItemKey.SUPER_INVITATION_COUNT]),"number"==typeof a[e.UnreadItemKey.NONSUPER_UNREAD_MENTION_COUNT]&&(i.nonSuperGroupChannelUnreadMentionCount=a[e.UnreadItemKey.NONSUPER_UNREAD_MENTION_COUNT]),"number"==typeof a[e.UnreadItemKey.NONSUPER_UNREAD_MESSAGE_COUNT]&&(i.nonSuperGroupChannelUnreadMessageCount=a[e.UnreadItemKey.NONSUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof a[e.UnreadItemKey.NONSUPER_INVITATION_COUNT]&&(i.nonSuperGroupChannelInvitationCount=a[e.UnreadItemKey.NONSUPER_INVITATION_COUNT]),i}return a(s)}($),Od=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/unread_channel_count"),a}return a(r)}(J),Dd=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).unreadCount=a.unread_count,i}return a(r)}($),Ld=function(t){i(s,t);var r=f(s);function s(t){var a,i=t.userId,o=t.filter;n(this,s),a=r.call(this);var u=o.channelCustomTypesFilter,c=o.superChannelFilter;return a.method=R.GET,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/unread_message_count"),a.params={super_mode:null!=c?c:e.SuperChannelFilter.ALL,custom_types:u},a}return a(s)}(J),Pd=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).unreadCount=a.unread_count,i}return a(r)}($),Fd=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelUrl,s=e.scheduledStatus,o=e.messageTypeFilter;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Zr,"/count"),a.params={channel_url:i,status:Gd(s)},o&&(a.params.message_type=o),a}return a(r)}(J),Hd=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).count=a.count,i}return a(r)}($),Gd=function(t){if(t){var n=[];return t.forEach((function(t){switch(t){case e.ScheduledStatus.PENDING:n.push(hi.PENDING);break;case e.ScheduledStatus.SENT:n.push(hi.IN_QUEUE),n.push(hi.SENT);break;case e.ScheduledStatus.CANCELED:n.push(hi.CANCELED);break;case e.ScheduledStatus.FAILED:n.push(hi.FAILED)}})),n}},qd=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.userId,s=e.channelUrl,o=e.coverUrl,u=e.coverImage,c=e.isDistinct,l=e.isSuper,h=e.isBroadcast,d=e.isPublic,f=e.isExclusive,p=e.isDiscoverable,v=e.isStrict,m=e.isEphemeral,g=e.accessCode,y=e.name,k=e.data,E=e.customType,b=e.messageSurvivalSeconds,w=e.invitedUserIds,x=e.operatorUserIds;return(a=t.call(this)).method=R.POST,a.path=qr,a.params=Z({user_ids:[i].concat(_(null!=w?w:[])).filter((function(e,t,n){return t===n.indexOf(e)})),channel_url:s,cover_url:o,cover_file:u,is_distinct:c,is_super:l,is_broadcast:h,is_exclusive:f,is_public:d,is_discoverable:p,strict:v,is_ephemeral:m,access_code:g,name:y,data:k,custom_type:E,operator_ids:x,message_survival_seconds:b}),a}return a(r)}(J),jd=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).channel=new Mp(e,a),i.isCreated=a.is_created,i}return a(r)}($),zd=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.channelUrls;return n(this,r),(a=t.call(this)).method=R.PUT,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/mark_as_read_all"),a.params={channel_urls:s},a}return a(r)}(J),Vd=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"SYEV",i)).event=new ad(i),s}return a(r)}(ie),Bd=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.userId,o=e.accessCode;return(a=t.call(this)).method=R.PUT,a.path="".concat(qr,"/").concat(encodeURIComponent(i),"/join"),a.params={user_id:s,access_code:o},a}return a(r)}(J),Qd=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).channel=new Mp(e,a),i}return a(r)}($),Kd=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;n(this,r),s=t.call(this,e,a,i);var o=i.data,u=o.member_count,c=void 0===u?null:u,l=o.joined_member_count,h=void 0===l?null:l,d=o.users,f=void 0===d?null:d;return s.memberCount=c,s.joinedMemberCount=h,s.members=Array.isArray(f)?f.map((function(t){return new Jh(e,t)})):[new Jh(e,i.data)],s}return a(r)}(Vd),Wd=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.userId,o=e.shouldRemoveOperatorStatus;return(a=t.call(this)).method=R.PUT,a.path="".concat(qr,"/").concat(encodeURIComponent(i),"/leave"),a.params={user_id:s,should_remove_operator_status:o},a}return a(r)}(J),Yd=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;n(this,r),s=t.call(this,e,a,i);var o=i.data,u=o.member_count,c=void 0===u?null:u,l=o.joined_member_count,h=void 0===l?null:l;return s.memberCount=c,s.joinedMemberCount=h,s.member=new Jh(s._iid,i.data),s}return a(r)}(Vd),Zd=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.userIds;return(a=t.call(this)).method=R.POST,a.path="".concat(qr,"/").concat(encodeURIComponent(i),"/invite"),a.params={user_ids:s},a}return a(r)}(J),Xd=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).channel=new Mp(e,a),i}return a(r)}($),Jd=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;n(this,r),s=t.call(this,e,a,i);var o=i.data,u=o.member_count,c=void 0===u?null:u,l=o.joined_member_count,h=void 0===l?null:l,d=o.inviter,f=void 0===d?null:d,p=o.invitees,v=void 0===p?[]:p;return s.memberCount=c,s.joinedMemberCount=h,s.inviter=f?new Ua(e,f):null,s.invitees=v.map((function(t){return new Jh(e,t)})),s}return a(r)}(Vd),$d=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.userId;return(a=t.call(this)).method=R.PUT,a.path="".concat(qr,"/").concat(encodeURIComponent(i),"/decline"),a.params={user_id:s},a}return a(r)}(J),ef=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;n(this,r),s=t.call(this,e,a,i);var o=i.data,u=o.member_count,c=void 0===u?null:u,l=o.joined_member_count,h=void 0===l?null:l,d=o.inviter,f=void 0===d?null:d,p=o.invitee,v=void 0===p?null:p;return s.memberCount=c,s.joinedMemberCount=h,s.inviter=f?new Ua(e,f):null,s.invitee=v?new Jh(e,v):null,s}return a(r)}(Vd),tf=function(e){i(r,e);var t=f(r);function r(e){var a=e.channelUrl;return n(this,r),t.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:a}})}return a(r)}(Ir),nf=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"READ",i)).readStatus=new $h(e,i),s}return a(r)}(ie),rf=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelUrl,s=e.userId;return n(this,r),a=t.call(this),(a=t.call(this)).method=R.PUT,a.path="".concat(qr,"/").concat(encodeURIComponent(i),"/messages/mark_as_delivered"),a.params=Z({userId:s}),a}return a(r)}(J),af=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"DLVR",i)).channelUrl=i.channel_url,s.deliveredStateUpdate=i.updated,s}return a(r)}(ie),sf=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.userId,o=e.hidePreviousMessages,u=e.allowAutoUnhide;return(a=t.call(this)).method=R.PUT,a.path="".concat(qr,"/").concat(encodeURIComponent(i),"/hide"),a.params={user_id:s,hide_previous_messages:o,allow_auto_unhide:u},a}return a(r)}(J),of=function(e){i(r,e);var t=f(r);function r(e,a){var i;n(this,r),(i=t.call(this,e,a)).messageOffsetTimestamp=null;var s=a.ts_message_offset;return i.messageOffsetTimestamp=null!=s?s:null,i}return a(r)}($),uf=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"SYEV",i)).allowAutoUnhide=null,s.hidePreviousMessages=null,s.messageOffsetTimestamp=null,i.data&&(s.allowAutoUnhide=i.data.allow_auto_unhide,s.hidePreviousMessages=i.data.hide_previous_messages),s.messageOffsetTimestamp=i.ts_message_offset,s}return a(r)}(ie),cf=function(e){i(r,e);var t=f(r);function r(e){var a=e.channelUrl,i=e.time;return n(this,r),t.call(this,{code:"TPST",ackRequired:!1,payload:{channel_url:a,time:i}})}return a(r)}(Ir),lf=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"SYEV",i)).user=new Ua(e,i.data),s}return a(r)}(ie),hf=function(e){i(r,e);var t=f(r);function r(e){var a=e.channelUrl,i=e.time;return n(this,r),t.call(this,{code:"TPEN",ackRequired:!1,payload:{channel_url:a,time:i}})}return a(r)}(Ir),df=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"SYEV",i)).user=new Ua(e,i.data),s}return a(r)}(ie),ff=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;n(this,r),s=t.call(this,e,a,i);var o=i.data.operators,u=void 0===o?[]:o;return s.operators=u.map((function(e){return new Ua(s._iid,e)})),s}return a(r)}(Vd),pf=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"MCNT",i)).groupChannelMemberCounts=i.group_channels.map((function(e){return{channelUrl:e.channel_url,memberCount:e.member_count,joinedMemberCount:e.joined_member_count,updatedAt:e.ts}})),s.openChannelMemberCounts=i.open_channels.map((function(e){return{channelUrl:e.channel_url,participantCount:e.participant_count,updatedAt:e.ts}})),s}return a(r)}(ie),vf=function(e){i(r,e);var t=f(r);function r(e){var a=e.channelUrl,i=e.messageId;return n(this,r),t.call(this,{code:"MACK",ackRequired:!1,payload:{channel_url:a,msg_id:i}})}return a(r)}(Ir),mf=function(e){i(r,e);var t=f(r);function r(e,a,i){var s,o,u,c;n(this,r),(s=t.call(this,e,"ADMM",i)).message=new Ci(e,i);var l=Ya.of(e).sdkState;return s.isMentioned=Gi(s.message.mentionType,null!==(o=s.message.mentionedUserIds)&&void 0!==o?o:null===(u=s.message.mentionedUsers)||void 0===u?void 0:u.map((function(e){return e.userId})),l.userId),s.forceUpdateLastMessage=null!==(c=i.force_update_last_message)&&void 0!==c&&c,s}return a(r)}(ie),_f=function(e){i(r,e);var t=f(r);function r(e,a,i){var s,o,u,c,l,h,d;n(this,r),(s=t.call(this,e,"AEDI",i)).message=new Ci(e,i);var f=Ya.of(e).sdkState;return s.mentionCountChange=qi({mentionType:null!==(u=null===(o=i.old_values)||void 0===o?void 0:o.mention_type)&&void 0!==u?u:null,mentionedUserIds:null!==(l=null===(c=i.old_values)||void 0===c?void 0:c.mentioned_user_ids)&&void 0!==l?l:[]},{mentionType:s.message.mentionType,mentionedUserIds:null!==(h=s.message.mentionedUserIds)&&void 0!==h?h:null===(d=s.message.mentionedUsers)||void 0===d?void 0:d.map((function(e){return e.userId}))},f.userId),s}return a(r)}(ie),gf=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"MRCT",i)).channelUrl=i.channel_url,s.channelType=i.channel_type,s.event=new di(i),s}return a(r)}(ie),yf=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"MTHD",i)).event=new _s(e,i),s}return a(r)}(ie),kf=function(e){i(r,e);var t=f(r);function r(e,a,i){var s;return n(this,r),(s=t.call(this,e,"PEDI",i)).event=null,s.status=null,s.channelUrl=null,s.channelType=null,s.event=new Ws(e,i),s.status=Ni(i.poll.status)||i.poll.status,s.channelUrl=i.channel_url,s.channelType=i.channel_type,s}return a(r)}(ie),Ef=function(t){i(o,t);var r=f(o);function o(t,a){var i,s,u,c,l,h,d,f,p,v,m,_,g,y,k,E,b,w,x,R,C,T,S;return n(this,o),(i=r.call(this,t,a)).includeEmpty=!1,i.includeFrozen=!0,i.includeMetaData=!0,i.channelUrlsFilter=null,i.customTypesFilter=null,i.customTypeStartsWithFilter=null,i.nicknameContainsFilter=null,i.nicknameStartsWithFilter=null,i.nicknameExactMatchFilter=null,i.channelNameContainsFilter="",i.myMemberStateFilter=e.MyMemberStateFilter.ALL,i.unreadChannelFilter=e.UnreadChannelFilter.ALL,i.superChannelFilter=e.SuperChannelFilter.ALL,i.publicChannelFilter=e.PublicChannelFilter.ALL,i.hiddenChannelFilter=e.HiddenChannelFilter.UNHIDDEN,i.searchFilter={fields:[],query:null},i.userIdsFilter={userIds:[],includeMode:!0,queryType:e.QueryType.AND},i.metadataKey=null,i.metadataValues=null,i.metadataOrderKeyFilter=null,i.metadataValueStartsWith=null,i.order=e.GroupChannelListOrder.LATEST_LAST_MESSAGE,i.includeEmpty=null!==(s=a.includeEmpty)&&void 0!==s&&s,i.includeFrozen=null===(u=a.includeFrozen)||void 0===u||u,i.includeMetaData=null===(c=a.includeMetaData)||void 0===c||c,i.channelUrlsFilter=null!==(l=a.channelUrlsFilter)&&void 0!==l?l:null,i.customTypesFilter=null!==(h=a.customTypesFilter)&&void 0!==h?h:null,i.customTypeStartsWithFilter=null!==(d=a.customTypeStartsWithFilter)&&void 0!==d?d:"",i.nicknameContainsFilter=null!==(f=a.nicknameContainsFilter)&&void 0!==f?f:null,i.nicknameStartsWithFilter=null!==(p=a.nicknameStartsWithFilter)&&void 0!==p?p:null,i.nicknameExactMatchFilter=null!==(v=a.nicknameExactMatchFilter)&&void 0!==v?v:null,i.channelNameContainsFilter=null!==(m=a.channelNameContainsFilter)&&void 0!==m?m:"",i.myMemberStateFilter=null!==(_=a.myMemberStateFilter)&&void 0!==_?_:e.MyMemberStateFilter.ALL,i.unreadChannelFilter=null!==(g=a.unreadChannelFilter)&&void 0!==g?g:e.UnreadChannelFilter.ALL,i.superChannelFilter=null!==(y=a.superChannelFilter)&&void 0!==y?y:e.SuperChannelFilter.ALL,i.publicChannelFilter=null!==(k=a.publicChannelFilter)&&void 0!==k?k:e.PublicChannelFilter.ALL,i.hiddenChannelFilter=null!==(E=a.hiddenChannelFilter)&&void 0!==E?E:e.HiddenChannelFilter.UNHIDDEN,i.searchFilter=null!==(b=a.searchFilter)&&void 0!==b?b:{fields:[],query:null},i.userIdsFilter=null!==(w=a.userIdsFilter)&&void 0!==w?w:{userIds:[],includeMode:!0,queryType:e.QueryType.AND},i.metadataKey=null!==(x=a.metadataKey)&&void 0!==x?x:null,i.metadataValues=null!==(R=a.metadataValues)&&void 0!==R?R:null,i.metadataOrderKeyFilter=null!==(C=a.metadataOrderKeyFilter)&&void 0!==C?C:null,i.metadataValueStartsWith=null!==(T=a.metadataValueStartsWith)&&void 0!==T?T:null,i.order=null!==(S=a.order)&&void 0!==S?S:e.GroupChannelListOrder.LATEST_LAST_MESSAGE,i}return a(o,[{key:"_validate",value:function(){return v(s(o.prototype),"_validate",this).call(this)&&A("boolean",this.includeEmpty)&&A("boolean",this.includeFrozen)&&A("boolean",this.includeMetaData)&&A("string",this.channelNameContainsFilter)&&O("string",this.channelUrlsFilter,!0)&&O("string",this.customTypesFilter,!0)&&A("string",this.customTypeStartsWithFilter)&&A("string",this.nicknameContainsFilter,!0)&&A("string",this.nicknameStartsWithFilter,!0)&&A("string",this.nicknameExactMatchFilter,!0)&&M(e.MyMemberStateFilter,this.myMemberStateFilter)&&M(e.SuperChannelFilter,this.superChannelFilter)&&M(e.PublicChannelFilter,this.publicChannelFilter)&&M(e.UnreadChannelFilter,this.unreadChannelFilter)&&M(e.HiddenChannelFilter,this.hiddenChannelFilter)&&O(e.GroupChannelSearchField,this.searchFilter.fields)&&A("string",this.searchFilter.query,!0)&&O("string",this.userIdsFilter.userIds)&&A("boolean",this.userIdsFilter.includeMode)&&M(e.QueryType,this.userIdsFilter.queryType)&&M(e.GroupChannelListOrder,this.order)&&A("string",this.metadataOrderKeyFilter,!0)&&A("string",this.metadataKey,!0)&&O("string",this.metadataValues,!0)&&A("string",this.metadataValueStartsWith,!0)}},{key:"serialize",value:function(){return Ia(this)}},{key:"next",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,t=Rf.of(this._iid),e.next=7,t.getMyGroupChannels(this._token,this,this.limit);case 7:return n=e.sent,r=n.channels,a=n.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,e.abrupt("return",r);case 14:return e.abrupt("return",[]);case 17:throw T.queryInProgress;case 18:e.next=21;break;case 20:throw T.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),o}(ks),bf=function(){function e(t){var r=t.top,a=void 0===r?Number.MAX_SAFE_INTEGER:r,i=t.bottom,s=void 0===i?0:i;n(this,e),this.top=a,this.bottom=s}return a(e,[{key:"includes",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.every((function(t){return e.top<=t&&t<=e.bottom}))}},{key:"overlap",value:function(e){return this.includes(e.top)||this.includes(e.bottom)}},{key:"extends",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.top=Math.min.apply(Math,[this.top].concat(t)),this.bottom=Math.max.apply(Math,[this.bottom].concat(t))}}]),e}(),wf=function(e){i(r,e);var t=f(r);function r(e,a,i){var s,o;return n(this,r),(s=t.call(this,e,"SYEV",i)).pinnedMessageIds=[],s.latestPinnedMessage=null,s.ts=0,i.data&&(s.pinnedMessageIds=null!==(o=i.data.pinned_message_ids)&&void 0!==o?o:[],s.latestPinnedMessage=i.data.latest_pinned_message?Li(e,Object.assign({},i.data.latest_pinned_message)):null),s.ts=i.ts,s}return a(r)}(ie),xf={},Rf=function(){function t(r,a){var i=this,s=a.sdkState,o=a.cacheContext,u=a.dispatcher,c=a.sessionManager,l=a.requestQueue,h=a.logger,d=a.disableMack,f=void 0!==d&&d;return n(this,t),this._leftChannels=new Map,this._disableMack=!1,this._markAsReadAllLastSentAt=0,xf[r]||(this._iid=r,this._sdkState=s,this._sessionManager=c,this._requestQueue=l,this._dispatcher=u,this._logger=h,this._disableMack=f,this._groupChannelHandlers=new Map,this._groupChannelCache=new nd(this._iid,{sdkState:s,cacheContext:o}),this._unsentMessageCache=new jo(this._iid,{sdkState:s,cacheContext:o}),this._messageCache=new Bo(this._iid,{sdkState:s,cacheContext:o,unsentMessageCache:this._unsentMessageCache}),this._groupChannelBroadcast=new bd({groupChannelCache:this._groupChannelCache,messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:u}),this._messageBroadcast=new wd({cacheContext:o,messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:u,logger:h}),setInterval((function(){var t,n=k(i._groupChannelCache.channels);try{var r=function(){var n=t.value;n.invalidateTypingStatus()&&(i._dispatcher.dispatch(new kd({channels:[n],source:e.GroupChannelEventSource.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),i._groupChannelHandlers.forEach((function(e){e.onTypingStatusUpdated(n)})))};for(n.s();!(t=n.n()).done;)r()}catch(e){n.e(e)}finally{n.f()}}),1e3),this._dispatcher.on((function(e){e instanceof ie?i._handleEvent(e):e instanceof Wo&&E(i,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.message,t.next=3,this.getChannel(n.channelUrl,!0);case 3:r=t.sent,n instanceof Oi?r._autoResendUserMessage(n):n instanceof Pi&&r._autoResendFileMessage(n);case 5:case"end":return t.stop()}}),t,this)})))})),xf[r]=this),xf[r]}return a(t,[{key:"handlers",get:function(){return _(this._groupChannelHandlers.values())}},{key:"buildGroupChannelFromSerializedData",value:function(e){var t=Na(e);return new Mp(this._iid,Mp.payloadify(t))}},{key:"buildGroupChannelListQueryFromSerializedData",value:function(e){var t=Na(e);return new Ef(this._iid,t)}},{key:"buildMemberFromSerializedData",value:function(e){var t=Na(e);return new Jh(this._iid,Jh.payloadify(t))}},{key:"getChannelFromCache",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._groupChannelCache.get(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"getChannelsFromCache",value:function(e,t,n,r){return E(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this._groupChannelCache.fetch({token:e,filter:t,order:n,limit:r});case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),a,this)})))}},{key:"upsertChannelsToCache",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._groupChannelCache.upsert(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"removeChannelsFromCache",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._groupChannelCache.remove(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"clearChannelsFromCache",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._groupChannelCache.clear();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"_handleEvent",value:function(t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c,l,h,d,f,p,v,m,_,g,y,b,w,x,R,T,S,I,N,A,M,U,O,D,L,P,F,H,G,q,j,z,V,B,Q,K,W,Y,Z,X,J,$,ee,te,ne,re,ae,ie,se,oe,ue,ce,le,he,de,fe,pe,ve,me,_e,ge,ye,ke,Ee,be,we,xe,Re,Ce,Te,Se,Ie,Ne,Ae,Me,Ue,Oe,De,Le,Pe,Fe,He,Ge,qe,je,ze,Ve,Be,Qe,Ke,We,Ye,Ze,Xe,Je,$e,et,tt,nt,rt,at,it,st,ot,ut,ct,lt,ht,dt,ft,pt,vt,mt,_t,gt,yt,kt,Et,bt,wt,xt,Rt,Ct,Tt,St,It,Nt,At,Mt,Ut,Ot,Dt,Lt,Pt,Ft,Ht,Gt,qt,jt,zt,Vt,Bt,Qt,Kt,Wt,Yt,Zt,Xt,Jt,$t,en,tn,nn,rn,an,sn,on,un=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:n.prev=0,n.t0=t.code,n.next="MESG"===n.t0||"FILE"===n.t0||"ADMM"===n.t0||"BRDM"===n.t0?4:"MEDI"===n.t0||"FEDI"===n.t0||"AEDI"===n.t0?45:"DELM"===n.t0?64:"READ"===n.t0?72:"DLVR"===n.t0?81:"MRCT"===n.t0?89:"MTHD"===n.t0?100:"MCNT"===n.t0?111:"PEDI"===n.t0?135:"VOTE"===n.t0?144:"SYEV"===n.t0?153:"USEV"===n.t0?326:337;break;case 4:if(r=null,"MESG"===t.code?r=t.as(lh):"FILE"===t.code?r=t.as(Vi):"ADMM"!==t.code&&"BRDM"!=t.code||(r=t.as(mf)),!r){n.next=44;break}if(i=(a=r).message,s=a.isMentioned,o=a.forceUpdateLastMessage,i.channelType!==e.ChannelType.GROUP){n.next=44;break}return this._disableMack||oa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new vf(i),this._requestQueue.send(t);case 2:case"end":return e.stop()}}),e,this)})))})),u=this._groupChannelCache.isCachedInMemory(i.channelUrl),c=i instanceof bi&&i.sender.userId===this._sdkState.userId,n.next=14,this.getChannel(i.channelUrl,!0);case 14:if((l=n.sent).hiddenState===e.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE&&(l.hiddenState=e.HiddenState.UNHIDDEN),!(i instanceof bi)){n.next=38;break}h=Ya.of(this._iid),d=h.useMemberInfoInMessage,f=k(l.members),n.prev=19,f.s();case 21:if((p=f.n()).done){n.next=28;break}if((v=p.value).userId!==i.sender.userId){n.next=26;break}return d||(i.sender.nickname=v.nickname,i.sender.plainProfileUrl=v.plainProfileUrl,i.sender.metaData=v.metaData,i.sender.isBlockedByMe=v.isBlockedByMe),n.abrupt("break",28);case 26:n.next=21;break;case 28:n.next=33;break;case 30:n.prev=30,n.t1=n.catch(19),f.e(n.t1);case 33:return n.prev=33,f.f(),n.finish(33);case 36:!d&&s&&i.mentionedUsers.forEach((function(e){var t,n=k(l.members);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(e.userId===r.userId){e.nickname=r.nickname,e.plainProfileUrl=r.plainProfileUrl,e.metaData=r.metaData;break}}}catch(e){n.e(e)}finally{n.f()}})),c&&(m=this._sessionManager.currentUser)&&(m.nickname=i.sender.nickname,m.plainProfileUrl=i.sender.plainProfileUrl,m.metaData=i.sender.metaData);case 38:i.silent&&!c||(l.isEphemeral||u)&&((!l.lastMessage||l.lastMessage.createdAt<i.createdAt)&&(l.lastMessage=i),c||l._updateUnreadCount(l.unreadMessageCount+1,l.unreadMentionCount+(s?1:0))),o&&(!l.lastMessage||l.lastMessage.createdAt<i.createdAt)&&(l.lastMessage=i),this._dispatcher.dispatch(new kd({channels:[l],source:e.GroupChannelEventSource.EVENT_MESSAGE_RECEIVED})),i.silent&&!c||sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._groupChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onChannelChanged(l)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))})),this._dispatcher.dispatch(new es({messages:[i],source:e.MessageEventSource.EVENT_MESSAGE_RECEIVED})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._groupChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)(r=n.value).onMessageReceived(l,i),s&&r.onMentionReceived(l,i)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 44:return n.abrupt("break",337);case 45:if(_=null,"MEDI"===t.code?_=t.as(dh):"FEDI"===t.code?_=t.as(ph):"AEDI"===t.code&&(_=t.as(_f)),!_){n.next=63;break}if(y=(g=_).message,b=g.mentionCountChange,y.channelType!==e.ChannelType.GROUP){n.next=63;break}return w=this._groupChannelCache.isCachedInMemory(y.channelUrl),n.next=53,this.getChannel(y.channelUrl,!0);case 53:x=n.sent,R=y instanceof bi&&y.sender.userId===this._sdkState.userId,T=!1,R?(S=this._sessionManager.currentUser)&&(S.nickname=y.sender.nickname,S.plainProfileUrl=y.sender.plainProfileUrl,S.metaData=y.sender.metaData):x.isReadMessage(y)||0!==b&&!y.silent&&w&&(x._updateUnreadCount(x.unreadMessageCount,x.unreadMentionCount+b),T=!0),!x.lastMessage||x.lastMessage.createdAt<y.createdAt?(x.lastMessage=y,T=!0):x.lastMessage.isIdentical(y)&&(w?x.lastMessage.updatedAt<y.updatedAt&&(x.lastMessage=y,T=!0):T=!0),I=!1,x.lastPinnedMessage&&x.lastPinnedMessage.messageId===y.messageId&&(x.lastPinnedMessage=y,T=!0,I=!0),T&&(this._dispatcher.dispatch(new kd({channels:[x],source:I?e.GroupChannelEventSource.EVENT_PINNED_MESSAGE_UPDATED:e.GroupChannelEventSource.EVENT_MESSAGE_UPDATED})),y.silent&&!R||sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._groupChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onChannelChanged(x)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))})),I&&sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._groupChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onPinnedMessageUpdated(x)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}))),this._dispatcher.dispatch(new es({messages:[y],source:e.MessageEventSource.EVENT_MESSAGE_UPDATED})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._groupChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)(r=n.value).onMessageUpdated(x,y),0!==b&&r.onMentionReceived(x,y)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 63:return n.abrupt("break",337);case 64:if(N=t.as(mh),A=N.channelUrl,M=N.channelType,U=N.messageId,M!==e.ChannelType.GROUP){n.next=71;break}return n.next=68,this.getChannel(A,!0);case 68:O=n.sent,this._dispatcher.dispatch(new ts({messageIds:[U],source:e.MessageEventSource.EVENT_MESSAGE_DELETED})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._groupChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onMessageDeleted(O,U)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 71:return n.abrupt("break",337);case 72:if(D=t.as(nf),(L=D.readStatus).channelType!==e.ChannelType.GROUP){n.next=80;break}return P=this._groupChannelCache.isCachedInMemory(L.channelUrl),n.next=77,this.getChannel(L.channelUrl,!0);case 77:F=n.sent,P&&F._updateUnreadMemberState(L.reader.userId,L.readAt),L.reader.userId===this._sdkState.userId?P?(F.unreadMessageCount>0||F.unreadMentionCount>0)&&(F._updateUnreadCount(0,0),this._dispatcher.dispatch(new kd({channels:[F],source:e.GroupChannelEventSource.EVENT_CHANNEL_READ})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._groupChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onChannelChanged(F)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}))):0!==F.unreadMessageCount&&0!==F.unreadMentionCount||(this._dispatcher.dispatch(new kd({channels:[F],source:e.GroupChannelEventSource.EVENT_CHANNEL_READ})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._groupChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onChannelChanged(F)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}))):(this._dispatcher.dispatch(new kd({channels:[F],source:e.GroupChannelEventSource.EVENT_CHANNEL_READ})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._groupChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onUnreadMemberStatusUpdated(F)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))})));case 80:return n.abrupt("break",337);case 81:return H=t.as(af),G=H.channelUrl,q=H.deliveredStateUpdate,j=void 0===q?{}:q,z=this._groupChannelCache.isCachedInMemory(G),n.next=85,this.getChannel(G,!0);case 85:if(V=n.sent,z)for(B in j)V._updateUndeliveredMemberState(B,j[B]);return Object.keys(j).some((function(e){return e!==un._sdkState.userId}))&&(this._dispatcher.dispatch(new kd({channels:[V],source:e.GroupChannelEventSource.EVENT_CHANNEL_DELIVERED})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._groupChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onUndeliveredMemberStatusUpdated(V)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}))),n.abrupt("break",337);case 89:if(Q=t.as(gf),K=Q.channelUrl,W=Q.channelType,Y=Q.event,W!==e.ChannelType.GROUP){n.next=99;break}return n.next=93,this.getChannel(K,!0);case 93:return Z=n.sent,n.next=96,this.getMessageFromCache(Y.messageId);case 96:(X=n.sent)&&(X.applyReactionEvent(Y),this._dispatcher.dispatch(new es({messages:[X],source:e.MessageEventSource.EVENT_MESSAGE_REACTION_UPDATED}))),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._groupChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onReactionUpdated(Z,Y)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 99:return n.abrupt("break",337);case 100:if(J=t.as(yf),($=J.event).channelType!==e.ChannelType.GROUP){n.next=110;break}return n.next=104,this.getChannel($.channelUrl,!0);case 104:return ee=n.sent,n.next=107,this.getMessageFromCache($.targetMessageId);case 107:(te=n.sent)&&(te.applyThreadInfoUpdateEvent($),this._dispatcher.dispatch(new es({messages:[te],source:e.MessageEventSource.EVENT_MESSAGE_THREADINFO_UPDATED}))),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._groupChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onThreadInfoUpdated(ee,$)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 110:return n.abrupt("break",337);case 111:ne=t.as(pf),re=ne.groupChannelMemberCounts,ae=[],ie=k(re),n.prev=114,ie.s();case 116:if((se=ie.n()).done){n.next=125;break}return oe=se.value,ue=oe.channelUrl,ce=oe.memberCount,le=oe.joinedMemberCount,he=oe.updatedAt,n.next=121,this.getChannelFromCache(ue);case 121:(de=n.sent)&&de._setLatestMemberCount(ce,le,he)&&ae.push(de);case 123:n.next=116;break;case 125:n.next=130;break;case 127:n.prev=127,n.t2=n.catch(114),ie.e(n.t2);case 130:return n.prev=130,ie.f(),n.finish(130);case 133:return ae.length>0&&(this._dispatcher.dispatch(new kd({channels:ae,source:e.GroupChannelEventSource.EVENT_CHANNEL_MEMBER_COUNT_UPDATED})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._groupChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onChannelMemberCountChanged(ae)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}))),n.abrupt("break",337);case 135:if(fe=t.as(kf),pe=fe.event,ve=fe.status,me=fe.channelUrl,_e=fe.channelType,me&&_e){n.next=138;break}return n.abrupt("break",337);case 138:return n.next=140,this.getChannel(me,!0);case 140:return ge=n.sent,this._dispatcher.dispatch(new as({event:pe,source:e.MessageEventSource.EVENT_POLL_UPDATED})),sa(ve===Ii?function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._groupChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onPollDeleted(ge,pe.pollId)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}:function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._groupChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onPollUpdated(ge,pe)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}),n.abrupt("break",337);case 144:if(ye=t.as(Hh),ke=ye.event,Ee=ye.channelUrl,be=ye.channelType,Ee&&be){n.next=147;break}return n.abrupt("break",337);case 147:return n.next=149,this.getChannel(Ee,!0);case 149:return we=n.sent,this._dispatcher.dispatch(new is({event:ke,source:e.MessageEventSource.EVENT_POLL_VOTED})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._groupChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onPollVoted(we,ke)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",337);case 153:if(xe=t.as(Vd),!(Re=xe.event).isGroupChannelEvent){n.next=325;break}n.t3=Re.category,n.next=n.t3===ed.CHANNEL_JOIN?158:n.t3===ed.CHANNEL_LEAVE?167:n.t3===ed.CHANNEL_OPERATOR_UPDATE?183:n.t3===ed.CHANNEL_INVITE?194:n.t3===ed.CHANNEL_DECLINE_INVITE?204:n.t3===ed.TYPING_START||n.t3===ed.TYPING_END?212:n.t3===ed.USER_CHANNEL_MUTE||n.t3===ed.USER_CHANNEL_UNMUTE?221:n.t3===ed.USER_CHANNEL_BAN?248:n.t3===ed.USER_CHANNEL_UNBAN?261:n.t3===ed.CHANNEL_FREEZE||n.t3===ed.CHANNEL_UNFREEZE?267:n.t3===ed.CHANNEL_HIDE?275:n.t3===ed.CHANNEL_UNHIDE?285:n.t3===ed.CHANNEL_DELETED?292:n.t3===ed.CHANNEL_PROP_CHANGED?298:n.t3===ed.CHANNEL_META_DATA_CHANGED?304:n.t3===ed.CHANNEL_META_COUNTERS_CHANGED?313:n.t3===ed.PINNED_MESSAGE_CHANGED?319:325;break;case 158:return n.next=160,this.getChannel(Re.channelUrl,!0);case 160:return Ce=n.sent,Te=t.as(Kd),Se=Te.memberCount,Ie=Te.joinedMemberCount,Ne=Te.members,Ae=!1,Ne.forEach((function(t){Ce.isExclusive||Ce.isSuper||Ce.isBroadcast?Ae=Ae||Ce._setLatestMemberCount(Se,Ie,Re.ts):(t.state=e.MemberState.JOINED,Ce.addMember(t,Re.ts),un._updateJoinedMemberCount(Ce)),t.userId===un._sdkState.userId&&(Ce.myMemberState=e.MemberState.JOINED)})),this._dispatcher.dispatch(new kd({channels:[Ce],source:e.GroupChannelEventSource.EVENT_CHANNEL_JOINED})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){var t,n=k(Ne);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.onUserJoined(Ce,r)}}catch(e){n.e(e)}finally{n.f()}Ce.isBroadcast&&Ae&&e.onChannelMemberCountChanged([Ce])}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",325);case 167:if(!(Me=this._leftChannels.get(Re.channelUrl))){n.next=172;break}n.t4=Me.channel,n.next=175;break;case 172:return n.next=174,this.getChannel(Re.channelUrl,!0);case 174:n.t4=n.sent;case 175:return Ue=n.t4,Oe=t.as(Yd),De=Oe.memberCount,Le=Oe.joinedMemberCount,Pe=Oe.member,Fe=!1,He=Ya.of(this._iid),Ge=He.appInfo,Ue.isExclusive||Ue.isSuper||Ue.isBroadcast?Fe=Ue._setLatestMemberCount(De,Le,Re.ts):(Ge.enabledChannelMemberShipHistory?(Ue.members.find((function(e){return e.userId===Pe.userId})).state=e.MemberState.LEFT,Ue.memberCount=De):Ue.removeMember(Pe),this._updateJoinedMemberCount(Ue)),Pe.userId===this._sdkState.userId?(Ue.myMemberState=e.MemberState.NONE,Ue.invitedAt=0,Ue.joinedAt=0,Ue._updateUnreadCount(0,0),Ue.isPublic?this._dispatcher.dispatch(new kd({channels:[Ue],source:e.GroupChannelEventSource.EVENT_CHANNEL_LEFT})):(this._markAsLeave(Ue),this._dispatcher.dispatch(new Ed({channelUrls:[Ue.url],source:e.GroupChannelEventSource.EVENT_CHANNEL_LEFT})))):this._dispatcher.dispatch(new kd({channels:[Ue],source:e.GroupChannelEventSource.EVENT_CHANNEL_LEFT})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onUserLeft(Ue,Pe),Ue.isBroadcast&&Fe&&e.onChannelMemberCountChanged([Ue])}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",325);case 183:return n.next=185,this.getChannel(Re.channelUrl,!0);case 185:qe=n.sent,je=t.as(ff),ze=je.operators,Ve=ze.map((function(e){return e.userId})),Be=k(qe.members);try{for(Be.s();!(Qe=Be.n()).done;)(Ke=Qe.value).role=Ve.includes(Ke.userId)?e.Role.OPERATOR:e.Role.NONE}catch(e){Be.e(e)}finally{Be.f()}return qe.myRole=Ve.includes(this._sdkState.userId)?e.Role.OPERATOR:e.Role.NONE,this._dispatcher.dispatch(new kd({channels:[qe],source:e.GroupChannelEventSource.EVENT_CHANNEL_OPERATOR_UPDATED})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onOperatorUpdated(qe,ze)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",325);case 194:return n.next=196,this.getChannel(Re.channelUrl,!0);case 196:We=n.sent,Ye=t.as(Jd),Ze=Ye.memberCount,Xe=Ye.joinedMemberCount,Je=Ye.inviter,($e=Ye.invitees).forEach((function(t){return t.state=e.MemberState.INVITED})),et=k($e);try{for(et.s();!(tt=et.n()).done;)nt=tt.value,We.isExclusive||We.isSuper||We.isBroadcast?We._setLatestMemberCount(Ze,Xe,Re.ts):We.addMember(nt,Re.ts),this._sdkState.userId===nt.userId&&(We.hiddenState=e.HiddenState.UNHIDDEN,We.myMemberState!==e.MemberState.JOINED&&(We.myMemberState=e.MemberState.INVITED),We.invitedAt=Re.ts)}catch(e){et.e(e)}finally{et.f()}return this._dispatcher.dispatch(new kd({channels:[We],source:e.GroupChannelEventSource.EVENT_CHANNEL_INVITED})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onUserReceivedInvitation(We,Je,$e)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",325);case 204:return n.next=206,this.getChannel(Re.channelUrl,!0);case 206:return rt=n.sent,at=t.as(ef),it=at.memberCount,st=at.joinedMemberCount,ot=at.inviter,ut=at.invitee,rt.isExclusive||rt.isSuper||rt.isBroadcast?rt._setLatestMemberCount(it,st,Re.ts):rt.removeMember(ut),this._sdkState.userId===ut.userId?(rt.invitedAt=0,rt.myMemberState=e.MemberState.NONE,rt.isPublic?this._dispatcher.dispatch(new kd({channels:[rt],source:e.GroupChannelEventSource.EVENT_CHANNEL_DECLINED_INVITE})):this._dispatcher.dispatch(new Ed({channelUrls:[rt.url],source:e.GroupChannelEventSource.EVENT_CHANNEL_DECLINED_INVITE}))):this._dispatcher.dispatch(new kd({channels:[rt],source:e.GroupChannelEventSource.EVENT_CHANNEL_DECLINED_INVITE})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onUserDeclinedInvitation(rt,ot,ut)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",325);case 212:return n.next=214,this.getChannel(Re.channelUrl,!0);case 214:return ct=n.sent,lt=Re.category===ed.TYPING_START,ht=t.as(lt?lf:df),dt=ht.user,ct._updateTypingStatus(dt,lt?Re.ts:0),this._dispatcher.dispatch(new kd({channels:[ct],source:e.GroupChannelEventSource.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onTypingStatusUpdated(ct)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",325);case 221:return n.next=223,this.getChannel(Re.channelUrl,!0);case 223:ft=n.sent,pt=Re.category===ed.USER_CHANNEL_MUTE,vt=t.as(pt?Xl:$l),(mt=vt.user).userId===this._sdkState.userId&&(ft.myMutedState=pt?e.MutedState.MUTED:e.MutedState.UNMUTED),_t=k(ft.members),n.prev=228,_t.s();case 230:if((gt=_t.n()).done){n.next=237;break}if((yt=gt.value).userId!==mt.userId){n.next=235;break}return yt.isMuted=pt,n.abrupt("break",237);case 235:n.next=230;break;case 237:n.next=242;break;case 239:n.prev=239,n.t5=n.catch(228),_t.e(n.t5);case 242:return n.prev=242,_t.f(),n.finish(242);case 245:return this._dispatcher.dispatch(new kd({channels:[ft],source:pt?e.GroupChannelEventSource.EVENT_CHANNEL_MUTED:e.GroupChannelEventSource.EVENT_CHANNEL_UNMUTED})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){pt?e.onUserMuted(ft,mt):e.onUserUnmuted(ft,mt)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",325);case 248:if(!(kt=this._leftChannels.get(Re.channelUrl))){n.next=253;break}n.t6=kt.channel,n.next=256;break;case 253:return n.next=255,this.getChannel(Re.channelUrl,!0);case 255:n.t6=n.sent;case 256:return Et=n.t6,this._markAsLeave(Et),bt=t.as(th),wt=bt.user,sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onUserBanned(Et,wt)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",325);case 261:return n.next=263,this.getChannel(Re.channelUrl,!0);case 263:return xt=n.sent,Rt=t.as(rh),Ct=Rt.user,sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onUserUnbanned(xt,Ct)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",325);case 267:return n.next=269,this.getChannel(Re.channelUrl,!0);case 269:return Tt=n.sent,St=t.as(ih),It=St.freeze,Tt.isFrozen=It,this._dispatcher.dispatch(new kd({channels:[Tt],source:It?e.GroupChannelEventSource.EVENT_CHANNEL_FROZEN:e.GroupChannelEventSource.EVENT_CHANNEL_UNFROZEN})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){It?e.onChannelFrozen(Tt):e.onChannelUnfrozen(Tt)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",325);case 275:return n.next=277,this.getChannel(Re.channelUrl,!0);case 277:return Nt=n.sent,At=t.as(uf),Mt=At.allowAutoUnhide,Ut=At.hidePreviousMessages,Ot=At.messageOffsetTimestamp,null!==Mt&&(Nt.hiddenState=Mt?e.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE:e.HiddenState.HIDDEN_PREVENT_AUTO_UNHIDE),null!==Ut&&Ut&&Nt._updateUnreadCount(0,0),null!==Ot&&(Nt.messageOffsetTimestamp=Ot),this._dispatcher.dispatch(new kd({channels:[Nt],source:e.GroupChannelEventSource.EVENT_CHANNEL_HIDDEN})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onChannelHidden(Nt)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",325);case 285:return n.next=287,this.getChannel(Re.channelUrl,!0);case 287:return(Dt=n.sent).hiddenState=e.HiddenState.UNHIDDEN,this._dispatcher.dispatch(new kd({channels:[Dt],source:e.GroupChannelEventSource.EVENT_CHANNEL_UNHIDDEN})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onChannelChanged(Dt)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",325);case 292:return n.next=294,this.getChannel(Re.channelUrl,!0);case 294:return Lt=n.sent,this._dispatcher.dispatch(new Ed({channelUrls:[Re.channelUrl],source:e.GroupChannelEventSource.EVENT_CHANNEL_DELETED})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onChannelDeleted(Lt.url,Lt.channelType)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",325);case 298:return n.next=300,this.getChannelWithoutCache(Re.channelUrl,!0);case 300:return Pt=n.sent,this._dispatcher.dispatch(new kd({channels:[Pt],source:e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onChannelChanged(Pt)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",325);case 304:return n.next=306,this.getChannel(Re.channelUrl,!0);case 306:return Ft=n.sent,Ht=t.as(Ll),Gt=Ht.created,qt=Ht.updated,jt=Ht.deleted,Gt&&Ft._upsertCachedMetaData(Gt,Re.ts),qt&&Ft._upsertCachedMetaData(qt,Re.ts),jt&&Ft._removeFromCachedMetaData(jt,Re.ts),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){Gt&&e.onMetaDataCreated(Ft,Gt),qt&&e.onMetaDataUpdated(Ft,qt),jt&&e.onMetaDataDeleted(Ft,jt)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",325);case 313:return n.next=315,this.getChannel(Re.channelUrl,!0);case 315:return zt=n.sent,Vt=t.as(Kl),Bt=Vt.created,Qt=Vt.updated,Kt=Vt.deleted,sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){Bt&&e.onMetaCounterCreated(zt,Bt),Qt&&e.onMetaCounterUpdated(zt,Qt),Kt&&e.onMetaCounterDeleted(zt,Kt)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",325);case 319:return n.next=321,this.getChannel(Re.channelUrl,!0);case 321:return Wt=n.sent,Yt=t.as(wf),Zt=Yt.pinnedMessageIds,Xt=Yt.latestPinnedMessage,(Jt=Yt.ts)>Wt._pinnedMessagesUpdatedAt&&(Wt.pinnedMessageIds=Zt,Wt.lastPinnedMessage=Xt,Wt._pinnedMessagesUpdatedAt=Jt,this._dispatcher.dispatch(new kd({channels:[Wt],source:e.GroupChannelEventSource.EVENT_PINNED_MESSAGE_UPDATED})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._groupChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onChannelChanged(Wt)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))})),sa((function(){return E(un,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onPinnedMessageUpdated(Wt)}));case 1:case"end":return e.stop()}}),e,this)})))}))),n.abrupt("break",325);case 325:return n.abrupt("break",337);case 326:$t=t.as(eu),en=$t.event,n.t7=en.category,n.next=n.t7===Do.USER_BLOCK?330:n.t7===Do.USER_UNBLOCK?333:336;break;case 330:return tn=Jo.getDataAsUserBlockEvent(this._iid,en),nn=tn.blocker,rn=tn.blockee,this._groupChannelCache.block(nn.userId,rn.userId),n.abrupt("break",336);case 333:return an=Jo.getDataAsUserBlockEvent(this._iid,en),sn=an.blocker,on=an.blockee,this._groupChannelCache.unblock(sn.userId,on.userId),n.abrupt("break",336);case 336:return n.abrupt("break",337);case 337:n.next=343;break;case 339:if(n.prev=339,n.t8=n.catch(0),!C(n.t8)){n.next=343;break}throw n.t8;case 343:case"end":return n.stop()}}),n,this,[[0,339],[19,30,33,36],[114,127,130,133],[228,239,242,245]])})))}},{key:"_markAsLeave",value:function(e){var t,n=this,r=null!==(t=this._leftChannels.get(e.url))&&void 0!==t?t:{channel:e,ref:0};r.ref++,this._leftChannels.set(e.url,r),setTimeout((function(){r.ref--,0===r.ref&&n._leftChannels.delete(e.url)}),1e4)}},{key:"addHandler",value:function(e,t){this._groupChannelHandlers.set(e,t)}},{key:"removeHandler",value:function(e){this._groupChannelHandlers.delete(e)}},{key:"clearHandler",value:function(){this._groupChannelHandlers.clear()}},{key:"subscribeGroupChannelEvent",value:function(e,t){this._groupChannelBroadcast.subscribe(e,t)}},{key:"unsubscribeGroupChannelEvent",value:function(e){this._groupChannelBroadcast.unsubscribe(e)}},{key:"subscribeMessageEvent",value:function(e,t){this._messageBroadcast.subscribe(e,t)}},{key:"unsubscribeMessageEvent",value:function(e){this._messageBroadcast.unsubscribe(e)}},{key:"_updateJoinedMemberCount",value:function(t){t.joinedMemberCount=t.members.filter((function(t){return t.state===e.MemberState.JOINED})).length}},{key:"getChannel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Aa(A("string",e)).throw(T.invalidParameters),n.prev=1,n.next=4,this.getChannelFromCache(e);case 4:if(!(r=n.sent)){n.next=7;break}return n.abrupt("return",r);case 7:n.next=11;break;case 9:n.prev=9,n.t0=n.catch(1);case 11:return n.next=13,this.getChannelWithoutCache(e,t);case 13:return n.abrupt("return",n.sent);case 14:case"end":return n.stop()}}),n,this,[[1,9]])})))}},{key:"getChannelWithoutCache",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){var a,i,s,o,u,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Aa(A("string",t)).throw(T.invalidParameters),a=new Cd({channelUrl:t,isInternalCall:n}),r.next=4,this._requestQueue.send(a);case 4:i=r.sent,s=i.as(Td),o=s.channel,u=o.unreadMessageCount,c=o.unreadMentionCount,r.t0=o.myCountPreference,r.next=r.t0===e.CountPreference.UNREAD_MESSAGE_COUNT_ONLY?10:r.t0===e.CountPreference.UNREAD_MENTION_COUNT_ONLY?12:r.t0===e.CountPreference.OFF?14:17;break;case 10:return c=0,r.abrupt("break",17);case 12:return u=0,r.abrupt("break",17);case 14:return u=0,c=0,r.abrupt("break",17);case 17:return o._updateUnreadCount(u,c),r.next=20,this.upsertChannelsToCache([o]);case 20:return r.abrupt("return",o);case 21:case"end":return r.stop()}}),r,this)})))}},{key:"refreshChannel",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.GroupChannelEventSource.REFRESH_CHANNEL;return E(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i,s,o,u;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,i=new Cd({channelUrl:t,isInternalCall:n}),a.next=4,this._requestQueue.send(i);case 4:s=a.sent,o=s.as(Td),(u=o.channel).myMemberState===e.MemberState.NONE?this._dispatcher.dispatch(new Ed({channelUrls:[u.url],source:r})):this._dispatcher.dispatch(new kd({channels:[u],source:r})),a.next=12;break;case 9:a.prev=9,a.t0=a.catch(0),a.t0.code!==b.NON_AUTHORIZED&&a.t0.code!==b.NOT_FOUND_IN_DATABASE||this._dispatcher.dispatch(new Ed({channelUrls:[t],source:r}));case 12:case"end":return a.stop()}}),a,this,[[0,9]])})))}},{key:"getMyGroupChannels",value:function(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.GroupChannelEventSource.REQUEST_CHANNEL;return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,s,o,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Sd(Object.assign(Object.assign({},n),{userId:this._sdkState.userId,token:t,limit:r})),e.next=3,this._requestQueue.send(i);case 3:return s=e.sent,o=s.as(Id),u=o.channels,c=o.token,this._dispatcher.dispatch(new kd({channels:u,source:a})),e.abrupt("return",{channels:u,token:c});case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getMessageFromCache",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._messageCache.get(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"getMessagesFromCache",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:co;return E(this,void 0,void 0,regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this._messageCache.fetch({channelUrl:e,token:t,limit:a,filter:r,backward:"next"===n});case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}}),i,this)})))}},{key:"getPollMessagesFromCache",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:co;return E(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this._messageCache.fetch({channelUrl:e,token:t,limit:r,filter:n,backward:!1,isPollOnly:!0});case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),a,this)})))}},{key:"getUnsentMessagesFromCache",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this._unsentMessageCache.fetch({channelUrl:e,filter:t});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"removeFailedMessageFromCache",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._unsentMessageCache.remove([e]);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"getCachedMessageCountBetween",value:function(e,t,n,r){return E(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this._messageCache.countBetween(e,t,new bf({top:n,bottom:r}));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),a,this)})))}},{key:"getMyGroupChannelChangeLogs",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.GroupChannelEventSource.REQUEST_CHANNEL_CHANGELOGS;return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var a,i,s,o,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object.assign(Object.assign({},od),n),Aa((A("string",t)||A("number",t))&&ud(a)).throw(T.invalidParameters),i=new xd(Z({userId:this._sdkState.userId,ts:"number"==typeof t?t:null,token:"string"==typeof t?t:null,filter:a})),e.next=5,this._requestQueue.send(i);case 5:return s=e.sent,o=s.as(Rd),u=o.updatedChannels,c=o.deletedChannelUrls,u.length>0&&this._dispatcher.dispatch(new kd({channels:u,source:r})),c.length>0&&this._dispatcher.dispatch(new Ed({channelUrls:c,source:r})),e.abrupt("return",o);case 11:case"end":return e.stop()}}),e,this)})))}},{key:"getGroupChannelCount",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object.assign(Object.assign({},cd),e),Aa(ld(n)).throw(T.invalidParameters),r=new Nd({userId:this._sdkState.userId,filter:n}),t.next=5,this._requestQueue.send(r);case 5:return a=t.sent,i=a.as(Ad),s=i.groupChannelCount,t.abrupt("return",s);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"getUnreadItemCount",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object.assign(Object.assign({},dd),e),Aa(fd(n)).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new Md({userId:a.userId,filter:n}),t.next=6,i.send(s);case 6:return o=t.sent,t.abrupt("return",o.as(Ud));case 8:case"end":return t.stop()}}),t,this)})))}},{key:"getTotalUnreadChannelCount",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.sdkState,r=t.requestQueue,a=new Od({userId:n.userId}),e.next=4,r.send(a);case 4:return i=e.sent,s=i.as(Dd),o=s.unreadCount,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getTotalUnreadMessageCount",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object.assign(Object.assign({},pd),e),Aa(vd(n)).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new Ld({userId:a.userId,filter:n}),t.next=6,i.send(s);case 6:return o=t.sent,u=o.as(Pd),c=u.unreadCount,t.abrupt("return",c);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"getTotalScheduledMessageCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object.assign(Object.assign({},md),e),Aa(_d(n)).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.requestQueue,i=new Fd(n),t.next=6,a.send(i);case 6:return s=t.sent,o=s.as(Hd),u=o.count,t.abrupt("return",u);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"getSubscribedTotalUnreadMessageCount",value:function(){var e=Ya.of(this._iid).subscribedUnreadMessageCount;return e.all>=0?e.all:0}},{key:"getSubscribedCustomTypeTotalUnreadMessageCount",value:function(){var e=0,t=Ya.of(this._iid).subscribedUnreadMessageCount;for(var n in t.customTypes)e+=t.customTypes[n];return e}},{key:"getSubscribedCustomTypeUnreadMessageCount",value:function(e){var t;return null!==(t=Ya.of(this._iid).subscribedUnreadMessageCount.customTypes[e])&&void 0!==t?t:0}},{key:"createChannel",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object.assign(Object.assign({},id),e),Aa(sd(n)).throw(T.invalidParameters),n.isPublic||(n.accessCode=null),r=new qd(Object.assign({userId:this._sdkState.userId},n)),t.next=6,this._requestQueue.send(r);case 6:return a=t.sent,i=a.as(jd),s=i.channel,t.next=10,this.upsertChannelsToCache([s]);case 10:return t.abrupt("return",s);case 11:case"end":return t.stop()}}),t,this)})))}},{key:"markAsReadAll",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Date.now(),Aa(t-this._markAsReadAllLastSentAt>=1e3).throw(T.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=t,n=new zd({userId:this._sdkState.userId}),e.next=6,this._requestQueue.send(n);case 6:r=this._groupChannelCache.channels,a=k(r);try{for(a.s();!(i=a.n()).done;)(s=i.value)._updateUnreadMemberState(this._sdkState.userId,t),s._updateUnreadCount(0,0)}catch(e){a.e(e)}finally{a.f()}if(!(r.length>0)){e.next=12;break}return e.next=12,this.upsertChannelsToCache(r);case 12:case"end":return e.stop()}}),e,this)})))}},{key:"markAsReadWithChannelUrls",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),Aa(O("string",e)&&n-this._markAsReadAllLastSentAt>=1e3).throw(T.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=n,r=new zd({userId:this._sdkState.userId,channelUrls:e}),t.next=6,this._requestQueue.send(r);case 6:a=this._groupChannelCache.channels,i=[],s=k(a);try{for(s.s();!(o=s.n()).done;)u=o.value,e.includes(u.url)&&(u._updateUnreadMemberState(this._sdkState.userId,n),u._updateUnreadCount(0,0),i.push(u))}catch(e){s.e(e)}finally{s.f()}if(!(i.length>0)){t.next=13;break}return t.next=13,this.upsertChannelsToCache(i);case 13:case"end":return t.stop()}}),t,this)})))}},{key:"markAsDelivered",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChannel(e);case 2:return n=t.sent,t.next=5,n.markAsDelivered();case 5:case"end":return t.stop()}}),t,this)})))}}],[{key:"of",value:function(e){return xf[e]}},{key:"clear",value:function(e){xf[e]&&delete xf[e]}}]),t}();!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.END=2]="END"}(gd||(gd={}));var Cf=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this))._worker=null,i._state=gd.IDLE,i._semaphore=null,i._retryCount=0,i._retryLimit=3,i.priority=0,i._worker=a,i}return a(r,[{key:"isIdle",get:function(){return this._state===gd.IDLE}},{key:"isRunning",get:function(){return this._state===gd.RUNNING}},{key:"isDone",get:function(){return this._state===gd.END}},{key:"retryCount",get:function(){return this._retryCount}},{key:"retryLimit",get:function(){return this._retryLimit}},{key:"_run",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isRunning){t.next=14;break}return t.prev=1,t.next=4,this._worker(e);case 4:n=t.sent,this._retryCount=0,this.dispatch("progress",n),n.hasNext?this._run(n.nextToken):this.end(),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(1),this.dispatch("error",t.t0),this._retryCount<this._retryLimit?(this._retryCount++,this._run(e)):this.stop();case 14:case"end":return t.stop()}}),t,this,[[1,10]])})))}},{key:"start",value:function(e){this.isIdle&&(this._state=gd.RUNNING,this._run(e))}},{key:"stop",value:function(){this._state=gd.IDLE,this.dispatch("stop")}},{key:"end",value:function(){this._state=gd.END,this.dispatch("end")}}]),r}(K),Tf=a((function e(t){n(this,e),this.source=t})),Sf=a((function e(t){n(this,e),this.source=t})),If={},Nf=function(){function t(r){var a=this,i=r._iid,s=r.channel,o=r.limit,u=void 0===o?100:o;n(this,t),this._prevSync=null,this._nextSync=null,this._connectionEventContext=null,this.ref=0,this._metadata=null,this._iid=i,this._channel=s,this._limit=u;var c,l,h=Ya.of(this._iid),d=h.sdkState,f=h.dispatcher,p=h.logger;this._metadataKey=(c=d.userId,l=s.url,"sendbird:".concat(c,"@groupchannel/").concat(l,"/message/sync.meta"));var v=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/sync")}(d.userId,s.url);this._prevSync=new Cf(v,(function(t){return E(a,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s={hasNext:!0,nextToken:0},n.next=3,this.loadMetadata();case 3:if(p.debug("message background prev sync from",null===(r=this._metadata)||void 0===r?void 0:r.range.top),this._metadata.previousComplete){n.next=28;break}return n.prev=5,o=vs.of(this._iid),n.next=9,o.getMessagesByTimestamp(this._channel.url,this._channel.channelType,null!==(i=null===(a=this._metadata.range)||void 0===a?void 0:a.top)&&void 0!==i?i:t,{prevResultSize:this._limit,nextResultSize:0,replyType:e.ReplyType.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},e.MessageEventSource.SYNC_MESSAGE_BACKGROUND);case 9:return u=n.sent,this.extendRange(u),s.hasNext=u.length>=this._limit,s.nextToken=this._metadata.range.top,this._metadata.previousComplete=!s.hasNext,p.debug("message background prev sync progress",s),n.next=17,this.saveMetadata();case 17:n.next=26;break;case 19:if(n.prev=19,n.t0=n.catch(5),p.debug("message background prev sync error",n.t0),!(n.t0 instanceof T&&n.t0.isInvalidTokenError)){n.next=25;break}return n.next=25,this.clearMetadata();case 25:throw n.t0;case 26:n.next=29;break;case 28:s.hasNext=!1;case 29:return n.abrupt("return",s);case 30:case"end":return n.stop()}}),n,this,[[5,19]])})))})),this._nextSync=new Cf(v,(function(t){return E(a,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s={hasNext:!0,nextToken:0},n.next=3,this.loadMetadata();case 3:return p.debug("message background next sync from",null===(r=this._metadata)||void 0===r?void 0:r.range.bottom),n.prev=4,o=vs.of(this._iid),n.next=8,o.getMessagesByTimestamp(this._channel.url,this._channel.channelType,null!==(i=null===(a=this._metadata.range)||void 0===a?void 0:a.bottom)&&void 0!==i?i:t,{prevResultSize:0,nextResultSize:this._limit,replyType:e.ReplyType.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},e.MessageEventSource.SYNC_MESSAGE_BACKGROUND);case 8:return u=n.sent,this.extendRange(u),s.hasNext=u.length>=this._limit,s.nextToken=this._metadata.range.bottom,p.debug("message background next sync progress",s),n.next=15,this.saveMetadata();case 15:n.next=21;break;case 17:throw n.prev=17,n.t0=n.catch(4),p.debug("message background next sync error",n.t0),n.t0;case 21:return n.abrupt("return",s);case 22:case"end":return n.stop()}}),n,this,[[4,17]])})))})),this._connectionEventContext=f.on((function(e){if(e instanceof Or)if(e.stateType===Tr.CONNECTED)a.resume();else a.pause()}))}return a(t,[{key:"range",get:function(){var e;return null===(e=this._metadata)||void 0===e?void 0:e.range}},{key:"previousComplete",get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.previousComplete)}},{key:"isWrappingMessages",value:function(e){var t,n;return null===(n=this.range)||void 0===n?void 0:(t=n).includes.apply(t,_(e.map((function(e){return e.createdAt}))))}},{key:"extendRange",value:function(e){var t;this._metadata&&(t=this._metadata.range).extends.apply(t,_(e.map((function(e){return e.createdAt}))))}},{key:"loadMetadata",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._metadata){e.next=6;break}return t=Ya.of(this._iid),n=t.cacheContext,e.next=4,n.preference.get(this._metadataKey);case 4:r=e.sent,this._metadata={range:new bf(r?r.range:{top:Number.MAX_SAFE_INTEGER,bottom:Number.MAX_SAFE_INTEGER}),previousComplete:!!r&&r.previousComplete};case 6:return e.abrupt("return",this._metadata);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"saveMetadata",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._metadata){e.next=5;break}return t=Ya.of(this._iid),n=t.cacheContext,e.next=4,n.preference.set(this._metadataKey,this._metadata);case 4:return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"clearMetadata",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.cacheContext,e.next=3,n.preference.remove(this._metadataKey);case 3:this._metadata=null;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"resume",value:function(){var e,t,n,r,a=Ya.of(this._iid),i=a.logger;a.connectionManager.isConnected&&(i.debug("message background sync resume()"),this._metadata&&this._metadata.previousComplete||this._prevSync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.range.top)&&void 0!==t?t:Date.now()),this._nextSync.start(null!==(r=null===(n=this._metadata)||void 0===n?void 0:n.range.bottom)&&void 0!==r?r:Date.now()))}},{key:"pause",value:function(){Ya.of(this._iid).logger.debug("message background sync stop()"),this._prevSync.stop(),this._nextSync.stop()}},{key:"close",value:function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete If[this._iid][this._channel.url])}}],[{key:"of",value:function(e,n){return If[e]||(If[e]={}),If[e][n.url]||(If[e][n.url]=new t({_iid:e,channel:n})),If[e][n.url].ref++,If[e][n.url]}},{key:"clear",value:function(e,t){If[e]&&If[e][t]&&(If[e][t].close(),delete If[e])}}]),t}(),Af={},Mf=function(){function t(r){var a=this,i=r._iid,s=r.channel;n(this,t),this._sync=null,this._connectionEventContext=null,this.ref=0,this._metadata=null,this._iid=i,this._channel=s;var o,u,c=Ya.of(this._iid),l=c.logger,h=c.sdkState,d=c.dispatcher;this._metadataKey=(o=h.userId,u=s.url,"sendbird:".concat(o,"@groupchannel/").concat(u,"/message/changelogs.meta"));var f=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/changelogs")}(h.userId,this._channel.url);this._sync=new Cf(f,(function(){return E(a,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={hasNext:!0,nextToken:0},t.next=3,this.loadMetadata();case 3:return l.debug("message changelog sync from",null===(n=this._metadata)||void 0===n?void 0:n.token),t.prev=4,a=vs.of(this._iid),t.next=8,a.getMessageChangelogs(this._channel.url,this._channel.channelType,this._metadata.token,{replyType:e.ReplyType.ALL,includeReactions:!0,includeThreadInfo:!0,includeMetaArray:!0,includeParentMessageInfo:!0},e.MessageEventSource.SYNC_MESSAGE_CHANGELOGS);case 8:return i=t.sent,s=i.updatedMessages,o=i.deletedMessageIds,u=i.hasMore,c=i.token,r.hasNext=u,r.nextToken=c,(s.length>0||o.length>0)&&(this._metadata.token=c),l.debug("message changelog sync progress",r),t.next=19,this.saveMetadata();case 19:t.next=28;break;case 21:if(t.prev=21,t.t0=t.catch(4),l.debug("message changelog sync error",t.t0),!(t.t0 instanceof T&&t.t0.isInvalidTokenError)){t.next=27;break}return t.next=27,this.clearMetadata();case 27:throw t.t0;case 28:return t.abrupt("return",r);case 29:case"end":return t.stop()}}),t,this,[[4,21]])})))})),this._connectionEventContext=d.on((function(e){if(e instanceof Or)if(e.stateType===Tr.CONNECTED)a.resume();else a.pause()}))}return a(t,[{key:"loadMetadata",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._metadata){e.next=6;break}return t=Ya.of(this._iid),n=t.cacheContext,r=t.firstConnectedAt,e.next=4,n.preference.get(this._metadataKey);case 4:a=e.sent,this._metadata={token:a?a.token:r};case 6:return e.abrupt("return",this._metadata);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"saveMetadata",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._metadata){e.next=5;break}return t=Ya.of(this._iid),n=t.cacheContext,e.next=4,n.preference.set(this._metadataKey,this._metadata);case 4:return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"clearMetadata",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.cacheContext,e.next=3,n.preference.remove(this._metadataKey);case 3:this._metadata=null;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"resume",value:function(){var e=Ya.of(this._iid),t=e.logger;e.connectionManager.isConnected&&(t.debug("message changelog sync resume()"),this._sync.start(0))}},{key:"pause",value:function(){var e=Ya.of(this._iid),t=e.logger;e.connectionManager.isConnected&&(t.debug("message changelog sync pause()"),this._sync.stop())}},{key:"close",value:function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete Af[this._iid][this._channel.url])}}],[{key:"of",value:function(e,n){return Af[e]||(Af[e]={}),Af[e][n.url]||(Af[e][n.url]=new t({_iid:e,channel:n})),Af[e][n.url].ref++,Af[e][n.url]}},{key:"clear",value:function(e,t){Af[e]&&Af[e][t]&&(Af[e][t].close(),delete Af[e])}}]),t}(),Uf=function(e){i(r,e);var t=f(r);function r(e){var a,i,s,o,u,c,l;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Fi(e.channelType),"/").concat(e.channelUrl,"/messages_gap"),a.params=Z({prev_start_ts:e.prevStart,prev_end_ts:e.prevEnd,prev_cache_count:e.prevCount,next_start_ts:e.nextStart,next_end_ts:e.nextEnd,next_cache_count:e.nextCount,huge_gap_threshold:null!==(i=e.threshold)&&void 0!==i?i:null,reverse:!0,custom_types:null!==(s=e.customTypes)&&void 0!==s?s:["*"],message_type:null!==(o=e.messageType)&&void 0!==o?o:null,include_reactions:null===(u=e.includeReactions)||void 0===u||u,with_sorted_meta_array:null===(c=e.includeMetaArray)||void 0===c||c,show_subchannel_messages_only:null!==(l=e.showSubchannelMessagesOnly)&&void 0!==l&&l,include_poll_details:!0}),a}return a(r)}(J),Of=function(e){i(r,e);var t=f(r);function r(e,a){var i,s,o,u,c;return n(this,r),(i=t.call(this,e,a)).isHugeGap=a.is_huge_gap,i.prevMessages=(null!==(s=a.prev_messages)&&void 0!==s?s:[]).map((function(t){return Li(e,t)})),i.prevHasMore=null!==(o=a.prev_hasmore)&&void 0!==o&&o,i.nextMessages=(null!==(u=a.next_messages)&&void 0!==u?u:[]).map((function(t){return Li(e,t)})),i.nextHasmore=null!==(c=a.next_hasmore)&&void 0!==c&&c,i}return a(r)}($),Df=function(t,n){var r,a;switch(n){case e.GroupChannelListOrder.LATEST_LAST_MESSAGE:return null!==(a=null===(r=t.lastMessage)||void 0===r?void 0:r.createdAt)&&void 0!==a?a:t.createdAt;case e.GroupChannelListOrder.CHRONOLOGICAL:return t.createdAt;case e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL:return t.name}return null},Lf=function(e,t){return e.findIndex((function(e){return e.isIdentical(t)}))},Pf=function(e,t,n){if(e.length>0){var r=Lf(e,t);if(r<0){for(var a=0,i=e.length-1,s=Math.floor((a+i)/2);a<i;){var o=Ff(e[s],t,n);if(o>0)i=s,s=Math.floor((a+i)/2);else{if(!(o<0))return{place:s,contains:e[s].isIdentical(t)};a=s+1,s=Math.floor((a+i)/2)}}return{place:Ff(e[s],t,n)>0?s:s+1,contains:!1}}return{place:r,contains:!0}}return{place:e.length,contains:!1}},Ff=function(t,n,r){switch(r){case e.GroupChannelListOrder.LATEST_LAST_MESSAGE:return t.lastMessage&&n.lastMessage?n.lastMessage.createdAt-t.lastMessage.createdAt:t.lastMessage?-1:n.lastMessage?1:n.createdAt-t.createdAt;case e.GroupChannelListOrder.CHRONOLOGICAL:return n.createdAt-t.createdAt;case e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL:return t.name.localeCompare(n.name)}},Hf=function(e,t){return t instanceof bi?e.findIndex((function(e){return e instanceof bi&&t.isIdentical(e)})):e.findIndex((function(e){return e.isIdentical(t)}))},Gf=function(e,t){return e.findIndex((function(e){return e.messageId===t}))},qf=function(e,t){if(e.length>0){for(var n=0,r=e.length-1,a=Math.floor((n+r)/2);n<r;){var i=e[a].createdAt-t.createdAt;if(i>0)r=a,a=Math.floor((n+r)/2);else{if(!(i<0))return a;n=a+1,a=Math.floor((n+r)/2)}}return e[a].createdAt>t.createdAt?a:a+1}return e.length},jf={},zf=function(){function e(t){var r=this,a=t._iid,i=t.channel,s=t.hasPollMessage;n(this,e),this._sync=null,this.ref=0,this._metadata=null,this._iid=a,this._channel=i;var o,u,c=Ya.of(this._iid),l=c.logger,h=c.sdkState,d=c.dispatcher;this._metadataKey=(o=h.userId,u=i.url,"sendbird:".concat(o,"@groupchannel/").concat(u,"/poll/changelogs.meta"));var f=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/poll/changelogs")}(h.userId,this._channel.url);this._sync=new Cf(f,(function(){return E(r,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,u,c,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={hasNext:!0,nextToken:0},e.next=3,this.loadMetadata();case 3:if(l.debug("poll changelog sync from",null===(t=this._metadata)||void 0===t?void 0:t.token),e.t0=!this._metadata||!this._metadata.token,!e.t0){e.next=9;break}return e.next=8,s();case 8:e.t0=!e.sent;case 9:if(!e.t0){e.next=12;break}return r={hasNext:!1,nextToken:0},e.abrupt("return",r);case 12:return this._metadata||(a=Ya.of(this._iid),i=a.firstConnectedAt,this._metadata={token:i}),e.prev=13,o=Ks.of(this._iid),e.next=17,o.getPollChangeLogs(this._channel.url,this._channel.channelType,this._metadata.token);case 17:return u=e.sent,c=u.hasMore,h=u.token,n.hasNext=c,n.nextToken=h,this._metadata.token=h,l.debug("poll changelog sync progress",n),e.next=26,this.saveMetadata();case 26:e.next=35;break;case 28:if(e.prev=28,e.t1=e.catch(13),l.debug("poll changelog sync error",e.t1),!(e.t1 instanceof T&&e.t1.isInvalidTokenError)){e.next=34;break}return e.next=34,this.clearMetadata();case 34:throw e.t1;case 35:return e.abrupt("return",n);case 36:case"end":return e.stop()}}),e,this,[[13,28]])})))})),this._connectionEventContext=d.on((function(e){if(e instanceof Or)if(e.stateType===Tr.CONNECTED)r.resume();else r.pause()}))}return a(e,[{key:"loadMetadata",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._metadata){e.next=6;break}return t=Ya.of(this._iid),n=t.cacheContext,e.next=4,n.preference.get(this._metadataKey);case 4:r=e.sent,this._metadata=r?{token:r.token}:null;case 6:case"end":return e.stop()}}),e,this)})))}},{key:"saveMetadata",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._metadata){e.next=4;break}return t=Ya.of(this._iid),n=t.cacheContext,e.next=4,n.preference.set(this._metadataKey,this._metadata);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"clearMetadata",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.cacheContext,e.next=3,n.preference.remove(this._metadataKey);case 3:this._metadata=null;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"resume",value:function(){Ya.of(this._iid).logger.debug("poll changelog sync resume()"),this._sync.start(0)}},{key:"pause",value:function(){Ya.of(this._iid).logger.debug("poll changelog sync pause()"),this._sync.stop()}},{key:"close",value:function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete jf[this._iid][this._channel.url])}}],[{key:"of",value:function(t,n,r){return jf[t]||(jf[t]={}),jf[t][n.url]||(jf[t][n.url]=new e({_iid:t,channel:n,hasPollMessage:r})),jf[t][n.url].ref++,jf[t][n.url]}}]),e}(),Vf=6e5;e.MessageCollectionInitPolicy=void 0,(e.MessageCollectionInitPolicy||(e.MessageCollectionInitPolicy={})).CACHE_AND_REPLACE_BY_API="cache_and_replace_by_api";var Bf,Qf,Kf,Wf=function(){function e(){n(this,e)}return a(e,[{key:"_invokeResponse",value:function(e,t,n){var r=this;sa((function(){return E(r,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=e,r.next="local"===r.t0?3:"remote"===r.t0?5:7;break;case 3:return this._onCacheResult(t,n),r.abrupt("break",7);case 5:return this._onApiResult(t,n),r.abrupt("break",7);case 7:case"end":return r.stop()}}),r,this)})))}))}},{key:"onCacheResult",value:function(e){return this._onCacheResult=e,this}},{key:"onApiResult",value:function(e){return this._onApiResult=e,this}}]),e}(),Yf=function(){function t(r,a){var i=this,s=a.channel,o=a.filter,u=a.startingPoint,c=a.limit;n(this,t),this._channel=null,this._messages=[],this._unsentMessages=[],this._backgroundSync=null,this._changelogSync=null,this._pollChangelogSync=null,this._iid=r,this._key="mc-".concat(B()),this.filter=null!=o?o:new po,this._channel=s,this._syncRange=new bf({}),this._hasPrevious=!0,this._hasNext=!0,this._startingPoint="number"==typeof u?u:Date.now()+Vf,this._limit=c||co;var l=Rf.of(this._iid);l.subscribeGroupChannelEvent(this._key,{onUpdate:function(t,n){var r=Lf(t,i._channel);if(r>=0&&(sa((function(){return E(i,void 0,void 0,regeneratorRuntime.mark((function e(){var a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=new Tf(n),this._channel=t[r],(null===(a=this._handler)||void 0===a?void 0:a.onChannelUpdated)&&this._handler.onChannelUpdated(i,this.channel);case 3:case"end":return e.stop()}}),e,this)})))})),n===e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED)){var a=!1;for(var s in i._messages){if(i._messages[s].createdAt>=i._channel.messageOffsetTimestamp){a=!0;var o=parseInt(s);if(o>0){var u=i._messages.splice(0,o);i._removeMessagesFromView(u.map((function(e){return e.messageId})),e.MessageEventSource.EVENT_MESSAGE_OFFSET_UPDATED)}break}}!a&&i._messages.length>0&&i._removeMessagesFromView(i._messages.map((function(e){return e.messageId})),e.MessageEventSource.EVENT_MESSAGE_OFFSET_UPDATED)}},onRemove:function(e,t){e.indexOf(i.channel.url)>=0&&sa((function(){return E(i,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Tf(t),(null===(n=this._handler)||void 0===n?void 0:n.onChannelDeleted)&&this._handler.onChannelDeleted(r,this.channel.url);case 2:case"end":return e.stop()}}),e,this)})))}))}}),l.subscribeMessageEvent(this._key,{onUpdate:function(t,n){var r,a=[],s=[],o=k(t);try{for(o.s();!(r=o.n()).done;){var u=r.value;u.channelUrl===i._channel.url&&(i.filter.match(u)?a.push(u):s.push(u.messageId))}}catch(e){o.e(e)}finally{o.f()}if($i(n)){if(a.length>0)switch(n){case e.MessageEventSource.EVENT_MESSAGE_SENT_FAILED:case e.MessageEventSource.EVENT_MESSAGE_SENT_SUCCESS:case e.MessageEventSource.EVENT_MESSAGE_UPDATED:case e.MessageEventSource.EVENT_MESSAGE_THREADINFO_UPDATED:case e.MessageEventSource.EVENT_MESSAGE_REACTION_UPDATED:case e.MessageEventSource.SYNC_MESSAGE_CHANGELOGS:i._updateMessagesToView(a,n);break;case e.MessageEventSource.EVENT_MESSAGE_SENT_PENDING:i._addMessagesToView(a,n);break;case e.MessageEventSource.EVENT_MESSAGE_RECEIVED:i.hasNext||i._addMessagesToView(a,n);break;case e.MessageEventSource.SYNC_MESSAGE_FILL:i._addMessagesToView(a,n)}s.length>0&&i._removeMessagesFromView(s,n)}},onRemove:function(e,t){i._removeMessagesFromView(e,t)},onRemoveUnsent:function(e,t){i._removeUnsentMessageFromView(e,t)},onPollChangeLogUpdate:function(e,t){i._updatePollsToView(e,t)},onPollUpdate:function(e,t){i._applyPollUpdateEventToView(e,t)},onPollVote:function(e,t){i._applyPollVoteEventToView(e,t)}});var h=Ya.of(this._iid).cacheContext;!this._channel.isSuper&&h.localCacheEnabled&&(this._backgroundSync=Nf.of(this._iid,this._channel),this._backgroundSync.resume()),this._changelogSync=Mf.of(this._iid,this._channel),this._changelogSync.resume(),this._pollChangelogSync=zf.of(this._iid,this._channel,this._hasPollMessage.bind(this)),this._pollChangelogSync.resume(),this._prevFill=new Cf(this._key,(function(t){return E(i,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this._getRemoteMessages(t,{prevLimit:this._limit,source:e.MessageEventSource.SYNC_MESSAGE_FILL});case 2:if(!((r=n.sent).length>0)){n.next=7;break}return a=Math.min.apply(Math,_(r.map((function(e){return e.createdAt})))),this._syncRange.extends(a),n.abrupt("return",{hasNext:r.length>=this._limit&&this.viewTop<a,nextToken:this._syncRange.top});case 7:return n.abrupt("return",{hasNext:!1,nextToken:0});case 8:case"end":return n.stop()}}),n,this)})))})),this._nextFill=new Cf(this._key,(function(t){return E(i,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this._getRemoteMessages(t,{nextLimit:this._limit,source:e.MessageEventSource.SYNC_MESSAGE_FILL});case 2:if(!((r=n.sent).length>0)){n.next=7;break}return a=Math.max.apply(Math,_(r.map((function(e){return e.createdAt})))),this._syncRange.extends(a),n.abrupt("return",{hasNext:!(r.length>=this._limit&&this._hasNext)||this.viewBottom>a,nextToken:this._syncRange.bottom});case 7:return n.abrupt("return",{hasNext:!1,nextToken:0});case 8:case"end":return n.stop()}}),n,this)})))}));var d=Ya.of(this._iid),f=d.dispatcher,p=d.logger;this._connectionEventContext=f.on((function(t){if(t instanceof Or)if(t.stateType===Tr.CONNECTED)i._refreshChannel(e.GroupChannelEventSource.SYNC_CHANNEL_CHANGELOGS),p.debug("check huge gap"),i._checkHugeGap();else i._prevFill.stop(),i._nextFill.stop()}))}return a(t,[{key:"channel",get:function(){return this._channel}},{key:"succeededMessages",get:function(){return _(this._messages)}},{key:"failedMessages",get:function(){return this._unsentMessages.filter((function(t){return t.sendingStatus===e.SendingStatus.FAILED}))}},{key:"pendingMessages",get:function(){return this._unsentMessages.filter((function(t){return t.sendingStatus===e.SendingStatus.PENDING}))}},{key:"hasPrevious",get:function(){return this._hasPrevious}},{key:"hasNext",get:function(){return this._hasNext}},{key:"viewTop",get:function(){return Math.min.apply(Math,_(this._messages.map((function(e){return e.createdAt}))).concat([Number.MAX_SAFE_INTEGER]))}},{key:"viewBottom",get:function(){return Math.max.apply(Math,_(this._messages.map((function(e){return e.createdAt}))).concat([0]))}},{key:"setMessageCollectionHandler",value:function(e){this._handler=e}},{key:"_filterUnderOffsetMessage",value:function(e){return e}},{key:"_addMessagesToView",value:function(t,n){var r,a=this,i=this._filterUnderOffsetMessage(t),s=[],o=[],u=k(i);try{for(u.s();!(r=u.n()).done;){var c=r.value;if(n===e.MessageEventSource.SYNC_MESSAGE_FILL){if(c.messageId>0){if(Hf(this._messages,c)<0){Hf(this._unsentMessages,c)<0&&s.push(c);var l=qf(this._messages,c);this._messages.splice(l,0,c)}}else if(c instanceof bi){Hf(this._unsentMessages,c)<0&&Hf(this._messages,c)<0&&(this._unsentMessages.push(c),s.push(c))}}else if(c.messageId>0){var h=Hf(this._messages,c);if(h<0){var d=Hf(this._unsentMessages,c);d<0?s.push(c):(this._unsentMessages.splice(d,1),o.push(c));var f=qf(this._messages,c);this._messages.splice(f,0,c)}else o.push(c),this._messages[h]=c;if(c.updatedAt>0){var p=this._updateChildMessagesInView(c);o.push.apply(o,_(p))}}else if(c instanceof bi){var v=Hf(this._unsentMessages,c);v<0?Hf(this._messages,c)<0&&(this._unsentMessages.push(c),s.push(c)):(o.push(c),this._unsentMessages[v]=c)}}}catch(e){u.e(e)}finally{u.f()}$i(n)&&sa((function(){return E(a,void 0,void 0,regeneratorRuntime.mark((function e(){var t,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new Sf(n),s.length>0&&(null===(t=this._handler)||void 0===t||t.onMessagesAdded(a,this.channel,s)),o.length>0&&(null===(r=this._handler)||void 0===r||r.onMessagesUpdated(a,this.channel,o));case 3:case"end":return e.stop()}}),e,this)})))}))}},{key:"_updateChildMessagesInView",value:function(e){var t=[];return this._messages.forEach((function(n){n.applyParentMessage(e)&&t.push(n)})),t}},{key:"_updatePollsToView",value:function(e,t){var n,r=this,a=[],i=k(e);try{for(i.s();!(n=i.n()).done;){var s=n.value,o=Gf(this._messages,s.messageId);if(o>=0){var u=this._messages[o];u&&u.applyPoll(s),a.push(u)}}}catch(e){i.e(e)}finally{i.f()}return a.length>0&&$i(t)&&sa((function(){return E(r,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Sf(t),a.length>0&&(null===(n=this._handler)||void 0===n||n.onMessagesUpdated(r,this.channel,a));case 2:case"end":return e.stop()}}),e,this)})))})),a}},{key:"_applyPollUpdateEventToView",value:function(e,t){var n=this,r=Gf(this._messages,e.messageId);if(r>=0){var a=this._messages[r];a&&a.isUserMessage()&&a.poll&&a.poll.applyPollUpdateEvent(e)&&$i(t)&&sa((function(){return E(n,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Sf(t),null===(n=this._handler)||void 0===n||n.onMessagesUpdated(r,this.channel,[a]);case 2:case"end":return e.stop()}}),e,this)})))}))}}},{key:"_applyPollVoteEventToView",value:function(e,t){var n=this,r=Gf(this._messages,e.messageId);if(r>=0){var a=this._messages[r];a&&a.isUserMessage()&&a.poll&&a.poll.applyPollVoteEvent(e)&&$i(t)&&sa((function(){return E(n,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Sf(t),null===(n=this._handler)||void 0===n||n.onMessagesUpdated(r,this.channel,[a]);case 2:case"end":return e.stop()}}),e,this)})))}))}}},{key:"_updateMessagesToView",value:function(e,t){var n,r=this,a=[],i=[],s=k(e);try{for(s.s();!(n=s.n()).done;){var o=n.value;if(o.messageId>0){var u=Hf(this._messages,o);if(u>=0)a.push(o),this._messages[u]=o;else{var c=Hf(this._unsentMessages,o);if(c>=0){var l=this._unsentMessages.splice(c,1);if(this.hasNext&&l.length>0)i.push(l[0]);else{a.push(o);var h=qf(this._messages,o);this._messages.splice(h,0,o)}}}}else if(o instanceof bi){var d=Hf(this._unsentMessages,o);d>=0&&(a.push(o),this._unsentMessages[d]=o)}}}catch(e){s.e(e)}finally{s.f()}return $i(t)&&sa((function(){return E(r,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=new Sf(t),a.length>0?null===(n=this._handler)||void 0===n||n.onMessagesUpdated(s,this.channel,a):i.length>0&&(null===(r=this._handler)||void 0===r||r.onMessagesDeleted(s,this.channel,[],i));case 2:case"end":return e.stop()}}),e,this)})))})),a}},{key:"_removeMessagesFromView",value:function(e,t){var n,r=this,a=[],i=[],s=k(e);try{var o=function(){var e=n.value,t=r._messages.findIndex((function(t){return t.messageId===e}));if(t>=0){var s=r._messages[t];a.push(s.messageId),i.push(s),r._messages.splice(t,1)}};for(s.s();!(n=s.n()).done;)o()}catch(e){s.e(e)}finally{s.f()}return $i(t)&&i.length>0&&sa((function(){return E(r,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Sf(t),null===(n=this._handler)||void 0===n||n.onMessagesDeleted(r,this.channel,a,i);case 2:case"end":return e.stop()}}),e,this)})))})),a}},{key:"_removeUnsentMessageFromView",value:function(e,t){var n=this._unsentMessages.findIndex((function(t){return t.reqId===e}));n>=0&&this._unsentMessages.splice(n,1)}},{key:"_getLocalMessages",value:function(e,t){var n=t.prevLimit,r=void 0===n?0:n,a=t.nextLimit,i=void 0===a?0:a;return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,a,s,o,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Rf.of(this._iid),!(r>0)){t.next=7;break}return t.next=4,n.getMessagesFromCache(this._channel.url,e,"prev",this.filter,r);case 4:t.t0=t.sent,t.next=8;break;case 7:t.t0=[];case 8:if(a=t.t0,!(i>0)){t.next=15;break}return t.next=12,n.getMessagesFromCache(this._channel.url,e,"next",this.filter,i);case 12:t.t1=t.sent,t.next=16;break;case 15:t.t1=[];case 16:if(s=t.t1,!(a.length>0&&s.length>0)){t.next=27;break}o=a.map((function(e){return e.messageId})),t.t2=regeneratorRuntime.keys(s);case 20:if((t.t3=t.t2()).done){t.next=27;break}if(u=t.t3.value,!o.includes(s[u].messageId)){t.next=25;break}return s.splice(parseInt(u),1),t.abrupt("break",27);case 25:t.next=20;break;case 27:return t.abrupt("return",[].concat(_(a),_(s)).sort((function(e,t){return t.createdAt-e.createdAt})));case 28:case"end":return t.stop()}}),t,this)})))}},{key:"_getRemoteMessages",value:function(t,n){var r=n.prevLimit,a=void 0===r?0:r,i=n.nextLimit,s=void 0===i?0:i,o=n.source,u=void 0===o?e.MessageEventSource.REQUEST_MESSAGE:o,c=n.reverse,l=void 0!==c&&c;return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=vs.of(this._iid),!(a>0||s>0)){e.next=7;break}return e.next=4,n.getMessagesByTimestamp(this._channel.url,this._channel.channelType,t,Object.assign(Object.assign({},this.filter),{isInclusive:!0,reverse:l,prevResultSize:a,nextResultSize:s,includeMetaArray:!0,includeReactions:!0,includeThreadInfo:!0}),u);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=[];case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})))}},{key:"_checkHugeGap",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c,l,h,d,f,p,v,m,g,y=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this._messages.length>0)){t.next=16;break}return n=this.viewTop,r=this._syncRange.top,a=this._syncRange.bottom,i=this.hasNext?this.viewBottom:Number.MAX_SAFE_INTEGER,s=Rf.of(this._iid),t.next=8,s.getCachedMessageCountBetween(this._channel.url,this.filter,n,r);case 8:return o=t.sent,t.next=11,s.getCachedMessageCountBetween(this._channel.url,this.filter,a,i);case 11:return u=t.sent,t.next=14,ia((function(){return E(y,void 0,void 0,regeneratorRuntime.mark((function t(){var s,c,l,h,d,f,p,v,m,g,y,k,b,w,x,R,C,T=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=Ya.of(this._iid),c=s.dispatcher,l=s.requestQueue,h=new Uf(Object.assign({channelUrl:this._channel.url,channelType:this._channel.channelType,prevStart:n,prevEnd:r,prevCount:o,nextStart:a,nextEnd:i,nextCount:u},this.filter)),t.next=4,l.send(h);case 4:d=t.sent,f=d.as(Of),p=f.isHugeGap,v=f.prevMessages,m=void 0===v?[]:v,g=f.prevHasMore,y=f.nextMessages,k=void 0===y?[]:y,b=f.nextHasmore,p?sa((function(){return E(T,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null===(t=this._handler)||void 0===t||t.onHugeGapDetected();case 1:case"end":return e.stop()}}),e,this)})))})):(this._hasPrevious=g,this._hasNext=b,w=this.viewTop,x=this.viewBottom,R=Math.min.apply(Math,[Number.MAX_SAFE_INTEGER,w].concat(_(m.map((function(e){return e.createdAt}))))),C=Math.max.apply(Math,[0,x].concat(_(k.map((function(e){return e.createdAt}))))),c.dispatch(new es({messages:m,source:e.MessageEventSource.SYNC_MESSAGE_FILL})),c.dispatch(new es({messages:k,source:e.MessageEventSource.SYNC_MESSAGE_FILL})),this._syncRange.extends(R,C),w<R&&this._prevFill.start(R),x>C&&this._nextFill.start(C));case 7:case"end":return t.stop()}}),t,this)})))}),1);case 14:t.next=22;break;case 16:return c=Math.floor(this._limit/2),l=Date.now(),t.next=20,this._getRemoteMessages(l,{prevLimit:c,nextLimit:c,source:e.MessageEventSource.SYNC_MESSAGE_FILL});case 20:if((h=t.sent).length>0){for(f=h.map((function(e){return e.createdAt})),p=0,v=0,m=0;m<f.length;m++)(g=f[m])<=l?p++:g>=l&&v++;this._hasPrevious=p>=c,this._hasNext=v>=c,(d=this._syncRange).extends.apply(d,_(h.map((function(e){return e.createdAt})))),this._addMessagesToView(h,e.MessageEventSource.SYNC_MESSAGE_FILL)}else this._hasPrevious=!1,this._hasNext=!1;case 22:case"end":return t.stop()}}),t,this)})))}},{key:"_loadUnsentMessages",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Rf.of(this._iid),e.next=3,t.getUnsentMessagesFromCache(this._channel.url,this.filter);case 3:this._unsentMessages=e.sent;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"_hasPollMessage",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Rf.of(this._iid),e.next=3,t.getPollMessagesFromCache(this._channel.url,Date.now()+Vf,this.filter,1);case 3:if(!(e.sent.length>0)){e.next=6;break}return e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"_refreshChannel",value:function(e){Rf.of(this._iid).refreshChannel(this.channel.url,!0,e)}},{key:"initialize",value:function(t){var n=this,r=new Wf;this._messages=[],this._unsentMessages=[],this._syncRange=new bf({}),this._hasNext=!0,this._hasPrevious=!0,this._refreshChannel(e.GroupChannelEventSource.REFRESH_CHANNEL);var a=Math.floor(this._limit/2);if(t===e.MessageCollectionInitPolicy.CACHE_AND_REPLACE_BY_API)this._getLocalMessages(this._startingPoint,{prevLimit:a,nextLimit:a}).then((function(t){return E(n,void 0,void 0,regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=this._filterUnderOffsetMessage(t),this._addMessagesToView(a,e.MessageEventSource.REQUEST_MESSAGE),n.next=4,this._loadUnsentMessages();case 4:r._invokeResponse("local",null,a);case 5:case"end":return n.stop()}}),n,this)})))})).catch((function(e){if(C(e))throw e;r._invokeResponse("local",e,null)})).finally((function(){n._getRemoteMessages(n._startingPoint,{prevLimit:a,nextLimit:a,reverse:!0}).then((function(t){n._messages=[];var i=n._filterUnderOffsetMessage(t);if(i.length>0){for(var s,o=i.map((function(e){return e.createdAt})),u=0,c=0,l=0;l<o.length;l++){var h=o[l];h<=n._startingPoint?u++:h>=n._startingPoint&&c++}n._hasPrevious=u>=a,n._hasNext=c>=a,(s=n._syncRange).extends.apply(s,_(i.map((function(e){return e.createdAt})))),n._addMessagesToView(i,e.MessageEventSource.REQUEST_MESSAGE)}else n._hasPrevious=!1,n._hasNext=!1;r._invokeResponse("remote",null,i)})).catch((function(e){if(C(e))throw e;r._invokeResponse("remote",e,null)}))}));return r}},{key:"loadPrevious",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._hasPrevious){t.next=14;break}return n=this.viewTop,r=[],t.next=5,oa((function(){return E(i,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._getLocalMessages(n,{prevLimit:this._limit});case 3:e.t1=e.sent,r=e.t0._filterUnderOffsetMessage.call(e.t0,e.t1);case 5:case"end":return e.stop()}}),e,this)})))}));case 5:if(0!==r.length&&this._backgroundSync&&this._backgroundSync.isWrappingMessages(r)){t.next=11;break}return t.next=8,oa((function(){return E(i,void 0,void 0,regeneratorRuntime.mark((function e(){var t,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._getRemoteMessages(n,{prevLimit:this._limit});case 3:e.t1=e.sent,r=e.t0._filterUnderOffsetMessage.call(e.t0,e.t1),this._hasPrevious=r.length>=this._limit,r.length>0&&((i=this._syncRange).extends.apply(i,_(r.map((function(e){return e.createdAt})))),(null===(t=this._backgroundSync)||void 0===t?void 0:t.range.overlap(this._syncRange))&&(null===(a=this._backgroundSync)||void 0===a||a.range.extends(this._syncRange.top)));case 7:case"end":return e.stop()}}),e,this)})))}));case 8:this._addMessagesToView(r,e.MessageEventSource.REQUEST_MESSAGE),t.next=13;break;case 11:this._hasPrevious=r.length>=this._limit,r.length>0&&((a=this._syncRange).extends.apply(a,_(r.map((function(e){return e.createdAt})))),this._addMessagesToView(r,e.MessageEventSource.REQUEST_MESSAGE));case 13:return t.abrupt("return",r);case 14:return t.abrupt("return",[]);case 15:case"end":return t.stop()}}),t,this)})))}},{key:"loadNext",value:function(){var t;return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this._hasNext){n.next=2;break}return n.abrupt("return",[]);case 2:return r=this.viewBottom,a=[],n.next=6,oa((function(){return E(s,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._getLocalMessages(r,{nextLimit:this._limit});case 3:e.t1=e.sent,a=e.t0._filterUnderOffsetMessage.call(e.t0,e.t1);case 5:case"end":return e.stop()}}),e,this)})))}));case 6:if(0!==a.length&&(null===(t=this._backgroundSync)||void 0===t?void 0:t.isWrappingMessages(a))){n.next=12;break}return n.next=9,oa((function(){return E(s,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._getRemoteMessages(r,{nextLimit:this._limit});case 3:e.t1=e.sent,a=e.t0._filterUnderOffsetMessage.call(e.t0,e.t1),this._hasNext=a.length>=this._limit,a.length>0&&((i=this._syncRange).extends.apply(i,_(a.map((function(e){return e.createdAt})))),(null===(t=this._backgroundSync)||void 0===t?void 0:t.range.overlap(this._syncRange))&&(null===(n=this._backgroundSync)||void 0===n||n.range.extends(this._syncRange.bottom)));case 7:case"end":return e.stop()}}),e,this)})))}));case 9:this._addMessagesToView(a,e.MessageEventSource.REQUEST_MESSAGE),n.next=14;break;case 12:this._hasNext=a.length>=this._limit,a.length>0&&((i=this._syncRange).extends.apply(i,_(a.map((function(e){return e.createdAt})))),this._addMessagesToView(a,e.MessageEventSource.REQUEST_MESSAGE));case 14:return n.abrupt("return",a);case 15:case"end":return n.stop()}}),n,this)})))}},{key:"removeFailedMessage",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Rf.of(this._iid),t.next=3,n.removeFailedMessageFromCache(e);case 3:(r=this._unsentMessages.findIndex((function(t){return t.reqId===e})))>-1&&this._unsentMessages.splice(r,1);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){var e,t,n;Ya.of(this._iid).cacheContext.localCacheEnabled&&(this._prevFill.stop(),this._nextFill.stop()),null===(e=this._backgroundSync)||void 0===e||e.close(),null===(t=this._changelogSync)||void 0===t||t.close(),null===(n=this._pollChangelogSync)||void 0===n||n.close();var r=Rf.of(this._iid);r.unsubscribeGroupChannelEvent(this._key),r.unsubscribeMessageEvent(this._key),this._connectionEventContext&&this._connectionEventContext.close()}}]),t}(),Zf={coverUrl:null,coverImage:null,isDistinct:null,isPublic:null,isDiscoverable:null,accessCode:null,name:null,data:null,customType:null,operatorUserIds:null,messageSurvivalSeconds:null},Xf=function(e){return A("string",e.coverUrl,!0)&&(L(e.coverImage)||A("string",e.coverImage)||null===e.coverImage)&&A("boolean",e.isDistinct,!0)&&A("boolean",e.isPublic,!0)&&A("boolean",e.isDiscoverable,!0)&&A("string",e.accessCode,!0)&&A("string",e.name,!0)&&A("string",e.data,!0)&&A("string",e.customType,!0)&&O("string",e.operatorUserIds,!0)&&A("number",e.messageSurvivalSeconds,!0)},Jf={hidePreviousMessages:!1,allowAutoUnhide:!0},$f=function(e){return A("boolean",e.hidePreviousMessages)&&A("boolean",e.allowAutoUnhide)},ep=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.token,o=e.limit,u=e.order,c=e.mutedMemberFilter,l=e.memberStateFilter,h=e.nicknameStartsWithFilter,d=e.operatorFilter;return(a=t.call(this)).method=R.GET,a.path="".concat(qr,"/").concat(encodeURIComponent(i),"/members"),a.params={token:s,limit:o,order:u,muted_member_filter:c,member_state_filter:l,nickname_startswith:h,operator_filter:d,show_member_is_muted:!0,show_read_receipt:!0,show_delivery_receipt:!0},a}return a(r)}(J),tp=function(e){i(r,e);var t=f(r);function r(e,a){var i;n(this,r),(i=t.call(this,e,a)).token=null,i.members=[];var s=a.next,o=a.members;return i.token=s,o&&o.length>0&&(i.members=o.map((function(t){return new Jh(e,t)}))),i}return a(r)}($);e.MutedMemberFilter=void 0,(Bf=e.MutedMemberFilter||(e.MutedMemberFilter={})).ALL="all",Bf.MUTED="muted",Bf.UNMUTED="unmuted",e.MemberListOrder=void 0,(Qf=e.MemberListOrder||(e.MemberListOrder={})).MEMBER_NICKNAME_ALPHABETICAL="member_nickname_alphabetical",Qf.OPERATOR_THEN_MEMBER_ALPHABETICAL="operator_then_member_alphabetical",e.MemberStateFilter=void 0,(Kf=e.MemberStateFilter||(e.MemberStateFilter={})).ALL="all",Kf.JOINED="joined_only",Kf.INVITED="invited_only",Kf.INVITED_BY_FRIEND="invited_by_friend",Kf.INVITED_BY_NON_FRIEND="invited_by_non_friend";var np,rp,ap,ip=function(t){i(o,t);var r=f(o);function o(t,a,i){var s,u,c,l,h;return n(this,o),(s=r.call(this,t,a,e.ChannelType.GROUP,i)).mutedMemberFilter=e.MutedMemberFilter.ALL,s.memberStateFilter=e.MemberStateFilter.ALL,s.nicknameStartsWithFilter=null,s.operatorFilter=e.OperatorFilter.ALL,s.order=e.MemberListOrder.MEMBER_NICKNAME_ALPHABETICAL,s.mutedMemberFilter=null!==(u=i.mutedMemberFilter)&&void 0!==u?u:e.MutedMemberFilter.ALL,s.memberStateFilter=null!==(c=i.memberStateFilter)&&void 0!==c?c:e.MemberStateFilter.ALL,s.nicknameStartsWithFilter=null!==(l=i.nicknameStartsWithFilter)&&void 0!==l?l:null,s.order=null!==(h=i.order)&&void 0!==h?h:e.MemberListOrder.MEMBER_NICKNAME_ALPHABETICAL,s}return a(o,[{key:"_validate",value:function(){return v(s(o.prototype),"_validate",this).call(this)&&M(e.MutedMemberFilter,this.mutedMemberFilter)&&M(e.MemberStateFilter,this.memberStateFilter)&&(A("string",this.nicknameStartsWithFilter)||null===this.nicknameStartsWithFilter)&&M(e.OperatorFilter,this.operatorFilter)&&M(e.MemberListOrder,this.order)}},{key:"next",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,t=Ya.of(this._iid),n=t.requestQueue,r=new ep(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,n.send(r);case 8:return a=e.sent,i=a.as(tp),s=i.members,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,e.abrupt("return",s);case 14:return e.abrupt("return",[]);case 17:throw T.queryInProgress;case 18:e.next=21;break;case 20:throw T.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),o}(Ts),sp=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.userId,o=e.accessCode;return(a=t.call(this)).method=R.PUT,a.path="".concat(qr,"/").concat(encodeURIComponent(i),"/accept"),a.params={user_id:s,access_code:o},a}return a(r)}(J),op=function(t){i(s,t);var r=f(s);function s(t,a){var i;return n(this,s),(i=r.call(this,t,a)).channel=new Mp(t,a),i.channel.myMemberState=e.MemberState.JOINED,i}return a(s)}($),up=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.isDistinct,o=e.isPublic,u=e.isDiscoverable,c=e.coverUrl,l=e.coverImage,h=e.accessCode,d=e.name,f=e.data,p=e.customType,v=e.operatorUserIds,m=e.messageSurvivalSeconds;return(a=t.call(this)).method=R.PUT,a.path="".concat(qr,"/").concat(encodeURIComponent(i)),a.params=Z({is_distinct:s,is_public:o,is_discoverable:u,name:d,data:f,custom_type:p,cover_url:c,cover_file:l,access_code:h,operator_ids:v,message_survival_seconds:m}),a}return a(r)}(J),cp=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).channel=new Mp(e,a),i}return a(r)}($),lp=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl;return(a=t.call(this)).method=R.DELETE,a.path="".concat(qr,"/").concat(encodeURIComponent(i)),a}return a(r)}(J),hp=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl;return(a=t.call(this)).method=R.DELETE,a.path="".concat(qr,"/").concat(encodeURIComponent(i),"/hide"),a}return a(r)}(J),dp=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.channelUrl,o=e.countPreference;return n(this,r),(a=t.call(this)).method=R.PUT,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/count_preference/").concat(encodeURIComponent(s)),a.params={count_preference:o},a}return a(r)}(J),fp=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).countPreference=a.count_preference,i}return a(r)}($),pp=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl;return(a=t.call(this)).method=R.PUT,a.path="".concat(qr,"/").concat(encodeURIComponent(i),"/reset_user_history"),a}return a(r)}(J),vp=function(e){i(r,e);var t=f(r);function r(e,a){var i;n(this,r),(i=t.call(this,e,a)).messageOffsetTimestamp=null;var s=a.ts_message_offset;return i.messageOffsetTimestamp=null!=s?s:null,i}return a(r)}($),mp=Object.assign(Object.assign({},ll),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1}),_p=function(e){return hl(e)&&A("number",e.scheduledAt,!0)&&(L(e.file)||A("string",e.fileUrl))&&A("string",e.fileName,!0)&&A("string",e.mimeType,!0)&&A("number",e.fileSize,!0)&&(null===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return A("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},gp=Object.assign(Object.assign({},dl),{scheduledAt:null}),yp=function(e){return fl(e)&&A("number",e.scheduledAt,!0)},kp=function(t){i(s,t);var r=f(s);function s(t){var a,i;n(this,s),a=r.call(this);var o=null;t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?o=t.mentionedUserIds:t.mentionedUsers&&(o=t.mentionedUsers.map((function(e){return e.userId}))));var u=t.channelType,c=t.channelUrl,l=t.scheduledMessageId;return a.method=R.PUT,a.path="".concat(Fi(u),"/").concat(encodeURIComponent(c),"/scheduled_messages/").concat(encodeURIComponent(l)),a.params=Z({req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:Ja.FILE,url:t.fileUrl,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,thumbnails:t.thumbnailSizes?t.thumbnailSizes.map((function(e){return wi.payloadify(e)})):[],custom_type:t.customType,data:t.data,require_auth:t.requireAuth,mention_type:t.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(i=t.metaArrays)||void 0===i?void 0:i.map((function(e){return pi.payloadify(e)})),apple_critical_alert_options:_i.payloadify(t.appleCriticalAlertOptions),push_option:t.pushNotificationDeliveryOption}),a}return a(s)}(J),Ep=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).message=new Pi(e,a),i}return a(r)}($),bp=function(t){i(s,t);var r=f(s);function s(t){var a,i;n(this,s),a=r.call(this);var o=null;t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?o=t.mentionedUserIds:t.mentionedUsers&&(o=t.mentionedUsers.map((function(e){return e.userId}))));var u=t.channelType,c=t.channelUrl,l=t.scheduledMessageId;return a.method=R.PUT,a.path="".concat(Fi(u),"/").concat(encodeURIComponent(c),"/scheduled_messages/").concat(encodeURIComponent(l)),a.params=Z({req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:Ja.USER,message:t.message,custom_type:t.customType,data:t.data,mention_type:t.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(i=t.metaArrays)||void 0===i?void 0:i.map((function(e){return pi.payloadify(e)})),apple_critical_alert_options:_i.payloadify(t.appleCriticalAlertOptions),target_langs:t.translationTargetLanguages,push_option:t.pushNotificationDeliveryOption}),a}return a(s)}(J),wp=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r),a=t.call(this);var i=e.channelType,s=e.channelUrl,o=e.scheduledMessageId;return a.method=R.DELETE,a.path="".concat(Fi(i),"/").concat(encodeURIComponent(s),"/scheduled_messages/").concat(encodeURIComponent(o)),a}return a(r)}(J),xp=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r),a=t.call(this);var i=e.channelType,s=e.channelUrl,o=e.scheduledMessageId;return a.method=R.POST,a.path="".concat(Fi(i),"/").concat(encodeURIComponent(s),"/scheduled_messages/").concat(encodeURIComponent(o),"/send_now"),a}return a(r)}(J),Rp=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.channelUrl,o=e.pushTriggerOption;return n(this,r),(a=t.call(this)).method=R.PUT,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/push_preference/").concat(encodeURIComponent(s)),a.params={push_trigger_option:o},a}return a(r)}(J),Cp=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).pushTriggerOption=a.push_trigger_option,i.enabled=a.enable,i}return a(r)}($),Tp=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.userId,s=e.channelUrl;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(Hr,"/").concat(encodeURIComponent(i),"/push_preference/").concat(encodeURIComponent(s)),a}return a(r)}(J),Sp=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).pushTriggerOption=a.push_trigger_option,i.enabled=a.enable,i}return a(r)}($),Ip=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelType,s=e.channelUrl,o=e.messageId;return n(this,r),(a=t.call(this)).method=R.POST,a.path="".concat(Fi(i),"/").concat(encodeURIComponent(s),"/messages/").concat(o,"/pin"),a}return a(r)}(J),Np=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelType,s=e.channelUrl,o=e.messageId;return n(this,r),(a=t.call(this)).method=R.DELETE,a.path="".concat(Fi(i),"/").concat(encodeURIComponent(s),"/messages/").concat(o,"/pin"),a}return a(r)}(J);e.CountPreference=void 0,(np=e.CountPreference||(e.CountPreference={})).ALL="all",np.UNREAD_MESSAGE_COUNT_ONLY="unread_message_count_only",np.UNREAD_MENTION_COUNT_ONLY="unread_mention_count_only",np.OFF="off",e.MutedState=void 0,(rp=e.MutedState||(e.MutedState={})).MUTED="muted",rp.UNMUTED="unmuted",e.HiddenState=void 0,(ap=e.HiddenState||(e.HiddenState={})).UNHIDDEN="unhidden",ap.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",ap.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide";var Ap,Mp=function(t){i(o,t);var r=f(o);function o(t,a){var i,s,u,c,l,h,d,f,p,v,m,g,y,k,E,b,w,x,R,C;(n(this,o),(i=r.call(this,t,a))._unreadMemberStateMap=new Map,i._undeliveredMemberStateMap=new Map,i._typingStatus=new Map,i._lastMemberCountUpdated=0,i._typingStarted=0,i._typingEnded=0,i.isDistinct=!1,i.isSuper=!1,i.isBroadcast=!1,i.isExclusive=!1,i.isPublic=!1,i.isDiscoverable=!0,i.isAccessCodeRequired=!1,i.isPushEnabled=!1,i.unreadMessageCount=0,i.unreadMentionCount=0,i.members=[],i.memberCount=0,i.joinedMemberCount=0,i.hiddenState=e.HiddenState.UNHIDDEN,i.lastMessage=null,i.messageOffsetTimestamp=0,i.messageSurvivalSeconds=-1,i.myMemberState=e.MemberState.NONE,i.myRole=e.Role.NONE,i.myMutedState=e.MutedState.UNMUTED,i.myLastRead=0,i.myCountPreference=e.CountPreference.ALL,i.myPushTriggerOption=e.PushTriggerOption.DEFAULT,i.inviter=null,i.invitedAt=0,i.joinedAt=0,i.pinnedMessageIds=[],i.lastPinnedMessage=null,i._pinnedMessagesUpdatedAt=0,i.channelType=e.ChannelType.GROUP,i.isDistinct=null!==(s=a.is_distinct)&&void 0!==s&&s,i.isSuper=null!==(u=a.is_super)&&void 0!==u&&u,i.isBroadcast=null!==(c=a.is_broadcast)&&void 0!==c&&c,i.isExclusive=null!==(l=a.is_exclusive)&&void 0!==l&&l,i.isPublic=null!==(h=a.is_public)&&void 0!==h&&h,i.isDiscoverable=null!==(d=a.is_discoverable)&&void 0!==d?d:i.isPublic,i.isAccessCodeRequired=null!==(f=a.is_access_code_required)&&void 0!==f&&f,i.isPushEnabled=null!==(p=a.is_push_enabled)&&void 0!==p&&p,Array.isArray(a.members))&&(C=i.members).push.apply(C,_(a.members.map((function(e){return new Jh(i._iid,e)}))));return i.memberCount=null!==(v=a.member_count)&&void 0!==v?v:0,i.joinedMemberCount=null!==(m=a.joined_member_count)&&void 0!==m?m:0,i.hiddenState=M(e.HiddenState,a.hidden_state)?a.hidden_state:e.HiddenState.UNHIDDEN,i.messageOffsetTimestamp=null!==(g=a.ts_message_offset)&&void 0!==g?g:0,i.messageSurvivalSeconds=null!==(y=a.message_survival_seconds)&&void 0!==y?y:-1,i.lastMessage=a.last_message?Li(i._iid,Object.assign({channel_type:i.channelType},a.last_message)):null,a.read_receipt&&Object.keys(a.read_receipt).forEach((function(e){A("number",a.read_receipt[e])&&i._updateUnreadMemberState(e,a.read_receipt[e])})),a.delivery_receipt&&Object.keys(a.delivery_receipt).forEach((function(e){A("number",a.delivery_receipt[e])&&i._updateUndeliveredMemberState(e,a.delivery_receipt[e])})),i.myMemberState=M(e.MemberState,a.member_state)?a.member_state:e.MemberState.NONE,i.myRole=M(e.Role,a.my_role)?a.my_role:e.Role.NONE,M(e.MutedState,a.is_muted)?i.myMutedState=a.is_muted:A("boolean",a.is_muted)?i.myMutedState=a.is_muted?e.MutedState.MUTED:e.MutedState.UNMUTED:i.myMutedState=e.MutedState.UNMUTED,i.myCountPreference=M(e.CountPreference,a.count_preference)?a.count_preference:e.CountPreference.ALL,i.myPushTriggerOption=M(e.PushTriggerOption,a.push_trigger_option)?a.push_trigger_option:e.PushTriggerOption.ALL,i.myLastRead=null!==(k=a.user_last_read)&&void 0!==k?k:0,i.inviter=a.inviter?new Ua(i._iid,a.inviter):null,i.invitedAt=null!==(E=a.invited_at)&&void 0!==E?E:0,i.joinedAt=null!==(b=a.joined_ts)&&void 0!==b?b:0,i._updateUnreadCount(null!==(w=a.unread_message_count)&&void 0!==w?w:0,null!==(x=a.unread_mention_count)&&void 0!==x?x:0),i.pinnedMessageIds=null!==(R=a.pinned_message_ids)&&void 0!==R?R:[],i.lastPinnedMessage=a.latest_pinned_message?Li(i._iid,Object.assign({channel_type:i.channelType},a.latest_pinned_message)):null,i}return a(o,[{key:"isHidden",get:function(){return this.hiddenState!==e.HiddenState.UNHIDDEN}},{key:"isTyping",get:function(){return this._typingStatus.size>0}},{key:"cachedUnreadMemberState",get:function(){var e,t={},n=k(this._unreadMemberStateMap);try{for(n.s();!(e=n.n()).done;){var r=m(e.value,2),a=r[0],i=r[1];t[a]=i}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"cachedUndeliveredMemberState",get:function(){var e,t={},n=k(this._undeliveredMemberStateMap);try{for(n.s();!(e=n.n()).done;){var r=m(e.value,2),a=r[0],i=r[1];t[a]=i}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"_shouldUpdateLastMessageWith",value:function(e){return!(e instanceof bi&&e.parentMessageId>0&&!e.replyToChannel)&&(!this.lastMessage||this.lastMessage.createdAt<e.createdAt||this.lastMessage.createdAt===e.createdAt&&this.lastMessage.messageId===e.messageId&&this.lastMessage.updatedAt<e.updatedAt)}},{key:"_updateUnreadCount",value:function(t,n){if("number"==typeof t&&t>=0)if(this.myCountPreference===e.CountPreference.ALL||this.myCountPreference===e.CountPreference.UNREAD_MESSAGE_COUNT_ONLY)if(this.isExclusive||this.isSuper||this.isBroadcast){var r=Ya.of(this._iid).maxSuperGroupChannelUnreadCount;this.unreadMessageCount=r&&t>=r?r:t}else this.unreadMessageCount=t;else this.unreadMessageCount=0;else this.unreadMessageCount=0;"number"==typeof n&&n>=0&&(this.myCountPreference===e.CountPreference.ALL||this.myCountPreference===e.CountPreference.UNREAD_MENTION_COUNT_ONLY)?this.unreadMentionCount=n:this.unreadMentionCount=0}},{key:"_updateUnreadMemberState",value:function(e,t){var n=this._unreadMemberStateMap.get(e);return(!n||n<t)&&(this._unreadMemberStateMap.set(e,t),Ya.of(this._iid).sdkState.userId===e&&(this.myLastRead=t),!0)}},{key:"_updateUndeliveredMemberState",value:function(e,t){var n=this._undeliveredMemberStateMap.get(e);return(!n||n<t)&&(this._undeliveredMemberStateMap.set(e,t),!0)}},{key:"_updateTypingStatus",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).getTime();t>0?this._typingStatus.set(e.userId,{user:e,ts:t}):this._typingStatus.delete(e.userId)}},{key:"_clearTypingStatus",value:function(){this._typingStatus.clear(),this._typingStarted=0,this._typingEnded=0}},{key:"_setLatestMemberCount",value:function(e,t,n){var r=!1;return n>=this._lastMemberCountUpdated&&(this._lastMemberCountUpdated=n,r=e!==this.memberCount||t!==this.joinedMemberCount,this.memberCount=e,this.joinedMemberCount=t),r}},{key:"isReadMessage",value:function(e){var t=Ya.of(this._iid).sdkState,n=this._unreadMemberStateMap.get(t.userId);return n&&n>=e.createdAt}},{key:"serialize",value:function(){var e=this;return Ia(this,(function(t){t.cachedUnreadMemberState=e.cachedUnreadMemberState,t.cachedUndeliveredMemberState=e.cachedUndeliveredMemberState}))}},{key:"createMessageCollection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Yf(this._iid,Object.assign({channel:this},e))}},{key:"createMemberListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new ip(this._iid,this.url,e)}},{key:"addMember",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=this.members.findIndex((function(e){return e.userId===t.userId}));if(r>-1){var a=this.members[r];a.state===e.MemberState.JOINED&&(t.state=a.state),this.members.splice(r,1),this.memberCount--}this.members.push(t),this.memberCount++,this._updateUnreadMemberState(t.userId,n),this._updateUndeliveredMemberState(t.userId,n)}}},{key:"removeMember",value:function(e){if(!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var t=e instanceof Jh?e.userId:e,n=this.members.findIndex((function(e){return e.userId===t}));if(n>-1)return this.members.splice(n,1),this.memberCount--,!0}return!1}},{key:"getUnreadMemberCount",value:function(t){if(t instanceof bi&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var n,r=Ya.of(this._iid).sdkState,a=t.createdAt,i=0,s=k(this.members);try{for(s.s();!(n=s.n()).done;){var o=n.value;if(r.userId!==o.userId&&o.state===e.MemberState.JOINED&&t.sender.userId!==o.userId)(this.cachedUnreadMemberState[o.userId]||0)<a&&i++}}catch(e){s.e(e)}finally{s.f()}return i}return 0}},{key:"getUndeliveredMemberCount",value:function(t){if(t instanceof bi&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var n,r=Ya.of(this._iid).sdkState,a=t.createdAt,i=0,s=k(this.members);try{for(s.s();!(n=s.n()).done;){var o=n.value;if(r.userId!==o.userId&&o.state===e.MemberState.JOINED&&t.sender.userId!==o.userId)(this.cachedUndeliveredMemberState[o.userId]||0)<a&&i++}}catch(e){s.e(e)}finally{s.f()}return i}return 0}},{key:"getReadMembers",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ya.of(this._iid),a=r.sdkState;if(!a.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var i=e instanceof bi?e.sender:null,s=[];return this.members.forEach((function(r){(n||r.userId!==a.userId&&r.userId!==(null==i?void 0:i.userId))&&(t._unreadMemberStateMap.get(r.userId)>=e.createdAt&&s.push(r))})),s}},{key:"getUnreadMembers",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ya.of(this._iid),a=r.sdkState;if(!a.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var i=e instanceof bi?e.sender:null,s=[];return this.members.forEach((function(r){(n||r.userId!==a.userId&&r.userId!==(null==i?void 0:i.userId))&&(t._unreadMemberStateMap.get(r.userId)<e.createdAt&&s.push(r))})),s}},{key:"getReadStatus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=Ya.of(this._iid),r=n.sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var a={};return this.members.forEach((function(n){if(t||n.userId!==r.userId){var i=e._unreadMemberStateMap.get(n.userId);a[n.userId]=new $h(e._iid,{channel_url:e.url,channel_type:e.channelType,user:Jh.payloadify(n),ts:i})}})),a}},{key:"getTypingUsers",value:function(){var e=[];return this._typingStatus.forEach((function(t){var n=t.user;e.push(n)})),e}},{key:"invalidateTypingStatus",value:function(){var e=this,t=Ya.of(this._iid).typingIndicatorInvalidateTime,n=Date.now(),r=!1;return this._typingStatus.forEach((function(a,i){var s=a.ts;n-s>=t&&(e._typingStatus.delete(i),r=!0)})),r}},{key:"refresh",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Ya.of(this._iid),r=n.requestQueue,a=n.dispatcher,i=new Cd({channelUrl:this.url}),t.next=4,r.send(i);case 4:return s=t.sent,o=s.as(Td),u=o.channel,a.dispatch(new kd({channels:[u],source:e.GroupChannelEventSource.REQUEST_CHANNEL})),t.abrupt("return",u);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"freeze",value:function(){var t=this,n=Object.create(null,{freeze:{get:function(){return v(s(o.prototype),"freeze",t)}}});return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.freeze.call(this);case 2:r=Ya.of(this._iid),r.dispatcher.dispatch(new kd({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_HIDDEN}));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"unfreeze",value:function(){var t=this,n=Object.create(null,{unfreeze:{get:function(){return v(s(o.prototype),"unfreeze",t)}}});return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.unfreeze.call(this);case 2:r=Ya.of(this._iid),r.dispatcher.dispatch(new kd({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_UNHIDDEN}));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"updateChannel",value:function(t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Object.assign(Object.assign({},Zf),t),Aa(Xf(r)).throw(T.invalidParameters),a=Ya.of(this._iid),i=a.dispatcher,s=a.requestQueue,o=new up(Object.assign({channelUrl:this.url},r)),n.next=6,s.send(o);case 6:return u=n.sent,c=u.as(cp),l=c.channel,i.dispatch(new kd({channels:[l],source:e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED})),n.abrupt("return",l);case 10:case"end":return n.stop()}}),n,this)})))}},{key:"invite",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(e.every((function(e){return e instanceof Ua}))).throw(T.invalidParameters),t.abrupt("return",this.inviteWithUserIds(e.map((function(e){return e.userId}))));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"inviteWithUserIds",value:function(t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Aa(O("string",t)).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.dispatcher,i=r.requestQueue,s=new Zd({channelUrl:this.url,userIds:t}),n.next=5,i.send(s);case 5:return o=n.sent,u=o.as(Xd),c=u.channel,a.dispatch(new kd({channels:[c],source:e.GroupChannelEventSource.EVENT_CHANNEL_INVITED})),n.abrupt("return",c);case 9:case"end":return n.stop()}}),n,this)})))}},{key:"join",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Aa(A("string",t)||null===t).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.dispatcher,i=r.sdkState,s=r.requestQueue,o=new Bd({channelUrl:this.url,userId:i.userId,accessCode:t}),n.next=5,s.send(o);case 5:return u=n.sent,c=u.as(Qd),(l=c.channel).myMemberState=this.myMemberState=e.MemberState.JOINED,a.dispatch(new kd({channels:[l],source:e.GroupChannelEventSource.EVENT_CHANNEL_JOINED})),n.abrupt("return",this);case 10:case"end":return n.stop()}}),n,this)})))}},{key:"leave",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Ya.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new Wd({channelUrl:this.url,userId:a.userId,shouldRemoveOperatorStatus:t}),n.next=4,i.send(s);case 4:this.myMemberState=e.MemberState.NONE;case 5:case"end":return n.stop()}}),n,this)})))}},{key:"acceptInvitation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Aa(A("string",t)||null===t).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.dispatcher,i=r.sdkState,s=r.requestQueue,o=new sp({channelUrl:this.url,userId:i.userId,accessCode:t}),n.next=5,s.send(o);case 5:return u=n.sent,c=u.as(op),(l=c.channel).myMemberState=this.myMemberState=e.MemberState.JOINED,a.dispatch(new kd({channels:[l],source:e.GroupChannelEventSource.EVENT_CHANNEL_ACCEPTED_INVITE})),n.abrupt("return",this);case 10:case"end":return n.stop()}}),n,this)})))}},{key:"declineInvitation",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Ya.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new $d({channelUrl:this.url,userId:r.userId}),t.next=4,a.send(i);case 4:return this.myMemberState=e.MemberState.NONE,t.abrupt("return",this);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"sendUserMessage",value:function(t){var n=this,r=new ms,a=Ya.of(this._iid).dispatcher,i=Zo.of(this._iid);return v(s(o.prototype),"sendUserMessage",this).call(this,t).onPending((function(e){i.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)})).onFailed((function(e,t){t&&i.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)})).onSucceeded((function(t){n.hiddenState===e.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE&&(n.hiddenState=e.HiddenState.UNHIDDEN),i.completeCurrentAndProcessNextAutoResend(t),n._shouldUpdateLastMessageWith(t)&&(n.lastMessage=t),Rf.of(n._iid).handlers.map((function(e){return e.onChannelChanged(n)})),a.dispatch(new kd({channels:[n],source:e.GroupChannelEventSource.EVENT_MESSAGE_SENT})),r._trigger(null,t)})),r}},{key:"updateUserMessage",value:function(t,n){var r=this,a=Object.create(null,{updateUserMessage:{get:function(){return v(s(o.prototype),"updateUserMessage",r)}}});return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){var i,s,o,u,c,l=this;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=Ya.of(this._iid),s=i.dispatcher,r.next=3,a.updateUserMessage.call(this,t,n);case 3:return o=r.sent,u=!1,!o.silent&&this._shouldUpdateLastMessageWith(o)&&(this.lastMessage=o,u=!0),c=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===o.messageId&&(this.lastPinnedMessage=o,u=!0,c=!0),u&&(Rf.of(this._iid).handlers.map((function(e){return e.onChannelChanged(l)})),s.dispatch(new kd({channels:[this],source:c?e.GroupChannelEventSource.EVENT_PINNED_MESSAGE_UPDATED:e.GroupChannelEventSource.EVENT_MESSAGE_UPDATED}))),c&&Rf.of(this._iid).handlers.map((function(e){return e.onPinnedMessageUpdated(l)})),s.dispatch(new es({messages:[o],source:e.MessageEventSource.EVENT_MESSAGE_UPDATED})),r.abrupt("return",o);case 12:case"end":return r.stop()}}),r,this)})))}},{key:"_autoResendUserMessage",value:function(t){var n=this,r=new ms,a=Ya.of(this._iid).dispatcher,i=Zo.of(this._iid);return v(s(o.prototype),"_autoResendUserMessage",this).call(this,t).onPending((function(e){i.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)})).onFailed((function(e,t){i.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)})).onSucceeded((function(t){var s=Rf.of(n._iid);i.completeCurrentAndProcessNextAutoResend(t),n._shouldUpdateLastMessageWith(t)&&(n.lastMessage=t),s.handlers.map((function(e){return e.onChannelChanged(n)})),a.dispatch(new kd({channels:[n],source:e.GroupChannelEventSource.EVENT_MESSAGE_SENT})),r._trigger(null,t)})),r}},{key:"sendFileMessage",value:function(t){var n=this,r=new ms,a=Ya.of(this._iid).dispatcher,i=Zo.of(this._iid);return v(s(o.prototype),"sendFileMessage",this).call(this,t).onPending((function(e){i.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)})).onFailed((function(e,t){t&&i.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)})).onSucceeded((function(t){var s=Rf.of(n._iid);i.completeCurrentAndProcessNextAutoResend(t),n._shouldUpdateLastMessageWith(t)&&(n.lastMessage=t),s.handlers.map((function(e){return e.onChannelChanged(n)})),a.dispatch(new kd({channels:[n],source:e.GroupChannelEventSource.EVENT_MESSAGE_SENT})),r._trigger(null,t)})),r}},{key:"updateFileMessage",value:function(t,n){var r=this,a=Object.create(null,{updateFileMessage:{get:function(){return v(s(o.prototype),"updateFileMessage",r)}}});return E(this,void 0,void 0,regeneratorRuntime.mark((function r(){var i,s,o,u,c,l=this;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=Ya.of(this._iid),s=i.dispatcher,r.next=3,a.updateFileMessage.call(this,t,n);case 3:return o=r.sent,u=!1,!o.silent&&this._shouldUpdateLastMessageWith(o)&&(this.lastMessage=o,u=!0),c=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===o.messageId&&(this.lastPinnedMessage=o,u=!0,c=!0),u&&(Rf.of(this._iid).handlers.map((function(e){return e.onChannelChanged(l)})),s.dispatch(new kd({channels:[this],source:c?e.GroupChannelEventSource.EVENT_PINNED_MESSAGE_UPDATED:e.GroupChannelEventSource.EVENT_MESSAGE_UPDATED}))),c&&Rf.of(this._iid).handlers.map((function(e){return e.onPinnedMessageUpdated(l)})),s.dispatch(new es({messages:[o],source:e.MessageEventSource.EVENT_MESSAGE_UPDATED})),r.abrupt("return",o);case 12:case"end":return r.stop()}}),r,this)})))}},{key:"_autoResendFileMessage",value:function(t){var n=this,r=new ms,a=Ya.of(this._iid).dispatcher,i=Zo.of(this._iid);return v(s(o.prototype),"_autoResendFileMessage",this).call(this,t).onPending((function(e){i.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)})).onFailed((function(e,t){i.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)})).onSucceeded((function(t){var s=Rf.of(n._iid);i.completeCurrentAndProcessNextAutoResend(t),n._shouldUpdateLastMessageWith(t)&&(n.lastMessage=t),s.handlers.map((function(e){return e.onChannelChanged(n)})),a.dispatch(new kd({channels:[n],source:e.GroupChannelEventSource.EVENT_MESSAGE_SENT})),r._trigger(null,t)})),r}},{key:"deleteMessage",value:function(t){var n=this,r=Object.create(null,{deleteMessage:{get:function(){return v(s(o.prototype),"deleteMessage",n)}}});return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.deleteMessage.call(this,t);case 2:0===t.messageId&&t instanceof bi&&(a=Ya.of(this._iid),a.dispatcher.dispatch(new ns({reqId:t.reqId,source:e.MessageEventSource.EVENT_MESSAGE_DELETED})));case 3:case"end":return n.stop()}}),n,this)})))}},{key:"hide",value:function(t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c,l,h;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Object.assign(Object.assign({},Jf),t),Aa($f(r)).throw(T.invalidParameters),a=Ya.of(this._iid),i=a.dispatcher,s=a.sdkState,o=a.requestQueue,u=new sf(Object.assign({channelUrl:this.url,userId:s.userId},r)),n.next=6,o.send(u);case 6:return c=n.sent,l=c.as(of),h=l.messageOffsetTimestamp,this.hiddenState=r.allowAutoUnhide?e.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE:e.HiddenState.HIDDEN_PREVENT_AUTO_UNHIDE,r.hidePreviousMessages&&this._updateUnreadCount(0,0),h&&(this.messageOffsetTimestamp=h),i.dispatch(new kd({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_HIDDEN})),n.abrupt("return",this);case 13:case"end":return n.stop()}}),n,this)})))}},{key:"unhide",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Ya.of(this._iid),r=n.dispatcher,a=n.requestQueue,i=new hp({channelUrl:this.url}),t.next=4,a.send(i);case 4:return this.hiddenState=e.HiddenState.UNHIDDEN,r.dispatch(new kd({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_UNHIDDEN})),t.abrupt("return",this);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"delete",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.requestQueue,r=new lp({channelUrl:this.url}),e.next=4,n.send(r);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"markAsRead",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c,l=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Ya.of(this._iid),r=n.sdkState,a=n.dispatcher,i=n.requestQueue,s=new tf({channelUrl:this.url}),t.next=4,i.send(s);case 4:o=t.sent,u=o.as(nf),c=u.readStatus,this._updateUnreadMemberState(r.userId,c.readAt),(this.unreadMessageCount>0||this.unreadMentionCount>0)&&(this._updateUnreadCount(0,0),Rf.of(this._iid).handlers.map((function(e){return e.onChannelChanged(l)}))),a.dispatch(new kd({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_READ}));case 9:case"end":return t.stop()}}),t,this)})))}},{key:"markAsDelivered",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.sdkState,r=t.requestQueue,a=new rf({channelUrl:this.url,userId:n.userId}),e.next=4,r.send(a);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"startTyping",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Ya.of(this._iid),n=t.requestQueue,r=t.typingIndicatorThrottle,(a=(new Date).getTime())-this._typingStarted>=r&&(this._typingStarted=a,this._typingEnded=0,i=new cf({channelUrl:this.url,time:this._typingStarted}),n.send(i));case 3:case"end":return e.stop()}}),e,this)})))}},{key:"endTyping",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Ya.of(this._iid),n=t.requestQueue,r=t.typingIndicatorThrottle,(a=(new Date).getTime())-this._typingEnded>=r&&(this._typingStarted=0,this._typingEnded=a,i=new hf({channelUrl:this.url,time:this._typingStarted}),n.send(i));case 3:case"end":return e.stop()}}),e,this)})))}},{key:"createScheduledUserMessage",value:function(e){e=Object.assign(Object.assign({},Fo),e),Aa(function(e){return bo(e)&&A("number",e.scheduledAt,!0)}(e)).throw(T.invalidParameters);var t=new ms;return this._createScheduledUserMessage(e,t),t}},{key:"updateScheduledUserMessage",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Object.assign(Object.assign({},gp),t),Aa(yp(r)).throw(T.invalidParameters),a=Ya.of(this._iid),i=a.requestQueue,s=new bp(Object.assign({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},r)),n.next=6,i.send(s);case 6:return o=n.sent,u=o.as(xh),c=u.message,n.abrupt("return",c);case 9:case"end":return n.stop()}}),n,this)})))}},{key:"createScheduledFileMessage",value:function(e){var t=this;e=Object.assign(Object.assign({},Ho),e),Aa(function(e){return go(e)&&A("number",e.scheduledAt)&&(L(e.file)||A("string",e.fileUrl))&&A("string",e.fileName,!0)&&A("string",e.mimeType,!0)&&A("number",e.fileSize,!0)&&(null===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return A("object",e)&&e.maxWidth>0&&e.maxHeight>0})))}(e)).throw(T.invalidParameters);var n=Date.now(),r=this._generateRequestId(),a=new ms;return ra(2).then((function(){var i=t._createPendingScheduledFileMessage(e,r,n);sa((function(){return E(t,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a._trigger(null,i));case 1:case"end":return e.stop()}}),e)})))}))})),L(e.file)?this._uploadFileAndUpdateParams(e).then((function(){return t._createScheduledFileMessage(e,a,r,n)})):this._createScheduledFileMessage(e,a,r,n),a}},{key:"updateScheduledFileMessage",value:function(e,t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=Object.assign(Object.assign({},mp),t),Aa(_p(r)).throw(T.invalidParameters),!L(r.file)){n.next=5;break}return n.next=5,this._uploadFileAndUpdateParams(r);case 5:return a=new kp(Object.assign({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},r)),i=Ya.of(this._iid),s=i.requestQueue,n.next=9,s.send(a);case 9:return o=n.sent,u=o.as(Ep),c=u.message,n.abrupt("return",c);case 12:case"end":return n.stop()}}),n,this)})))}},{key:"cancelScheduledMessage",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new wp({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),r=Ya.of(this._iid),a=r.requestQueue,t.next=4,a.send(n);case 4:return t.abrupt("return");case 5:case"end":return t.stop()}}),t,this)})))}},{key:"sendScheduledMessageNow",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new xp({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),r=Ya.of(this._iid),a=r.requestQueue,t.next=4,a.send(n);case 4:return t.abrupt("return");case 5:case"end":return t.stop()}}),t,this)})))}},{key:"getMyPushTriggerOption",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.sdkState,r=t.requestQueue,a=new Tp({userId:n.userId,channelUrl:this.url}),e.next=4,r.send(a);case 4:return i=e.sent,s=i.as(Sp),o=s.pushTriggerOption,this.myPushTriggerOption=o,e.abrupt("return",o);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"setMyPushTriggerOption",value:function(t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Aa(M(e.PushTriggerOption,t)).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.dispatcher,i=r.sdkState,s=r.requestQueue,o=new Rp({userId:i.userId,channelUrl:this.url,pushTriggerOption:t}),n.next=5,s.send(o);case 5:return u=n.sent,c=u.as(Cp),l=c.pushTriggerOption,this.myPushTriggerOption=l,a.dispatch(new kd({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED})),n.abrupt("return",l);case 10:case"end":return n.stop()}}),n,this)})))}},{key:"setMyCountPreference",value:function(t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Aa(M(e.CountPreference,t)).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.dispatcher,i=r.sdkState,s=r.requestQueue,o=new dp({channelUrl:this.url,userId:i.userId,countPreference:t}),n.next=5,s.send(o);case 5:return u=n.sent,c=u.as(fp),l=c.countPreference,this.myCountPreference=l,this._updateUnreadCount(this.unreadMessageCount,this.unreadMentionCount),a.dispatch(new kd({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED})),n.abrupt("return",l);case 11:case"end":return n.stop()}}),n,this)})))}},{key:"resetMyHistory",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Ya.of(this._iid),r=n.dispatcher,a=n.requestQueue,i=new pp({channelUrl:this.url}),t.next=4,a.send(i);case 4:return s=t.sent,o=s.as(vp),u=o.messageOffsetTimestamp,this.messageOffsetTimestamp=u,r.dispatch(new kd({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_RESET_HISTORY})),t.abrupt("return",this);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"pinMessage",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(A("number",e)&&e>0).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.requestQueue,a=new Ip({channelType:this.channelType,channelUrl:this.url,messageId:e}),t.next=5,r.send(a);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"unpinMessage",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(A("number",e)&&e>0).throw(T.invalidParameters),n=Ya.of(this._iid),r=n.requestQueue,a=new Np({channelType:this.channelType,channelUrl:this.url,messageId:e}),t.next=5,r.send(a);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"_uploadFileAndUpdateParams",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c,l,h,d,f;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!L(e.file)){t.next=11;break}return n=Ya.of(this._iid),r=n.requestQueue,a=new ai({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:this._generateRequestId()}),t.next=5,r.send(a);case 5:i=t.sent,s=i.as(ii),o=s.url,u=s.fileSize,c=void 0===u?e.fileSize:u,l=s.thumbnailSizes,h=void 0===l?e.thumbnailSizes:l,d=s.requireAuth,f=void 0!==d&&d,e.fileUrl=o,e.fileSize=c,e.thumbnailSizes=h,e.requireAuth=f;case 11:case"end":return t.stop()}}),t,this)})))}}],[{key:"payloadify",value:function(e){return e?Z(Object.assign(Object.assign({},v(s(o),"payloadify",this).call(this,e)),{is_access_code_required:e.isAccessCodeRequired,is_distinct:e.isDistinct,is_super:e.isSuper,is_broadcast:e.isBroadcast,is_exclusive:e.isExclusive,is_public:e.isPublic,is_discoverable:e.isDiscoverable,is_muted:e.myMutedState,is_push_enabled:e.isPushEnabled,unread_message_count:e.unreadMessageCount,unread_mention_count:e.unreadMentionCount,push_trigger_option:e.myPushTriggerOption,count_preference:e.myCountPreference,hidden_state:e.hiddenState,member_count:e.memberCount,joined_member_count:e.joinedMemberCount,member_state:e.myMemberState,my_role:e.myRole,user_last_read:e.myLastRead,ts_message_offset:e.messageOffsetTimestamp,message_survival_seconds:e.messageSurvivalSeconds,read_receipt:e.cachedUnreadMemberState,delivery_receipt:e.cachedUndeliveredMemberState,members:e.members.map((function(e){return Jh.payloadify(e)})),last_message:Di(e.lastMessage),inviter:e.inviter?Ua.payloadify(e.inviter):null,invited_at:e.invitedAt,joined_ts:e.joinedAt,pinned_message_ids:e.pinnedMessageIds,latest_pinned_message:Di(e.lastPinnedMessage)})):null}}]),o}(Gh),Up={},Op=function(){function t(r){var a=this,i=r._iid,s=r.limit,o=void 0===s?100:s;n(this,t),this._sync=null,this._connectionEventContext=null,this.ref=0,this._metadata=null,this._iid=i,this._limit=o;var u,c=Ya.of(this._iid),l=c.sdkState,h=c.dispatcher,d=c.logger;this._metadataKey=(u=l.userId,"sendbird:".concat(u,"@groupchannel/sync.meta"));var f=function(e){return"sendbird:".concat(e,"@groupchannel/sync")}(l.userId);this._sync=new Cf(f,(function(){return E(a,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={hasNext:!0,nextToken:""},t.next=3,this.loadMetadata();case 3:if(d.debug("channel background sync from",this._metadata.token),this._metadata.completed){t.next=31;break}return t.prev=5,a=Rf.of(this._iid),t.next=9,a.getMyGroupChannels(this._metadata.token,{includeEmpty:!0,order:e.GroupChannelListOrder.CHRONOLOGICAL},this._limit,e.GroupChannelEventSource.SYNC_CHANNEL_BACKGROUND);case 9:return i=t.sent,s=i.channels,o=i.token,n.hasNext=s.length>=this._limit&&!!o,n.nextToken=o,this._metadata.token=o,(r=this._metadata.range).extends.apply(r,_(s.map((function(e){return e.createdAt})))),this._metadata.completed=!n.hasNext,d.debug("channel background sync progress",n),t.next=20,this.saveMetadata();case 20:t.next=29;break;case 22:if(t.prev=22,t.t0=t.catch(5),d.debug("channel background sync error",t.t0),!(t.t0 instanceof T&&t.t0.isInvalidTokenError)){t.next=28;break}return t.next=28,this.clearMetaData();case 28:throw t.t0;case 29:t.next=33;break;case 31:n.hasNext=!1,n.nextToken="";case 33:return t.abrupt("return",n);case 34:case"end":return t.stop()}}),t,this,[[5,22]])})))})),this._connectionEventContext=h.on((function(e){if(e instanceof Or)if(e.stateType===Tr.CONNECTED)a.resume();else a.pause()}))}return a(t,[{key:"range",get:function(){var e;return null===(e=this._metadata)||void 0===e?void 0:e.range}},{key:"completed",get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.completed)}},{key:"loadMetadata",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._metadata){e.next=6;break}return t=Ya.of(this._iid),n=t.cacheContext,e.next=4,n.preference.get(this._metadataKey);case 4:r=e.sent,this._metadata={token:r?r.token:"",range:new bf(r?r.range:{top:Number.MAX_SAFE_INTEGER,bottom:0}),completed:!!r&&r.completed};case 6:return e.abrupt("return",this._metadata);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"saveMetadata",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._metadata){e.next=5;break}return t=Ya.of(this._iid),n=t.cacheContext,e.next=4,n.preference.set(this._metadataKey,this._metadata);case 4:return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"clearMetaData",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.cacheContext,e.next=3,n.preference.remove(this._metadataKey);case 3:this._metadata=null;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"resume",value:function(){var e,t,n=Ya.of(this._iid),r=n.logger;n.connectionManager.isConnected&&(r.debug("channel background sync resume()"),this._sync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.token)&&void 0!==t?t:""))}},{key:"pause",value:function(){Ya.of(this._iid).logger.debug("channel background sync stop()"),this._sync.stop()}},{key:"close",value:function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete Up[this._iid])}}],[{key:"of",value:function(e){return Up[e]||(Up[e]=new t({_iid:e})),Up[e].ref++,Up[e]}},{key:"clear",value:function(e){Up[e]&&(Up[e].close(),delete Up[e])}}]),t}(),Dp={},Lp=function(){function t(r){var a=this,i=r._iid;n(this,t),this._sync=null,this._connectionEventContext=null,this.ref=0,this._metadataKey=null,this._metadata=null,this._iid=i;var s,o=Ya.of(this._iid),u=o.logger,c=o.sdkState,l=o.dispatcher;this._metadataKey=(s=c.userId,"sendbird:".concat(s,"@groupchannel/changelogs.meta"));var h=function(e){return"sendbird:".concat(e,"@groupchannel/changelogs")}(c.userId);this._sync=new Cf(h,(function(){return E(a,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={hasNext:!0,nextToken:0},t.next=3,this.loadMetadata();case 3:return u.debug("channel changelog sync from",this._metadata.token),t.prev=4,r=Rf.of(this._iid),t.next=8,r.getMyGroupChannelChangeLogs(this._metadata.token,{},e.GroupChannelEventSource.SYNC_CHANNEL_CHANGELOGS);case 8:return a=t.sent,i=a.hasMore,s=a.token,n.hasNext=i,n.nextToken=s,this._metadata.token=s,u.debug("channel changelog sync progress",n),t.next=17,this.saveMetadata();case 17:t.next=26;break;case 19:if(t.prev=19,t.t0=t.catch(4),u.debug("channel changelog sync error",t.t0),!(t.t0 instanceof T&&t.t0.isInvalidTokenError)){t.next=25;break}return t.next=25,this.clearMetadata();case 25:throw t.t0;case 26:return t.abrupt("return",n);case 27:case"end":return t.stop()}}),t,this,[[4,19]])})))})),this._connectionEventContext=l.on((function(e){if(e instanceof Or)if(e.stateType===Tr.CONNECTED)a.resume();else a.pause()}))}return a(t,[{key:"loadMetadata",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._metadata){e.next=6;break}return t=Ya.of(this._iid),n=t.cacheContext,r=t.firstConnectedAt,e.next=4,n.preference.get(this._metadataKey);case 4:a=e.sent,this._metadata={token:a?a.token:r};case 6:return e.abrupt("return",this._metadata);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"saveMetadata",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._metadata){e.next=5;break}return t=Ya.of(this._iid),n=t.cacheContext,e.next=4,n.preference.set(this._metadataKey,this._metadata);case 4:return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"clearMetadata",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.cacheContext,e.next=3,n.preference.remove(this._metadataKey);case 3:this._metadata=null;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"resume",value:function(){Ya.of(this._iid).connectionManager.isConnected&&this._sync.start(0)}},{key:"pause",value:function(){this._sync.stop()}},{key:"close",value:function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete Dp[this._iid])}}],[{key:"of",value:function(e){return Dp[e]||(Dp[e]=new t({_iid:e})),Dp[e].ref++,Dp[e]}},{key:"clear",value:function(e){Dp[e]&&(Dp[e].close(),delete Dp[e])}}]),t}(),Pp=function(){function t(r,a){var i=this,s=a.filter,o=a.order,u=a.limit;n(this,t),this.channels=[],this._backgroundSync=null,this._changelogSync=null,this._iid=r,this._key="gcc-".concat(B()),this.filter=null!=s?s:new td,this.order=null!=o?o:e.GroupChannelListOrder.LATEST_LAST_MESSAGE,this._hasMore=!0,this._token="",this._limit=null!=u?u:100;var c=Ya.of(this._iid),l=c.sdkState;c.cacheContext.localCacheEnabled&&(this._backgroundSync=Op.of(r),this._backgroundSync.resume()),this._changelogSync=Lp.of(r),this._changelogSync.resume(),Rf.of(this._iid).subscribeGroupChannelEvent(this._key,{onUpdate:function(e,t){var n=e.filter((function(e){return i.filter.match(e,l.userId)})),r=e.filter((function(e){return!i.filter.match(e,l.userId)})).map((function(e){return e.url}));n.length>0&&i._addChannelsToView(n,t),r.length>0&&i._removeChannelsFromView(r,t)},onRemove:function(e,t){i._removeChannelsFromView(e,t)}})}return a(t,[{key:"hasMore",get:function(){return this._hasMore}},{key:"setGroupChannelCollectionHandler",value:function(e){this._handler=e}},{key:"_addChannelsToView",value:function(t,n){var r,a=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=[],o=[],u=k(t);try{for(u.s();!(r=u.n()).done;){var c=r.value,l=Pf(this.channels,c,this.order),h=l.place,d=l.contains;if(d)switch(o.push(c),n){case e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED:case e.GroupChannelEventSource.EVENT_MESSAGE_RECEIVED:this.channels.splice(h,1);var f=Pf(this.channels,c,this.order),p=f.place;this.channels.splice(p,0,c);break;default:this.channels[h]=c}else h===this.channels.length?(i||!this._backgroundSync||this._backgroundSync.completed)&&(s.push(c),this.channels.push(c)):(s.push(c),this.channels.splice(h,0,c))}}catch(e){u.e(e)}finally{u.f()}yd(n)&&sa((function(){return E(a,void 0,void 0,regeneratorRuntime.mark((function e(){var t,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new Tf(n),s.length>0&&(null===(t=this._handler)||void 0===t?void 0:t.onChannelsAdded)&&this._handler.onChannelsAdded(a,s),o.length>0&&(null===(r=this._handler)||void 0===r?void 0:r.onChannelsUpdated)&&this._handler.onChannelsUpdated(a,o);case 3:case"end":return e.stop()}}),e,this)})))}))}},{key:"_removeChannelsFromView",value:function(e,t){var n,r=this,a=[],i=k(e);try{var s=function(){var e=n.value,t=r.channels.findIndex((function(t){return t.url===e}));t>=0&&(a.push(r.channels[t].url),r.channels.splice(t,1))};for(i.s();!(n=i.n()).done;)s()}catch(e){i.e(e)}finally{i.f()}return yd(t)&&a.length>0&&sa((function(){return E(r,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Tf(t),(null===(n=this._handler)||void 0===n?void 0:n.onChannelsDeleted)&&this._handler.onChannelsDeleted(r,a);case 2:case"end":return e.stop()}}),e,this)})))})),a}},{key:"_getLocalChannels",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Rf.of(this._iid),n=this.channels.length>0?Df(this.channels[this.channels.length-1],this.order):null,e.next=4,t.getChannelsFromCache(n,this.filter,this.order,this._limit);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"_getRemoteChannels",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Rf.of(this._iid),e.next=3,t.getMyGroupChannels(this._token,Object.assign(Object.assign({},this.filter),{order:this.order}),this._limit);case 3:return n=e.sent,r=n.channels,a=n.token,this._token=a,this._hasMore=!!a,e.abrupt("return",r);case 9:case"end":return e.stop()}}),e,this)})))}},{key:"loadMore",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._hasMore){t.next=8;break}return n=[],t.next=4,oa((function(){return E(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getLocalChannels();case 2:n=e.sent;case 3:case"end":return e.stop()}}),e,this)})))}));case 4:return t.next=6,oa((function(){return E(r,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getRemoteChannels();case 2:n=e.sent;case 3:case"end":return e.stop()}}),e,this)})))}));case 6:return this._addChannelsToView(n,e.GroupChannelEventSource.REQUEST_CHANNEL,!0),t.abrupt("return",n);case 8:return t.abrupt("return",[]);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){var e,t;null===(e=this._backgroundSync)||void 0===e||e.close(),null===(t=this._changelogSync)||void 0===t||t.close(),Rf.of(this._iid).unsubscribeGroupChannelEvent(this._key)}}]),t}(),Fp=function(t){i(s,t);var r=f(s);function s(t){var a;n(this,s);var i=t.token,o=t.limit,u=t.order,c=t.includeEmpty,l=t.membershipFilter,h=t.channelNameContainsFilter,d=t.channelUrlsFilter,f=t.customTypesFilter,p=t.customTypeStartsWithFilter,v=t.superChannelFilter,m=t.metadataOrderKeyFilter,_=t.metadataKey,g=t.metadataValues,y=t.metadataValueStartsWith,k=t.includeFrozen,E=t.includeMetaData;return(a=r.call(this)).method=R.GET,a.path=qr,a.params=Z({token:i,limit:o,order:u,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:c,public_mode:e.PublicChannelFilter.PUBLIC,public_membership_mode:l,name_contains:h,channel_urls:d,custom_types:f,custom_type_startswith:p,super_mode:v,metadata_order_key:m,metadata_key:_,metadata_values:g,metadata_value_startswith:y,show_frozen:k,show_metadata:E}),a}return a(s)}(J),Hp=function(e){i(r,e);var t=f(r);function r(e,a){var i;n(this,r),(i=t.call(this,e,a)).token=null,i.channels=[],i.ts=null;var s=a.next,o=a.channels,u=a.ts;return i.token=s,o&&o.length>0&&(i.channels=o.map((function(t){return t.ts=u,new Mp(e,t)}))),i.ts="number"==typeof u?u:null,i}return a(r)}($);e.MembershipFilter=void 0,(Ap=e.MembershipFilter||(e.MembershipFilter={})).ALL="all",Ap.JOINED="joined";var Gp=function(t){i(o,t);var r=f(o);function o(t,a){var i,s,u,c,l,h,d,f,p,v,m,_,g,y,k;return n(this,o),(i=r.call(this,t,a)).includeEmpty=!1,i.includeFrozen=!0,i.includeMetaData=!0,i.channelUrlsFilter=null,i.customTypesFilter=null,i.customTypeStartsWithFilter=null,i.channelNameContainsFilter=null,i.membershipFilter=e.MembershipFilter.ALL,i.superChannelFilter=e.SuperChannelFilter.ALL,i.metadataKey=null,i.metadataValues=null,i.metadataOrderKeyFilter=null,i.metadataValueStartsWith=null,i.order=e.PublicGroupChannelListOrder.CHRONOLOGICAL,i.includeEmpty=null!==(s=a.includeEmpty)&&void 0!==s&&s,i.includeFrozen=null===(u=a.includeFrozen)||void 0===u||u,i.includeMetaData=null===(c=a.includeMetaData)||void 0===c||c,i.channelUrlsFilter=null!==(l=a.channelUrlsFilter)&&void 0!==l?l:null,i.customTypesFilter=null!==(h=a.customTypesFilter)&&void 0!==h?h:null,i.customTypeStartsWithFilter=null!==(d=a.customTypeStartsWithFilter)&&void 0!==d?d:null,i.channelNameContainsFilter=null!==(f=a.channelNameContainsFilter)&&void 0!==f?f:null,i.membershipFilter=null!==(p=a.membershipFilter)&&void 0!==p?p:e.MembershipFilter.ALL,i.superChannelFilter=null!==(v=a.superChannelFilter)&&void 0!==v?v:e.SuperChannelFilter.ALL,i.metadataKey=null!==(m=a.metadataKey)&&void 0!==m?m:null,i.metadataValues=null!==(_=a.metadataValues)&&void 0!==_?_:null,i.metadataOrderKeyFilter=null!==(g=a.metadataOrderKeyFilter)&&void 0!==g?g:null,i.metadataValueStartsWith=null!==(y=a.metadataValueStartsWith)&&void 0!==y?y:null,i.order=null!==(k=a.order)&&void 0!==k?k:e.PublicGroupChannelListOrder.CHRONOLOGICAL,i}return a(o,[{key:"_validate",value:function(){return v(s(o.prototype),"_validate",this).call(this)&&A("boolean",this.includeEmpty)&&A("boolean",this.includeFrozen)&&A("boolean",this.includeMetaData)&&A("string",this.channelNameContainsFilter,!0)&&O("string",this.channelUrlsFilter,!0)&&O("string",this.customTypesFilter,!0)&&A("string",this.customTypeStartsWithFilter,!0)&&M(e.MembershipFilter,this.membershipFilter)&&M(e.SuperChannelFilter,this.superChannelFilter)&&M(e.PublicGroupChannelListOrder,this.order)&&A("string",this.metadataOrderKeyFilter,!0)&&A("string",this.metadataKey,!0)&&O("string",this.metadataValues,!0)&&A("string",this.metadataValueStartsWith,!0)}},{key:"next",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._validate()){t.next=22;break}if(this._isLoading){t.next=19;break}if(n=[],!this._hasNext){t.next=16;break}return this._isLoading=!0,r=Ya.of(this._iid),a=r.requestQueue,i=r.dispatcher,s=new Fp(Object.assign(Object.assign({},this),{token:this._token})),t.next=9,a.send(s);case 9:return o=t.sent,u=o.as(Hp),c=u.channels,l=u.token,this._token=l,this._hasNext=!!l,i.dispatch(new kd({channels:c,source:e.GroupChannelEventSource.REQUEST_CHANNEL})),this._isLoading=!1,t.abrupt("return",c);case 16:return t.abrupt("return",n);case 19:throw T.queryInProgress;case 20:t.next=23;break;case 22:throw T.invalidParameters;case 23:case"end":return t.stop()}}),t,this)})))}}]),o}(ks),qp=a((function e(){n(this,e),this.onUserMuted=se,this.onUserUnmuted=se,this.onUserBanned=se,this.onUserUnbanned=se,this.onChannelChanged=se,this.onChannelDeleted=se,this.onChannelFrozen=se,this.onChannelUnfrozen=se,this.onOperatorUpdated=se,this.onChannelMemberCountChanged=se,this.onMetaDataCreated=se,this.onMetaDataUpdated=se,this.onMetaDataDeleted=se,this.onMetaCounterCreated=se,this.onMetaCounterUpdated=se,this.onMetaCounterDeleted=se,this.onMessageReceived=se,this.onMessageUpdated=se,this.onMessageDeleted=se,this.onMentionReceived=se,this.onReactionUpdated=se,this.onThreadInfoUpdated=se})),jp=function(e){i(r,e);var t=f(r);function r(){var e;return n(this,r),(e=t.apply(this,arguments)).onUserJoined=se,e.onUserLeft=se,e.onUserReceivedInvitation=se,e.onUserDeclinedInvitation=se,e.onChannelHidden=se,e.onUnreadMemberStatusUpdated=se,e.onUndeliveredMemberStatusUpdated=se,e.onTypingStatusUpdated=se,e.onPollUpdated=se,e.onPollVoted=se,e.onPollDeleted=se,e.onPinnedMessageUpdated=se,e}return a(r)}(qp),zp=function(e){i(r,e);var t=f(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,r),e=t.call(this),Object.keys(a).forEach((function(t){e.hasOwnProperty(t)&&(e[t]=a[t])})),e}return a(r)}(jp),Vp=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.token,s=e.limit,o=e.order,u=e.reverse,c=e.channelUrl,l=e.messageTypeFilter,h=e.scheduledStatus;return(a=t.call(this)).method=R.GET,a.path="".concat(Zr),a.params=Z({limit:s,reverse:u,channel_url:c,order:o,status:h}),i&&(a.params.token=i),l&&(a.params.message_type=l),a}return a(r)}(J),Bp=function(e){i(r,e);var t=f(r);function r(e,a){var i;n(this,r),(i=t.call(this,e,a)).token=null,i.scheduledMessages=[];var s=a.next,o=a.scheduled_messages;return i.token=s,i.scheduledMessages=o.map((function(t){return Li(e,t)})),i}return a(r)}($),Qp=function(t){i(o,t);var r=f(o);function o(t,a){var i,s,u,c,l,h;return n(this,o),(i=r.call(this,t,a)).channelUrl=null,i.order=null,i.reverse=!1,i.scheduledStatus=null,i.messageTypeFilter=e.MessageTypeFilter.ALL,i.channelUrl=null!==(s=a.channelUrl)&&void 0!==s?s:null,i.order=null!==(u=a.order)&&void 0!==u?u:null,i.reverse=null!==(c=a.reverse)&&void 0!==c&&c,i.scheduledStatus=null!==(l=a.scheduledStatus)&&void 0!==l?l:null,i.messageTypeFilter=null!==(h=a.messageTypeFilter)&&void 0!==h?h:e.MessageTypeFilter.ALL,i}return a(o,[{key:"_validate",value:function(){return v(s(o.prototype),"_validate",this).call(this)&&A("string",this.channelUrl,!0)&&(M(e.ScheduledMessageListOrder,this.order)||null===this.order)&&A("boolean",this.reverse)&&(O(e.ScheduledStatus,this.scheduledStatus)||null===this.scheduledStatus)&&M(e.MessageTypeFilter,this.messageTypeFilter)}},{key:"next",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,t=Ya.of(this._iid),n=t.requestQueue,r=new Vp(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,n.send(r);case 8:return a=e.sent,i=a.as(Bp),s=i.scheduledMessages,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,e.abrupt("return",s);case 14:return e.abrupt("return",[]);case 17:throw T.queryInProgress;case 18:e.next=21;break;case 20:throw T.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),o}(ks),Kp=function(e){i(r,e);var t=f(r);function r(){var e;return n(this,r),(e=t.apply(this,arguments)).name="groupChannel",e}return a(r,[{key:"init",value:function(e,t){var n=t.sdkState,a=t.dispatcher,i=t.sessionManager,o=t.requestQueue,u=t.logger,c=t.onlineDetector,l=t.cacheContext;v(s(r.prototype),"init",this).call(this,e,{sdkState:n,dispatcher:a,sessionManager:i,requestQueue:o,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Rf(e,{sdkState:n,cacheContext:l,dispatcher:a,sessionManager:i,requestQueue:o,logger:u})}},{key:"createGroupChannelCollection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Pp(this._iid,e)}},{key:"createMyGroupChannelListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Ef(this._iid,e)}},{key:"createPublicGroupChannelListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Gp(this._iid,e)}},{key:"createScheduledMessageListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Qp(this._iid,e)}},{key:"addGroupChannelHandler",value:function(e,t){Aa(A("string",e)&&t instanceof zp).throw(T.invalidParameters),this._manager.addHandler(e,t)}},{key:"removeGroupChannelHandler",value:function(e){Aa(A("string",e)).throw(T.invalidParameters),this._manager.removeHandler(e)}},{key:"removeAllGroupChannelHandlers",value:function(){this._manager.clearHandler()}},{key:"buildGroupChannelFromSerializedData",value:function(e){return this._manager.buildGroupChannelFromSerializedData(e)}},{key:"buildGroupChannelListQueryFromSerializedData",value:function(e){return this._manager.buildGroupChannelListQueryFromSerializedData(e)}},{key:"buildMemberFromSerializedData",value:function(e){return this._manager.buildMemberFromSerializedData(e)}},{key:"getChannel",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(A("string",e)).throw(T.invalidParameters),t.abrupt("return",this._manager.getChannel(e));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"getChannelWithoutCache",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(A("string",e)).throw(T.invalidParameters),t.abrupt("return",this._manager.getChannelWithoutCache(e));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"getMyGroupChannelChangeLogsByToken",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Object.assign(Object.assign({},od),t),Aa(A("string",e)&&ud(r)).throw(T.invalidParameters),n.next=4,this._manager.getMyGroupChannelChangeLogs(e,r);case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}}),n,this)})))}},{key:"getMyGroupChannelChangeLogsByTimestamp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Object.assign(Object.assign({},od),t),Aa(A("number",e)&&ud(r)).throw(T.invalidParameters),n.next=4,this._manager.getMyGroupChannelChangeLogs(e,r);case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}}),n,this)})))}},{key:"getGroupChannelCount",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object.assign(Object.assign({},cd),e),Aa(ld(n)).throw(T.invalidParameters),t.abrupt("return",this._manager.getGroupChannelCount(n));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"getUnreadItemCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._manager.getUnreadItemCount(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"getTotalUnreadChannelCount",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._manager.getTotalUnreadChannelCount();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"getTotalUnreadMessageCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._manager.getTotalUnreadMessageCount(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"getTotalScheduledMessageCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._manager.getTotalScheduledMessageCount(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"getSubscribedTotalUnreadMessageCount",value:function(){return this._manager.getSubscribedTotalUnreadMessageCount()}},{key:"getSubscribedCustomTypeTotalUnreadMessageCount",value:function(){return this._manager.getSubscribedCustomTypeTotalUnreadMessageCount()}},{key:"getSubscribedCustomTypeUnreadMessageCount",value:function(e){return this._manager.getSubscribedCustomTypeUnreadMessageCount(e)}},{key:"createChannel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object.assign(Object.assign({},id),e),Aa(sd(n)).throw(T.invalidParameters),t.abrupt("return",this._manager.createChannel(n));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"createDistinctChannelIfNotExist",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object.assign(Object.assign({},id),e),Aa(sd(n)).throw(T.invalidParameters),n&&(n.isDistinct=!0),t.abrupt("return",this.createChannel(n));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"createChannelWithUserIds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";return E(this,void 0,void 0,regeneratorRuntime.mark((function s(){var o;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return o=Object.assign(Object.assign({},id),{invitedUserIds:e,isDistinct:t,name:n,data:a,customType:i}),"string"==typeof r?o.coverUrl=r:o.coverImage=r,s.abrupt("return",this.createChannel(o));case 3:case"end":return s.stop()}}),s,this)})))}},{key:"markAsReadAll",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._manager.markAsReadAll();case 1:case"end":return e.stop()}}),e,this)})))}},{key:"markAsReadWithChannelUrls",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Aa(O("string",e)).throw(T.invalidParameters),this._manager.markAsReadWithChannelUrls(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"markAsDelivered",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(A("string",e)).throw(T.invalidParameters),t.next=3,this.getChannel(e);case 3:return n=t.sent,t.next=6,n.markAsDelivered();case 6:case"end":return t.stop()}}),t,this)})))}}]),r}(ri),Wp=function(e){i(r,e);var t=f(r);function r(){var e;return n(this,r),(e=t.apply(this,arguments))._channels=new Map,e._enteredChannelUrls=[],e}return a(r,[{key:"enteredChannels",get:function(){var e=this;return this._enteredChannelUrls.map((function(t){return e._channels.get(t)})).filter((function(e){return null!==e}))}},{key:"isEnteredChannel",value:function(e){return this._enteredChannelUrls.includes(e)}},{key:"enter",value:function(e){this._enteredChannelUrls.indexOf(e)<0&&this._enteredChannelUrls.push(e)}},{key:"exit",value:function(e){var t=this._enteredChannelUrls.indexOf(e);t>=0&&this._enteredChannelUrls.splice(t,1)}},{key:"exitAll",value:function(){this._enteredChannelUrls=[]}},{key:"get",value:function(e){var t;return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",null!==(t=this._channels.get(e))&&void 0!==t?t:null);case 1:case"end":return n.stop()}}),n,this)})))}},{key:"upsert",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.forEach((function(e){if(n._channels.has(e.url)){var t=n._channels.get(e.url);Object.assign(t,e)}else n._channels.set(e.url,e)}));case 1:case"end":return t.stop()}}),t)})))}},{key:"remove",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._channels.delete(e),this.exit(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._channels.clear(),this._enteredChannelUrls=[];case 2:case"end":return e.stop()}}),e,this)})))}}]),r}(ba),Yp={channelUrl:null,name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},Zp=function(e){return O("string",e.operatorUserIds,!0)&&(A("string",e.coverUrlOrImage)||L(e.coverUrlOrImage)||null===e.coverUrlOrImage)&&A("string",e.name,!0)&&A("string",e.data,!0)&&A("string",e.customType,!0)&&(A("string",e.channelUrl)&&/^\w+$/.test(e.channelUrl)||null===e.channelUrl)},Xp=function(e){i(r,e);var t=f(r);function r(e){var a,i=e.channelUrl,s=e.isInternalCall;return n(this,r),(a=t.call(this)).method=R.GET,a.path="".concat(s?Vr:zr,"/").concat(encodeURIComponent(i)),a}return a(r)}(J),Jp=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).channel=null,i.channel=new pv(e,a),i}return a(r)}($),$p=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.coverUrlOrImage,o=e.name,u=e.data,c=e.customType,l=e.operatorUserIds;return(a=t.call(this)).method=R.POST,a.path=zr,a.params=Z({channel_url:i,cover_url:A("string",s)?s:null,cover_file:L(s)?s:null,name:o,data:u,custom_type:c,operators:l}),a}return a(r)}(J),ev=function(e){i(r,e);var t=f(r);function r(e){var a=e.channelUrl;return n(this,r),t.call(this,{code:"ENTR",payload:{channel_url:a},ackRequired:!0})}return a(r)}(Ir),tv=function(e){i(r,e);var t=f(r);function r(e,a,i){var s,o,u;return n(this,r),s=t.call(this,e,"SYEV",i),i.data&&(s.participantCount=null!==(o=i.data.participant_count)&&void 0!==o?o:0,s.user=new Ua(e,i.data),s.ts=null!==(u=i.data.edge_ts)&&void 0!==u?u:0),s}return a(r)}(Vd),nv=function(e){i(r,e);var t=f(r);function r(e){var a=e.channelUrl;return n(this,r),t.call(this,{code:"EXIT",payload:{channel_url:a},ackRequired:!0})}return a(r)}(Ir),rv=function(e){i(r,e);var t=f(r);function r(e,a,i){var s,o,u;return n(this,r),s=t.call(this,e,"EXIT",i),i.data&&(s.participantCount=null!==(o=i.data.participant_count)&&void 0!==o?o:0,s.user=new Ua(e,i.data),s.ts=null!==(u=i.data.edge_ts)&&void 0!==u?u:0),s}return a(r)}(Vd),av={},iv=function(){function t(e,r){var a=this,i=r.sdkState,s=r.dispatcher,o=r.requestQueue;return n(this,t),av[e]||(this._iid=e,this._sdkState=i,this._requestQueue=o,this._dispatcher=s,this._openChannelCache=new Wp(e),this._openChannelHandlers=new Map,this._dispatcher.on((function(e){if(e instanceof ie)a._handleEvent(e);else if(e instanceof Or&&e.stateType===Tr.CONNECTED){var t,n=k(a._openChannelCache.enteredChannels);try{for(n.s();!(t=n.n()).done;){t.value.enter()}}catch(e){n.e(e)}finally{n.f()}}})),av[e]=this),av[e]}return a(t,[{key:"buildOpenChannelFromSerializedData",value:function(e){var t=Na(e);return new pv(this._iid,pv.payloadify(t))}},{key:"getChannelFromCache",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._openChannelCache.get(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"upsertChannelsToCache",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._openChannelCache.upsert(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"removeChannelsFromCache",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=k(e),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=9;break}return a=r.value,t.next=7,this._openChannelCache.remove(a);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),n.e(t.t0);case 14:return t.prev=14,n.f(),t.finish(14);case 17:case"end":return t.stop()}}),t,this,[[1,11,14,17]])})))}},{key:"setEnteredToCache",value:function(e){this._openChannelCache.enter(e.url)}},{key:"setExitedToCache",value:function(e){this._openChannelCache.exit(e.url)}},{key:"_handleEvent",value:function(t){return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s,o,u,c,l,h,d,f,p,v,m,_,g,y,b,w,x,R,T,S,I,N,A,M,U,O,D,L,P,F,H,G,q,j,z,V,B,Q,K,W,Y,Z,X,J,$,ee,te,ne,re,ae,ie,se,oe,ue,ce,le,he,de,fe,pe,ve,me,_e,ge,ye,ke,Ee,be,we,xe,Re,Ce,Te,Se,Ie,Ne,Ae,Me,Ue,Oe=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:n.prev=0,n.t0=t.code,n.next="MESG"===n.t0||"FILE"===n.t0||"ADMM"===n.t0||"BRDM"===n.t0?4:"MEDI"===n.t0||"FEDI"===n.t0||"AEDI"===n.t0?14:"DELM"===n.t0?24:"MRCT"===n.t0?31:"MTHD"===n.t0?38:"MCNT"===n.t0?45:"PEDI"===n.t0?72:"VOTE"===n.t0?81:"SYEV"===n.t0?90:167;break;case 4:if(r=null,"MESG"===t.code?r=t.as(lh):"FILE"===t.code?r=t.as(Vi):"ADMM"!==t.code&&"BRDM"!=t.code||(r=t.as(mf)),!r){n.next=13;break}if(i=(a=r).message,s=a.isMentioned,i.channelType!==e.ChannelType.OPEN){n.next=13;break}return n.next=11,this.getChannel(i.channelUrl,!0);case 11:o=n.sent,sa((function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._openChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)r=n.value,this._openChannelCache.isEnteredChannel(o.url)&&(r.onMessageReceived(o,i),s&&r.onMentionReceived(o,i))}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 13:return n.abrupt("break",167);case 14:if(u=null,"MEDI"===t.code?u=t.as(dh):"FEDI"===t.code?u=t.as(ph):"AEDI"===t.code&&(u=t.as(_f)),!u){n.next=23;break}if(l=(c=u).message,h=c.mentionCountChange,l.channelType!==e.ChannelType.OPEN){n.next=23;break}return n.next=21,this.getChannel(l.channelUrl,!0);case 21:d=n.sent,sa((function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._openChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)r=n.value,this._openChannelCache.isEnteredChannel(d.url)&&(r.onMessageUpdated(d,l),h>0&&r.onMentionReceived(d,l))}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 23:return n.abrupt("break",167);case 24:if(f=t.as(mh),p=f.channelUrl,v=f.channelType,m=f.messageId,v!==e.ChannelType.OPEN){n.next=30;break}return n.next=28,this.getChannel(p,!0);case 28:_=n.sent,sa((function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._openChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)r=n.value,this._openChannelCache.isEnteredChannel(_.url)&&r.onMessageDeleted(_,m)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 30:return n.abrupt("break",167);case 31:if(g=t.as(gf),y=g.channelUrl,b=g.channelType,w=g.event,b!==e.ChannelType.OPEN){n.next=37;break}return n.next=35,this.getChannel(y,!0);case 35:x=n.sent,sa((function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._openChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)r=n.value,this._openChannelCache.isEnteredChannel(x.url)&&r.onReactionUpdated(x,w)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 37:return n.abrupt("break",167);case 38:if(R=t.as(yf),(T=R.event).channelType!==e.ChannelType.OPEN){n.next=44;break}return n.next=42,this.getChannel(T.channelUrl,!0);case 42:S=n.sent,sa((function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._openChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)r=n.value,this._openChannelCache.isEnteredChannel(S.url)&&r.onThreadInfoUpdated(S,T)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 44:return n.abrupt("break",167);case 45:I=t.as(pf),N=I.openChannelMemberCounts,A=[],M=k(N),n.prev=48,M.s();case 50:if((U=M.n()).done){n.next=59;break}return O=U.value,D=O.channelUrl,L=O.participantCount,P=O.updatedAt,n.next=55,this.getChannelFromCache(D);case 55:(F=n.sent)&&F._updateParticipantCount(L,P)&&A.push(F);case 57:n.next=50;break;case 59:n.next=64;break;case 61:n.prev=61,n.t1=n.catch(48),M.e(n.t1);case 64:return n.prev=64,M.f(),n.finish(64);case 67:if(!(A.length>0)){n.next=71;break}return n.next=70,this.upsertChannelsToCache(A);case 70:sa((function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._openChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onChannelMemberCountChanged(A)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 71:return n.abrupt("break",167);case 72:if(H=t.as(kf),G=H.event,q=H.status,j=H.channelUrl,z=H.channelType,j&&z){n.next=75;break}return n.abrupt("break",167);case 75:return n.next=77,this.getChannel(j,!0);case 77:return V=n.sent,this._dispatcher.dispatch(new as({event:G,source:e.MessageEventSource.EVENT_POLL_UPDATED})),sa(q===Ii?function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._openChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onPollDeleted(V,G.pollId)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}:function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._openChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onPollUpdated(V,G)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))}),n.abrupt("break",167);case 81:if(B=t.as(Hh),Q=B.event,K=B.channelUrl,W=B.channelType,K&&W){n.next=84;break}return n.abrupt("break",167);case 84:return n.next=86,this.getChannel(K,!0);case 86:return Y=n.sent,this._dispatcher.dispatch(new is({event:Q,source:e.MessageEventSource.EVENT_POLL_VOTED})),sa((function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(this._openChannelHandlers.values());try{for(t.s();!(n=t.n()).done;)n.value.onPollVoted(Y,Q)}catch(e){t.e(e)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",167);case 90:if(Z=t.as(Vd),!(X=Z.event).isOpenChannelEvent){n.next=166;break}n.t2=X.category,n.next=n.t2===ed.CHANNEL_ENTER?95:n.t2===ed.CHANNEL_EXIT?102:n.t2===ed.CHANNEL_OPERATOR_UPDATE?109:n.t2===ed.USER_CHANNEL_MUTE||n.t2===ed.USER_CHANNEL_UNMUTE?117:n.t2===ed.USER_CHANNEL_BAN||n.t2===ed.USER_CHANNEL_UNBAN?124:n.t2===ed.CHANNEL_FREEZE||n.t2===ed.CHANNEL_UNFREEZE?131:n.t2===ed.CHANNEL_DELETED?139:n.t2===ed.CHANNEL_PROP_CHANGED?146:n.t2===ed.CHANNEL_META_DATA_CHANGED?151:n.t2===ed.CHANNEL_META_COUNTERS_CHANGED?160:166;break;case 95:return n.next=97,this.getChannel(X.channelUrl,!0);case 97:return J=n.sent,$=t.as(tv),ee=$.participantCount,te=$.user,ne=J._updateParticipantCount(ee,X.ts),sa((function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){e.onUserEntered(J,te),ne&&e.onChannelParticipantCountChanged(J)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",166);case 102:return n.next=104,this.getChannel(X.channelUrl,!0);case 104:return re=n.sent,ae=t.as(rv),ie=ae.participantCount,se=ae.user,oe=re._updateParticipantCount(ie,X.ts),sa((function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){e.onUserExited(re,se),oe&&e.onChannelParticipantCountChanged(re)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",166);case 109:return n.next=111,this.getChannel(X.channelUrl,!0);case 111:return ue=n.sent,ce=t.as(ff),le=ce.operators,ue.operators=le,this.upsertChannelsToCache([ue]),sa((function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){e.onOperatorUpdated(ue,le)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",166);case 117:return n.next=119,this.getChannel(X.channelUrl,!0);case 119:return he=n.sent,de=X.category===ed.USER_CHANNEL_MUTE,fe=t.as(de?Xl:$l),pe=fe.user,sa((function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){de?e.onUserMuted(he,pe):e.onUserUnmuted(he,pe)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",166);case 124:return n.next=126,this.getChannel(X.channelUrl,!0);case 126:return ve=n.sent,me=X.category===ed.USER_CHANNEL_BAN,_e=t.as(me?th:rh),ge=_e.user,sa((function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){me?e.onUserBanned(ve,ge):e.onUserUnbanned(ve,ge)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",166);case 131:return n.next=133,this.getChannel(X.channelUrl,!0);case 133:return ye=n.sent,ke=t.as(ih),Ee=ke.freeze,ye.isFrozen=Ee,this.upsertChannelsToCache([ye]),sa((function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){Ee?e.onChannelFrozen(ye):e.onChannelUnfrozen(ye)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",166);case 139:return n.next=141,this.getChannel(X.channelUrl,!0);case 141:return be=n.sent,n.next=144,this.removeChannelsFromCache([be.url]);case 144:return sa((function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){e.onChannelDeleted(be.url,be.channelType)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",166);case 146:return n.next=148,this.getChannelWithoutCache(X.channelUrl,!0);case 148:return we=n.sent,sa((function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){e.onChannelChanged(we)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",166);case 151:return n.next=153,this.getChannel(X.channelUrl,!0);case 153:return xe=n.sent,Re=t.as(Ll),Ce=Re.created,Te=Re.updated,Se=Re.deleted,Ce&&xe._upsertCachedMetaData(Ce,X.ts),Te&&xe._upsertCachedMetaData(Te,X.ts),Se&&xe._removeFromCachedMetaData(Se,X.ts),sa((function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){Ce&&e.onMetaDataCreated(xe,Ce),Te&&e.onMetaDataUpdated(xe,Te),Se&&e.onMetaDataDeleted(xe,Se)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",166);case 160:return n.next=162,this.getChannel(X.channelUrl,!0);case 162:return Ie=n.sent,Ne=t.as(Kl),Ae=Ne.created,Me=Ne.updated,Ue=Ne.deleted,sa((function(){return E(Oe,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){Ae&&e.onMetaCounterCreated(Ie,Ae),Me&&e.onMetaCounterUpdated(Ie,Me),Ue&&e.onMetaCounterDeleted(Ie,Ue)}));case 1:case"end":return e.stop()}}),e,this)})))})),n.abrupt("break",166);case 166:return n.abrupt("break",167);case 167:n.next=173;break;case 169:if(n.prev=169,n.t3=n.catch(0),!C(n.t3)){n.next=173;break}throw n.t3;case 173:case"end":return n.stop()}}),n,this,[[0,169],[48,61,64,67]])})))}},{key:"addHandler",value:function(e,t){this._openChannelHandlers.set(e,t)}},{key:"removeHandler",value:function(e){this._openChannelHandlers.delete(e)}},{key:"clearHandler",value:function(){this._openChannelHandlers.clear()}},{key:"getChannel",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Aa(A("string",e)).throw(T.invalidParameters),t.prev=1,t.next=4,this.getChannelFromCache(e);case 4:if(!(n=t.sent)){t.next=7;break}return t.abrupt("return",n);case 7:t.next=11;break;case 9:t.prev=9,t.t0=t.catch(1);case 11:return t.next=13,this.getChannelWithoutCache(e);case 13:return t.abrupt("return",t.sent);case 14:case"end":return t.stop()}}),t,this,[[1,9]])})))}},{key:"getChannelWithoutCache",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return E(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a,i,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Aa(A("string",e)).throw(T.invalidParameters),r=new Xp({channelUrl:e,isInternalCall:t}),n.next=4,this._requestQueue.send(r);case 4:return a=n.sent,i=a.as(Jp),s=i.channel,n.next=8,this.upsertChannelsToCache([s]);case 8:return n.abrupt("return",s);case 9:case"end":return n.stop()}}),n,this)})))}},{key:"createChannel",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object.assign(Object.assign({},Yp),e),Aa(Zp(n)).throw(T.invalidParameters),r=new $p(n),t.next=5,this._requestQueue.send(r);case 5:return a=t.sent,i=a.as(Jp),s=i.channel,this.upsertChannelsToCache([s]),t.abrupt("return",s);case 9:case"end":return t.stop()}}),t,this)})))}}],[{key:"of",value:function(e){return av[e]}}]),t}(),sv={name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},ov=function(e){return O("string",e.operatorUserIds,!0)&&(A("string",e.coverUrlOrImage)||L(e.coverUrlOrImage)||null===e.coverUrlOrImage)&&A("string",e.name,!0)&&A("string",e.data,!0)&&A("string",e.customType,!0)},uv=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.token,o=e.limit;return(a=t.call(this)).method=R.GET,a.path="".concat(zr,"/").concat(encodeURIComponent(i),"/participants"),a.params={token:s,limit:o},a}return a(r)}(J),cv=function(e){i(r,e);var t=f(r);function r(e,a){var i;n(this,r),(i=t.call(this,e,a)).token=null,i.participants=[];var s=a.next,o=a.participants;return i.token=s,i.participants=o.map((function(t){return new qh(e,t)})),i}return a(r)}($),lv=function(t){i(o,t);var r=f(o);function o(t,a,i){return n(this,o),r.call(this,t,a,e.ChannelType.OPEN,i)}return a(o,[{key:"_validate",value:function(){return v(s(o.prototype),"_validate",this).call(this)}},{key:"next",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,t=Ya.of(this._iid),n=t.requestQueue,r=new uv(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,n.send(r);case 8:return a=e.sent,i=a.as(cv),s=i.participants,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,e.abrupt("return",s);case 14:return e.abrupt("return",[]);case 17:throw T.queryInProgress;case 18:e.next=21;break;case 20:throw T.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),o}(Ts),hv=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl,s=e.coverUrlOrImage,o=e.name,u=e.data,c=e.customType,l=e.operatorUserIds;return(a=t.call(this)).method=R.PUT,a.path="".concat(zr,"/").concat(encodeURIComponent(i)),a.params=Z({cover_url:A("string",s)?s:null,cover_file:L(s)?s:null,name:o,data:u,custom_type:c,operators:l}),a}return a(r)}(J),dv=function(e){i(r,e);var t=f(r);function r(e,a){var i;return n(this,r),(i=t.call(this,e,a)).channel=new pv(e,a),i}return a(r)}($),fv=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.channelUrl;return(a=t.call(this)).method=R.DELETE,a.path="".concat(zr,"/").concat(encodeURIComponent(i)),a}return a(r)}(J),pv=function(t){i(o,t);var r=f(o);function o(t,a){var i,s;return n(this,o),(i=r.call(this,t,a))._lastParticipantCountUpdated=0,i.participantCount=0,i.operators=[],i.channelType=e.ChannelType.OPEN,i.participantCount=null!==(s=a.participant_count)&&void 0!==s?s:0,i.operators=Array.isArray(a.operators)?a.operators.map((function(e){return new Ua(t,e)})):[],i}return a(o,[{key:"serialize",value:function(){return Ia(this)}},{key:"isOperator",value:function(e){return e instanceof Ua?this.isOperator(e.userId):this.operators.some((function(t){return t.userId===e}))}},{key:"_updateParticipantCount",value:function(e,t){return t>this._lastParticipantCountUpdated&&(this.participantCount=e,this._lastParticipantCountUpdated=t,!0)}},{key:"createParticipantListQuery",value:function(e){return new lv(this._iid,this.url,e)}},{key:"refresh",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=iv.of(this._iid),e.next=3,t.getChannelWithoutCache(this.url);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"enter",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.requestQueue,r=new ev({channelUrl:this.url}),e.next=4,n.send(r);case 4:a=e.sent,i=a.as(tv),s=i.participantCount,o=i.ts,this._updateParticipantCount(s,o),iv.of(this._iid).setEnteredToCache(this);case 9:case"end":return e.stop()}}),e,this)})))}},{key:"exit",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.requestQueue,r=new nv({channelUrl:this.url}),e.next=4,n.send(r);case 4:a=e.sent,i=a.as(rv),s=i.participantCount,o=i.ts,this._updateParticipantCount(s,o),iv.of(this._iid).setExitedToCache(this),vs.of(this._iid).fileMessageQueue.cancel(this);case 11:case"end":return e.stop()}}),e,this)})))}},{key:"updateChannel",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,s,o,u,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object.assign(Object.assign({},sv),e),Aa(ov(n)).throw(T.invalidParameters),r=Ya.of(this._iid),a=r.requestQueue,i=new hv(Object.assign({channelUrl:this.url},n)),t.next=6,a.send(i);case 6:return s=t.sent,o=s.as(dv),u=o.channel,c=iv.of(this._iid),t.next=11,c.upsertChannelsToCache([u]);case 11:return t.abrupt("return",u);case 12:case"end":return t.stop()}}),t,this)})))}},{key:"updateChannelWithOperatorUserIds",value:function(e,t,n,r,a){return E(this,void 0,void 0,regeneratorRuntime.mark((function i(){var s;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return s=Object.assign(Object.assign({},sv),{name:e,coverUrlOrImage:t,data:n,operatorUserIds:r,customType:a}),i.abrupt("return",this.updateChannel(s));case 2:case"end":return i.stop()}}),i,this)})))}},{key:"delete",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ya.of(this._iid),n=t.requestQueue,r=new fv({channelUrl:this.url}),e.next=4,n.send(r);case 4:return a=iv.of(this._iid),e.next=7,a.removeChannelsFromCache([this.url]);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"sendUserMessage",value:function(e){return Aa(!e.isPinnedMessage).throw(T.notSupportedError),v(s(o.prototype),"sendUserMessage",this).call(this,e)}},{key:"sendFileMessage",value:function(e){return Aa(!e.isPinnedMessage).throw(T.notSupportedError),v(s(o.prototype),"sendFileMessage",this).call(this,e)}}],[{key:"payloadify",value:function(e){return e?Z(Object.assign(Object.assign({},Gh.payloadify(e)),{participant_count:e.participantCount,operators:e.operators.map((function(e){return Ua.payloadify(e)}))})):null}}]),o}(Gh),vv=function(e){i(r,e);var t=f(r);function r(){var e;return n(this,r),(e=t.apply(this,arguments)).onUserEntered=se,e.onUserExited=se,e.onChannelParticipantCountChanged=se,e.onPollUpdated=se,e.onPollVoted=se,e.onPollDeleted=se,e}return a(r)}(qp),mv=function(e){i(r,e);var t=f(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,r),e=t.call(this),Object.keys(a).forEach((function(t){e.hasOwnProperty(t)&&(e[t]=a[t])})),e}return a(r)}(vv),_v=function(e){i(r,e);var t=f(r);function r(e){var a;n(this,r);var i=e.token,s=e.limit,o=e.nameKeyword,u=e.urlKeyword,c=e.customTypes,l=e.includeFrozen,h=e.includeMetaData;return(a=t.call(this)).method=R.GET,a.path=zr,a.params=Z({token:i,limit:s,name_contains:o,url_contains:u,custom_types:c,show_frozen:l,show_metadata:h}),a}return a(r)}(J),gv=function(e){i(r,e);var t=f(r);function r(e,a){var i;n(this,r),(i=t.call(this,e,a)).token=null,i.channels=[],i.ts=null;var s=a.next,o=a.channels,u=a.ts;return i.token=s,o&&o.length>0&&(i.channels=o.map((function(t){return new pv(e,t)}))),i.ts="number"==typeof u?u:null,i}return a(r)}($),yv=function(e){i(r,e);var t=f(r);function r(e,a){var i,s,o,u,c,l;return n(this,r),(i=t.call(this,e,a)).includeFrozen=!0,i.includeMetaData=!0,i.nameKeyword=null,i.urlKeyword=null,i.customTypes=null,i.includeFrozen=null===(s=a.includeFrozen)||void 0===s||s,i.includeMetaData=null===(o=a.includeMetaData)||void 0===o||o,i.nameKeyword=null!==(u=a.nameKeyword)&&void 0!==u?u:null,i.urlKeyword=null!==(c=a.urlKeyword)&&void 0!==c?c:null,i.customTypes=null!==(l=a.customTypes)&&void 0!==l?l:null,i}return a(r,[{key:"_validate",value:function(){return v(s(r.prototype),"_validate",this).call(this)&&A("boolean",this.includeFrozen)&&A("boolean",this.includeMetaData)&&A("string",this.nameKeyword,!0)&&A("string",this.urlKeyword,!0)&&O("string",this.customTypes,!0)}},{key:"next",value:function(){return E(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=23;break}if(this._isLoading){e.next=20;break}if(!this._hasNext){e.next=17;break}return this._isLoading=!0,t=Ya.of(this._iid),n=t.requestQueue,r=new _v(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,n.send(r);case 8:return a=e.sent,i=a.as(gv),s=i.channels,o=i.token,this._token=o,this._hasNext=!!o,u=iv.of(this._iid),e.next=15,u.upsertChannelsToCache(s);case 15:return this._isLoading=!1,e.abrupt("return",s);case 17:return e.abrupt("return",[]);case 20:throw T.queryInProgress;case 21:e.next=24;break;case 23:throw T.invalidParameters;case 24:case"end":return e.stop()}}),e,this)})))}}]),r}(ks),kv=function(e){i(r,e);var t=f(r);function r(){var e;return n(this,r),(e=t.apply(this,arguments)).name="openChannel",e}return a(r,[{key:"init",value:function(e,t){var n=t.sdkState,a=t.dispatcher,i=t.sessionManager,o=t.requestQueue,u=t.logger,c=t.onlineDetector,l=t.cacheContext;v(s(r.prototype),"init",this).call(this,e,{sdkState:n,dispatcher:a,sessionManager:i,requestQueue:o,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new iv(e,{sdkState:n,dispatcher:a,requestQueue:o})}},{key:"createOpenChannelListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new yv(this._iid,e)}},{key:"addOpenChannelHandler",value:function(e,t){this._manager.addHandler(e,t)}},{key:"removeOpenChannelHandler",value:function(e){this._manager.removeHandler(e)}},{key:"removeAllOpenChannelHandlers",value:function(){this._manager.clearHandler()}},{key:"buildOpenChannelFromSerializedData",value:function(e){return this._manager.buildOpenChannelFromSerializedData(e)}},{key:"getChannel",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._manager.getChannel(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getChannelWithoutCache",value:function(e){return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._manager.getChannelWithoutCache(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"createChannel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._manager.createChannel(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"createChannelWithOperatorUserIds",value:function(e,t,n,r,a){return E(this,void 0,void 0,regeneratorRuntime.mark((function i(){var s;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return(s=Object.assign({},Yp)).name=e,s.coverUrlOrImage=t,s.data=n,s.operatorUserIds=r,s.customType=a,i.abrupt("return",this._manager.createChannel(s));case 7:case"end":return i.stop()}}),i,this)})))}}]),r}(ri);return e.AdminMessage=Ci,e.AppleCriticalAlertOptions=_i,e.ApplicationUserListQuery=tc,e.BannedUserListQuery=xl,e.BaseChannel=Gh,e.BaseMessage=ki,e.BlockedUserListQuery=ac,e.ConnectionHandler=so,e.Emoji=Vu,e.EmojiCategory=Bu,e.EmojiContainer=Qu,e.FileMessage=Pi,e.FriendListQuery=oc,e.GroupChannel=Mp,e.GroupChannelCollection=Pp,e.GroupChannelEventContext=Tf,e.GroupChannelFilter=td,e.GroupChannelHandler=zp,e.GroupChannelListQuery=Ef,e.GroupChannelModule=Kp,e.Member=Jh,e.MemberListQuery=ip,e.MemoryStore=Zc,e.MessageCollection=Yf,e.MessageCollectionInitHandler=Wf,e.MessageEventContext=Sf,e.MessageFilter=po,e.MessageMetaArray=pi,e.MessageModule=As,e.MessageRequestHandler=ms,e.MessageSearchQuery=Cs,e.MutedUserListQuery=El,e.OGImage=vi,e.OGMetaData=mi,e.OpenChannel=pv,e.OpenChannelHandler=mv,e.OpenChannelListQuery=yv,e.OpenChannelModule=kv,e.OperatorListQuery=gl,e.Participant=qh,e.ParticipantListQuery=lv,e.Plugin=Ti,e.PreviousMessageListQuery=Ss,e.PublicGroupChannelListQuery=Gp,e.Reaction=fi,e.ReactionEvent=di,e.ReadStatus=$h,e.RestrictedUser=cl,e.RestrictionInfo=ul,e.ScheduledMessageListQuery=Qp,e.SendbirdChat=zh,e.SendbirdChatOptions=G,e.SendbirdError=T,e.Sender=Ei,e.SessionHandler=io,e.ThreadInfo=oi,e.ThreadInfoUpdateEvent=_s,e.Thumbnail=wi,e.User=Ua,e.UserEventHandler=oo,e.UserMessage=Oi,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
