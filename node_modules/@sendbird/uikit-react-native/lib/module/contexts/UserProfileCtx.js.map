{"version":3,"names":["React","useCallback","useContext","useState","useSafeAreaInsets","Modal","OutlinedButton","ProfileCard","createStyleSheet","Logger","PASS","useIIFE","LocalizationContext","SendbirdChatContext","WARN_onCreateChannel","UserProfileContext","createContext","UserProfileProvider","children","onCreateChannel","onBeforeCreateChannel","chatContext","localizationContext","Error","__DEV__","warn","bottom","left","right","user","setUser","visible","setVisible","show","hide","userProfileButton","isMe","currentUser","userId","undefined","onPressMessageButton","params","invitedUserIds","name","coverUrl","isDistinct","operatorUserIds","processedParams","channel","sdk","groupChannel","createChannel","STRINGS","PROFILE_CARD","BUTTON_MESSAGE","Boolean","styles","modal","profileCardContainer","paddingLeft","paddingRight","paddingBottom","profileUrl","nickname","LABELS","USER_NO_NAME","BODY_LABEL","BODY","justifyContent","borderTopLeftRadius","borderTopRightRadius"],"sources":["UserProfileCtx.tsx"],"sourcesContent":["import React, { useCallback, useContext, useState } from 'react';\nimport { useSafeAreaInsets } from 'react-native-safe-area-context';\n\nimport { Modal, OutlinedButton, ProfileCard, createStyleSheet } from '@sendbird/uikit-react-native-foundation';\nimport type {\n  SendbirdGroupChannel,\n  SendbirdGroupChannelCreateParams,\n  SendbirdMember,\n  SendbirdUser,\n} from '@sendbird/uikit-utils';\nimport { Logger, PASS, useIIFE } from '@sendbird/uikit-utils';\n\nimport { LocalizationContext } from '../contexts/LocalizationCtx';\nimport { SendbirdChatContext } from '../contexts/SendbirdChatCtx';\n\ntype OnCreateChannel = (channel: SendbirdGroupChannel) => void;\ntype OnBeforeCreateChannel = (\n  channelParams: SendbirdGroupChannelCreateParams,\n  users: SendbirdUser[] | SendbirdMember[],\n) => SendbirdGroupChannelCreateParams | Promise<SendbirdGroupChannelCreateParams>;\n\nexport type UserProfileContextType = {\n  show(user: SendbirdUser | SendbirdMember): void;\n  hide(): void;\n};\n\ntype Props = React.PropsWithChildren<{\n  onCreateChannel?: OnCreateChannel;\n  onBeforeCreateChannel?: OnBeforeCreateChannel;\n}>;\n\nlet WARN_onCreateChannel = false;\n\nexport const UserProfileContext = React.createContext<UserProfileContextType | null>(null);\nexport const UserProfileProvider = ({ children, onCreateChannel, onBeforeCreateChannel = PASS }: Props) => {\n  const chatContext = useContext(SendbirdChatContext);\n  const localizationContext = useContext(LocalizationContext);\n\n  if (!chatContext) throw new Error('SendbirdChatContext is not provided');\n  if (!localizationContext) throw new Error('LocalizationContext is not provided');\n\n  if (__DEV__ && !WARN_onCreateChannel && !onCreateChannel) {\n    Logger.warn(\n      'You should pass `userProfile.onCreateChannel` prop to SendbirdUIKitContainer if want to use message in a user profile',\n    );\n    WARN_onCreateChannel = true;\n  }\n\n  const { bottom, left, right } = useSafeAreaInsets();\n\n  const [user, setUser] = useState<SendbirdUser | SendbirdMember>();\n  const [visible, setVisible] = useState(false);\n\n  const show: UserProfileContextType['show'] = useCallback((user) => {\n    setUser(user);\n    setVisible(true);\n  }, []);\n\n  const hide: UserProfileContextType['hide'] = useCallback(() => {\n    setVisible(false);\n  }, []);\n\n  const userProfileButton = useIIFE(() => {\n    const isMe = chatContext.currentUser && user?.userId === chatContext.currentUser.userId;\n    if (isMe) return undefined;\n\n    const onPressMessageButton = async () => {\n      if (user) {\n        const params: SendbirdGroupChannelCreateParams = {\n          invitedUserIds: [user.userId],\n          name: '',\n          coverUrl: '',\n          isDistinct: false,\n        };\n\n        if (chatContext.currentUser) params.operatorUserIds = [chatContext.currentUser.userId];\n        const processedParams = await onBeforeCreateChannel(params, [user]);\n\n        hide();\n        const channel = await chatContext.sdk.groupChannel.createChannel(processedParams);\n\n        if (onCreateChannel) {\n          onCreateChannel(channel);\n        } else {\n          Logger.warn(\n            'Please set `onCreateChannel` before message to user from profile card, see `userProfile` prop in the `SendbirdUIKitContainer` props',\n          );\n        }\n      }\n    };\n\n    return (\n      <OutlinedButton onPress={onPressMessageButton}>\n        {localizationContext.STRINGS.PROFILE_CARD.BUTTON_MESSAGE}\n      </OutlinedButton>\n    );\n  });\n\n  return (\n    <UserProfileContext.Provider value={{ show, hide }}>\n      {children}\n      <Modal\n        type={'slide'}\n        onClose={hide}\n        onDismiss={() => setUser(undefined)}\n        visible={visible && Boolean(user)}\n        backgroundStyle={styles.modal}\n      >\n        {user && (\n          <ProfileCard\n            containerStyle={[\n              styles.profileCardContainer,\n              { paddingLeft: left, paddingRight: right, paddingBottom: bottom },\n            ]}\n            uri={user.profileUrl}\n            username={user.nickname || localizationContext.STRINGS.LABELS.USER_NO_NAME}\n            bodyLabel={localizationContext.STRINGS.PROFILE_CARD.BODY_LABEL}\n            body={localizationContext.STRINGS.PROFILE_CARD.BODY(user)}\n            button={userProfileButton}\n          />\n        )}\n      </Modal>\n    </UserProfileContext.Provider>\n  );\n};\n\nconst styles = createStyleSheet({\n  modal: {\n    justifyContent: 'flex-end',\n  },\n  profileCardContainer: {\n    borderTopLeftRadius: 8,\n    borderTopRightRadius: 8,\n  },\n});\n"],"mappings":"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"}