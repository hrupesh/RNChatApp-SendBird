{"version":3,"names":["React","useCallback","useContext","useEffect","useRef","useState","Platform","View","useSafeAreaInsets","ChannelFrozenBanner","createStyleSheet","useAlert","useBottomSheet","useToast","useUIKitTheme","Logger","getAvailableUriFromFileMessage","getFileExtension","getFileType","isMyMessage","messageKeyExtractor","shouldRenderReaction","toMegabyte","useFreshCallback","ChatFlatList","ReactionAddons","DEPRECATION_WARNING","useLocalization","usePlatformService","useSendbirdChat","SBUUtils","GroupChannelContexts","HANDLE_NEXT_MSG_SEPARATELY","select","default","GroupChannelMessageList","currentUserId","channel","messages","renderMessage","nextMessages","newMessagesFromMembers","onBottomReached","onTopReached","renderNewMessagesButton","renderScrollToBottomButton","onResendFailedMessage","onDeleteMessage","onPressImageMessage","onPressMediaMessage","flatListProps","enableMessageGrouping","STRINGS","colors","left","right","scrollLeaveBottom","setScrollLeaveBottom","scrollRef","newMessagesInternalBuffer","setNewMessagesInternalBuffer","getMessagePressActions","useGetMessagePressActions","safeAreaLayout","paddingLeft","paddingRight","renderItem","item","index","onPress","onLongPress","message","prevMessage","nextMessage","length","prev","concat","onLeaveScrollBottom","val","flex","backgroundColor","background","isFrozen","styles","frozenBanner","GROUP_CHANNEL","LIST_BANNER_FROZEN","url","frozenListPadding","contentContainerStyle","newMsgButton","visible","current","scrollToBottom","newMessages","scrollButton","toast","openSheet","alert","clipboardService","fileService","features","setMessageToEdit","Fragment","handleFailedMessage","sheetItems","title","DIALOG_MESSAGE_FAILED_RETRY","catch","show","TOAST","RESEND_MSG_ERROR","DIALOG_MESSAGE_FAILED_REMOVE","titleColor","ui","dialog","none","destructive","confirmDelete","DIALOG_MESSAGE_DELETE_CONFIRM_TITLE","buttons","text","DIALOG_MESSAGE_DELETE_CONFIRM_CANCEL","DIALOG_MESSAGE_DELETE_CONFIRM_OK","style","DELETE_MSG_ERROR","msg","isUserMessage","isFileMessage","undefined","response","push","icon","DIALOG_MESSAGE_COPY","setString","COPY_OK","sendingStatus","DIALOG_MESSAGE_EDIT","DIALOG_MESSAGE_DELETE","DIALOG_MESSAGE_SAVE","size","DOWNLOAD_START","save","fileUrl","fileName","name","fileType","type","then","DOWNLOAD_OK","log","err","DOWNLOAD_ERROR","warn","ON_PRESS_IMAGE_MESSAGE","openURL","HeaderComponent","reactionEnabled","onClose","position","zIndex","top","paddingBottom","bottom","alignSelf","memo"],"sources":["GroupChannelMessageList.tsx"],"sourcesContent":["import React, { useCallback, useContext, useEffect, useRef, useState } from 'react';\nimport { ListRenderItem, Platform, View } from 'react-native';\nimport { useSafeAreaInsets } from 'react-native-safe-area-context';\n\nimport type { BottomSheetItem } from '@sendbird/uikit-react-native-foundation';\nimport {\n  ChannelFrozenBanner,\n  createStyleSheet,\n  useAlert,\n  useBottomSheet,\n  useToast,\n  useUIKitTheme,\n} from '@sendbird/uikit-react-native-foundation';\nimport type { SendbirdFileMessage, SendbirdMessage, SendbirdUserMessage } from '@sendbird/uikit-utils';\nimport {\n  Logger,\n  getAvailableUriFromFileMessage,\n  getFileExtension,\n  getFileType,\n  isMyMessage,\n  messageKeyExtractor,\n  shouldRenderReaction,\n  toMegabyte,\n  useFreshCallback,\n} from '@sendbird/uikit-utils';\n\nimport type { ChatFlatListRef } from '../../../components/ChatFlatList';\nimport ChatFlatList from '../../../components/ChatFlatList';\nimport { ReactionAddons } from '../../../components/ReactionAddons';\nimport { DEPRECATION_WARNING } from '../../../constants';\nimport { useLocalization, usePlatformService, useSendbirdChat } from '../../../hooks/useContext';\nimport SBUUtils from '../../../libs/SBUUtils';\nimport { GroupChannelContexts } from '../module/moduleContext';\nimport type { GroupChannelProps } from '../types';\n\nconst HANDLE_NEXT_MSG_SEPARATELY = Platform.select({ default: true });\n\nconst GroupChannelMessageList = ({\n  currentUserId,\n  channel,\n  messages,\n  renderMessage,\n  nextMessages,\n  newMessagesFromMembers,\n  onBottomReached,\n  onTopReached,\n  renderNewMessagesButton,\n  renderScrollToBottomButton,\n  onResendFailedMessage,\n  onDeleteMessage,\n  onPressImageMessage,\n  onPressMediaMessage,\n  flatListProps,\n  enableMessageGrouping,\n}: GroupChannelProps['MessageList']) => {\n  const { STRINGS } = useLocalization();\n  const { colors } = useUIKitTheme();\n  const { left, right } = useSafeAreaInsets();\n  const [scrollLeaveBottom, setScrollLeaveBottom] = useState(false);\n  const scrollRef = useRef<ChatFlatListRef>(null);\n  const [newMessagesInternalBuffer, setNewMessagesInternalBuffer] = useState(() => newMessagesFromMembers);\n  const getMessagePressActions = useGetMessagePressActions({\n    channel,\n    currentUserId,\n    onDeleteMessage,\n    onResendFailedMessage,\n    onPressImageMessage,\n    onPressMediaMessage,\n  });\n\n  const safeAreaLayout = { paddingLeft: left, paddingRight: right };\n\n  const renderItem: ListRenderItem<SendbirdMessage> = useFreshCallback(({ item, index }) => {\n    const { onPress, onLongPress } = getMessagePressActions(item);\n    return renderMessage({\n      message: item,\n      prevMessage: messages[index + 1],\n      nextMessage: messages[index - 1],\n      onPress,\n      onLongPress,\n      enableMessageGrouping,\n      channel,\n      currentUserId,\n    });\n  });\n\n  if (!HANDLE_NEXT_MSG_SEPARATELY) {\n    useEffect(() => {\n      if (newMessagesInternalBuffer.length !== 0) {\n        setNewMessagesInternalBuffer((prev) => prev.concat(newMessagesFromMembers));\n      }\n      onBottomReached();\n    }, [newMessagesFromMembers]);\n  }\n\n  const onLeaveScrollBottom = useCallback((val: boolean) => {\n    if (!HANDLE_NEXT_MSG_SEPARATELY) setNewMessagesInternalBuffer([]);\n    setScrollLeaveBottom(val);\n  }, []);\n\n  return (\n    <View style={[{ flex: 1, backgroundColor: colors.background }, safeAreaLayout]}>\n      {channel.isFrozen && (\n        <ChannelFrozenBanner style={styles.frozenBanner} text={STRINGS.GROUP_CHANNEL.LIST_BANNER_FROZEN} />\n      )}\n      <ChatFlatList\n        nextMessages={nextMessages}\n        onBottomReached={onBottomReached}\n        onTopReached={onTopReached}\n        onLeaveScrollBottom={onLeaveScrollBottom}\n        currentUserId={currentUserId}\n        {...flatListProps}\n        listKey={`group-channel-messages-${channel.url}`}\n        ref={scrollRef}\n        data={messages}\n        renderItem={renderItem}\n        keyExtractor={messageKeyExtractor}\n        contentContainerStyle={[\n          // { minHeight: '100%', justifyContent: 'flex-end' },\n          channel.isFrozen && styles.frozenListPadding,\n          flatListProps?.contentContainerStyle,\n        ]}\n      />\n      {renderNewMessagesButton && (\n        <View style={[styles.newMsgButton, safeAreaLayout]}>\n          {renderNewMessagesButton({\n            visible: scrollLeaveBottom,\n            onPress: () => scrollRef.current?.scrollToBottom(false),\n            newMessages: !HANDLE_NEXT_MSG_SEPARATELY ? newMessagesInternalBuffer : newMessagesFromMembers,\n          })}\n        </View>\n      )}\n      {renderScrollToBottomButton && (\n        <View pointerEvents={scrollLeaveBottom ? 'auto' : 'none'} style={[styles.scrollButton, safeAreaLayout]}>\n          {renderScrollToBottomButton({\n            visible: scrollLeaveBottom,\n            onPress: () => scrollRef.current?.scrollToBottom(false),\n          })}\n        </View>\n      )}\n    </View>\n  );\n};\n\ntype HandleableMessage = SendbirdUserMessage | SendbirdFileMessage;\nconst useGetMessagePressActions = ({\n  channel,\n  currentUserId,\n  onResendFailedMessage,\n  onDeleteMessage,\n  onPressImageMessage,\n  onPressMediaMessage,\n}: Pick<\n  GroupChannelProps['MessageList'],\n  | 'channel'\n  | 'currentUserId'\n  | 'onResendFailedMessage'\n  | 'onDeleteMessage'\n  | 'onPressImageMessage'\n  | 'onPressMediaMessage'\n>) => {\n  const { colors } = useUIKitTheme();\n  const { STRINGS } = useLocalization();\n  const toast = useToast();\n  const { openSheet } = useBottomSheet();\n  const { alert } = useAlert();\n  const { clipboardService, fileService } = usePlatformService();\n  const { features } = useSendbirdChat();\n  const { setMessageToEdit } = useContext(GroupChannelContexts.Fragment);\n\n  const handleFailedMessage = (message: HandleableMessage) => {\n    openSheet({\n      sheetItems: [\n        {\n          title: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_FAILED_RETRY,\n          onPress: () =>\n            onResendFailedMessage(message).catch(() => toast.show(STRINGS.TOAST.RESEND_MSG_ERROR, 'error')),\n        },\n        {\n          title: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_FAILED_REMOVE,\n          titleColor: colors.ui.dialog.default.none.destructive,\n          onPress: () => confirmDelete(message),\n        },\n      ],\n    });\n  };\n  const confirmDelete = (message: HandleableMessage) => {\n    alert({\n      title: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_DELETE_CONFIRM_TITLE,\n      buttons: [\n        {\n          text: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_DELETE_CONFIRM_CANCEL,\n        },\n        {\n          text: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_DELETE_CONFIRM_OK,\n          style: 'destructive',\n          onPress: () => onDeleteMessage(message).catch(() => toast.show(STRINGS.TOAST.DELETE_MSG_ERROR, 'error')),\n        },\n      ],\n    });\n  };\n\n  return (msg: SendbirdMessage) => {\n    if (!msg.isUserMessage() && !msg.isFileMessage()) {\n      return { onPress: undefined, onLongPress: undefined };\n    }\n\n    const sheetItems: BottomSheetItem['sheetItems'] = [];\n    const response: { onPress?: () => void; onLongPress?: () => void } = {\n      onPress: undefined,\n      onLongPress: undefined,\n    };\n\n    if (msg.isUserMessage()) {\n      sheetItems.push({\n        icon: 'copy',\n        title: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_COPY,\n        onPress: () => {\n          clipboardService.setString(msg.message || '');\n          toast.show(STRINGS.TOAST.COPY_OK, 'success');\n        },\n      });\n\n      if (isMyMessage(msg, currentUserId) && msg.sendingStatus === 'succeeded') {\n        sheetItems.push(\n          {\n            icon: 'edit',\n            title: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_EDIT,\n            onPress: () => setMessageToEdit(msg),\n          },\n          {\n            icon: 'delete',\n            title: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_DELETE,\n            onPress: () => confirmDelete(msg),\n          },\n        );\n      }\n    }\n\n    if (msg.isFileMessage()) {\n      sheetItems.push({\n        icon: 'download',\n        title: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_SAVE,\n        onPress: async () => {\n          if (toMegabyte(msg.size) > 4) {\n            toast.show(STRINGS.TOAST.DOWNLOAD_START, 'success');\n          }\n\n          fileService\n            .save({ fileUrl: msg.url, fileName: msg.name, fileType: msg.type })\n            .then((response) => {\n              toast.show(STRINGS.TOAST.DOWNLOAD_OK, 'success');\n              Logger.log('File saved to', response);\n            })\n            .catch((err) => {\n              toast.show(STRINGS.TOAST.DOWNLOAD_ERROR, 'error');\n              Logger.log('File save failure', err);\n            });\n        },\n      });\n\n      if (isMyMessage(msg, currentUserId) && msg.sendingStatus === 'succeeded') {\n        sheetItems.push({\n          icon: 'delete',\n          title: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_DELETE,\n          onPress: () => confirmDelete(msg),\n        });\n      }\n\n      const fileType = getFileType(msg.type || getFileExtension(msg.name));\n      switch (fileType) {\n        case 'image':\n        case 'video':\n        case 'audio': {\n          response.onPress = () => {\n            if (onPressImageMessage && fileType === 'image') {\n              Logger.warn(DEPRECATION_WARNING.GROUP_CHANNEL.ON_PRESS_IMAGE_MESSAGE);\n              onPressImageMessage(msg, getAvailableUriFromFileMessage(msg));\n            }\n            onPressMediaMessage?.(msg, () => onDeleteMessage(msg), getAvailableUriFromFileMessage(msg));\n          };\n          break;\n        }\n        default: {\n          response.onPress = () => SBUUtils.openURL(msg.url);\n          break;\n        }\n      }\n    }\n\n    if (sheetItems.length > 0) {\n      response.onLongPress = () => {\n        openSheet({\n          sheetItems,\n          HeaderComponent: shouldRenderReaction(channel, features.reactionEnabled)\n            ? ({ onClose }) => <ReactionAddons.BottomSheet message={msg} channel={channel} onClose={onClose} />\n            : undefined,\n        });\n      };\n    }\n\n    if (msg.sendingStatus === 'failed') {\n      response.onLongPress = () => handleFailedMessage(msg);\n      response.onPress = () => {\n        onResendFailedMessage(msg).catch(() => toast.show(STRINGS.TOAST.RESEND_MSG_ERROR, 'error'));\n      };\n    }\n\n    if (msg.sendingStatus === 'pending') {\n      response.onLongPress = undefined;\n      response.onPress = undefined;\n    }\n\n    return response;\n  };\n};\n\nconst styles = createStyleSheet({\n  frozenBanner: {\n    position: 'absolute',\n    zIndex: 999,\n    top: 8,\n    left: 8,\n    right: 8,\n  },\n  frozenListPadding: {\n    paddingBottom: 32,\n  },\n  newMsgButton: {\n    position: 'absolute',\n    zIndex: 999,\n    bottom: 10,\n    alignSelf: 'center',\n  },\n  scrollButton: {\n    position: 'absolute',\n    zIndex: 998,\n    bottom: 10,\n    right: 16,\n  },\n});\n\nexport default React.memo(GroupChannelMessageList);\n"],"mappings":"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"}