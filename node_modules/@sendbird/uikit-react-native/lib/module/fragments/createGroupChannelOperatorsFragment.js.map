{"version":3,"names":["React","useChannelHandler","useUserList","useActionMenu","ifOperator","isDifferentChannel","useFreshCallback","useUniqId","StatusComposition","UserActionBar","createGroupChannelOperatorsModule","useLocalization","useSendbirdChat","useUserProfile","name","createGroupChannelOperatorsFragment","initModule","GroupChannelOperatorsModule","channel","onPressHeaderLeft","onPressHeaderRight","renderUser","uniqId","STRINGS","sdk","currentUser","openMenu","show","users","deleteUser","upsertUser","loading","refresh","next","error","queryCreator","createOperatorListQuery","limit","onUserLeft","eventChannel","user","userId","onUserBanned","onOperatorUpdated","updatedUsers","operatorsAdded","length","forEach","_renderUser","props","profileUrl","nickname","LABELS","USER_NO_NAME","USER_BAR_ME_POSTFIX","myRole","title","menuItems","UNREGISTER_OPERATOR","onPress","removeOperators","then","Boolean"],"sources":["createGroupChannelOperatorsFragment.tsx"],"sourcesContent":["import React from 'react';\n\nimport { useChannelHandler, useUserList } from '@sendbird/uikit-chat-hooks';\nimport { useActionMenu } from '@sendbird/uikit-react-native-foundation';\nimport { ifOperator, isDifferentChannel, useFreshCallback, useUniqId } from '@sendbird/uikit-utils';\n\nimport StatusComposition from '../components/StatusComposition';\nimport UserActionBar from '../components/UserActionBar';\nimport { createGroupChannelOperatorsModule } from '../domain/groupChannelOperators';\nimport type { GroupChannelOperatorsFragment, GroupChannelOperatorsModule } from '../domain/groupChannelOperators/types';\nimport { useLocalization, useSendbirdChat, useUserProfile } from '../hooks/useContext';\n\nconst name = 'createGroupChannelOperatorsFragment';\nconst createGroupChannelOperatorsFragment = (\n  initModule?: Partial<GroupChannelOperatorsModule>,\n): GroupChannelOperatorsFragment => {\n  const GroupChannelOperatorsModule = createGroupChannelOperatorsModule(initModule);\n\n  return ({ channel, onPressHeaderLeft, onPressHeaderRight, renderUser }) => {\n    const uniqId = useUniqId(name);\n\n    const { STRINGS } = useLocalization();\n    const { sdk, currentUser } = useSendbirdChat();\n    const { openMenu } = useActionMenu();\n    const { show } = useUserProfile();\n\n    const { users, deleteUser, upsertUser, loading, refresh, next, error } = useUserList(sdk, {\n      queryCreator: () => channel.createOperatorListQuery({ limit: 20 }),\n    });\n\n    useChannelHandler(sdk, `${name}_${uniqId}`, {\n      onUserLeft(eventChannel, user) {\n        if (isDifferentChannel(eventChannel, channel)) return;\n        deleteUser(user.userId);\n      },\n      onUserBanned(eventChannel, user) {\n        if (isDifferentChannel(eventChannel, channel)) return;\n        deleteUser(user.userId);\n      },\n      onOperatorUpdated(eventChannel, updatedUsers) {\n        if (isDifferentChannel(eventChannel, channel)) return;\n        const operatorsAdded = users.length < updatedUsers.length;\n        if (operatorsAdded) updatedUsers.forEach(upsertUser);\n      },\n    });\n\n    const _renderUser: NonNullable<typeof renderUser> = useFreshCallback((props) => {\n      if (renderUser) return renderUser(props);\n\n      const { user } = props;\n      return (\n        <UserActionBar\n          muted={false}\n          uri={user.profileUrl}\n          name={\n            (user.nickname || STRINGS.LABELS.USER_NO_NAME) +\n            (user.userId === currentUser?.userId ? STRINGS.LABELS.USER_BAR_ME_POSTFIX : '')\n          }\n          disabled={user.userId === currentUser?.userId}\n          onPressAvatar={() => show(user)}\n          onPressActionMenu={ifOperator(channel.myRole, () => {\n            openMenu({\n              title: user.nickname || STRINGS.LABELS.USER_NO_NAME,\n              menuItems: [\n                {\n                  title: STRINGS.LABELS.UNREGISTER_OPERATOR,\n                  onPress: () => channel.removeOperators([user.userId]).then(() => deleteUser(user.userId)),\n                },\n              ],\n            });\n          })}\n        />\n      );\n    });\n\n    return (\n      <GroupChannelOperatorsModule.Provider channel={channel}>\n        <GroupChannelOperatorsModule.Header\n          onPressHeaderLeft={onPressHeaderLeft}\n          onPressHeaderRight={onPressHeaderRight}\n        />\n\n        <StatusComposition\n          loading={loading}\n          LoadingComponent={<GroupChannelOperatorsModule.StatusLoading />}\n          error={Boolean(error)}\n          ErrorComponent={<GroupChannelOperatorsModule.StatusError onPressRetry={refresh} />}\n        >\n          <GroupChannelOperatorsModule.List\n            operators={users}\n            renderUser={_renderUser}\n            onLoadNext={next}\n            ListEmptyComponent={<GroupChannelOperatorsModule.StatusEmpty />}\n          />\n        </StatusComposition>\n      </GroupChannelOperatorsModule.Provider>\n    );\n  };\n};\n\nexport default createGroupChannelOperatorsFragment;\n"],"mappings":"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"}