{"version":3,"names":["React","useMemo","useGroupChannelMessages","NOOP","PASS","messageComparator","useFreshCallback","MessageRenderer","NewMessagesButton","ScrollToBottomButton","StatusComposition","createGroupChannelModule","useSendbirdChat","createGroupChannelFragment","initModule","GroupChannelModule","renderNewMessagesButton","props","renderScrollToBottomButton","renderMessage","enableMessageGrouping","enableTypingIndicator","onPressHeaderLeft","onPressHeaderRight","onPressImageMessage","onPressMediaMessage","onChannelDeleted","onBeforeSendFileMessage","onBeforeSendUserMessage","channel","keyboardAvoidOffset","queryCreator","collectionCreator","sortComparator","flatListProps","sdk","currentUser","messages","nextMessages","newMessagesFromMembers","next","prev","sendFileMessage","sendUserMessage","updateFileMessage","updateUserMessage","resendMessage","deleteMessage","loading","userId","enableCollectionWithoutLocalCache","_renderMessage","memoizedFlatListProps","ListEmptyComponent","contentContainerStyle","flexGrow","onSendFileMessage","file","processedParams","onSendUserMessage","text","mention","message","mentionedUserIds","userIds","mentionedMessageTemplate","messageTemplate","mentionType","type","onUpdateFileMessage","editedFile","messageId","onUpdateUserMessage","editedText","SuggestedMentionList","shouldRenderInput","isBroadcast","myRole"],"sources":["createGroupChannelFragment.tsx"],"sourcesContent":["import React, { useMemo } from 'react';\n\nimport { useGroupChannelMessages } from '@sendbird/uikit-chat-hooks';\nimport { NOOP, PASS, SendbirdGroupChannel, messageComparator, useFreshCallback } from '@sendbird/uikit-utils';\n\nimport MessageRenderer from '../components/MessageRenderer';\nimport NewMessagesButton from '../components/NewMessagesButton';\nimport ScrollToBottomButton from '../components/ScrollToBottomButton';\nimport StatusComposition from '../components/StatusComposition';\nimport createGroupChannelModule from '../domain/groupChannel/module/createGroupChannelModule';\nimport type { GroupChannelFragment, GroupChannelModule, GroupChannelProps } from '../domain/groupChannel/types';\nimport { useSendbirdChat } from '../hooks/useContext';\n\nconst createGroupChannelFragment = (initModule?: Partial<GroupChannelModule>): GroupChannelFragment => {\n  const GroupChannelModule = createGroupChannelModule(initModule);\n\n  return ({\n    renderNewMessagesButton = (props) => <NewMessagesButton {...props} />,\n    renderScrollToBottomButton = (props) => <ScrollToBottomButton {...props} />,\n    renderMessage,\n    enableMessageGrouping = true,\n    enableTypingIndicator = true,\n    onPressHeaderLeft = NOOP,\n    onPressHeaderRight = NOOP,\n    onPressImageMessage,\n    onPressMediaMessage = NOOP,\n    onChannelDeleted = NOOP,\n    onBeforeSendFileMessage = PASS,\n    onBeforeSendUserMessage = PASS,\n    channel,\n    keyboardAvoidOffset,\n    queryCreator,\n    collectionCreator,\n    sortComparator = messageComparator,\n    flatListProps,\n  }) => {\n    const { sdk, currentUser } = useSendbirdChat();\n\n    const {\n      messages,\n      nextMessages,\n      newMessagesFromMembers,\n      next,\n      prev,\n      sendFileMessage,\n      sendUserMessage,\n      updateFileMessage,\n      updateUserMessage,\n      resendMessage,\n      deleteMessage,\n      loading,\n    } = useGroupChannelMessages(sdk, channel, currentUser?.userId, {\n      collectionCreator,\n      queryCreator,\n      sortComparator,\n      onChannelDeleted,\n      enableCollectionWithoutLocalCache: !queryCreator,\n    });\n\n    const _renderMessage: GroupChannelProps['MessageList']['renderMessage'] = useFreshCallback((props) => {\n      if (renderMessage) return renderMessage(props);\n      return <MessageRenderer {...props} />;\n    });\n\n    const memoizedFlatListProps = useMemo(\n      () => ({\n        ListEmptyComponent: <GroupChannelModule.StatusEmpty />,\n        contentContainerStyle: { flexGrow: 1 },\n        ...flatListProps,\n      }),\n      [loading, flatListProps],\n    );\n\n    const onSendFileMessage: GroupChannelProps['Input']['onSendFileMessage'] = useFreshCallback(async (file) => {\n      const processedParams = await onBeforeSendFileMessage({ file });\n      await sendFileMessage(processedParams);\n    });\n    const onSendUserMessage: GroupChannelProps['Input']['onSendUserMessage'] = useFreshCallback(\n      async (text, mention) => {\n        const processedParams = await onBeforeSendUserMessage({\n          message: text,\n          mentionedUserIds: mention?.userIds,\n          mentionedMessageTemplate: mention?.messageTemplate,\n          mentionType: mention?.type,\n        });\n        await sendUserMessage(processedParams);\n      },\n    );\n    const onUpdateFileMessage: GroupChannelProps['Input']['onUpdateFileMessage'] = useFreshCallback(\n      async (editedFile, message) => {\n        const processedParams = await onBeforeSendFileMessage({ file: editedFile });\n        await updateFileMessage(message.messageId, processedParams);\n      },\n    );\n    const onUpdateUserMessage: GroupChannelProps['Input']['onUpdateUserMessage'] = useFreshCallback(\n      async (editedText, message, mention) => {\n        const processedParams = await onBeforeSendUserMessage({\n          message: editedText,\n          mentionedUserIds: mention?.userIds,\n          mentionedMessageTemplate: mention?.messageTemplate,\n          mentionType: mention?.type,\n        });\n        await updateUserMessage(message.messageId, processedParams);\n      },\n    );\n\n    return (\n      <GroupChannelModule.Provider\n        channel={channel}\n        enableTypingIndicator={enableTypingIndicator}\n        keyboardAvoidOffset={keyboardAvoidOffset}\n      >\n        <GroupChannelModule.Header onPressHeaderLeft={onPressHeaderLeft} onPressHeaderRight={onPressHeaderRight} />\n        <StatusComposition loading={loading} LoadingComponent={<GroupChannelModule.StatusLoading />}>\n          <GroupChannelModule.MessageList\n            channel={channel}\n            enableMessageGrouping={enableMessageGrouping}\n            currentUserId={currentUser?.userId}\n            renderMessage={_renderMessage}\n            messages={messages}\n            nextMessages={nextMessages}\n            newMessagesFromMembers={newMessagesFromMembers}\n            onTopReached={prev}\n            onBottomReached={next}\n            renderNewMessagesButton={renderNewMessagesButton}\n            renderScrollToBottomButton={renderScrollToBottomButton}\n            onResendFailedMessage={resendMessage}\n            onDeleteMessage={deleteMessage}\n            onPressImageMessage={onPressImageMessage}\n            onPressMediaMessage={onPressMediaMessage}\n            flatListProps={memoizedFlatListProps}\n          />\n          <GroupChannelModule.Input\n            SuggestedMentionList={GroupChannelModule.SuggestedMentionList}\n            shouldRenderInput={shouldRenderInput(channel)}\n            onSendFileMessage={onSendFileMessage}\n            onSendUserMessage={onSendUserMessage}\n            onUpdateFileMessage={onUpdateFileMessage}\n            onUpdateUserMessage={onUpdateUserMessage}\n          />\n        </StatusComposition>\n      </GroupChannelModule.Provider>\n    );\n  };\n};\n\nfunction shouldRenderInput(channel: SendbirdGroupChannel) {\n  if (channel.isBroadcast) {\n    return channel.myRole === 'operator';\n  }\n\n  return true;\n}\n\nexport default createGroupChannelFragment;\n"],"mappings":"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"}