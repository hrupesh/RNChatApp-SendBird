{"version":3,"names":["React","TouchableOpacity","useUserList","PASS","useFreshCallback","StatusComposition","UserSelectableBar","createUserListModule","useLocalization","useSendbirdChat","createGroupChannelCreateFragment","initModule","UserListModule","onPressHeaderLeft","onBeforeCreateChannel","onCreateChannel","sortComparator","queryCreator","channelType","renderUser","sdk","currentUser","STRINGS","users","refreshing","loading","error","refresh","next","_renderUser","user","selectedUsers","setSelectedUsers","hasRequiredKey","Object","hasOwn","Error","isMe","userId","userIdx","findIndex","u","isSelected","draft","splice","push","profileUrl","nickname","LABELS","USER_NO_NAME","GROUP_CHANNEL_CREATE","HEADER_RIGHT","HEADER_TITLE","params","invitedUserIds","map","it","name","coverUrl","isDistinct","isBroadcast","isSuper","operatorUserIds","processedParams","channel","groupChannel","createChannel","Boolean"],"sources":["createGroupChannelCreateFragment.tsx"],"sourcesContent":["import React from 'react';\nimport { TouchableOpacity } from 'react-native';\n\nimport { useUserList } from '@sendbird/uikit-chat-hooks';\nimport {\n  PASS,\n  SendbirdGroupChannelCreateParams,\n  SendbirdUser,\n  UserStruct,\n  useFreshCallback,\n} from '@sendbird/uikit-utils';\n\nimport StatusComposition from '../components/StatusComposition';\nimport UserSelectableBar from '../components/UserSelectableBar';\nimport type { GroupChannelCreateFragment } from '../domain/groupChannelUserList/types';\nimport createUserListModule from '../domain/userList/module/createUserListModule';\nimport type { UserListModule } from '../domain/userList/types';\nimport { useLocalization, useSendbirdChat } from '../hooks/useContext';\n\nconst createGroupChannelCreateFragment = <UserType extends UserStruct>(\n  initModule?: Partial<UserListModule<UserType>>,\n): GroupChannelCreateFragment<UserType> => {\n  const UserListModule = createUserListModule<UserType>(initModule);\n\n  return ({\n    onPressHeaderLeft,\n    onBeforeCreateChannel = PASS,\n    onCreateChannel,\n    sortComparator,\n    queryCreator,\n    channelType = 'GROUP',\n    renderUser,\n  }) => {\n    const { sdk, currentUser } = useSendbirdChat();\n    const { STRINGS } = useLocalization();\n    const { users, refreshing, loading, error, refresh, next } = useUserList(sdk, {\n      queryCreator,\n      sortComparator,\n    });\n\n    const _renderUser: NonNullable<typeof renderUser> = useFreshCallback((user, selectedUsers, setSelectedUsers) => {\n      if (queryCreator && !renderUser) {\n        const hasRequiredKey = Object.hasOwn(user, 'profileUrl') && Object.hasOwn(user, 'nickname');\n        if (!hasRequiredKey) throw new Error('You should provide \"renderUser\" when providing \"queryCreator\"');\n      }\n\n      if (renderUser) return renderUser(user, selectedUsers, setSelectedUsers);\n\n      const isMe = user.userId === currentUser?.userId;\n      if (isMe) return null;\n\n      const userIdx = selectedUsers.findIndex((u) => u.userId === user.userId);\n      const isSelected = userIdx > -1;\n\n      return (\n        <TouchableOpacity\n          activeOpacity={0.7}\n          onPress={() => {\n            setSelectedUsers(([...draft]) => {\n              if (isSelected) draft.splice(userIdx, 1);\n              else draft.push(user);\n              return draft;\n            });\n          }}\n        >\n          <UserSelectableBar\n            uri={(user as unknown as SendbirdUser).profileUrl}\n            name={(user as unknown as SendbirdUser).nickname || STRINGS.LABELS.USER_NO_NAME}\n            selected={isSelected}\n            disabled={false}\n          />\n        </TouchableOpacity>\n      );\n    });\n\n    return (\n      <UserListModule.Provider\n        headerRight={(selectedUsers) => STRINGS.GROUP_CHANNEL_CREATE.HEADER_RIGHT({ selectedUsers })}\n        headerTitle={STRINGS.GROUP_CHANNEL_CREATE.HEADER_TITLE}\n      >\n        <UserListModule.Header\n          onPressHeaderLeft={onPressHeaderLeft}\n          onPressHeaderRight={async (users) => {\n            const params: SendbirdGroupChannelCreateParams = {\n              invitedUserIds: users.map((it) => it.userId),\n              name: '',\n              coverUrl: '',\n              isDistinct: false,\n            };\n\n            if (channelType === 'BROADCAST') params.isBroadcast = true;\n            if (channelType === 'SUPER_GROUP') params.isSuper = true;\n            if (currentUser) params.operatorUserIds = [currentUser.userId];\n\n            const processedParams = await onBeforeCreateChannel(params, users);\n            const channel = await sdk.groupChannel.createChannel(processedParams);\n            onCreateChannel(channel);\n          }}\n        />\n        <StatusComposition\n          loading={loading}\n          error={Boolean(error)}\n          LoadingComponent={<UserListModule.StatusLoading />}\n          ErrorComponent={<UserListModule.StatusError onPressRetry={() => refresh()} />}\n        >\n          <UserListModule.List\n            onLoadNext={next}\n            users={users}\n            renderUser={_renderUser}\n            onRefresh={refresh}\n            refreshing={refreshing}\n            ListEmptyComponent={<UserListModule.StatusEmpty />}\n          />\n        </StatusComposition>\n      </UserListModule.Provider>\n    );\n  };\n};\n\nexport default createGroupChannelCreateFragment;\n"],"mappings":"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"}