{"version":3,"names":["React","useRef","useChannelHandler","useUserList","Icon","useActionMenu","ifMuted","ifOperator","isDifferentChannel","useFreshCallback","useUniqId","StatusComposition","UserActionBar","createUserListModule","useLocalization","useSendbirdChat","useUserProfile","noop","HOOK_NAME","createGroupChannelMembersFragment","initModule","UserListModule","channel","onPressHeaderLeft","onPressHeaderRight","renderUser","uniqId","refreshSchedule","STRINGS","sdk","currentUser","openMenu","show","users","refresh","loading","next","error","upsertUser","deleteUser","queryCreator","createMemberListQuery","limit","onUserLeft","eventChannel","user","userId","onUserBanned","onOperatorUpdated","current","clearTimeout","setTimeout","onUserMuted","isGroupChannel","memberFromChannel","members","find","it","memberFromList","isMuted","onUserUnmuted","_renderUser","selectedUsers","setSelectedUsers","profileUrl","role","LABELS","USER_BAR_OPERATOR","nickname","USER_NO_NAME","USER_BAR_ME_POSTFIX","myRole","menuItems","push","title","UNREGISTER_OPERATOR","REGISTER_AS_OPERATOR","onPress","removeOperators","addOperators","isBroadcast","UNMUTE","MUTE","unmuteUser","muteUser","BAN","style","banUser","GROUP_CHANNEL_MEMBERS","HEADER_TITLE","Boolean"],"sources":["createGroupChannelMembersFragment.tsx"],"sourcesContent":["import React, { useRef } from 'react';\n\nimport { useChannelHandler, useUserList } from '@sendbird/uikit-chat-hooks';\nimport type { ActionMenuItem } from '@sendbird/uikit-react-native-foundation';\nimport { Icon, useActionMenu } from '@sendbird/uikit-react-native-foundation';\nimport type { SendbirdMember } from '@sendbird/uikit-utils';\nimport { ifMuted, ifOperator, isDifferentChannel, useFreshCallback, useUniqId } from '@sendbird/uikit-utils';\n\nimport StatusComposition from '../components/StatusComposition';\nimport UserActionBar from '../components/UserActionBar';\nimport type { GroupChannelMembersFragment } from '../domain/groupChannelUserList/types';\nimport createUserListModule from '../domain/userList/module/createUserListModule';\nimport type { UserListModule } from '../domain/userList/types';\nimport { useLocalization, useSendbirdChat, useUserProfile } from '../hooks/useContext';\n\nconst noop = () => '';\nconst HOOK_NAME = 'createGroupChannelMembersFragment';\nconst createGroupChannelMembersFragment = (\n  initModule?: Partial<UserListModule<SendbirdMember>>,\n): GroupChannelMembersFragment<SendbirdMember> => {\n  const UserListModule = createUserListModule<SendbirdMember>(initModule);\n\n  return ({ channel, onPressHeaderLeft, onPressHeaderRight, renderUser }) => {\n    const uniqId = useUniqId(HOOK_NAME);\n\n    const refreshSchedule = useRef<NodeJS.Timeout>();\n    const { STRINGS } = useLocalization();\n    const { sdk, currentUser } = useSendbirdChat();\n    const { openMenu } = useActionMenu();\n    const { show } = useUserProfile();\n\n    const { users, refresh, loading, next, error, upsertUser, deleteUser } = useUserList(sdk, {\n      queryCreator: () => channel.createMemberListQuery({ limit: 20 }),\n    });\n\n    useChannelHandler(sdk, `${HOOK_NAME}_${uniqId}`, {\n      onUserLeft(eventChannel, user) {\n        if (isDifferentChannel(eventChannel, channel)) return;\n        deleteUser(user.userId);\n      },\n      onUserBanned(eventChannel, user) {\n        if (isDifferentChannel(eventChannel, channel)) return;\n        deleteUser(user.userId);\n      },\n      onOperatorUpdated(eventChannel) {\n        if (isDifferentChannel(eventChannel, channel)) return;\n        if (refreshSchedule.current) clearTimeout(refreshSchedule.current);\n        refreshSchedule.current = setTimeout(() => refresh(), 500);\n      },\n      onUserMuted(eventChannel, user) {\n        if (isDifferentChannel(eventChannel, channel) || !eventChannel.isGroupChannel()) return;\n\n        const memberFromChannel = eventChannel.members.find((it) => it.userId === user.userId);\n        if (memberFromChannel) return upsertUser(memberFromChannel);\n\n        const memberFromList = users.find((it) => it.userId === user.userId);\n        if (memberFromList) {\n          memberFromList.isMuted = true;\n          upsertUser(memberFromList);\n        }\n      },\n      onUserUnmuted(eventChannel, user) {\n        if (isDifferentChannel(eventChannel, channel) || !eventChannel.isGroupChannel()) return;\n\n        const memberFromChannel = eventChannel.members.find((it) => it.userId === user.userId);\n        if (memberFromChannel) return upsertUser(memberFromChannel);\n\n        const memberFromList = users.find((it) => it.userId === user.userId);\n        if (memberFromList) {\n          memberFromList.isMuted = false;\n          upsertUser(memberFromList);\n        }\n      },\n    });\n\n    const _renderUser: NonNullable<typeof renderUser> = useFreshCallback((user, selectedUsers, setSelectedUsers) => {\n      if (renderUser) return renderUser(user, selectedUsers, setSelectedUsers);\n\n      return (\n        <UserActionBar\n          muted={user.isMuted}\n          uri={user.profileUrl}\n          label={user.role === 'operator' ? STRINGS.LABELS.USER_BAR_OPERATOR : ''}\n          name={\n            (user.nickname || STRINGS.LABELS.USER_NO_NAME) +\n            (user.userId === currentUser?.userId ? STRINGS.LABELS.USER_BAR_ME_POSTFIX : '')\n          }\n          disabled={user.userId === currentUser?.userId}\n          onPressActionMenu={ifOperator(channel.myRole, () => {\n            const menuItems: ActionMenuItem['menuItems'] = [];\n\n            menuItems.push({\n              title: ifOperator(user.role, STRINGS.LABELS.UNREGISTER_OPERATOR, STRINGS.LABELS.REGISTER_AS_OPERATOR),\n              onPress: ifOperator(\n                user.role,\n                () => channel.removeOperators([user.userId]),\n                () => channel.addOperators([user.userId]),\n              ),\n            });\n\n            if (!channel.isBroadcast) {\n              menuItems.push({\n                title: ifMuted(user.isMuted, STRINGS.LABELS.UNMUTE, STRINGS.LABELS.MUTE),\n                onPress: ifMuted(\n                  user.isMuted,\n                  () => channel.unmuteUser(user),\n                  () => channel.muteUser(user),\n                ),\n              });\n            }\n\n            menuItems.push({\n              title: STRINGS.LABELS.BAN,\n              style: 'destructive',\n              onPress: () => channel.banUser(user),\n            });\n\n            openMenu({ title: user.nickname || STRINGS.LABELS.USER_NO_NAME, menuItems });\n          })}\n          onPressAvatar={() => show(user)}\n        />\n      );\n    });\n\n    return (\n      <UserListModule.Provider headerRight={noop} headerTitle={STRINGS.GROUP_CHANNEL_MEMBERS.HEADER_TITLE}>\n        <UserListModule.Header\n          shouldActivateHeaderRight={() => true}\n          onPressHeaderLeft={onPressHeaderLeft}\n          right={<Icon icon={'plus'} />}\n          onPressHeaderRight={async () => onPressHeaderRight()}\n        />\n        <StatusComposition\n          loading={loading}\n          LoadingComponent={<UserListModule.StatusLoading />}\n          error={Boolean(error)}\n          ErrorComponent={<UserListModule.StatusError onPressRetry={refresh} />}\n        >\n          <UserListModule.List\n            users={users}\n            renderUser={_renderUser}\n            onLoadNext={next}\n            ListEmptyComponent={<UserListModule.StatusEmpty />}\n          />\n        </StatusComposition>\n      </UserListModule.Provider>\n    );\n  };\n};\n\nexport default createGroupChannelMembersFragment;\n"],"mappings":"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"}