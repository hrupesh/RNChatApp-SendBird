{"version":3,"names":["React","Pressable","createStyleSheet","useUIKitTheme","getReactionCount","DEFAULT_LONG_PRESS_DELAY","UNKNOWN_USER_ID","useReaction","useSendbirdChat","ReactionRoundedButton","NUM_COL","REACTION_MORE_KEY","getUserReacted","reaction","userId","userIds","indexOf","createOnPressReaction","channel","message","reacted","deleteReaction","key","addReaction","createReactionButtons","getEmoji","emojiLimit","onOpenReactionList","onOpenReactionUserList","currentUserId","reactions","buttons","map","index","isNotLastOfRow","isNotLastOfCol","length","pressed","url","styles","marginRight","marginBottom","push","MessageReactionAddon","colors","emojiManager","currentUser","openReactionList","openReactionUserList","reactionButtons","allEmojiMap","allEmoji","focusIndex","reactionContainer","backgroundColor","background","borderColor","ui","rounded","enabled","alignItems","flexDirection","flexWrap","padding","borderRadius","borderWidth"],"sources":["MessageReactionAddon.tsx"],"sourcesContent":["import React from 'react';\nimport { Pressable } from 'react-native';\n\nimport type { Emoji } from '@sendbird/chat';\nimport { createStyleSheet, useUIKitTheme } from '@sendbird/uikit-react-native-foundation';\nimport type { SendbirdBaseChannel, SendbirdBaseMessage, SendbirdReaction } from '@sendbird/uikit-utils';\nimport { getReactionCount } from '@sendbird/uikit-utils';\n\nimport { DEFAULT_LONG_PRESS_DELAY, UNKNOWN_USER_ID } from '../../constants';\nimport { useReaction, useSendbirdChat } from '../../hooks/useContext';\nimport ReactionRoundedButton from './ReactionRoundedButton';\n\nconst NUM_COL = 4;\nconst REACTION_MORE_KEY = 'reaction-more-button';\n\nconst getUserReacted = (reaction: SendbirdReaction, userId = UNKNOWN_USER_ID) => {\n  return reaction.userIds.indexOf(userId) > -1;\n};\n\nconst createOnPressReaction = (\n  reaction: SendbirdReaction,\n  channel: SendbirdBaseChannel,\n  message: SendbirdBaseMessage,\n  reacted: boolean,\n) => {\n  return () => {\n    if (reacted) {\n      return channel.deleteReaction(message, reaction.key);\n    } else {\n      return channel.addReaction(message, reaction.key);\n    }\n  };\n};\n\nconst createReactionButtons = (\n  channel: SendbirdBaseChannel,\n  message: SendbirdBaseMessage,\n  getEmoji: (key: string) => Emoji,\n  emojiLimit: number,\n  onOpenReactionList: () => void,\n  onOpenReactionUserList: (focusIndex: number) => void,\n  currentUserId?: string,\n) => {\n  const reactions = message.reactions ?? [];\n  const buttons = reactions.map((reaction, index) => {\n    const isNotLastOfRow = index % NUM_COL !== NUM_COL - 1;\n    const isNotLastOfCol = index < NUM_COL && reactions.length >= NUM_COL;\n    return (\n      <Pressable\n        key={reaction.key}\n        onPress={createOnPressReaction(reaction, channel, message, getUserReacted(reaction, currentUserId))}\n        onLongPress={() => onOpenReactionUserList(index)}\n        delayLongPress={DEFAULT_LONG_PRESS_DELAY}\n      >\n        {({ pressed }) => (\n          <ReactionRoundedButton\n            url={getEmoji(reaction.key).url}\n            count={getReactionCount(reaction)}\n            reacted={pressed || getUserReacted(reaction, currentUserId)}\n            style={[isNotLastOfRow && styles.marginRight, isNotLastOfCol && styles.marginBottom]}\n          />\n        )}\n      </Pressable>\n    );\n  });\n  if (buttons.length < emojiLimit) {\n    buttons.push(\n      <Pressable key={REACTION_MORE_KEY} onPress={onOpenReactionList}>\n        {({ pressed }) => <ReactionRoundedButton.More pressed={pressed} />}\n      </Pressable>,\n    );\n  }\n\n  return buttons;\n};\n\nconst MessageReactionAddon = ({ channel, message }: { channel: SendbirdBaseChannel; message: SendbirdBaseMessage }) => {\n  const { colors } = useUIKitTheme();\n  const { emojiManager, currentUser } = useSendbirdChat();\n  const { openReactionList, openReactionUserList } = useReaction();\n\n  if (!message.reactions?.length) return null;\n\n  const reactionButtons = createReactionButtons(\n    channel,\n    message,\n    (key) => emojiManager.allEmojiMap[key],\n    emojiManager.allEmoji.length,\n    () => openReactionList({ channel, message }),\n    (focusIndex) => openReactionUserList({ channel, message, focusIndex }),\n    currentUser?.userId,\n  );\n\n  return (\n    <Pressable\n      style={[\n        styles.reactionContainer,\n        { backgroundColor: colors.background, borderColor: colors.ui.reaction.rounded.enabled.background },\n      ]}\n    >\n      {reactionButtons}\n    </Pressable>\n  );\n};\n\nconst styles = createStyleSheet({\n  reactionContainer: {\n    alignItems: 'stretch',\n    flexDirection: 'row',\n    flexWrap: 'wrap',\n    padding: 8,\n    borderRadius: 16,\n    borderWidth: 1,\n  },\n  marginRight: {\n    marginRight: 4.5,\n  },\n  marginBottom: {\n    marginBottom: 4,\n  },\n});\n\nexport default MessageReactionAddon;\n"],"mappings":"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"}