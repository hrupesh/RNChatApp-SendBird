{"version":3,"names":["InternalLocalCacheStorage","MemoryStorage","getAllKeys","Object","keys","_data","getItem","key","removeItem","setItem","value","EmojiManager","constructor","internalStorage","data","get","emojiStorage","strItem","freeze","JSON","parse","set","stringify","emojiContainer","container","category","emojiCategories","_emojiCategoryMap","id","emoji","emojis","_allEmojiMap","_allEmoji","values","emojiCategoryMap","allEmojiMap","allEmoji"],"sources":["EmojiManager.ts"],"sourcesContent":["import type { SendbirdEmoji, SendbirdEmojiCategory, SendbirdEmojiContainer } from '@sendbird/uikit-utils';\n\nimport type { LocalCacheStorage } from '../types';\nimport InternalLocalCacheStorage from './InternalLocalCacheStorage';\n\nclass MemoryStorage implements LocalCacheStorage {\n  _data: Record<string, string> = {};\n\n  async getAllKeys(): Promise<readonly string[] | string[]> {\n    return Object.keys(this._data);\n  }\n\n  async getItem(key: string): Promise<string | null> {\n    return this._data[key];\n  }\n\n  async removeItem(key: string): Promise<void> {\n    delete this._data[key];\n  }\n\n  async setItem(key: string, value: string): Promise<void> {\n    this._data[key] = value;\n  }\n}\n\nclass EmojiManager {\n  static key = 'sendbird-uikit@emoji-manager';\n\n  constructor(\n    private internalStorage: InternalLocalCacheStorage = new InternalLocalCacheStorage(new MemoryStorage()),\n  ) {}\n\n  private emojiStorage = {\n    data: null as null | SendbirdEmojiContainer,\n    get: async () => {\n      if (!this.emojiStorage.data) {\n        const strItem = await this.internalStorage.getItem(EmojiManager.key);\n        if (strItem) this.emojiStorage.data = Object.freeze(JSON.parse(strItem));\n      }\n      return this.emojiStorage.data;\n    },\n    set: async (data: SendbirdEmojiContainer) => {\n      this.emojiStorage.data = Object.freeze(data);\n      await this.internalStorage.setItem(EmojiManager.key, JSON.stringify(data));\n    },\n  };\n\n  private _emojiCategoryMap: Record<string, SendbirdEmojiCategory> = {};\n  public get emojiCategoryMap() {\n    return this._emojiCategoryMap;\n  }\n\n  private _allEmojiMap: Record<string, SendbirdEmoji> = {};\n  public get allEmojiMap() {\n    return this._allEmojiMap;\n  }\n\n  private _allEmoji: SendbirdEmoji[] = [];\n  public get allEmoji() {\n    return this._allEmoji;\n  }\n\n  public init = async (emojiContainer?: SendbirdEmojiContainer) => {\n    if (emojiContainer) await this.emojiStorage.set(emojiContainer);\n\n    const container = await this.emojiStorage.get();\n\n    if (container) {\n      for (const category of container.emojiCategories) {\n        this._emojiCategoryMap[category.id] = category;\n        for (const emoji of category.emojis) {\n          this._allEmojiMap[emoji.key] = emoji;\n        }\n      }\n      this._allEmoji = Object.values(this._allEmojiMap);\n    }\n  };\n}\n\nexport default EmojiManager;\n"],"mappings":";;AAGA,OAAOA,yBAAP,MAAsC,6BAAtC;;AAEA,MAAMC,aAAN,CAAiD;EAAA;IAAA,+BACf,EADe;EAAA;;EAG/B,MAAVC,UAAU,GAA0C;IACxD,OAAOC,MAAM,CAACC,IAAP,CAAY,KAAKC,KAAjB,CAAP;EACD;;EAEY,MAAPC,OAAO,CAACC,GAAD,EAAsC;IACjD,OAAO,KAAKF,KAAL,CAAWE,GAAX,CAAP;EACD;;EAEe,MAAVC,UAAU,CAACD,GAAD,EAA6B;IAC3C,OAAO,KAAKF,KAAL,CAAWE,GAAX,CAAP;EACD;;EAEY,MAAPE,OAAO,CAACF,GAAD,EAAcG,KAAd,EAA4C;IACvD,KAAKL,KAAL,CAAWE,GAAX,IAAkBG,KAAlB;EACD;;AAjB8C;;AAoBjD,MAAMC,YAAN,CAAmB;EAGjBC,WAAW,GAET;IAAA,IADQC,eACR,uEADqD,IAAIb,yBAAJ,CAA8B,IAAIC,aAAJ,EAA9B,CACrD;IAAA,KADQY,eACR,GADQA,eACR;;IAAA,sCAEqB;MACrBC,IAAI,EAAE,IADe;MAErBC,GAAG,EAAE,YAAY;QACf,IAAI,CAAC,KAAKC,YAAL,CAAkBF,IAAvB,EAA6B;UAC3B,MAAMG,OAAO,GAAG,MAAM,KAAKJ,eAAL,CAAqBP,OAArB,CAA6BK,YAAY,CAACJ,GAA1C,CAAtB;UACA,IAAIU,OAAJ,EAAa,KAAKD,YAAL,CAAkBF,IAAlB,GAAyBX,MAAM,CAACe,MAAP,CAAcC,IAAI,CAACC,KAAL,CAAWH,OAAX,CAAd,CAAzB;QACd;;QACD,OAAO,KAAKD,YAAL,CAAkBF,IAAzB;MACD,CARoB;MASrBO,GAAG,EAAE,MAAOP,IAAP,IAAwC;QAC3C,KAAKE,YAAL,CAAkBF,IAAlB,GAAyBX,MAAM,CAACe,MAAP,CAAcJ,IAAd,CAAzB;QACA,MAAM,KAAKD,eAAL,CAAqBJ,OAArB,CAA6BE,YAAY,CAACJ,GAA1C,EAA+CY,IAAI,CAACG,SAAL,CAAeR,IAAf,CAA/C,CAAN;MACD;IAZoB,CAFrB;;IAAA,2CAiBiE,EAjBjE;;IAAA,sCAsBoD,EAtBpD;;IAAA,mCA2BmC,EA3BnC;;IAAA,8BAgCY,MAAOS,cAAP,IAAmD;MAC/D,IAAIA,cAAJ,EAAoB,MAAM,KAAKP,YAAL,CAAkBK,GAAlB,CAAsBE,cAAtB,CAAN;MAEpB,MAAMC,SAAS,GAAG,MAAM,KAAKR,YAAL,CAAkBD,GAAlB,EAAxB;;MAEA,IAAIS,SAAJ,EAAe;QACb,KAAK,MAAMC,QAAX,IAAuBD,SAAS,CAACE,eAAjC,EAAkD;UAChD,KAAKC,iBAAL,CAAuBF,QAAQ,CAACG,EAAhC,IAAsCH,QAAtC;;UACA,KAAK,MAAMI,KAAX,IAAoBJ,QAAQ,CAACK,MAA7B,EAAqC;YACnC,KAAKC,YAAL,CAAkBF,KAAK,CAACtB,GAAxB,IAA+BsB,KAA/B;UACD;QACF;;QACD,KAAKG,SAAL,GAAiB7B,MAAM,CAAC8B,MAAP,CAAc,KAAKF,YAAnB,CAAjB;MACD;IACF,CA9CC;EAAE;;EAkBuB,IAAhBG,gBAAgB,GAAG;IAC5B,OAAO,KAAKP,iBAAZ;EACD;;EAGqB,IAAXQ,WAAW,GAAG;IACvB,OAAO,KAAKJ,YAAZ;EACD;;EAGkB,IAARK,QAAQ,GAAG;IACpB,OAAO,KAAKJ,SAAZ;EACD;;AAnCgB;;gBAAbrB,Y,SACS,8B;;AAqDf,eAAeA,YAAf"}