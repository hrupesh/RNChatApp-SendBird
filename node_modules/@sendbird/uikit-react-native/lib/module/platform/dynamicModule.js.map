{"version":3,"names":["NativeModules","UIManager","Logger","checkLink","dmi","logLevel","nativeModule","isComponent","getViewManagerConfig","nativeModuleNamespace","message","packageName","url","console","error","warn","SBUDynamicModuleRegistry","getPackage","require","e","SBUDynamicModule","register","mdi","getInfo","name","get"],"sources":["dynamicModule.ts"],"sourcesContent":["/* eslint-disable no-console */\nimport type * as RNCNetInfo from '@react-native-community/netinfo';\nimport { NativeModules, UIManager } from 'react-native';\n\nimport { Logger } from '@sendbird/uikit-utils';\n\nexport type SBUNativeModule = keyof DynamicModules;\n\ninterface SBUDynamicModuleInfo {\n  packageName: SBUNativeModule;\n  nativeModuleNamespace: string;\n  getPackage: <T>(logLevel: 'error' | 'warn' | 'none') => T;\n  url: string;\n  isComponent?: boolean;\n}\n\nfunction checkLink(dmi: SBUDynamicModuleInfo, logLevel: 'error' | 'warn' | 'none') {\n  const nativeModule = (() => {\n    if (dmi.isComponent) {\n      return UIManager.getViewManagerConfig(dmi.nativeModuleNamespace);\n    } else {\n      return NativeModules[dmi.nativeModuleNamespace];\n    }\n  })();\n\n  if (!nativeModule) {\n    const message = `[UIKit] Cannot use native module, you should install and link ${dmi.packageName} (${dmi.url})`;\n    if (logLevel === 'error') console.error(message);\n    if (logLevel === 'warn') console.warn(message);\n  }\n}\n\nexport interface DynamicModules {\n  '@react-native-community/netinfo': typeof RNCNetInfo;\n}\n\nconst SBUDynamicModuleRegistry: Record<SBUNativeModule, SBUDynamicModuleInfo> = {\n  '@react-native-community/netinfo': {\n    packageName: '@react-native-community/netinfo',\n    nativeModuleNamespace: 'RNCNetInfo',\n    url: 'https://github.com/react-native-netinfo/react-native-netinfo',\n    getPackage(logLevel) {\n      checkLink(this, logLevel);\n\n      try {\n        return require('@react-native-community/netinfo');\n      } catch (e) {\n        return null;\n      }\n    },\n  },\n};\n\nconst SBUDynamicModule = {\n  register(mdi: SBUDynamicModuleInfo) {\n    SBUDynamicModuleRegistry[mdi.nativeModuleNamespace as SBUNativeModule] = mdi;\n  },\n  getInfo(name: SBUNativeModule) {\n    return SBUDynamicModuleRegistry[name] ?? null;\n  },\n  get<K extends SBUNativeModule, T extends DynamicModules[K]>(name: K, logLevel: 'error' | 'warn' | 'none' = 'error') {\n    const dmi = this.getInfo(name);\n    if (!dmi) Logger.warn(`${name} doesn't exist in the dynamic module`);\n    return dmi?.getPackage<T>(logLevel);\n  },\n};\n\nexport default SBUDynamicModule;\n"],"mappings":"AAAA;AAEA,SAASA,aAAT,EAAwBC,SAAxB,QAAyC,cAAzC;AAEA,SAASC,MAAT,QAAuB,uBAAvB;;AAYA,SAASC,SAAT,CAAmBC,GAAnB,EAA8CC,QAA9C,EAAmF;EACjF,MAAMC,YAAY,GAAG,CAAC,MAAM;IAC1B,IAAIF,GAAG,CAACG,WAAR,EAAqB;MACnB,OAAON,SAAS,CAACO,oBAAV,CAA+BJ,GAAG,CAACK,qBAAnC,CAAP;IACD,CAFD,MAEO;MACL,OAAOT,aAAa,CAACI,GAAG,CAACK,qBAAL,CAApB;IACD;EACF,CANoB,GAArB;;EAQA,IAAI,CAACH,YAAL,EAAmB;IACjB,MAAMI,OAAO,GAAI,iEAAgEN,GAAG,CAACO,WAAY,KAAIP,GAAG,CAACQ,GAAI,GAA7G;IACA,IAAIP,QAAQ,KAAK,OAAjB,EAA0BQ,OAAO,CAACC,KAAR,CAAcJ,OAAd;IAC1B,IAAIL,QAAQ,KAAK,MAAjB,EAAyBQ,OAAO,CAACE,IAAR,CAAaL,OAAb;EAC1B;AACF;;AAMD,MAAMM,wBAAuE,GAAG;EAC9E,mCAAmC;IACjCL,WAAW,EAAE,iCADoB;IAEjCF,qBAAqB,EAAE,YAFU;IAGjCG,GAAG,EAAE,8DAH4B;;IAIjCK,UAAU,CAACZ,QAAD,EAAW;MACnBF,SAAS,CAAC,IAAD,EAAOE,QAAP,CAAT;;MAEA,IAAI;QACF,OAAOa,OAAO,CAAC,iCAAD,CAAd;MACD,CAFD,CAEE,OAAOC,CAAP,EAAU;QACV,OAAO,IAAP;MACD;IACF;;EAZgC;AAD2C,CAAhF;AAiBA,MAAMC,gBAAgB,GAAG;EACvBC,QAAQ,CAACC,GAAD,EAA4B;IAClCN,wBAAwB,CAACM,GAAG,CAACb,qBAAL,CAAxB,GAAyEa,GAAzE;EACD,CAHsB;;EAIvBC,OAAO,CAACC,IAAD,EAAwB;IAC7B,OAAOR,wBAAwB,CAACQ,IAAD,CAAxB,IAAkC,IAAzC;EACD,CANsB;;EAOvBC,GAAG,CAAyDD,IAAzD,EAAiH;IAAA,IAA/CnB,QAA+C,uEAAT,OAAS;IAClH,MAAMD,GAAG,GAAG,KAAKmB,OAAL,CAAaC,IAAb,CAAZ;IACA,IAAI,CAACpB,GAAL,EAAUF,MAAM,CAACa,IAAP,CAAa,GAAES,IAAK,sCAApB;IACV,OAAOpB,GAAP,aAAOA,GAAP,uBAAOA,GAAG,CAAEa,UAAL,CAAmBZ,QAAnB,CAAP;EACD;;AAXsB,CAAzB;AAcA,eAAee,gBAAf"}