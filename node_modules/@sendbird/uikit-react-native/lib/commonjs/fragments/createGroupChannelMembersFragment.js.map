{"version":3,"names":["noop","HOOK_NAME","createGroupChannelMembersFragment","initModule","UserListModule","createUserListModule","channel","onPressHeaderLeft","onPressHeaderRight","renderUser","uniqId","useUniqId","refreshSchedule","useRef","STRINGS","useLocalization","sdk","currentUser","useSendbirdChat","openMenu","useActionMenu","show","useUserProfile","users","refresh","loading","next","error","upsertUser","deleteUser","useUserList","queryCreator","createMemberListQuery","limit","useChannelHandler","onUserLeft","eventChannel","user","isDifferentChannel","userId","onUserBanned","onOperatorUpdated","current","clearTimeout","setTimeout","onUserMuted","isGroupChannel","memberFromChannel","members","find","it","memberFromList","isMuted","onUserUnmuted","_renderUser","useFreshCallback","selectedUsers","setSelectedUsers","profileUrl","role","LABELS","USER_BAR_OPERATOR","nickname","USER_NO_NAME","USER_BAR_ME_POSTFIX","ifOperator","myRole","menuItems","push","title","UNREGISTER_OPERATOR","REGISTER_AS_OPERATOR","onPress","removeOperators","addOperators","isBroadcast","ifMuted","UNMUTE","MUTE","unmuteUser","muteUser","BAN","style","banUser","GROUP_CHANNEL_MEMBERS","HEADER_TITLE","Boolean"],"sources":["createGroupChannelMembersFragment.tsx"],"sourcesContent":["import React, { useRef } from 'react';\n\nimport { useChannelHandler, useUserList } from '@sendbird/uikit-chat-hooks';\nimport type { ActionMenuItem } from '@sendbird/uikit-react-native-foundation';\nimport { Icon, useActionMenu } from '@sendbird/uikit-react-native-foundation';\nimport type { SendbirdMember } from '@sendbird/uikit-utils';\nimport { ifMuted, ifOperator, isDifferentChannel, useFreshCallback, useUniqId } from '@sendbird/uikit-utils';\n\nimport StatusComposition from '../components/StatusComposition';\nimport UserActionBar from '../components/UserActionBar';\nimport type { GroupChannelMembersFragment } from '../domain/groupChannelUserList/types';\nimport createUserListModule from '../domain/userList/module/createUserListModule';\nimport type { UserListModule } from '../domain/userList/types';\nimport { useLocalization, useSendbirdChat, useUserProfile } from '../hooks/useContext';\n\nconst noop = () => '';\nconst HOOK_NAME = 'createGroupChannelMembersFragment';\nconst createGroupChannelMembersFragment = (\n  initModule?: Partial<UserListModule<SendbirdMember>>,\n): GroupChannelMembersFragment<SendbirdMember> => {\n  const UserListModule = createUserListModule<SendbirdMember>(initModule);\n\n  return ({ channel, onPressHeaderLeft, onPressHeaderRight, renderUser }) => {\n    const uniqId = useUniqId(HOOK_NAME);\n\n    const refreshSchedule = useRef<NodeJS.Timeout>();\n    const { STRINGS } = useLocalization();\n    const { sdk, currentUser } = useSendbirdChat();\n    const { openMenu } = useActionMenu();\n    const { show } = useUserProfile();\n\n    const { users, refresh, loading, next, error, upsertUser, deleteUser } = useUserList(sdk, {\n      queryCreator: () => channel.createMemberListQuery({ limit: 20 }),\n    });\n\n    useChannelHandler(sdk, `${HOOK_NAME}_${uniqId}`, {\n      onUserLeft(eventChannel, user) {\n        if (isDifferentChannel(eventChannel, channel)) return;\n        deleteUser(user.userId);\n      },\n      onUserBanned(eventChannel, user) {\n        if (isDifferentChannel(eventChannel, channel)) return;\n        deleteUser(user.userId);\n      },\n      onOperatorUpdated(eventChannel) {\n        if (isDifferentChannel(eventChannel, channel)) return;\n        if (refreshSchedule.current) clearTimeout(refreshSchedule.current);\n        refreshSchedule.current = setTimeout(() => refresh(), 500);\n      },\n      onUserMuted(eventChannel, user) {\n        if (isDifferentChannel(eventChannel, channel) || !eventChannel.isGroupChannel()) return;\n\n        const memberFromChannel = eventChannel.members.find((it) => it.userId === user.userId);\n        if (memberFromChannel) return upsertUser(memberFromChannel);\n\n        const memberFromList = users.find((it) => it.userId === user.userId);\n        if (memberFromList) {\n          memberFromList.isMuted = true;\n          upsertUser(memberFromList);\n        }\n      },\n      onUserUnmuted(eventChannel, user) {\n        if (isDifferentChannel(eventChannel, channel) || !eventChannel.isGroupChannel()) return;\n\n        const memberFromChannel = eventChannel.members.find((it) => it.userId === user.userId);\n        if (memberFromChannel) return upsertUser(memberFromChannel);\n\n        const memberFromList = users.find((it) => it.userId === user.userId);\n        if (memberFromList) {\n          memberFromList.isMuted = false;\n          upsertUser(memberFromList);\n        }\n      },\n    });\n\n    const _renderUser: NonNullable<typeof renderUser> = useFreshCallback((user, selectedUsers, setSelectedUsers) => {\n      if (renderUser) return renderUser(user, selectedUsers, setSelectedUsers);\n\n      return (\n        <UserActionBar\n          muted={user.isMuted}\n          uri={user.profileUrl}\n          label={user.role === 'operator' ? STRINGS.LABELS.USER_BAR_OPERATOR : ''}\n          name={\n            (user.nickname || STRINGS.LABELS.USER_NO_NAME) +\n            (user.userId === currentUser?.userId ? STRINGS.LABELS.USER_BAR_ME_POSTFIX : '')\n          }\n          disabled={user.userId === currentUser?.userId}\n          onPressActionMenu={ifOperator(channel.myRole, () => {\n            const menuItems: ActionMenuItem['menuItems'] = [];\n\n            menuItems.push({\n              title: ifOperator(user.role, STRINGS.LABELS.UNREGISTER_OPERATOR, STRINGS.LABELS.REGISTER_AS_OPERATOR),\n              onPress: ifOperator(\n                user.role,\n                () => channel.removeOperators([user.userId]),\n                () => channel.addOperators([user.userId]),\n              ),\n            });\n\n            if (!channel.isBroadcast) {\n              menuItems.push({\n                title: ifMuted(user.isMuted, STRINGS.LABELS.UNMUTE, STRINGS.LABELS.MUTE),\n                onPress: ifMuted(\n                  user.isMuted,\n                  () => channel.unmuteUser(user),\n                  () => channel.muteUser(user),\n                ),\n              });\n            }\n\n            menuItems.push({\n              title: STRINGS.LABELS.BAN,\n              style: 'destructive',\n              onPress: () => channel.banUser(user),\n            });\n\n            openMenu({ title: user.nickname || STRINGS.LABELS.USER_NO_NAME, menuItems });\n          })}\n          onPressAvatar={() => show(user)}\n        />\n      );\n    });\n\n    return (\n      <UserListModule.Provider headerRight={noop} headerTitle={STRINGS.GROUP_CHANNEL_MEMBERS.HEADER_TITLE}>\n        <UserListModule.Header\n          shouldActivateHeaderRight={() => true}\n          onPressHeaderLeft={onPressHeaderLeft}\n          right={<Icon icon={'plus'} />}\n          onPressHeaderRight={async () => onPressHeaderRight()}\n        />\n        <StatusComposition\n          loading={loading}\n          LoadingComponent={<UserListModule.StatusLoading />}\n          error={Boolean(error)}\n          ErrorComponent={<UserListModule.StatusError onPressRetry={refresh} />}\n        >\n          <UserListModule.List\n            users={users}\n            renderUser={_renderUser}\n            onLoadNext={next}\n            ListEmptyComponent={<UserListModule.StatusEmpty />}\n          />\n        </StatusComposition>\n      </UserListModule.Provider>\n    );\n  };\n};\n\nexport default createGroupChannelMembersFragment;\n"],"mappings":"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"}