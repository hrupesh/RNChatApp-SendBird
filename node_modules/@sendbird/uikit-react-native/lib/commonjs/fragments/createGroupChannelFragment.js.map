{"version":3,"names":["createGroupChannelFragment","initModule","GroupChannelModule","createGroupChannelModule","renderNewMessagesButton","props","renderScrollToBottomButton","renderMessage","enableMessageGrouping","enableTypingIndicator","onPressHeaderLeft","NOOP","onPressHeaderRight","onPressImageMessage","onPressMediaMessage","onChannelDeleted","onBeforeSendFileMessage","PASS","onBeforeSendUserMessage","channel","keyboardAvoidOffset","queryCreator","collectionCreator","sortComparator","messageComparator","flatListProps","sdk","currentUser","useSendbirdChat","messages","nextMessages","newMessagesFromMembers","next","prev","sendFileMessage","sendUserMessage","updateFileMessage","updateUserMessage","resendMessage","deleteMessage","loading","useGroupChannelMessages","userId","enableCollectionWithoutLocalCache","_renderMessage","useFreshCallback","memoizedFlatListProps","useMemo","ListEmptyComponent","contentContainerStyle","flexGrow","onSendFileMessage","file","processedParams","onSendUserMessage","text","mention","message","mentionedUserIds","userIds","mentionedMessageTemplate","messageTemplate","mentionType","type","onUpdateFileMessage","editedFile","messageId","onUpdateUserMessage","editedText","SuggestedMentionList","shouldRenderInput","isBroadcast","myRole"],"sources":["createGroupChannelFragment.tsx"],"sourcesContent":["import React, { useMemo } from 'react';\n\nimport { useGroupChannelMessages } from '@sendbird/uikit-chat-hooks';\nimport { NOOP, PASS, SendbirdGroupChannel, messageComparator, useFreshCallback } from '@sendbird/uikit-utils';\n\nimport MessageRenderer from '../components/MessageRenderer';\nimport NewMessagesButton from '../components/NewMessagesButton';\nimport ScrollToBottomButton from '../components/ScrollToBottomButton';\nimport StatusComposition from '../components/StatusComposition';\nimport createGroupChannelModule from '../domain/groupChannel/module/createGroupChannelModule';\nimport type { GroupChannelFragment, GroupChannelModule, GroupChannelProps } from '../domain/groupChannel/types';\nimport { useSendbirdChat } from '../hooks/useContext';\n\nconst createGroupChannelFragment = (initModule?: Partial<GroupChannelModule>): GroupChannelFragment => {\n  const GroupChannelModule = createGroupChannelModule(initModule);\n\n  return ({\n    renderNewMessagesButton = (props) => <NewMessagesButton {...props} />,\n    renderScrollToBottomButton = (props) => <ScrollToBottomButton {...props} />,\n    renderMessage,\n    enableMessageGrouping = true,\n    enableTypingIndicator = true,\n    onPressHeaderLeft = NOOP,\n    onPressHeaderRight = NOOP,\n    onPressImageMessage,\n    onPressMediaMessage = NOOP,\n    onChannelDeleted = NOOP,\n    onBeforeSendFileMessage = PASS,\n    onBeforeSendUserMessage = PASS,\n    channel,\n    keyboardAvoidOffset,\n    queryCreator,\n    collectionCreator,\n    sortComparator = messageComparator,\n    flatListProps,\n  }) => {\n    const { sdk, currentUser } = useSendbirdChat();\n\n    const {\n      messages,\n      nextMessages,\n      newMessagesFromMembers,\n      next,\n      prev,\n      sendFileMessage,\n      sendUserMessage,\n      updateFileMessage,\n      updateUserMessage,\n      resendMessage,\n      deleteMessage,\n      loading,\n    } = useGroupChannelMessages(sdk, channel, currentUser?.userId, {\n      collectionCreator,\n      queryCreator,\n      sortComparator,\n      onChannelDeleted,\n      enableCollectionWithoutLocalCache: !queryCreator,\n    });\n\n    const _renderMessage: GroupChannelProps['MessageList']['renderMessage'] = useFreshCallback((props) => {\n      if (renderMessage) return renderMessage(props);\n      return <MessageRenderer {...props} />;\n    });\n\n    const memoizedFlatListProps = useMemo(\n      () => ({\n        ListEmptyComponent: <GroupChannelModule.StatusEmpty />,\n        contentContainerStyle: { flexGrow: 1 },\n        ...flatListProps,\n      }),\n      [loading, flatListProps],\n    );\n\n    const onSendFileMessage: GroupChannelProps['Input']['onSendFileMessage'] = useFreshCallback(async (file) => {\n      const processedParams = await onBeforeSendFileMessage({ file });\n      await sendFileMessage(processedParams);\n    });\n    const onSendUserMessage: GroupChannelProps['Input']['onSendUserMessage'] = useFreshCallback(\n      async (text, mention) => {\n        const processedParams = await onBeforeSendUserMessage({\n          message: text,\n          mentionedUserIds: mention?.userIds,\n          mentionedMessageTemplate: mention?.messageTemplate,\n          mentionType: mention?.type,\n        });\n        await sendUserMessage(processedParams);\n      },\n    );\n    const onUpdateFileMessage: GroupChannelProps['Input']['onUpdateFileMessage'] = useFreshCallback(\n      async (editedFile, message) => {\n        const processedParams = await onBeforeSendFileMessage({ file: editedFile });\n        await updateFileMessage(message.messageId, processedParams);\n      },\n    );\n    const onUpdateUserMessage: GroupChannelProps['Input']['onUpdateUserMessage'] = useFreshCallback(\n      async (editedText, message, mention) => {\n        const processedParams = await onBeforeSendUserMessage({\n          message: editedText,\n          mentionedUserIds: mention?.userIds,\n          mentionedMessageTemplate: mention?.messageTemplate,\n          mentionType: mention?.type,\n        });\n        await updateUserMessage(message.messageId, processedParams);\n      },\n    );\n\n    return (\n      <GroupChannelModule.Provider\n        channel={channel}\n        enableTypingIndicator={enableTypingIndicator}\n        keyboardAvoidOffset={keyboardAvoidOffset}\n      >\n        <GroupChannelModule.Header onPressHeaderLeft={onPressHeaderLeft} onPressHeaderRight={onPressHeaderRight} />\n        <StatusComposition loading={loading} LoadingComponent={<GroupChannelModule.StatusLoading />}>\n          <GroupChannelModule.MessageList\n            channel={channel}\n            enableMessageGrouping={enableMessageGrouping}\n            currentUserId={currentUser?.userId}\n            renderMessage={_renderMessage}\n            messages={messages}\n            nextMessages={nextMessages}\n            newMessagesFromMembers={newMessagesFromMembers}\n            onTopReached={prev}\n            onBottomReached={next}\n            renderNewMessagesButton={renderNewMessagesButton}\n            renderScrollToBottomButton={renderScrollToBottomButton}\n            onResendFailedMessage={resendMessage}\n            onDeleteMessage={deleteMessage}\n            onPressImageMessage={onPressImageMessage}\n            onPressMediaMessage={onPressMediaMessage}\n            flatListProps={memoizedFlatListProps}\n          />\n          <GroupChannelModule.Input\n            SuggestedMentionList={GroupChannelModule.SuggestedMentionList}\n            shouldRenderInput={shouldRenderInput(channel)}\n            onSendFileMessage={onSendFileMessage}\n            onSendUserMessage={onSendUserMessage}\n            onUpdateFileMessage={onUpdateFileMessage}\n            onUpdateUserMessage={onUpdateUserMessage}\n          />\n        </StatusComposition>\n      </GroupChannelModule.Provider>\n    );\n  };\n};\n\nfunction shouldRenderInput(channel: SendbirdGroupChannel) {\n  if (channel.isBroadcast) {\n    return channel.myRole === 'operator';\n  }\n\n  return true;\n}\n\nexport default createGroupChannelFragment;\n"],"mappings":"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"}