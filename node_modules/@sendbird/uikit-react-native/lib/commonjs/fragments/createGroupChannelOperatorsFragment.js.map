{"version":3,"names":["name","createGroupChannelOperatorsFragment","initModule","GroupChannelOperatorsModule","createGroupChannelOperatorsModule","channel","onPressHeaderLeft","onPressHeaderRight","renderUser","uniqId","useUniqId","STRINGS","useLocalization","sdk","currentUser","useSendbirdChat","openMenu","useActionMenu","show","useUserProfile","users","deleteUser","upsertUser","loading","refresh","next","error","useUserList","queryCreator","createOperatorListQuery","limit","useChannelHandler","onUserLeft","eventChannel","user","isDifferentChannel","userId","onUserBanned","onOperatorUpdated","updatedUsers","operatorsAdded","length","forEach","_renderUser","useFreshCallback","props","profileUrl","nickname","LABELS","USER_NO_NAME","USER_BAR_ME_POSTFIX","ifOperator","myRole","title","menuItems","UNREGISTER_OPERATOR","onPress","removeOperators","then","Boolean"],"sources":["createGroupChannelOperatorsFragment.tsx"],"sourcesContent":["import React from 'react';\n\nimport { useChannelHandler, useUserList } from '@sendbird/uikit-chat-hooks';\nimport { useActionMenu } from '@sendbird/uikit-react-native-foundation';\nimport { ifOperator, isDifferentChannel, useFreshCallback, useUniqId } from '@sendbird/uikit-utils';\n\nimport StatusComposition from '../components/StatusComposition';\nimport UserActionBar from '../components/UserActionBar';\nimport { createGroupChannelOperatorsModule } from '../domain/groupChannelOperators';\nimport type { GroupChannelOperatorsFragment, GroupChannelOperatorsModule } from '../domain/groupChannelOperators/types';\nimport { useLocalization, useSendbirdChat, useUserProfile } from '../hooks/useContext';\n\nconst name = 'createGroupChannelOperatorsFragment';\nconst createGroupChannelOperatorsFragment = (\n  initModule?: Partial<GroupChannelOperatorsModule>,\n): GroupChannelOperatorsFragment => {\n  const GroupChannelOperatorsModule = createGroupChannelOperatorsModule(initModule);\n\n  return ({ channel, onPressHeaderLeft, onPressHeaderRight, renderUser }) => {\n    const uniqId = useUniqId(name);\n\n    const { STRINGS } = useLocalization();\n    const { sdk, currentUser } = useSendbirdChat();\n    const { openMenu } = useActionMenu();\n    const { show } = useUserProfile();\n\n    const { users, deleteUser, upsertUser, loading, refresh, next, error } = useUserList(sdk, {\n      queryCreator: () => channel.createOperatorListQuery({ limit: 20 }),\n    });\n\n    useChannelHandler(sdk, `${name}_${uniqId}`, {\n      onUserLeft(eventChannel, user) {\n        if (isDifferentChannel(eventChannel, channel)) return;\n        deleteUser(user.userId);\n      },\n      onUserBanned(eventChannel, user) {\n        if (isDifferentChannel(eventChannel, channel)) return;\n        deleteUser(user.userId);\n      },\n      onOperatorUpdated(eventChannel, updatedUsers) {\n        if (isDifferentChannel(eventChannel, channel)) return;\n        const operatorsAdded = users.length < updatedUsers.length;\n        if (operatorsAdded) updatedUsers.forEach(upsertUser);\n      },\n    });\n\n    const _renderUser: NonNullable<typeof renderUser> = useFreshCallback((props) => {\n      if (renderUser) return renderUser(props);\n\n      const { user } = props;\n      return (\n        <UserActionBar\n          muted={false}\n          uri={user.profileUrl}\n          name={\n            (user.nickname || STRINGS.LABELS.USER_NO_NAME) +\n            (user.userId === currentUser?.userId ? STRINGS.LABELS.USER_BAR_ME_POSTFIX : '')\n          }\n          disabled={user.userId === currentUser?.userId}\n          onPressAvatar={() => show(user)}\n          onPressActionMenu={ifOperator(channel.myRole, () => {\n            openMenu({\n              title: user.nickname || STRINGS.LABELS.USER_NO_NAME,\n              menuItems: [\n                {\n                  title: STRINGS.LABELS.UNREGISTER_OPERATOR,\n                  onPress: () => channel.removeOperators([user.userId]).then(() => deleteUser(user.userId)),\n                },\n              ],\n            });\n          })}\n        />\n      );\n    });\n\n    return (\n      <GroupChannelOperatorsModule.Provider channel={channel}>\n        <GroupChannelOperatorsModule.Header\n          onPressHeaderLeft={onPressHeaderLeft}\n          onPressHeaderRight={onPressHeaderRight}\n        />\n\n        <StatusComposition\n          loading={loading}\n          LoadingComponent={<GroupChannelOperatorsModule.StatusLoading />}\n          error={Boolean(error)}\n          ErrorComponent={<GroupChannelOperatorsModule.StatusError onPressRetry={refresh} />}\n        >\n          <GroupChannelOperatorsModule.List\n            operators={users}\n            renderUser={_renderUser}\n            onLoadNext={next}\n            ListEmptyComponent={<GroupChannelOperatorsModule.StatusEmpty />}\n          />\n        </StatusComposition>\n      </GroupChannelOperatorsModule.Provider>\n    );\n  };\n};\n\nexport default createGroupChannelOperatorsFragment;\n"],"mappings":"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"}