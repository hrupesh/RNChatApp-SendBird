{"version":3,"names":["ANDROID_BUG_ALERT_SHOWED","Platform","OS","BOTTOM_DETECT_THRESHOLD","hasReachedToBottom","yPos","thresholdPx","ChatFlatList","forwardRef","CustomFlatList","ref","onTopReached","nextMessages","onBottomReached","onLeaveScrollBottom","onScroll","currentUserId","props","select","useUIKitTheme","scrollRef","useRef","useImperativeHandle","scrollToBottom","animated","current","scrollToOffset","offset","useEffect","latestMessage","length","isMyMessage","_onScroll","useCallback","event","contentOffset","nativeEvent","y","__DEV__","console","warn","light","dark","Boolean","data","getMessageUniqId"],"sources":["ChatFlatList.tsx"],"sourcesContent":["import React, { forwardRef, useCallback, useEffect, useImperativeHandle, useRef } from 'react';\nimport { FlatList, FlatListProps, Platform } from 'react-native';\n\nimport { useUIKitTheme } from '@sendbird/uikit-react-native-foundation';\nimport { SendbirdMessage, getMessageUniqId, isMyMessage } from '@sendbird/uikit-utils';\n\nlet ANDROID_BUG_ALERT_SHOWED = Platform.OS !== 'android';\nconst BOTTOM_DETECT_THRESHOLD = 25;\n// const AUTO_SCROLL_TO_TOP_THRESHOLD = 15;\n\nfunction hasReachedToBottom(yPos: number, thresholdPx = 0) {\n  return thresholdPx >= yPos;\n}\n\nexport type ChatFlatListRef = { scrollToBottom: (animated?: boolean) => void };\ntype Props = Omit<FlatListProps<SendbirdMessage>, 'onEndReached'> & {\n  currentUserId?: string;\n  onBottomReached: () => void;\n  onTopReached: () => void;\n  nextMessages: SendbirdMessage[];\n  onLeaveScrollBottom: (value: boolean) => void;\n};\n// FIXME: Inverted FlatList performance issue on Android {@link https://github.com/facebook/react-native/issues/30034}\nconst ChatFlatList = forwardRef<ChatFlatListRef, Props>(function CustomFlatList(\n  { onTopReached, nextMessages, onBottomReached, onLeaveScrollBottom, onScroll, currentUserId, ...props },\n  ref,\n) {\n  const { select } = useUIKitTheme();\n  const scrollRef = useRef<FlatList<SendbirdMessage>>(null);\n  const yPos = useRef(0);\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      scrollToBottom: (animated = true) => scrollRef.current?.scrollToOffset({ animated, offset: 0 }),\n    }),\n    [],\n  );\n\n  useEffect(() => {\n    const latestMessage = nextMessages[nextMessages.length - 1];\n    if (!latestMessage) return;\n\n    if (hasReachedToBottom(yPos.current)) {\n      onBottomReached();\n    } else if (isMyMessage(latestMessage, currentUserId)) {\n      scrollRef.current?.scrollToOffset({ animated: false, offset: 0 });\n    }\n  }, [onBottomReached, nextMessages, currentUserId]);\n\n  const _onScroll = useCallback<NonNullable<Props['onScroll']>>(\n    (event) => {\n      const { contentOffset } = event.nativeEvent;\n      if (BOTTOM_DETECT_THRESHOLD < yPos.current && contentOffset.y <= BOTTOM_DETECT_THRESHOLD) {\n        onLeaveScrollBottom(false);\n      } else if (BOTTOM_DETECT_THRESHOLD < contentOffset.y && yPos.current <= BOTTOM_DETECT_THRESHOLD) {\n        onLeaveScrollBottom(true);\n      }\n\n      yPos.current = contentOffset.y;\n\n      onScroll?.(event);\n      if (hasReachedToBottom(yPos.current)) onBottomReached();\n    },\n    [onScroll, onBottomReached],\n  );\n\n  if (__DEV__ && !ANDROID_BUG_ALERT_SHOWED) {\n    ANDROID_BUG_ALERT_SHOWED = true;\n    // eslint-disable-next-line no-console\n    console.warn(\n      'UIKit Warning: Inverted FlatList has a performance issue on Android, Maybe this is a bug please refer link\\nhttps://github.com/facebook/react-native/issues/30034',\n    );\n  }\n\n  return (\n    <FlatList\n      bounces={false}\n      removeClippedSubviews\n      keyboardDismissMode={'on-drag'}\n      keyboardShouldPersistTaps={'handled'}\n      indicatorStyle={select({ light: 'black', dark: 'white' })}\n      {...props}\n      // FIXME: inverted list of ListEmptyComponent is reversed {@link https://github.com/facebook/react-native/issues/21196#issuecomment-836937743}\n      inverted={Boolean(props.data?.length)}\n      // FIXME: maintainVisibleContentPosition is not working on Android {@link https://github.com/facebook/react-native/issues/25239}\n      // maintainVisibleContentPosition={{ minIndexForVisible: 1, autoscrollToTopThreshold: AUTO_SCROLL_TO_TOP_THRESHOLD }}\n      ref={scrollRef}\n      onEndReachedThreshold={0.5}\n      onEndReached={onTopReached}\n      scrollEventThrottle={16}\n      onScroll={_onScroll}\n      keyExtractor={getMessageUniqId}\n    />\n  );\n});\n\nexport default ChatFlatList;\n"],"mappings":"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"}