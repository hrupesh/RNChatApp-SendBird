{"version":3,"names":["usePushTokenRegistration","sdk","useSendbirdChat","notificationService","usePlatformService","refreshListener","useRef","registerToken","unregisterToken","getToken","useIIFE","Platform","select","ios","token","registerAPNSPushTokenForCurrentUser","default","registerFCMPushTokenForCurrentUser","unregisterAPNSPushTokenForCurrentUser","unregisterFCMPushTokenForCurrentUser","getAPNSToken","getFCMToken","registerPushTokenForCurrentUser","useFreshCallback","hasPermission","hasPushPermission","pushPermission","requestPushPermission","Logger","warn","log","current","onTokenRefresh","unregisterPushTokenForCurrentUser"],"sources":["usePushTokenRegistration.ts"],"sourcesContent":["import { useRef } from 'react';\nimport { Platform } from 'react-native';\n\nimport { Logger, useFreshCallback, useIIFE } from '@sendbird/uikit-utils';\n\nimport { usePlatformService, useSendbirdChat } from './useContext';\n\nconst usePushTokenRegistration = () => {\n  const { sdk } = useSendbirdChat();\n  const { notificationService } = usePlatformService();\n\n  const refreshListener = useRef<() => void>();\n  const [registerToken, unregisterToken, getToken] = useIIFE(() => {\n    return [\n      Platform.select({\n        ios: (token: string) => sdk.registerAPNSPushTokenForCurrentUser(token),\n        default: (token: string) => sdk.registerFCMPushTokenForCurrentUser(token),\n      }),\n      Platform.select({\n        ios: (token: string) => sdk.unregisterAPNSPushTokenForCurrentUser(token),\n        default: (token: string) => sdk.unregisterFCMPushTokenForCurrentUser(token),\n      }),\n      Platform.select({\n        ios: notificationService.getAPNSToken,\n        default: notificationService.getFCMToken,\n      }),\n    ];\n  });\n\n  const registerPushTokenForCurrentUser = useFreshCallback(async () => {\n    // Check and request push permission\n    const hasPermission = await notificationService.hasPushPermission();\n    if (!hasPermission) {\n      const pushPermission = await notificationService.requestPushPermission();\n      if (!pushPermission) {\n        Logger.warn('[usePushTokenRegistration]', 'Not granted push permission');\n        return;\n      }\n    }\n\n    // Register device token\n    const token = await getToken();\n    if (token) {\n      Logger.log('[usePushTokenRegistration]', 'registered token:', token);\n      registerToken(token);\n    }\n\n    // Remove listener\n    refreshListener.current = notificationService.onTokenRefresh(registerToken);\n  });\n\n  const unregisterPushTokenForCurrentUser = useFreshCallback(async () => {\n    const token = await getToken();\n    if (token) {\n      unregisterToken(token);\n      Logger.log('[usePushTokenRegistration]', 'unregistered token:', token);\n    }\n    refreshListener.current?.();\n  });\n\n  return { registerPushTokenForCurrentUser, unregisterPushTokenForCurrentUser };\n};\n\nexport default usePushTokenRegistration;\n"],"mappings":";;;;;;;AAAA;;AACA;;AAEA;;AAEA;;AAEA,MAAMA,wBAAwB,GAAG,MAAM;EACrC,MAAM;IAAEC;EAAF,IAAU,IAAAC,2BAAA,GAAhB;EACA,MAAM;IAAEC;EAAF,IAA0B,IAAAC,8BAAA,GAAhC;EAEA,MAAMC,eAAe,GAAG,IAAAC,aAAA,GAAxB;EACA,MAAM,CAACC,aAAD,EAAgBC,eAAhB,EAAiCC,QAAjC,IAA6C,IAAAC,mBAAA,EAAQ,MAAM;IAC/D,OAAO,CACLC,qBAAA,CAASC,MAAT,CAAgB;MACdC,GAAG,EAAGC,KAAD,IAAmBb,GAAG,CAACc,mCAAJ,CAAwCD,KAAxC,CADV;MAEdE,OAAO,EAAGF,KAAD,IAAmBb,GAAG,CAACgB,kCAAJ,CAAuCH,KAAvC;IAFd,CAAhB,CADK,EAKLH,qBAAA,CAASC,MAAT,CAAgB;MACdC,GAAG,EAAGC,KAAD,IAAmBb,GAAG,CAACiB,qCAAJ,CAA0CJ,KAA1C,CADV;MAEdE,OAAO,EAAGF,KAAD,IAAmBb,GAAG,CAACkB,oCAAJ,CAAyCL,KAAzC;IAFd,CAAhB,CALK,EASLH,qBAAA,CAASC,MAAT,CAAgB;MACdC,GAAG,EAAEV,mBAAmB,CAACiB,YADX;MAEdJ,OAAO,EAAEb,mBAAmB,CAACkB;IAFf,CAAhB,CATK,CAAP;EAcD,CAfkD,CAAnD;EAiBA,MAAMC,+BAA+B,GAAG,IAAAC,4BAAA,EAAiB,YAAY;IACnE;IACA,MAAMC,aAAa,GAAG,MAAMrB,mBAAmB,CAACsB,iBAApB,EAA5B;;IACA,IAAI,CAACD,aAAL,EAAoB;MAClB,MAAME,cAAc,GAAG,MAAMvB,mBAAmB,CAACwB,qBAApB,EAA7B;;MACA,IAAI,CAACD,cAAL,EAAqB;QACnBE,kBAAA,CAAOC,IAAP,CAAY,4BAAZ,EAA0C,6BAA1C;;QACA;MACD;IACF,CATkE,CAWnE;;;IACA,MAAMf,KAAK,GAAG,MAAML,QAAQ,EAA5B;;IACA,IAAIK,KAAJ,EAAW;MACTc,kBAAA,CAAOE,GAAP,CAAW,4BAAX,EAAyC,mBAAzC,EAA8DhB,KAA9D;;MACAP,aAAa,CAACO,KAAD,CAAb;IACD,CAhBkE,CAkBnE;;;IACAT,eAAe,CAAC0B,OAAhB,GAA0B5B,mBAAmB,CAAC6B,cAApB,CAAmCzB,aAAnC,CAA1B;EACD,CApBuC,CAAxC;EAsBA,MAAM0B,iCAAiC,GAAG,IAAAV,4BAAA,EAAiB,YAAY;IAAA;;IACrE,MAAMT,KAAK,GAAG,MAAML,QAAQ,EAA5B;;IACA,IAAIK,KAAJ,EAAW;MACTN,eAAe,CAACM,KAAD,CAAf;;MACAc,kBAAA,CAAOE,GAAP,CAAW,4BAAX,EAAyC,qBAAzC,EAAgEhB,KAAhE;IACD;;IACD,yBAAAT,eAAe,CAAC0B,OAAhB,qFAAA1B,eAAe;EAChB,CAPyC,CAA1C;EASA,OAAO;IAAEiB,+BAAF;IAAmCW;EAAnC,CAAP;AACD,CAtDD;;eAwDejC,wB"}