{"version":3,"names":["HANDLE_NEXT_MSG_SEPARATELY","Platform","select","default","GroupChannelMessageList","currentUserId","channel","messages","renderMessage","nextMessages","newMessagesFromMembers","onBottomReached","onTopReached","renderNewMessagesButton","renderScrollToBottomButton","onResendFailedMessage","onDeleteMessage","onPressImageMessage","onPressMediaMessage","flatListProps","enableMessageGrouping","STRINGS","useLocalization","colors","useUIKitTheme","left","right","useSafeAreaInsets","scrollLeaveBottom","setScrollLeaveBottom","useState","scrollRef","useRef","newMessagesInternalBuffer","setNewMessagesInternalBuffer","getMessagePressActions","useGetMessagePressActions","safeAreaLayout","paddingLeft","paddingRight","renderItem","useFreshCallback","item","index","onPress","onLongPress","message","prevMessage","nextMessage","useEffect","length","prev","concat","onLeaveScrollBottom","useCallback","val","flex","backgroundColor","background","isFrozen","styles","frozenBanner","GROUP_CHANNEL","LIST_BANNER_FROZEN","url","messageKeyExtractor","frozenListPadding","contentContainerStyle","newMsgButton","visible","current","scrollToBottom","newMessages","scrollButton","toast","useToast","openSheet","useBottomSheet","alert","useAlert","clipboardService","fileService","usePlatformService","features","useSendbirdChat","setMessageToEdit","useContext","GroupChannelContexts","Fragment","handleFailedMessage","sheetItems","title","DIALOG_MESSAGE_FAILED_RETRY","catch","show","TOAST","RESEND_MSG_ERROR","DIALOG_MESSAGE_FAILED_REMOVE","titleColor","ui","dialog","none","destructive","confirmDelete","DIALOG_MESSAGE_DELETE_CONFIRM_TITLE","buttons","text","DIALOG_MESSAGE_DELETE_CONFIRM_CANCEL","DIALOG_MESSAGE_DELETE_CONFIRM_OK","style","DELETE_MSG_ERROR","msg","isUserMessage","isFileMessage","undefined","response","push","icon","DIALOG_MESSAGE_COPY","setString","COPY_OK","isMyMessage","sendingStatus","DIALOG_MESSAGE_EDIT","DIALOG_MESSAGE_DELETE","DIALOG_MESSAGE_SAVE","toMegabyte","size","DOWNLOAD_START","save","fileUrl","fileName","name","fileType","type","then","DOWNLOAD_OK","Logger","log","err","DOWNLOAD_ERROR","getFileType","getFileExtension","warn","DEPRECATION_WARNING","ON_PRESS_IMAGE_MESSAGE","getAvailableUriFromFileMessage","SBUUtils","openURL","HeaderComponent","shouldRenderReaction","reactionEnabled","onClose","createStyleSheet","position","zIndex","top","paddingBottom","bottom","alignSelf","React","memo"],"sources":["GroupChannelMessageList.tsx"],"sourcesContent":["import React, { useCallback, useContext, useEffect, useRef, useState } from 'react';\nimport { ListRenderItem, Platform, View } from 'react-native';\nimport { useSafeAreaInsets } from 'react-native-safe-area-context';\n\nimport type { BottomSheetItem } from '@sendbird/uikit-react-native-foundation';\nimport {\n  ChannelFrozenBanner,\n  createStyleSheet,\n  useAlert,\n  useBottomSheet,\n  useToast,\n  useUIKitTheme,\n} from '@sendbird/uikit-react-native-foundation';\nimport type { SendbirdFileMessage, SendbirdMessage, SendbirdUserMessage } from '@sendbird/uikit-utils';\nimport {\n  Logger,\n  getAvailableUriFromFileMessage,\n  getFileExtension,\n  getFileType,\n  isMyMessage,\n  messageKeyExtractor,\n  shouldRenderReaction,\n  toMegabyte,\n  useFreshCallback,\n} from '@sendbird/uikit-utils';\n\nimport type { ChatFlatListRef } from '../../../components/ChatFlatList';\nimport ChatFlatList from '../../../components/ChatFlatList';\nimport { ReactionAddons } from '../../../components/ReactionAddons';\nimport { DEPRECATION_WARNING } from '../../../constants';\nimport { useLocalization, usePlatformService, useSendbirdChat } from '../../../hooks/useContext';\nimport SBUUtils from '../../../libs/SBUUtils';\nimport { GroupChannelContexts } from '../module/moduleContext';\nimport type { GroupChannelProps } from '../types';\n\nconst HANDLE_NEXT_MSG_SEPARATELY = Platform.select({ default: true });\n\nconst GroupChannelMessageList = ({\n  currentUserId,\n  channel,\n  messages,\n  renderMessage,\n  nextMessages,\n  newMessagesFromMembers,\n  onBottomReached,\n  onTopReached,\n  renderNewMessagesButton,\n  renderScrollToBottomButton,\n  onResendFailedMessage,\n  onDeleteMessage,\n  onPressImageMessage,\n  onPressMediaMessage,\n  flatListProps,\n  enableMessageGrouping,\n}: GroupChannelProps['MessageList']) => {\n  const { STRINGS } = useLocalization();\n  const { colors } = useUIKitTheme();\n  const { left, right } = useSafeAreaInsets();\n  const [scrollLeaveBottom, setScrollLeaveBottom] = useState(false);\n  const scrollRef = useRef<ChatFlatListRef>(null);\n  const [newMessagesInternalBuffer, setNewMessagesInternalBuffer] = useState(() => newMessagesFromMembers);\n  const getMessagePressActions = useGetMessagePressActions({\n    channel,\n    currentUserId,\n    onDeleteMessage,\n    onResendFailedMessage,\n    onPressImageMessage,\n    onPressMediaMessage,\n  });\n\n  const safeAreaLayout = { paddingLeft: left, paddingRight: right };\n\n  const renderItem: ListRenderItem<SendbirdMessage> = useFreshCallback(({ item, index }) => {\n    const { onPress, onLongPress } = getMessagePressActions(item);\n    return renderMessage({\n      message: item,\n      prevMessage: messages[index + 1],\n      nextMessage: messages[index - 1],\n      onPress,\n      onLongPress,\n      enableMessageGrouping,\n      channel,\n      currentUserId,\n    });\n  });\n\n  if (!HANDLE_NEXT_MSG_SEPARATELY) {\n    useEffect(() => {\n      if (newMessagesInternalBuffer.length !== 0) {\n        setNewMessagesInternalBuffer((prev) => prev.concat(newMessagesFromMembers));\n      }\n      onBottomReached();\n    }, [newMessagesFromMembers]);\n  }\n\n  const onLeaveScrollBottom = useCallback((val: boolean) => {\n    if (!HANDLE_NEXT_MSG_SEPARATELY) setNewMessagesInternalBuffer([]);\n    setScrollLeaveBottom(val);\n  }, []);\n\n  return (\n    <View style={[{ flex: 1, backgroundColor: colors.background }, safeAreaLayout]}>\n      {channel.isFrozen && (\n        <ChannelFrozenBanner style={styles.frozenBanner} text={STRINGS.GROUP_CHANNEL.LIST_BANNER_FROZEN} />\n      )}\n      <ChatFlatList\n        nextMessages={nextMessages}\n        onBottomReached={onBottomReached}\n        onTopReached={onTopReached}\n        onLeaveScrollBottom={onLeaveScrollBottom}\n        currentUserId={currentUserId}\n        {...flatListProps}\n        listKey={`group-channel-messages-${channel.url}`}\n        ref={scrollRef}\n        data={messages}\n        renderItem={renderItem}\n        keyExtractor={messageKeyExtractor}\n        contentContainerStyle={[\n          // { minHeight: '100%', justifyContent: 'flex-end' },\n          channel.isFrozen && styles.frozenListPadding,\n          flatListProps?.contentContainerStyle,\n        ]}\n      />\n      {renderNewMessagesButton && (\n        <View style={[styles.newMsgButton, safeAreaLayout]}>\n          {renderNewMessagesButton({\n            visible: scrollLeaveBottom,\n            onPress: () => scrollRef.current?.scrollToBottom(false),\n            newMessages: !HANDLE_NEXT_MSG_SEPARATELY ? newMessagesInternalBuffer : newMessagesFromMembers,\n          })}\n        </View>\n      )}\n      {renderScrollToBottomButton && (\n        <View pointerEvents={scrollLeaveBottom ? 'auto' : 'none'} style={[styles.scrollButton, safeAreaLayout]}>\n          {renderScrollToBottomButton({\n            visible: scrollLeaveBottom,\n            onPress: () => scrollRef.current?.scrollToBottom(false),\n          })}\n        </View>\n      )}\n    </View>\n  );\n};\n\ntype HandleableMessage = SendbirdUserMessage | SendbirdFileMessage;\nconst useGetMessagePressActions = ({\n  channel,\n  currentUserId,\n  onResendFailedMessage,\n  onDeleteMessage,\n  onPressImageMessage,\n  onPressMediaMessage,\n}: Pick<\n  GroupChannelProps['MessageList'],\n  | 'channel'\n  | 'currentUserId'\n  | 'onResendFailedMessage'\n  | 'onDeleteMessage'\n  | 'onPressImageMessage'\n  | 'onPressMediaMessage'\n>) => {\n  const { colors } = useUIKitTheme();\n  const { STRINGS } = useLocalization();\n  const toast = useToast();\n  const { openSheet } = useBottomSheet();\n  const { alert } = useAlert();\n  const { clipboardService, fileService } = usePlatformService();\n  const { features } = useSendbirdChat();\n  const { setMessageToEdit } = useContext(GroupChannelContexts.Fragment);\n\n  const handleFailedMessage = (message: HandleableMessage) => {\n    openSheet({\n      sheetItems: [\n        {\n          title: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_FAILED_RETRY,\n          onPress: () =>\n            onResendFailedMessage(message).catch(() => toast.show(STRINGS.TOAST.RESEND_MSG_ERROR, 'error')),\n        },\n        {\n          title: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_FAILED_REMOVE,\n          titleColor: colors.ui.dialog.default.none.destructive,\n          onPress: () => confirmDelete(message),\n        },\n      ],\n    });\n  };\n  const confirmDelete = (message: HandleableMessage) => {\n    alert({\n      title: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_DELETE_CONFIRM_TITLE,\n      buttons: [\n        {\n          text: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_DELETE_CONFIRM_CANCEL,\n        },\n        {\n          text: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_DELETE_CONFIRM_OK,\n          style: 'destructive',\n          onPress: () => onDeleteMessage(message).catch(() => toast.show(STRINGS.TOAST.DELETE_MSG_ERROR, 'error')),\n        },\n      ],\n    });\n  };\n\n  return (msg: SendbirdMessage) => {\n    if (!msg.isUserMessage() && !msg.isFileMessage()) {\n      return { onPress: undefined, onLongPress: undefined };\n    }\n\n    const sheetItems: BottomSheetItem['sheetItems'] = [];\n    const response: { onPress?: () => void; onLongPress?: () => void } = {\n      onPress: undefined,\n      onLongPress: undefined,\n    };\n\n    if (msg.isUserMessage()) {\n      sheetItems.push({\n        icon: 'copy',\n        title: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_COPY,\n        onPress: () => {\n          clipboardService.setString(msg.message || '');\n          toast.show(STRINGS.TOAST.COPY_OK, 'success');\n        },\n      });\n\n      if (isMyMessage(msg, currentUserId) && msg.sendingStatus === 'succeeded') {\n        sheetItems.push(\n          {\n            icon: 'edit',\n            title: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_EDIT,\n            onPress: () => setMessageToEdit(msg),\n          },\n          {\n            icon: 'delete',\n            title: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_DELETE,\n            onPress: () => confirmDelete(msg),\n          },\n        );\n      }\n    }\n\n    if (msg.isFileMessage()) {\n      sheetItems.push({\n        icon: 'download',\n        title: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_SAVE,\n        onPress: async () => {\n          if (toMegabyte(msg.size) > 4) {\n            toast.show(STRINGS.TOAST.DOWNLOAD_START, 'success');\n          }\n\n          fileService\n            .save({ fileUrl: msg.url, fileName: msg.name, fileType: msg.type })\n            .then((response) => {\n              toast.show(STRINGS.TOAST.DOWNLOAD_OK, 'success');\n              Logger.log('File saved to', response);\n            })\n            .catch((err) => {\n              toast.show(STRINGS.TOAST.DOWNLOAD_ERROR, 'error');\n              Logger.log('File save failure', err);\n            });\n        },\n      });\n\n      if (isMyMessage(msg, currentUserId) && msg.sendingStatus === 'succeeded') {\n        sheetItems.push({\n          icon: 'delete',\n          title: STRINGS.GROUP_CHANNEL.DIALOG_MESSAGE_DELETE,\n          onPress: () => confirmDelete(msg),\n        });\n      }\n\n      const fileType = getFileType(msg.type || getFileExtension(msg.name));\n      switch (fileType) {\n        case 'image':\n        case 'video':\n        case 'audio': {\n          response.onPress = () => {\n            if (onPressImageMessage && fileType === 'image') {\n              Logger.warn(DEPRECATION_WARNING.GROUP_CHANNEL.ON_PRESS_IMAGE_MESSAGE);\n              onPressImageMessage(msg, getAvailableUriFromFileMessage(msg));\n            }\n            onPressMediaMessage?.(msg, () => onDeleteMessage(msg), getAvailableUriFromFileMessage(msg));\n          };\n          break;\n        }\n        default: {\n          response.onPress = () => SBUUtils.openURL(msg.url);\n          break;\n        }\n      }\n    }\n\n    if (sheetItems.length > 0) {\n      response.onLongPress = () => {\n        openSheet({\n          sheetItems,\n          HeaderComponent: shouldRenderReaction(channel, features.reactionEnabled)\n            ? ({ onClose }) => <ReactionAddons.BottomSheet message={msg} channel={channel} onClose={onClose} />\n            : undefined,\n        });\n      };\n    }\n\n    if (msg.sendingStatus === 'failed') {\n      response.onLongPress = () => handleFailedMessage(msg);\n      response.onPress = () => {\n        onResendFailedMessage(msg).catch(() => toast.show(STRINGS.TOAST.RESEND_MSG_ERROR, 'error'));\n      };\n    }\n\n    if (msg.sendingStatus === 'pending') {\n      response.onLongPress = undefined;\n      response.onPress = undefined;\n    }\n\n    return response;\n  };\n};\n\nconst styles = createStyleSheet({\n  frozenBanner: {\n    position: 'absolute',\n    zIndex: 999,\n    top: 8,\n    left: 8,\n    right: 8,\n  },\n  frozenListPadding: {\n    paddingBottom: 32,\n  },\n  newMsgButton: {\n    position: 'absolute',\n    zIndex: 999,\n    bottom: 10,\n    alignSelf: 'center',\n  },\n  scrollButton: {\n    position: 'absolute',\n    zIndex: 998,\n    bottom: 10,\n    right: 16,\n  },\n});\n\nexport default React.memo(GroupChannelMessageList);\n"],"mappings":"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"}