import { format, isThisYear, isToday, isYesterday } from 'date-fns';
import { truncate } from './common';
export const getGroupChannelTitle = function (currentUserId, channel) {
  let EMPTY_USERNAME = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '(No name)';
  let NO_MEMBERS = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : '(No members)';
  let DEFAULT_CHANNEL_NAME = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 'Group Channel';
  if (channel.name !== DEFAULT_CHANNEL_NAME && channel.name !== '') return channel.name;
  if (channel.memberCount === 1) return NO_MEMBERS;
  return channel.members.filter(_ref => {
    let {
      userId
    } = _ref;
    return userId !== currentUserId;
  }).map(_ref2 => {
    let {
      nickname
    } = _ref2;
    return nickname || EMPTY_USERNAME;
  }).join(', ');
};
export const getGroupChannelPreviewTime = (channel, locale) => {
  var _channel$lastMessage;

  const timestamp = ((_channel$lastMessage = channel.lastMessage) === null || _channel$lastMessage === void 0 ? void 0 : _channel$lastMessage.createdAt) || channel.joinedAt * 1000 || channel.createdAt;
  if (isToday(timestamp)) return format(timestamp, 'p', {
    locale
  });
  if (isYesterday(timestamp)) return 'Yesterday';
  if (isThisYear(timestamp)) return format(timestamp, 'MMM dd', {
    locale
  });
  return format(timestamp, 'yyyy/MM/dd', {
    locale
  });
};
export const getGroupChannelLastMessage = function (channel) {
  let EMPTY_MESSAGE = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';
  let MAX_LEN = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 15;
  const message = channel.lastMessage;
  if (!message) return EMPTY_MESSAGE;

  if (message.isFileMessage()) {
    const extIdx = message.name.lastIndexOf('.');

    if (extIdx > -1) {
      const file = message.name.slice(0, extIdx);
      const ext = message.name.slice(extIdx);
      return truncate(file, {
        maxLen: MAX_LEN
      }) + ext;
    }

    return truncate(message.name, {
      maxLen: MAX_LEN
    });
  }

  if (message.isUserMessage()) {
    return message.message ?? EMPTY_MESSAGE;
  }

  if (message.isAdminMessage()) {
    return message.message ?? EMPTY_MESSAGE;
  }

  return EMPTY_MESSAGE;
};
//# sourceMappingURL=groupChannel.js.map