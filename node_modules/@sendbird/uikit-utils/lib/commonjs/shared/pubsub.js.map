{"version":3,"names":["createPubSub","label","eventPool","getSubscribeListenerPool","event","subscribe","listener","subscriber","name","id","Symbol","subscribeListenerPool","publish","args","ids","Object","getOwnPropertySymbols","setTimeout","forEach","err","onError","stack","description"],"sources":["pubsub.ts"],"sourcesContent":["export type SubscribeListener = ((...args: unknown[]) => void) & { onError?: (error: unknown) => void };\nexport type SubscribeListenerPool = Record<symbol, SubscribeListener>;\n\nexport const createPubSub = (label = 'pubsub') => {\n  const eventPool: Record<string, SubscribeListenerPool> = {};\n\n  const getSubscribeListenerPool = (event: string) => {\n    if (!eventPool[event]) eventPool[event] = {};\n    return eventPool[event];\n  };\n\n  return {\n    subscribe: (event: string, listener: SubscribeListener, subscriber = '') => {\n      const name = `${label}_${event}_${subscriber}`;\n      const id = Symbol(name);\n\n      const subscribeListenerPool = getSubscribeListenerPool(event);\n      subscribeListenerPool[id] = listener;\n\n      return () => {\n        delete getSubscribeListenerPool(event)[id];\n      };\n    },\n    publish: (event: string, ...args: unknown[]) => {\n      const subscribeListenerPool = getSubscribeListenerPool(event);\n      const ids = Object.getOwnPropertySymbols(subscribeListenerPool);\n      setTimeout(() => {\n        ids.forEach((id) => {\n          const listener = subscribeListenerPool[id];\n          try {\n            listener(...args);\n          } catch (err: unknown) {\n            if (listener.onError) {\n              (err as Error).stack += `\\npubsub error: ${id.description}`;\n              listener.onError(err);\n            }\n          }\n        });\n      }, 0);\n    },\n  };\n};\n"],"mappings":";;;;;;;AAGO,MAAMA,YAAY,GAAG,YAAsB;EAAA,IAArBC,KAAqB,uEAAb,QAAa;EAChD,MAAMC,SAAgD,GAAG,EAAzD;;EAEA,MAAMC,wBAAwB,GAAIC,KAAD,IAAmB;IAClD,IAAI,CAACF,SAAS,CAACE,KAAD,CAAd,EAAuBF,SAAS,CAACE,KAAD,CAAT,GAAmB,EAAnB;IACvB,OAAOF,SAAS,CAACE,KAAD,CAAhB;EACD,CAHD;;EAKA,OAAO;IACLC,SAAS,EAAE,UAACD,KAAD,EAAgBE,QAAhB,EAAiE;MAAA,IAApBC,UAAoB,uEAAP,EAAO;MAC1E,MAAMC,IAAI,GAAI,GAAEP,KAAM,IAAGG,KAAM,IAAGG,UAAW,EAA7C;MACA,MAAME,EAAE,GAAGC,MAAM,CAACF,IAAD,CAAjB;MAEA,MAAMG,qBAAqB,GAAGR,wBAAwB,CAACC,KAAD,CAAtD;MACAO,qBAAqB,CAACF,EAAD,CAArB,GAA4BH,QAA5B;MAEA,OAAO,MAAM;QACX,OAAOH,wBAAwB,CAACC,KAAD,CAAxB,CAAgCK,EAAhC,CAAP;MACD,CAFD;IAGD,CAXI;IAYLG,OAAO,EAAE,UAACR,KAAD,EAAuC;MAAA,kCAApBS,IAAoB;QAApBA,IAAoB;MAAA;;MAC9C,MAAMF,qBAAqB,GAAGR,wBAAwB,CAACC,KAAD,CAAtD;MACA,MAAMU,GAAG,GAAGC,MAAM,CAACC,qBAAP,CAA6BL,qBAA7B,CAAZ;MACAM,UAAU,CAAC,MAAM;QACfH,GAAG,CAACI,OAAJ,CAAaT,EAAD,IAAQ;UAClB,MAAMH,QAAQ,GAAGK,qBAAqB,CAACF,EAAD,CAAtC;;UACA,IAAI;YACFH,QAAQ,CAAC,GAAGO,IAAJ,CAAR;UACD,CAFD,CAEE,OAAOM,GAAP,EAAqB;YACrB,IAAIb,QAAQ,CAACc,OAAb,EAAsB;cACnBD,GAAD,CAAeE,KAAf,IAAyB,mBAAkBZ,EAAE,CAACa,WAAY,EAA1D;cACAhB,QAAQ,CAACc,OAAT,CAAiBD,GAAjB;YACD;UACF;QACF,CAVD;MAWD,CAZS,EAYP,CAZO,CAAV;IAaD;EA5BI,CAAP;AA8BD,CAtCM"}