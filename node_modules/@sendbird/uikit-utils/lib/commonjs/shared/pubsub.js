"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createPubSub = void 0;

const createPubSub = function () {
  let label = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'pubsub';
  const eventPool = {};

  const getSubscribeListenerPool = event => {
    if (!eventPool[event]) eventPool[event] = {};
    return eventPool[event];
  };

  return {
    subscribe: function (event, listener) {
      let subscriber = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';
      const name = `${label}_${event}_${subscriber}`;
      const id = Symbol(name);
      const subscribeListenerPool = getSubscribeListenerPool(event);
      subscribeListenerPool[id] = listener;
      return () => {
        delete getSubscribeListenerPool(event)[id];
      };
    },
    publish: function (event) {
      for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        args[_key - 1] = arguments[_key];
      }

      const subscribeListenerPool = getSubscribeListenerPool(event);
      const ids = Object.getOwnPropertySymbols(subscribeListenerPool);
      setTimeout(() => {
        ids.forEach(id => {
          const listener = subscribeListenerPool[id];

          try {
            listener(...args);
          } catch (err) {
            if (listener.onError) {
              err.stack += `\npubsub error: ${id.description}`;
              listener.onError(err);
            }
          }
        });
      }, 0);
    }
  };
};

exports.createPubSub = createPubSub;
//# sourceMappingURL=pubsub.js.map