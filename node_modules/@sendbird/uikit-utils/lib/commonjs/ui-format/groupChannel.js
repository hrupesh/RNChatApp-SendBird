"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getGroupChannelTitle = exports.getGroupChannelPreviewTime = exports.getGroupChannelLastMessage = void 0;

var _dateFns = require("date-fns");

var _common = require("./common");

const getGroupChannelTitle = function (currentUserId, channel) {
  let EMPTY_USERNAME = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '(No name)';
  let NO_MEMBERS = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : '(No members)';
  let DEFAULT_CHANNEL_NAME = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 'Group Channel';
  if (channel.name !== DEFAULT_CHANNEL_NAME && channel.name !== '') return channel.name;
  if (channel.memberCount === 1) return NO_MEMBERS;
  return channel.members.filter(_ref => {
    let {
      userId
    } = _ref;
    return userId !== currentUserId;
  }).map(_ref2 => {
    let {
      nickname
    } = _ref2;
    return nickname || EMPTY_USERNAME;
  }).join(', ');
};

exports.getGroupChannelTitle = getGroupChannelTitle;

const getGroupChannelPreviewTime = (channel, locale) => {
  var _channel$lastMessage;

  const timestamp = ((_channel$lastMessage = channel.lastMessage) === null || _channel$lastMessage === void 0 ? void 0 : _channel$lastMessage.createdAt) || channel.joinedAt * 1000 || channel.createdAt;
  if ((0, _dateFns.isToday)(timestamp)) return (0, _dateFns.format)(timestamp, 'p', {
    locale
  });
  if ((0, _dateFns.isYesterday)(timestamp)) return 'Yesterday';
  if ((0, _dateFns.isThisYear)(timestamp)) return (0, _dateFns.format)(timestamp, 'MMM dd', {
    locale
  });
  return (0, _dateFns.format)(timestamp, 'yyyy/MM/dd', {
    locale
  });
};

exports.getGroupChannelPreviewTime = getGroupChannelPreviewTime;

const getGroupChannelLastMessage = function (channel) {
  let EMPTY_MESSAGE = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';
  let MAX_LEN = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 15;
  const message = channel.lastMessage;
  if (!message) return EMPTY_MESSAGE;

  if (message.isFileMessage()) {
    const extIdx = message.name.lastIndexOf('.');

    if (extIdx > -1) {
      const file = message.name.slice(0, extIdx);
      const ext = message.name.slice(extIdx);
      return (0, _common.truncate)(file, {
        maxLen: MAX_LEN
      }) + ext;
    }

    return (0, _common.truncate)(message.name, {
      maxLen: MAX_LEN
    });
  }

  if (message.isUserMessage()) {
    return message.message ?? EMPTY_MESSAGE;
  }

  if (message.isAdminMessage()) {
    return message.message ?? EMPTY_MESSAGE;
  }

  return EMPTY_MESSAGE;
};

exports.getGroupChannelLastMessage = getGroupChannelLastMessage;
//# sourceMappingURL=groupChannel.js.map